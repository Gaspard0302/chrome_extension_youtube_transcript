import{D as li}from"./providers-DGP2A9J8.js";var Kt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ui(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Za="vercel.ai.error",ci=Symbol.for(Za),Va,di=class Ba extends Error{constructor({name:t,message:n,cause:r}){super(n),this[Va]=!0,this.name=t,this.cause=r}static isInstance(t){return Ba.hasMarker(t,Za)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}};Va=ci;var $=di,Ja="AI_APICallError",Ha=`vercel.ai.error.${Ja}`,pi=Symbol.for(Ha),za,xe=class extends ${constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:a,responseBody:s,cause:o,isRetryable:i=r!=null&&(r===408||r===409||r===429||r>=500),data:u}){super({name:Ja,message:e,cause:o}),this[za]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=a,this.responseBody=s,this.isRetryable=i,this.data=u}static isInstance(e){return $.hasMarker(e,Ha)}};za=pi;var Ga="AI_EmptyResponseBodyError",Wa=`vercel.ai.error.${Ga}`,fi=Symbol.for(Wa),Ya,Ka=class extends ${constructor({message:e="Empty response body"}={}){super({name:Ga,message:e}),this[Ya]=!0}static isInstance(e){return $.hasMarker(e,Wa)}};Ya=fi;function Zt(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Xa="AI_InvalidArgumentError",Qa=`vercel.ai.error.${Xa}`,hi=Symbol.for(Qa),es,ts=class extends ${constructor({message:t,cause:n,argument:r}){super({name:Xa,message:t,cause:n}),this[es]=!0,this.argument=r}static isInstance(t){return $.hasMarker(t,Qa)}};es=hi;var ns="AI_InvalidPromptError",rs=`vercel.ai.error.${ns}`,mi=Symbol.for(rs),as,qe=class extends ${constructor({prompt:e,message:t,cause:n}){super({name:ns,message:`Invalid prompt: ${t}`,cause:n}),this[as]=!0,this.prompt=e}static isInstance(e){return $.hasMarker(e,rs)}};as=mi;var ss="AI_InvalidResponseDataError",os=`vercel.ai.error.${ss}`,gi=Symbol.for(os),is,ht=class extends ${constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:ss,message:t}),this[is]=!0,this.data=e}static isInstance(e){return $.hasMarker(e,os)}};is=gi;var ls="AI_JSONParseError",us=`vercel.ai.error.${ls}`,yi=Symbol.for(us),cs,tn=class extends ${constructor({text:e,cause:t}){super({name:ls,message:`JSON parsing failed: Text: ${e}.
Error message: ${Zt(t)}`,cause:t}),this[cs]=!0,this.text=e}static isInstance(e){return $.hasMarker(e,us)}};cs=yi;var ds="AI_LoadAPIKeyError",ps=`vercel.ai.error.${ds}`,vi=Symbol.for(ps),fs,Xt=class extends ${constructor({message:e}){super({name:ds,message:e}),this[fs]=!0}static isInstance(e){return $.hasMarker(e,ps)}};fs=vi;var hs="AI_NoSuchModelError",ms=`vercel.ai.error.${hs}`,_i=Symbol.for(ms),gs,ys=class extends ${constructor({errorName:e=hs,modelId:t,modelType:n,message:r=`No such ${n}: ${t}`}){super({name:e,message:r}),this[gs]=!0,this.modelId=t,this.modelType=n}static isInstance(e){return $.hasMarker(e,ms)}};gs=_i;var vs="AI_TooManyEmbeddingValuesForCallError",_s=`vercel.ai.error.${vs}`,bi=Symbol.for(_s),bs,Cn=class extends ${constructor(e){super({name:vs,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[bs]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return $.hasMarker(e,_s)}};bs=bi;var ws="AI_TypeValidationError",xs=`vercel.ai.error.${ws}`,wi=Symbol.for(xs),ks,xi=class er extends ${constructor({value:t,cause:n}){super({name:ws,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Zt(n)}`,cause:n}),this[ks]=!0,this.value=t}static isInstance(t){return $.hasMarker(t,xs)}static wrap({value:t,cause:n}){return er.isInstance(n)&&n.value===t?n:new er({value:t,cause:n})}};ks=wi;var nn=xi,Ts="AI_UnsupportedFunctionalityError",Ss=`vercel.ai.error.${Ts}`,ki=Symbol.for(Ss),Is,B=class extends ${constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Ts,message:t}),this[Is]=!0,this.functionality=e}static isInstance(e){return $.hasMarker(e,Ss)}};Is=ki;let Ti=(e,t=21)=>(n=t)=>{let r="",a=n|0;for(;a--;)r+=e[Math.random()*e.length|0];return r};var vt={exports:{}};const Si=typeof Buffer<"u",Yr=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,Kr=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function Cs(e,t,n){n==null&&t!==null&&typeof t=="object"&&(n=t,t=void 0),Si&&Buffer.isBuffer(e)&&(e=e.toString()),e&&e.charCodeAt(0)===65279&&(e=e.slice(1));const r=JSON.parse(e,t);if(r===null||typeof r!="object")return r;const a=n&&n.protoAction||"error",s=n&&n.constructorAction||"error";if(a==="ignore"&&s==="ignore")return r;if(a!=="ignore"&&s!=="ignore"){if(Yr.test(e)===!1&&Kr.test(e)===!1)return r}else if(a!=="ignore"&&s==="ignore"){if(Yr.test(e)===!1)return r}else if(Kr.test(e)===!1)return r;return As(r,{protoAction:a,constructorAction:s,safe:n&&n.safe})}function As(e,{protoAction:t="error",constructorAction:n="error",safe:r}={}){let a=[e];for(;a.length;){const s=a;a=[];for(const o of s){if(t!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"__proto__")){if(r===!0)return null;if(t==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.__proto__}if(n!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"constructor")&&Object.prototype.hasOwnProperty.call(o.constructor,"prototype")){if(r===!0)return null;if(n==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.constructor}for(const i in o){const u=o[i];u&&typeof u=="object"&&a.push(u)}}}return e}function _r(e,t,n){const r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return Cs(e,t,n)}finally{Error.stackTraceLimit=r}}function Ii(e,t){const n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return Cs(e,t,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=n}}vt.exports=_r;vt.exports.default=_r;vt.exports.parse=_r;vt.exports.safeParse=Ii;vt.exports.scan=As;var Ci=vt.exports;const br=ui(Ci);var Ai={};function te(...e){return e.reduce((t,n)=>({...t,...n??{}}),{})}function Ri(e){return new ReadableStream({async pull(t){try{const{value:n,done:r}=await e.next();r?t.close():t.enqueue(n)}catch(n){t.error(n)}},cancel(){}})}async function Ei(e){return e==null?Promise.resolve():new Promise(t=>setTimeout(t,e))}function Ni(){let e="",t,n=[],r,a;function s(u,l){if(u===""){o(l);return}if(u.startsWith(":"))return;const c=u.indexOf(":");if(c===-1){i(u,"");return}const h=u.slice(0,c),d=c+1,g=d<u.length&&u[d]===" "?u.slice(d+1):u.slice(d);i(h,g)}function o(u){n.length>0&&(u.enqueue({event:t,data:n.join(`
`),id:r,retry:a}),n=[],t=void 0,a=void 0)}function i(u,l){switch(u){case"event":t=l;break;case"data":n.push(l);break;case"id":r=l;break;case"retry":const c=parseInt(l,10);isNaN(c)||(a=c);break}}return new TransformStream({transform(u,l){const{lines:c,incompleteLine:h}=Oi(e,u);e=h;for(let d=0;d<c.length;d++)s(c[d],l)},flush(u){s(e,u),o(u)}})}function Oi(e,t){const n=[];let r=e;for(let a=0;a<t.length;){const s=t[a++];s===`
`?(n.push(r),r=""):s==="\r"?(n.push(r),r="",t[a]===`
`&&a++):r+=s}return{lines:n,incompleteLine:r}}function _t(e){const t={};return e.headers.forEach((n,r)=>{t[r]=n}),t}var ot=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const a=Ti(n,t);if(e==null)return a;if(n.includes(r))throw new ts({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return s=>`${e}${r}${a(s)}`},ve=ot();function Pi(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function Mi(e){return Object.fromEntries(Object.entries(e).filter(([t,n])=>n!=null))}function en(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function Vt({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:r}){if(typeof e=="string")return e;if(e!=null)throw new Xt({message:`${r} API key must be a string.`});if(typeof process>"u")throw new Xt({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(e=Ai[t],e==null)throw new Xt({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new Xt({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var rn=Symbol.for("vercel.ai.validator");function ji(e){return{[rn]:!0,validate:e}}function Di(e){return typeof e=="object"&&e!==null&&rn in e&&e[rn]===!0&&"validate"in e}function $i(e){return Di(e)?e:Li(e)}function Li(e){return ji(t=>{const n=e.safeParse(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function Ui({value:e,schema:t}){const n=bt({value:e,schema:t});if(!n.success)throw nn.wrap({value:e,cause:n.error});return n.value}function bt({value:e,schema:t}){const n=$i(t);try{if(n.validate==null)return{success:!0,value:e};const r=n.validate(e);return r.success?r:{success:!1,error:nn.wrap({value:e,cause:r.error})}}catch(r){return{success:!1,error:nn.wrap({value:e,cause:r})}}}function qi({text:e,schema:t}){try{const n=br.parse(e);return t==null?n:Ui({value:n,schema:t})}catch(n){throw tn.isInstance(n)||nn.isInstance(n)?n:new tn({text:e,cause:n})}}function tt({text:e,schema:t}){try{const n=br.parse(e);if(t==null)return{success:!0,value:n,rawValue:n};const r=bt({value:n,schema:t});return r.success?{...r,rawValue:n}:r}catch(n){return{success:!1,error:tn.isInstance(n)?n:new tn({text:e,cause:n})}}}function an(e){try{return br.parse(e),!0}catch{return!1}}function it({provider:e,providerOptions:t,schema:n}){if((t==null?void 0:t[e])==null)return;const r=bt({value:t[e],schema:n});if(!r.success)throw new ts({argument:"providerOptions",message:`invalid ${e} provider options`,cause:r.error});return r.value}var Fi=()=>globalThis.fetch,ne=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:a,abortSignal:s,fetch:o})=>Es({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:a,abortSignal:s,fetch:o}),Rs=async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:a,abortSignal:s,fetch:o})=>Es({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:a,abortSignal:s,fetch:o}),Es=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:a,abortSignal:s,fetch:o=Fi()})=>{try{const i=await o(e,{method:"POST",headers:Mi(t),body:n.content,signal:s}),u=_t(i);if(!i.ok){let l;try{l=await a({response:i,url:e,requestBodyValues:n.values})}catch(c){throw en(c)||xe.isInstance(c)?c:new xe({message:"Failed to process error response",cause:c,statusCode:i.status,url:e,responseHeaders:u,requestBodyValues:n.values})}throw l.value}try{return await r({response:i,url:e,requestBodyValues:n.values})}catch(l){throw l instanceof Error&&(en(l)||xe.isInstance(l))?l:new xe({message:"Failed to process successful response",cause:l,statusCode:i.status,url:e,responseHeaders:u,requestBodyValues:n.values})}}catch(i){if(en(i))throw i;if(i instanceof TypeError&&i.message==="fetch failed"){const u=i.cause;if(u!=null)throw new xe({message:`Cannot connect to API: ${u.message}`,cause:u,url:e,requestBodyValues:n.values,isRetryable:!0})}throw i}};async function sn(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}var wt=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:a,requestBodyValues:s})=>{const o=await r.text(),i=_t(r);if(o.trim()==="")return{responseHeaders:i,value:new xe({message:r.statusText,url:a,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:n==null?void 0:n(r)})};try{const u=qi({text:o,schema:e});return{responseHeaders:i,value:new xe({message:t(u),url:a,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:o,data:u,isRetryable:n==null?void 0:n(r,u)})}}catch{return{responseHeaders:i,value:new xe({message:r.statusText,url:a,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:n==null?void 0:n(r)})}}},lt=e=>async({response:t})=>{const n=_t(t);if(t.body==null)throw new Ka({});return{responseHeaders:n,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(Ni()).pipeThrough(new TransformStream({transform({data:r},a){r!=="[DONE]"&&a.enqueue(tt({text:r,schema:e}))}}))}},ge=e=>async({response:t,url:n,requestBodyValues:r})=>{const a=await t.text(),s=tt({text:a,schema:e}),o=_t(t);if(!s.success)throw new xe({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:o,responseBody:a,url:n,requestBodyValues:r});return{responseHeaders:o,value:s.value,rawValue:s.rawValue}},Zi=()=>async({response:e,url:t,requestBodyValues:n})=>{const r=_t(e);if(!e.body)throw new xe({message:"Response body is empty",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0});try{const a=await e.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(a)}}catch(a){throw new xe({message:"Failed to read response as array buffer",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0,cause:a})}},{btoa:Vi,atob:Bi}=globalThis;function Bt(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=Bi(t);return Uint8Array.from(n,r=>r.codePointAt(0))}function De(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return Vi(t)}function xt(e){return e==null?void 0:e.replace(/\/$/,"")}const Ji=Symbol("Let zodToJsonSchema decide on which parser to use"),Xr={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Hi=e=>typeof e=="string"?{...Xr,name:e}:{...Xr,...e},zi=e=>{const t=Hi(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function Ns(e,t,n,r){r!=null&&r.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function G(e,t,n,r,a){e[t]=n,Ns(e,t,r,a)}const Os=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};var V;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const s={};for(const o of a)s[o]=o;return s},e.getValidEnumValues=a=>{const s=e.objectKeys(a).filter(i=>typeof a[a[i]]!="number"),o={};for(const i of s)o[i]=a[i];return e.objectValues(o)},e.objectValues=a=>e.objectKeys(a).map(function(s){return a[s]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const s=[];for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&s.push(o);return s},e.find=(a,s)=>{for(const o of a)if(s(o))return o},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,s=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}e.joinValues=r,e.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s})(V||(V={}));var Qr;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(Qr||(Qr={}));const P=V.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ze=e=>{switch(typeof e){case"undefined":return P.undefined;case"string":return P.string;case"number":return Number.isNaN(e)?P.nan:P.number;case"boolean":return P.boolean;case"function":return P.function;case"bigint":return P.bigint;case"symbol":return P.symbol;case"object":return Array.isArray(e)?P.array:e===null?P.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?P.promise:typeof Map<"u"&&e instanceof Map?P.map:typeof Set<"u"&&e instanceof Set?P.set:typeof Date<"u"&&e instanceof Date?P.date:P.object;default:return P.unknown}},T=V.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Be extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(s){return s.message},r={_errors:[]},a=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)r._errors.push(n(o));else{let i=r,u=0;for(;u<o.path.length;){const l=o.path[u];u===o.path.length-1?(i[l]=i[l]||{_errors:[]},i[l]._errors.push(n(o))):i[l]=i[l]||{_errors:[]},i=i[l],u++}}};return a(this),r}static assert(t){if(!(t instanceof Be))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,V.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const s=a.path[0];n[s]=n[s]||[],n[s].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}Be.create=e=>new Be(e);const tr=(e,t)=>{let n;switch(e.code){case T.invalid_type:e.received===P.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case T.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,V.jsonStringifyReplacer)}`;break;case T.unrecognized_keys:n=`Unrecognized key(s) in object: ${V.joinValues(e.keys,", ")}`;break;case T.invalid_union:n="Invalid input";break;case T.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${V.joinValues(e.options)}`;break;case T.invalid_enum_value:n=`Invalid enum value. Expected ${V.joinValues(e.options)}, received '${e.received}'`;break;case T.invalid_arguments:n="Invalid function arguments";break;case T.invalid_return_type:n="Invalid function return type";break;case T.invalid_date:n="Invalid date";break;case T.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:V.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case T.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case T.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case T.custom:n="Invalid input";break;case T.invalid_intersection_types:n="Intersection results could not be merged";break;case T.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case T.not_finite:n="Number must be finite";break;default:n=t.defaultError,V.assertNever(e)}return{message:n}};let Gi=tr;function Wi(){return Gi}const Yi=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,s=[...n,...a.path||[]],o={...a,path:s};if(a.message!==void 0)return{...a,path:s,message:a.message};let i="";const u=r.filter(l=>!!l).slice().reverse();for(const l of u)i=l(o,{data:t,defaultError:i}).message;return{...a,path:s,message:i}};function N(e,t){const n=Wi(),r=Yi({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===tr?void 0:tr].filter(a=>!!a)});e.common.issues.push(r)}class me{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return L;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const s=await a.key,o=await a.value;r.push({key:s,value:o})}return me.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:s,value:o}=a;if(s.status==="aborted"||o.status==="aborted")return L;s.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||a.alwaysSet)&&(r[s.value]=o.value)}return{status:t.value,value:r}}}const L=Object.freeze({status:"aborted"}),At=e=>({status:"dirty",value:e}),Se=e=>({status:"valid",value:e}),ea=e=>e.status==="aborted",ta=e=>e.status==="dirty",mt=e=>e.status==="valid",on=e=>typeof Promise<"u"&&e instanceof Promise;var M;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(M||(M={}));class $e{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const na=(e,t)=>{if(mt(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Be(e.common.issues);return this._error=n,this._error}}};function U(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(o,i)=>{const{message:u}=e;return o.code==="invalid_enum_value"?{message:u??i.defaultError}:typeof i.data>"u"?{message:u??r??i.defaultError}:o.code!=="invalid_type"?{message:i.defaultError}:{message:u??n??i.defaultError}},description:a}}class F{get description(){return this._def.description}_getType(t){return ze(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:ze(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new me,ctx:{common:t.parent.common,data:t.data,parsedType:ze(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(on(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ze(t)},a=this._parseSync({data:t,path:r.path,parent:r});return na(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ze(t)};if(!this["~standard"].async)try{const s=this._parseSync({data:t,path:[],parent:n});return mt(s)?{value:s.value}:{issues:n.common.issues}}catch(s){(a=(r=s==null?void 0:s.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(s=>mt(s)?{value:s.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ze(t)},a=this._parse({data:t,path:r.path,parent:r}),s=await(on(a)?a:Promise.resolve(a));return na(r,s)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,s)=>{const o=t(a),i=()=>s.addIssue({code:T.custom,...r(a)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(i(),!1)):o?!0:(i(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new at({schema:this,typeName:S.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Ze.create(this,this._def)}nullable(){return st.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return je.create(this)}promise(){return mn.create(this,this._def)}or(t){return cn.create([this,t],this._def)}and(t){return dn.create(this,t,this._def)}transform(t){return new at({...U(this._def),schema:this,typeName:S.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new gn({...U(this._def),innerType:this,defaultValue:n,typeName:S.ZodDefault})}brand(){return new Ds({typeName:S.ZodBranded,type:this,...U(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new yn({...U(this._def),innerType:this,catchValue:n,typeName:S.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return xr.create(this,t)}readonly(){return vn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ki=/^c[^\s-]{8,}$/i,Xi=/^[0-9a-z]+$/,Qi=/^[0-9A-HJKMNP-TV-Z]{26}$/i,el=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,tl=/^[a-z0-9_-]{21}$/i,nl=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,rl=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,al=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,sl="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Bn;const ol=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,il=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ll=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ul=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,cl=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dl=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ps="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",pl=new RegExp(`^${Ps}$`);function Ms(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function fl(e){return new RegExp(`^${Ms(e)}$`)}function hl(e){let t=`${Ps}T${Ms(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function ml(e,t){return!!((t==="v4"||!t)&&ol.test(e)||(t==="v6"||!t)&&ll.test(e))}function gl(e,t){if(!nl.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function yl(e,t){return!!((t==="v4"||!t)&&il.test(e)||(t==="v6"||!t)&&ul.test(e))}class Fe extends F{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==P.string){const s=this._getOrReturnCtx(t);return N(s,{code:T.invalid_type,expected:P.string,received:s.parsedType}),L}const r=new me;let a;for(const s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(a=this._getOrReturnCtx(t,a),N(a,{code:T.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")t.data.length>s.value&&(a=this._getOrReturnCtx(t,a),N(a,{code:T.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const o=t.data.length>s.value,i=t.data.length<s.value;(o||i)&&(a=this._getOrReturnCtx(t,a),o?N(a,{code:T.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&N(a,{code:T.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")al.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"email",code:T.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")Bn||(Bn=new RegExp(sl,"u")),Bn.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"emoji",code:T.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")el.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"uuid",code:T.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")tl.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"nanoid",code:T.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")Ki.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"cuid",code:T.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")Xi.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"cuid2",code:T.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")Qi.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"ulid",code:T.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),N(a,{validation:"url",code:T.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"regex",code:T.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(t,a),N(a,{code:T.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(a=this._getOrReturnCtx(t,a),N(a,{code:T.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(a=this._getOrReturnCtx(t,a),N(a,{code:T.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?hl(s).test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{code:T.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?pl.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{code:T.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?fl(s).test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{code:T.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?rl.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"duration",code:T.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?ml(t.data,s.version)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"ip",code:T.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?gl(t.data,s.alg)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"jwt",code:T.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?yl(t.data,s.version)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"cidr",code:T.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?cl.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"base64",code:T.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?dl.test(t.data)||(a=this._getOrReturnCtx(t,a),N(a,{validation:"base64url",code:T.invalid_string,message:s.message}),r.dirty()):V.assertNever(s);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:T.invalid_string,...M.errToObj(r)})}_addCheck(t){return new Fe({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...M.errToObj(t)})}url(t){return this._addCheck({kind:"url",...M.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...M.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...M.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...M.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...M.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...M.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...M.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...M.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...M.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...M.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...M.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...M.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...M.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...M.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...M.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...M.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...M.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...M.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...M.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...M.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...M.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...M.errToObj(n)})}nonempty(t){return this.min(1,M.errToObj(t))}trim(){return new Fe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Fe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Fe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Fe.create=e=>new Fe({checks:[],typeName:S.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...U(e)});function vl(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,s=Number.parseInt(e.toFixed(a).replace(".","")),o=Number.parseInt(t.toFixed(a).replace(".",""));return s%o/10**a}class gt extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==P.number){const s=this._getOrReturnCtx(t);return N(s,{code:T.invalid_type,expected:P.number,received:s.parsedType}),L}let r;const a=new me;for(const s of this._def.checks)s.kind==="int"?V.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),N(r,{code:T.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),N(r,{code:T.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),N(r,{code:T.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="multipleOf"?vl(t.data,s.value)!==0&&(r=this._getOrReturnCtx(t,r),N(r,{code:T.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),N(r,{code:T.not_finite,message:s.message}),a.dirty()):V.assertNever(s);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,M.toString(n))}gt(t,n){return this.setLimit("min",t,!1,M.toString(n))}lte(t,n){return this.setLimit("max",t,!0,M.toString(n))}lt(t,n){return this.setLimit("max",t,!1,M.toString(n))}setLimit(t,n,r,a){return new gt({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:M.toString(a)}]})}_addCheck(t){return new gt({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:M.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:M.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:M.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:M.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:M.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:M.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:M.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:M.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:M.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&V.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}}gt.create=e=>new gt({checks:[],typeName:S.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...U(e)});class Et extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==P.bigint)return this._getInvalidInput(t);let r;const a=new me;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),N(r,{code:T.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),N(r,{code:T.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),N(r,{code:T.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):V.assertNever(s);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return N(n,{code:T.invalid_type,expected:P.bigint,received:n.parsedType}),L}gte(t,n){return this.setLimit("min",t,!0,M.toString(n))}gt(t,n){return this.setLimit("min",t,!1,M.toString(n))}lte(t,n){return this.setLimit("max",t,!0,M.toString(n))}lt(t,n){return this.setLimit("max",t,!1,M.toString(n))}setLimit(t,n,r,a){return new Et({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:M.toString(a)}]})}_addCheck(t){return new Et({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:M.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:M.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:M.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:M.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:M.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Et.create=e=>new Et({checks:[],typeName:S.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...U(e)});class nr extends F{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==P.boolean){const r=this._getOrReturnCtx(t);return N(r,{code:T.invalid_type,expected:P.boolean,received:r.parsedType}),L}return Se(t.data)}}nr.create=e=>new nr({typeName:S.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...U(e)});class ln extends F{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==P.date){const s=this._getOrReturnCtx(t);return N(s,{code:T.invalid_type,expected:P.date,received:s.parsedType}),L}if(Number.isNaN(t.data.getTime())){const s=this._getOrReturnCtx(t);return N(s,{code:T.invalid_date}),L}const r=new me;let a;for(const s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(a=this._getOrReturnCtx(t,a),N(a,{code:T.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(a=this._getOrReturnCtx(t,a),N(a,{code:T.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):V.assertNever(s);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new ln({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:M.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:M.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}ln.create=e=>new ln({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:S.ZodDate,...U(e)});class ra extends F{_parse(t){if(this._getType(t)!==P.symbol){const r=this._getOrReturnCtx(t);return N(r,{code:T.invalid_type,expected:P.symbol,received:r.parsedType}),L}return Se(t.data)}}ra.create=e=>new ra({typeName:S.ZodSymbol,...U(e)});class rr extends F{_parse(t){if(this._getType(t)!==P.undefined){const r=this._getOrReturnCtx(t);return N(r,{code:T.invalid_type,expected:P.undefined,received:r.parsedType}),L}return Se(t.data)}}rr.create=e=>new rr({typeName:S.ZodUndefined,...U(e)});class un extends F{_parse(t){if(this._getType(t)!==P.null){const r=this._getOrReturnCtx(t);return N(r,{code:T.invalid_type,expected:P.null,received:r.parsedType}),L}return Se(t.data)}}un.create=e=>new un({typeName:S.ZodNull,...U(e)});class Nt extends F{constructor(){super(...arguments),this._any=!0}_parse(t){return Se(t.data)}}Nt.create=e=>new Nt({typeName:S.ZodAny,...U(e)});class ar extends F{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Se(t.data)}}ar.create=e=>new ar({typeName:S.ZodUnknown,...U(e)});class Ge extends F{_parse(t){const n=this._getOrReturnCtx(t);return N(n,{code:T.invalid_type,expected:P.never,received:n.parsedType}),L}}Ge.create=e=>new Ge({typeName:S.ZodNever,...U(e)});class aa extends F{_parse(t){if(this._getType(t)!==P.undefined){const r=this._getOrReturnCtx(t);return N(r,{code:T.invalid_type,expected:P.void,received:r.parsedType}),L}return Se(t.data)}}aa.create=e=>new aa({typeName:S.ZodVoid,...U(e)});class je extends F{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==P.array)return N(n,{code:T.invalid_type,expected:P.array,received:n.parsedType}),L;if(a.exactLength!==null){const o=n.data.length>a.exactLength.value,i=n.data.length<a.exactLength.value;(o||i)&&(N(n,{code:o?T.too_big:T.too_small,minimum:i?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(N(n,{code:T.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(N(n,{code:T.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((o,i)=>a.type._parseAsync(new $e(n,o,n.path,i)))).then(o=>me.mergeArray(r,o));const s=[...n.data].map((o,i)=>a.type._parseSync(new $e(n,o,n.path,i)));return me.mergeArray(r,s)}get element(){return this._def.type}min(t,n){return new je({...this._def,minLength:{value:t,message:M.toString(n)}})}max(t,n){return new je({...this._def,maxLength:{value:t,message:M.toString(n)}})}length(t,n){return new je({...this._def,exactLength:{value:t,message:M.toString(n)}})}nonempty(t){return this.min(1,t)}}je.create=(e,t)=>new je({type:e,minLength:null,maxLength:null,exactLength:null,typeName:S.ZodArray,...U(t)});function pt(e){if(e instanceof oe){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Ze.create(pt(r))}return new oe({...e._def,shape:()=>t})}else return e instanceof je?new je({...e._def,type:pt(e.element)}):e instanceof Ze?Ze.create(pt(e.unwrap())):e instanceof st?st.create(pt(e.unwrap())):e instanceof nt?nt.create(e.items.map(t=>pt(t))):e}class oe extends F{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=V.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==P.object){const l=this._getOrReturnCtx(t);return N(l,{code:T.invalid_type,expected:P.object,received:l.parsedType}),L}const{status:r,ctx:a}=this._processInputParams(t),{shape:s,keys:o}=this._getCached(),i=[];if(!(this._def.catchall instanceof Ge&&this._def.unknownKeys==="strip"))for(const l in a.data)o.includes(l)||i.push(l);const u=[];for(const l of o){const c=s[l],h=a.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new $e(a,h,a.path,l)),alwaysSet:l in a.data})}if(this._def.catchall instanceof Ge){const l=this._def.unknownKeys;if(l==="passthrough")for(const c of i)u.push({key:{status:"valid",value:c},value:{status:"valid",value:a.data[c]}});else if(l==="strict")i.length>0&&(N(a,{code:T.unrecognized_keys,keys:i}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const c of i){const h=a.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new $e(a,h,a.path,c)),alwaysSet:c in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const l=[];for(const c of u){const h=await c.key,d=await c.value;l.push({key:h,value:d,alwaysSet:c.alwaysSet})}return l}).then(l=>me.mergeObjectSync(r,l)):me.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(t){return M.errToObj,new oe({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var s,o;const a=((o=(s=this._def).errorMap)==null?void 0:o.call(s,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:M.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new oe({...this._def,unknownKeys:"strip"})}passthrough(){return new oe({...this._def,unknownKeys:"passthrough"})}extend(t){return new oe({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new oe({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:S.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new oe({...this._def,catchall:t})}pick(t){const n={};for(const r of V.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new oe({...this._def,shape:()=>n})}omit(t){const n={};for(const r of V.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new oe({...this._def,shape:()=>n})}deepPartial(){return pt(this)}partial(t){const n={};for(const r of V.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new oe({...this._def,shape:()=>n})}required(t){const n={};for(const r of V.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Ze;)s=s._def.innerType;n[r]=s}return new oe({...this._def,shape:()=>n})}keyof(){return js(V.objectKeys(this.shape))}}oe.create=(e,t)=>new oe({shape:()=>e,unknownKeys:"strip",catchall:Ge.create(),typeName:S.ZodObject,...U(t)});oe.strictCreate=(e,t)=>new oe({shape:()=>e,unknownKeys:"strict",catchall:Ge.create(),typeName:S.ZodObject,...U(t)});oe.lazycreate=(e,t)=>new oe({shape:e,unknownKeys:"strip",catchall:Ge.create(),typeName:S.ZodObject,...U(t)});class cn extends F{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(s){for(const i of s)if(i.result.status==="valid")return i.result;for(const i of s)if(i.result.status==="dirty")return n.common.issues.push(...i.ctx.common.issues),i.result;const o=s.map(i=>new Be(i.ctx.common.issues));return N(n,{code:T.invalid_union,unionErrors:o}),L}if(n.common.async)return Promise.all(r.map(async s=>{const o={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}})).then(a);{let s;const o=[];for(const u of r){const l={...n,common:{...n.common,issues:[]},parent:null},c=u._parseSync({data:n.data,path:n.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const i=o.map(u=>new Be(u));return N(n,{code:T.invalid_union,unionErrors:i}),L}}get options(){return this._def.options}}cn.create=(e,t)=>new cn({options:e,typeName:S.ZodUnion,...U(t)});const Ue=e=>e instanceof fn?Ue(e.schema):e instanceof at?Ue(e.innerType()):e instanceof hn?[e.value]:e instanceof rt?e.options:e instanceof or?V.objectValues(e.enum):e instanceof gn?Ue(e._def.innerType):e instanceof rr?[void 0]:e instanceof un?[null]:e instanceof Ze?[void 0,...Ue(e.unwrap())]:e instanceof st?[null,...Ue(e.unwrap())]:e instanceof Ds||e instanceof vn?Ue(e.unwrap()):e instanceof yn?Ue(e._def.innerType):[];class wr extends F{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==P.object)return N(n,{code:T.invalid_type,expected:P.object,received:n.parsedType}),L;const r=this.discriminator,a=n.data[r],s=this.optionsMap.get(a);return s?n.common.async?s._parseAsync({data:n.data,path:n.path,parent:n}):s._parseSync({data:n.data,path:n.path,parent:n}):(N(n,{code:T.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),L)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const a=new Map;for(const s of n){const o=Ue(s.shape[t]);if(!o.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const i of o){if(a.has(i))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(i)}`);a.set(i,s)}}return new wr({typeName:S.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:a,...U(r)})}}function sr(e,t){const n=ze(e),r=ze(t);if(e===t)return{valid:!0,data:e};if(n===P.object&&r===P.object){const a=V.objectKeys(t),s=V.objectKeys(e).filter(i=>a.indexOf(i)!==-1),o={...e,...t};for(const i of s){const u=sr(e[i],t[i]);if(!u.valid)return{valid:!1};o[i]=u.data}return{valid:!0,data:o}}else if(n===P.array&&r===P.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let s=0;s<e.length;s++){const o=e[s],i=t[s],u=sr(o,i);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return n===P.date&&r===P.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class dn extends F{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(s,o)=>{if(ea(s)||ea(o))return L;const i=sr(s.value,o.value);return i.valid?((ta(s)||ta(o))&&n.dirty(),{status:n.value,value:i.data}):(N(r,{code:T.invalid_intersection_types}),L)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,o])=>a(s,o)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}dn.create=(e,t,n)=>new dn({left:e,right:t,typeName:S.ZodIntersection,...U(n)});class nt extends F{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==P.array)return N(r,{code:T.invalid_type,expected:P.array,received:r.parsedType}),L;if(r.data.length<this._def.items.length)return N(r,{code:T.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),L;!this._def.rest&&r.data.length>this._def.items.length&&(N(r,{code:T.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const s=[...r.data].map((o,i)=>{const u=this._def.items[i]||this._def.rest;return u?u._parse(new $e(r,o,r.path,i)):null}).filter(o=>!!o);return r.common.async?Promise.all(s).then(o=>me.mergeArray(n,o)):me.mergeArray(n,s)}get items(){return this._def.items}rest(t){return new nt({...this._def,rest:t})}}nt.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new nt({items:e,typeName:S.ZodTuple,rest:null,...U(t)})};class pn extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==P.object)return N(r,{code:T.invalid_type,expected:P.object,received:r.parsedType}),L;const a=[],s=this._def.keyType,o=this._def.valueType;for(const i in r.data)a.push({key:s._parse(new $e(r,i,r.path,i)),value:o._parse(new $e(r,r.data[i],r.path,i)),alwaysSet:i in r.data});return r.common.async?me.mergeObjectAsync(n,a):me.mergeObjectSync(n,a)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof F?new pn({keyType:t,valueType:n,typeName:S.ZodRecord,...U(r)}):new pn({keyType:Fe.create(),valueType:t,typeName:S.ZodRecord,...U(n)})}}class sa extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==P.map)return N(r,{code:T.invalid_type,expected:P.map,received:r.parsedType}),L;const a=this._def.keyType,s=this._def.valueType,o=[...r.data.entries()].map(([i,u],l)=>({key:a._parse(new $e(r,i,r.path,[l,"key"])),value:s._parse(new $e(r,u,r.path,[l,"value"]))}));if(r.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const u of o){const l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return L;(l.status==="dirty"||c.status==="dirty")&&n.dirty(),i.set(l.value,c.value)}return{status:n.value,value:i}})}else{const i=new Map;for(const u of o){const l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return L;(l.status==="dirty"||c.status==="dirty")&&n.dirty(),i.set(l.value,c.value)}return{status:n.value,value:i}}}}sa.create=(e,t,n)=>new sa({valueType:t,keyType:e,typeName:S.ZodMap,...U(n)});class Ot extends F{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==P.set)return N(r,{code:T.invalid_type,expected:P.set,received:r.parsedType}),L;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(N(r,{code:T.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(N(r,{code:T.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const s=this._def.valueType;function o(u){const l=new Set;for(const c of u){if(c.status==="aborted")return L;c.status==="dirty"&&n.dirty(),l.add(c.value)}return{status:n.value,value:l}}const i=[...r.data.values()].map((u,l)=>s._parse(new $e(r,u,r.path,l)));return r.common.async?Promise.all(i).then(u=>o(u)):o(i)}min(t,n){return new Ot({...this._def,minSize:{value:t,message:M.toString(n)}})}max(t,n){return new Ot({...this._def,maxSize:{value:t,message:M.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}Ot.create=(e,t)=>new Ot({valueType:e,minSize:null,maxSize:null,typeName:S.ZodSet,...U(t)});class fn extends F{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}fn.create=(e,t)=>new fn({getter:e,typeName:S.ZodLazy,...U(t)});class hn extends F{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return N(n,{received:n.data,code:T.invalid_literal,expected:this._def.value}),L}return{status:"valid",value:t.data}}get value(){return this._def.value}}hn.create=(e,t)=>new hn({value:e,typeName:S.ZodLiteral,...U(t)});function js(e,t){return new rt({values:e,typeName:S.ZodEnum,...U(t)})}class rt extends F{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return N(n,{expected:V.joinValues(r),received:n.parsedType,code:T.invalid_type}),L}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return N(n,{received:n.data,code:T.invalid_enum_value,options:r}),L}return Se(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return rt.create(t,{...this._def,...n})}exclude(t,n=this._def){return rt.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}}rt.create=js;class or extends F{_parse(t){const n=V.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==P.string&&r.parsedType!==P.number){const a=V.objectValues(n);return N(r,{expected:V.joinValues(a),received:r.parsedType,code:T.invalid_type}),L}if(this._cache||(this._cache=new Set(V.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=V.objectValues(n);return N(r,{received:r.data,code:T.invalid_enum_value,options:a}),L}return Se(t.data)}get enum(){return this._def.values}}or.create=(e,t)=>new or({values:e,typeName:S.ZodNativeEnum,...U(t)});class mn extends F{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==P.promise&&n.common.async===!1)return N(n,{code:T.invalid_type,expected:P.promise,received:n.parsedType}),L;const r=n.parsedType===P.promise?n.data:Promise.resolve(n.data);return Se(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}}mn.create=(e,t)=>new mn({type:e,typeName:S.ZodPromise,...U(t)});class at extends F{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===S.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,s={addIssue:o=>{N(r,o),o.fatal?n.abort():n.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){const o=a.transform(r.data,s);if(r.common.async)return Promise.resolve(o).then(async i=>{if(n.value==="aborted")return L;const u=await this._def.schema._parseAsync({data:i,path:r.path,parent:r});return u.status==="aborted"?L:u.status==="dirty"||n.value==="dirty"?At(u.value):u});{if(n.value==="aborted")return L;const i=this._def.schema._parseSync({data:o,path:r.path,parent:r});return i.status==="aborted"?L:i.status==="dirty"||n.value==="dirty"?At(i.value):i}}if(a.type==="refinement"){const o=i=>{const u=a.refinement(i,s);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?L:(i.status==="dirty"&&n.dirty(),o(i.value),{status:n.value,value:i.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>i.status==="aborted"?L:(i.status==="dirty"&&n.dirty(),o(i.value).then(()=>({status:n.value,value:i.value}))))}if(a.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!mt(o))return L;const i=a.transform(o.value,s);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:i}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>mt(o)?Promise.resolve(a.transform(o.value,s)).then(i=>({status:n.value,value:i})):L);V.assertNever(a)}}at.create=(e,t,n)=>new at({schema:e,typeName:S.ZodEffects,effect:t,...U(n)});at.createWithPreprocess=(e,t,n)=>new at({schema:t,effect:{type:"preprocess",transform:e},typeName:S.ZodEffects,...U(n)});class Ze extends F{_parse(t){return this._getType(t)===P.undefined?Se(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Ze.create=(e,t)=>new Ze({innerType:e,typeName:S.ZodOptional,...U(t)});class st extends F{_parse(t){return this._getType(t)===P.null?Se(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}st.create=(e,t)=>new st({innerType:e,typeName:S.ZodNullable,...U(t)});class gn extends F{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===P.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}gn.create=(e,t)=>new gn({innerType:e,typeName:S.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...U(t)});class yn extends F{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return on(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Be(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Be(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}yn.create=(e,t)=>new yn({innerType:e,typeName:S.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...U(t)});class oa extends F{_parse(t){if(this._getType(t)!==P.nan){const r=this._getOrReturnCtx(t);return N(r,{code:T.invalid_type,expected:P.nan,received:r.parsedType}),L}return{status:"valid",value:t.data}}}oa.create=e=>new oa({typeName:S.ZodNaN,...U(e)});class Ds extends F{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class xr extends F{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?L:s.status==="dirty"?(n.dirty(),At(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?L:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new xr({in:t,out:n,typeName:S.ZodPipeline})}}class vn extends F{_parse(t){const n=this._def.innerType._parse(t),r=a=>(mt(a)&&(a.value=Object.freeze(a.value)),a);return on(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}}vn.create=(e,t)=>new vn({innerType:e,typeName:S.ZodReadonly,...U(t)});function ia(e,t){const n=typeof e=="function"?e(t):typeof e=="string"?{message:e}:e;return typeof n=="string"?{message:n}:n}function $s(e,t={},n){return e?Nt.create().superRefine((r,a)=>{const s=e(r);if(s instanceof Promise)return s.then(o=>{if(!o){const i=ia(t,r),u=i.fatal??n??!0;a.addIssue({code:"custom",...i,fatal:u})}});if(!s){const o=ia(t,r),i=o.fatal??n??!0;a.addIssue({code:"custom",...o,fatal:i})}}):Nt.create()}var S;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(S||(S={}));const _n=(e,t={message:`Input not instance of ${e.name}`})=>$s(n=>n instanceof e,t),p=Fe.create,w=gt.create,he=nr.create,_l=un.create,An=Nt.create,kt=ar.create;Ge.create;const O=je.create,f=oe.create,W=cn.create,Ve=wr.create;dn.create;const la=nt.create,yt=pn.create,bl=fn.create,A=hn.create,Ee=rt.create;mn.create;const le=Ze.create;st.create;function _e(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?Os(t,e.currentPath):t.join("/")}}function wl(e,t){var r,a,s;const n={type:"array"};return(r=e.type)!=null&&r._def&&((s=(a=e.type)==null?void 0:a._def)==null?void 0:s.typeName)!==S.ZodAny&&(n.items=z(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&G(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&G(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(G(n,"minItems",e.exactLength.value,e.exactLength.message,t),G(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function xl(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?G(n,"minimum",r.value,r.message,t):G(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),G(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?G(n,"maximum",r.value,r.message,t):G(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),G(n,"maximum",r.value,r.message,t));break;case"multipleOf":G(n,"multipleOf",r.value,r.message,t);break}return n}function kl(){return{type:"boolean"}}function Ls(e,t){return z(e.type._def,t)}const Tl=(e,t)=>z(e.innerType._def,t);function Us(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,s)=>Us(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Sl(e,t)}}const Sl=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":G(n,"minimum",r.value,r.message,t);break;case"max":G(n,"maximum",r.value,r.message,t);break}return n};function Il(e,t){return{...z(e.innerType._def,t),default:e.defaultValue()}}function Cl(e,t){return t.effectStrategy==="input"?z(e.schema._def,t):_e(t)}function Al(e){return{type:"string",enum:Array.from(e.values)}}const Rl=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function El(e,t){const n=[z(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),z(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(s=>!!s);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(s=>{if(Rl(s))a.push(...s.allOf),s.unevaluatedProperties===void 0&&(r=void 0);else{let o=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:i,...u}=s;o=u}else r=void 0;a.push(o)}}),a.length?{allOf:a,...r}:void 0}function Nl(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let Jn;const Ce={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Jn===void 0&&(Jn=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Jn),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function qs(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":G(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":G(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Ae(n,"email",r.message,t);break;case"format:idn-email":Ae(n,"idn-email",r.message,t);break;case"pattern:zod":fe(n,Ce.email,r.message,t);break}break;case"url":Ae(n,"uri",r.message,t);break;case"uuid":Ae(n,"uuid",r.message,t);break;case"regex":fe(n,r.regex,r.message,t);break;case"cuid":fe(n,Ce.cuid,r.message,t);break;case"cuid2":fe(n,Ce.cuid2,r.message,t);break;case"startsWith":fe(n,RegExp(`^${Hn(r.value,t)}`),r.message,t);break;case"endsWith":fe(n,RegExp(`${Hn(r.value,t)}$`),r.message,t);break;case"datetime":Ae(n,"date-time",r.message,t);break;case"date":Ae(n,"date",r.message,t);break;case"time":Ae(n,"time",r.message,t);break;case"duration":Ae(n,"duration",r.message,t);break;case"length":G(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t),G(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":{fe(n,RegExp(Hn(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&Ae(n,"ipv4",r.message,t),r.version!=="v4"&&Ae(n,"ipv6",r.message,t);break}case"base64url":fe(n,Ce.base64url,r.message,t);break;case"jwt":fe(n,Ce.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&fe(n,Ce.ipv4Cidr,r.message,t),r.version!=="v4"&&fe(n,Ce.ipv6Cidr,r.message,t);break}case"emoji":fe(n,Ce.emoji(),r.message,t);break;case"ulid":{fe(n,Ce.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Ae(n,"binary",r.message,t);break}case"contentEncoding:base64":{G(n,"contentEncoding","base64",r.message,t);break}case"pattern:zod":{fe(n,Ce.base64,r.message,t);break}}break}case"nanoid":fe(n,Ce.nanoid,r.message,t)}return n}function Hn(e,t){return t.patternStrategy==="escape"?Pl(e):e}const Ol=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Pl(e){let t="";for(let n=0;n<e.length;n++)Ol.has(e[n])||(t+="\\"),t+=e[n];return t}function Ae(e,t,n,r){var a;e.format||(a=e.anyOf)!=null&&a.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):G(e,"format",t,n,r)}function fe(e,t,n,r){var a;e.pattern||(a=e.allOf)!=null&&a.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:ua(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):G(e,"pattern",ua(t,r),n,r)}function ua(e,t){var u;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=n.i?e.source.toLowerCase():e.source;let a="",s=!1,o=!1,i=!1;for(let l=0;l<r.length;l++){if(s){a+=r[l],s=!1;continue}if(n.i){if(o){if(r[l].match(/[a-z]/)){i?(a+=r[l],a+=`${r[l-2]}-${r[l]}`.toUpperCase(),i=!1):r[l+1]==="-"&&((u=r[l+2])!=null&&u.match(/[a-z]/))?(a+=r[l],i=!0):a+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){a+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(n.m){if(r[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&r[l]==="."){a+=o?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}a+=r[l],r[l]==="\\"?s=!0:o&&r[l]==="]"?o=!1:!o&&r[l]==="["&&(o=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function Fs(e,t){var r,a,s,o,i,u;if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===S.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((l,c)=>({...l,[c]:z(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",c]})??_e(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:z(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return n;if(((a=e.keyType)==null?void 0:a._def.typeName)===S.ZodString&&((s=e.keyType._def.checks)!=null&&s.length)){const{type:l,...c}=qs(e.keyType._def,t);return{...n,propertyNames:c}}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===S.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(((i=e.keyType)==null?void 0:i._def.typeName)===S.ZodBranded&&e.keyType._def.type._def.typeName===S.ZodString&&((u=e.keyType._def.type._def.checks)!=null&&u.length)){const{type:l,...c}=Ls(e.keyType._def,t);return{...n,propertyNames:c}}}return n}function Ml(e,t){if(t.mapStrategy==="record")return Fs(e,t);const n=z(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||_e(t),r=z(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||_e(t);return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function jl(e){const t=e.values,r=Object.keys(e.values).filter(s=>typeof t[t[s]]!="number").map(s=>t[s]),a=Array.from(new Set(r.map(s=>typeof s)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function Dl(e){return e.target==="openAi"?void 0:{not:_e({...e,currentPath:[...e.currentPath,"not"]})}}function $l(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const bn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Ll(e,t){if(t.target==="openApi3")return ca(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in bn&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,s)=>{const o=bn[s._def.typeName];return o&&!a.includes(o)?[...a,o]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,s)=>{const o=typeof s._def.value;switch(o){case"string":case"number":case"boolean":return[...a,o];case"bigint":return[...a,"integer"];case"object":if(s._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((s,o,i)=>i.indexOf(s)===o);return{type:a.length>1?a:a[0],enum:n.reduce((s,o)=>s.includes(o._def.value)?s:[...s,o._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(s=>!r.includes(s))],[])};return ca(e,t)}const ca=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>z(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function Ul(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:bn[e.innerType._def.typeName],nullable:!0}:{type:[bn[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=z(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=z(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function ql(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",Ns(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?G(n,"minimum",r.value,r.message,t):G(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),G(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?G(n,"maximum",r.value,r.message,t):G(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),G(n,"maximum",r.value,r.message,t));break;case"multipleOf":G(n,"multipleOf",r.value,r.message,t);break}return n}function Fl(e,t){const n=t.target==="openAi",r={type:"object",properties:{}},a=[],s=e.shape();for(const i in s){let u=s[i];if(u===void 0||u._def===void 0)continue;let l=Vl(u);l&&n&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);const c=z(u._def,{...t,currentPath:[...t.currentPath,"properties",i],propertyPath:[...t.currentPath,"properties",i]});c!==void 0&&(r.properties[i]=c,l||a.push(i))}a.length&&(r.required=a);const o=Zl(e,t);return o!==void 0&&(r.additionalProperties=o),r}function Zl(e,t){if(e.catchall._def.typeName!=="ZodNever")return z(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function Vl(e){try{return e.isOptional()}catch{return!0}}const Bl=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return z(e.innerType._def,t);const n=z(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:_e(t)},n]}:_e(t)},Jl=(e,t)=>{if(t.pipeStrategy==="input")return z(e.in._def,t);if(t.pipeStrategy==="output")return z(e.out._def,t);const n=z(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=z(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function Hl(e,t){return z(e.type._def,t)}function zl(e,t){const r={type:"array",uniqueItems:!0,items:z(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&G(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&G(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}function Gl(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>z(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:z(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>z(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function Wl(e){return{not:_e(e)}}function Yl(e){return _e(e)}const Kl=(e,t)=>z(e.innerType._def,t),Xl=(e,t,n)=>{switch(t){case S.ZodString:return qs(e,n);case S.ZodNumber:return ql(e,n);case S.ZodObject:return Fl(e,n);case S.ZodBigInt:return xl(e,n);case S.ZodBoolean:return kl();case S.ZodDate:return Us(e,n);case S.ZodUndefined:return Wl(n);case S.ZodNull:return $l(n);case S.ZodArray:return wl(e,n);case S.ZodUnion:case S.ZodDiscriminatedUnion:return Ll(e,n);case S.ZodIntersection:return El(e,n);case S.ZodTuple:return Gl(e,n);case S.ZodRecord:return Fs(e,n);case S.ZodLiteral:return Nl(e,n);case S.ZodEnum:return Al(e);case S.ZodNativeEnum:return jl(e);case S.ZodNullable:return Ul(e,n);case S.ZodOptional:return Bl(e,n);case S.ZodMap:return Ml(e,n);case S.ZodSet:return zl(e,n);case S.ZodLazy:return()=>e.getter()._def;case S.ZodPromise:return Hl(e,n);case S.ZodNaN:case S.ZodNever:return Dl(n);case S.ZodEffects:return Cl(e,n);case S.ZodAny:return _e(n);case S.ZodUnknown:return Yl(n);case S.ZodDefault:return Il(e,n);case S.ZodBranded:return Ls(e,n);case S.ZodReadonly:return Kl(e,n);case S.ZodCatch:return Tl(e,n);case S.ZodPipeline:return Jl(e,n);case S.ZodFunction:case S.ZodVoid:case S.ZodSymbol:return;default:return(r=>{})()}};function z(e,t,n=!1){var i;const r=t.seen.get(e);if(t.override){const u=(i=t.override)==null?void 0:i.call(t,e,t,r,n);if(u!==Ji)return u}if(r&&!n){const u=Ql(r,t);if(u!==void 0)return u}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const s=Xl(e,e.typeName,t),o=typeof s=="function"?z(s(),t):s;if(o&&eu(e,t,o),t.postProcess){const u=t.postProcess(o,e,t);return a.jsonSchema=o,u}return a.jsonSchema=o,o}const Ql=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Os(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),_e(t)):t.$refStrategy==="seen"?_e(t):void 0}},eu=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),tu=(e,t)=>{const n=zi(t);let r=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[l,c])=>({...u,[l]:z(c._def,{...n,currentPath:[...n.basePath,n.definitionPath,l]},!0)??_e(n)}),{}):void 0;const a=typeof t=="string"?t:(t==null?void 0:t.nameStrategy)==="title"||t==null?void 0:t.name,s=z(e._def,a===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1)??_e(n),o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(s.title=o),n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:n.$refStrategy==="relative"?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const i=a===void 0?r?{...s,[n.definitionPath]:r}:s:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:s}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};var Pt={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},Mt={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},jt={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},Dt={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},$t={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},nu=[Pt,Mt,jt,Dt,$t];Pt.code+"",Mt.code+"",jt.code+"",Dt.code+"",$t.code+"";Pt.name+"",Pt.code,Mt.name+"",Mt.code,jt.name+"",jt.code,Dt.name+"",Dt.code,$t.name+"",$t.code;nu.map(e=>e.code);function ru(e){const t=["ROOT"];let n=-1,r=null;function a(u,l,c){switch(u){case'"':{n=l,t.pop(),t.push(c),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{n=l,r=l,t.pop(),t.push(c),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=l,t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"{":{n=l,t.pop(),t.push(c),t.push("INSIDE_OBJECT_START");break}case"[":{n=l,t.pop(),t.push(c),t.push("INSIDE_ARRAY_START");break}}}function s(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=l,t.pop();break}}}function o(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=l,t.pop();break}}}for(let u=0;u<e.length;u++){const l=e[u];switch(t[t.length-1]){case"ROOT":a(l,u,"FINISH");break;case"INSIDE_OBJECT_START":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{n=u,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(l){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(l,u,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{s(l,u);break}case"INSIDE_STRING":{switch(l){case'"':{t.pop(),n=u;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:n=u}break}case"INSIDE_ARRAY_START":{switch(l){case"]":{n=u,t.pop();break}default:{n=u,a(l,u,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=u,t.pop();break}default:{n=u;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(l,u,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),n=u;break}case"INSIDE_NUMBER":{switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=u;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(l,u);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(l,u);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const h=e.substring(r,u+1);!"false".startsWith(h)&&!"true".startsWith(h)&&!"null".startsWith(h)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?s(l,u):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u)):n=u;break}}}let i=e.slice(0,n+1);for(let u=t.length-1;u>=0;u--)switch(t[u]){case"INSIDE_STRING":{i+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{i+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{i+="]";break}case"INSIDE_LITERAL":{const c=e.substring(r,e.length);"true".startsWith(c)?i+="true".slice(c.length):"false".startsWith(c)?i+="false".slice(c.length):"null".startsWith(c)&&(i+="null".slice(c.length))}}return i}function au(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=tt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=tt({text:ru(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var su={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},ou={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},iu={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},lu={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},uu={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},cu={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},du={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},pu={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},fu={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},hu={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},mu={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},gu={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},yu={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},vu={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},_u={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},bu={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}},Rn=[su,ou,iu,lu,uu,cu,du,pu,fu,hu,mu,gu,yu,vu,_u,bu];Object.fromEntries(Rn.map(e=>[e.code,e]));Object.fromEntries(Rn.map(e=>[e.name,e.code]));Rn.map(e=>e.code);function pe(e,t){const n=Rn.find(r=>r.name===e);if(!n)throw new Error(`Invalid stream part type: ${e}`);return`${n.code}:${JSON.stringify(t)}
`}function wu(e,t){var n;const r=(n=void 0)!=null?n:!1;return xu(tu(e,{$refStrategy:r?"root":"none",target:"jsonSchema7"}),{validate:a=>{const s=e.safeParse(a);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}var ir=Symbol.for("vercel.ai.schema");function xu(e,{validate:t}={}){return{[ir]:!0,_type:void 0,[rn]:!0,jsonSchema:e,validate:t}}function ku(e){return typeof e=="object"&&e!==null&&ir in e&&e[ir]===!0&&"jsonSchema"in e&&"validate"in e}function En(e){return ku(e)?e:wu(e)}var Tu=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},et="1.9.0",da=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Su(e){var t=new Set([e]),n=new Set,r=e.match(da);if(!r)return function(){return!1};var a={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(a.prerelease!=null)return function(u){return u===e};function s(i){return n.add(i),!1}function o(i){return t.add(i),!0}return function(u){if(t.has(u))return!0;if(n.has(u))return!1;var l=u.match(da);if(!l)return s(u);var c={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return c.prerelease!=null||a.major!==c.major?s(u):a.major===0?a.minor===c.minor&&a.patch<=c.patch?o(u):s(u):a.minor<=c.minor?o(u):s(u)}}var Iu=Su(et),Cu=et.split(".")[0],Lt=Symbol.for("opentelemetry.js.api."+Cu),Ut=Tu;function kr(e,t,n,r){var a;r===void 0&&(r=!1);var s=Ut[Lt]=(a=Ut[Lt])!==null&&a!==void 0?a:{version:et};if(!r&&s[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(o.stack||o.message),!1}if(s.version!==et){var o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+e+" does not match previously registered API v"+et);return n.error(o.stack||o.message),!1}return s[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+et+"."),!0}function qt(e){var t,n,r=(t=Ut[Lt])===null||t===void 0?void 0:t.version;if(!(!r||!Iu(r)))return(n=Ut[Lt])===null||n===void 0?void 0:n[e]}function Tr(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+et+".");var n=Ut[Lt];n&&delete n[e]}var Au=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Ru=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},Eu=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ct("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ct("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ct("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ct("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ct("verbose",this._namespace,t)},e}();function Ct(e,t,n){var r=qt("diag");if(r)return n.unshift(t),r[e].apply(r,Ru([],Au(n),!1))}var we;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(we||(we={}));function Nu(e,t){e<we.NONE?e=we.NONE:e>we.ALL&&(e=we.ALL),t=t||{};function n(r,a){var s=t[r];return typeof s=="function"&&e>=a?s.bind(t):function(){}}return{error:n("error",we.ERROR),warn:n("warn",we.WARN),info:n("info",we.INFO),debug:n("debug",we.DEBUG),verbose:n("verbose",we.VERBOSE)}}var Ou=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Pu=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},Mu="diag",wn=function(){function e(){function t(a){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var i=qt("diag");if(i)return i[a].apply(i,Pu([],Ou(s),!1))}}var n=this,r=function(a,s){var o,i,u;if(s===void 0&&(s={logLevel:we.INFO}),a===n){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof s=="number"&&(s={logLevel:s});var c=qt("diag"),h=Nu((i=s.logLevel)!==null&&i!==void 0?i:we.INFO,a);if(c&&!s.suppressOverrideMessage){var d=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+d),h.warn("Current logger will overwrite one already registered from "+d)}return kr("diag",h,n,!0)};n.setLogger=r,n.disable=function(){Tr(Mu,n)},n.createComponentLogger=function(a){return new Eu(a)},n.verbose=t("verbose"),n.debug=t("debug"),n.info=t("info"),n.warn=t("warn"),n.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function ju(e){return Symbol.for(e)}var Du=function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,a){var s=new e(n._currentContext);return s._currentContext.set(r,a),s},n.deleteValue=function(r){var a=new e(n._currentContext);return a._currentContext.delete(r),a}}return e}(),$u=new Du,Lu=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Uu=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},qu=function(){function e(){}return e.prototype.active=function(){return $u},e.prototype.with=function(t,n,r){for(var a=[],s=3;s<arguments.length;s++)a[s-3]=arguments[s];return n.call.apply(n,Uu([r],Lu(a),!1))},e.prototype.bind=function(t,n){return n},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),Fu=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Zu=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},zn="context",Vu=new qu,Zs=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return kr(zn,t,wn.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,n,r){for(var a,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(a=this._getContextManager()).with.apply(a,Zu([t,n,r],Fu(s),!1))},e.prototype.bind=function(t,n){return this._getContextManager().bind(t,n)},e.prototype._getContextManager=function(){return qt(zn)||Vu},e.prototype.disable=function(){this._getContextManager().disable(),Tr(zn,wn.instance())},e}(),lr;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(lr||(lr={}));var Vs="0000000000000000",Bs="00000000000000000000000000000000",Bu={traceId:Bs,spanId:Vs,traceFlags:lr.NONE},Rt=function(){function e(t){t===void 0&&(t=Bu),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,n){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,n){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,n){},e}(),Sr=ju("OpenTelemetry Context Key SPAN");function Ir(e){return e.getValue(Sr)||void 0}function Ju(){return Ir(Zs.getInstance().active())}function Cr(e,t){return e.setValue(Sr,t)}function Hu(e){return e.deleteValue(Sr)}function zu(e,t){return Cr(e,new Rt(t))}function Js(e){var t;return(t=Ir(e))===null||t===void 0?void 0:t.spanContext()}var Gu=/^([0-9a-f]{32})$/i,Wu=/^[0-9a-f]{16}$/i;function Yu(e){return Gu.test(e)&&e!==Bs}function Ku(e){return Wu.test(e)&&e!==Vs}function Hs(e){return Yu(e.traceId)&&Ku(e.spanId)}function Xu(e){return new Rt(e)}var Gn=Zs.getInstance(),zs=function(){function e(){}return e.prototype.startSpan=function(t,n,r){r===void 0&&(r=Gn.active());var a=!!(n!=null&&n.root);if(a)return new Rt;var s=r&&Js(r);return Qu(s)&&Hs(s)?new Rt(s):new Rt},e.prototype.startActiveSpan=function(t,n,r,a){var s,o,i;if(!(arguments.length<2)){arguments.length===2?i=n:arguments.length===3?(s=n,i=r):(s=n,o=r,i=a);var u=o??Gn.active(),l=this.startSpan(t,s,u),c=Cr(u,l);return Gn.with(c,i,void 0,l)}},e}();function Qu(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var ec=new zs,tc=function(){function e(t,n,r,a){this._provider=t,this.name=n,this.version=r,this.options=a}return e.prototype.startSpan=function(t,n,r){return this._getTracer().startSpan(t,n,r)},e.prototype.startActiveSpan=function(t,n,r,a){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):ec},e}(),nc=function(){function e(){}return e.prototype.getTracer=function(t,n,r){return new zs},e}(),rc=new nc,pa=function(){function e(){}return e.prototype.getTracer=function(t,n,r){var a;return(a=this.getDelegateTracer(t,n,r))!==null&&a!==void 0?a:new tc(this,t,n,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:rc},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,n,r){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(t,n,r)},e}(),xn;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(xn||(xn={}));var Wn="trace",ac=function(){function e(){this._proxyTracerProvider=new pa,this.wrapSpanContext=Xu,this.isSpanContextValid=Hs,this.deleteSpan=Hu,this.getSpan=Ir,this.getActiveSpan=Ju,this.getSpanContext=Js,this.setSpan=Cr,this.setSpanContext=zu}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var n=kr(Wn,this._proxyTracerProvider,wn.instance());return n&&this._proxyTracerProvider.setDelegate(t),n},e.prototype.getTracerProvider=function(){return qt(Wn)||this._proxyTracerProvider},e.prototype.getTracer=function(t,n){return this.getTracerProvider().getTracer(t,n)},e.prototype.disable=function(){Tr(Wn,wn.instance()),this._proxyTracerProvider=new pa},e}(),sc=ac.getInstance(),oc=Object.defineProperty,Ar=(e,t)=>{for(var n in t)oc(e,n,{get:t[n],enumerable:!0})};function kn(e,{contentType:t,dataStreamVersion:n}){const r=new Headers(e??{});return r.has("Content-Type")||r.set("Content-Type",t),n!==void 0&&r.set("X-Vercel-AI-Data-Stream",n),r}function fa(e,{contentType:t,dataStreamVersion:n}){const r={};if(e!=null)for(const[a,s]of Object.entries(e))r[a]=s;return r["Content-Type"]==null&&(r["Content-Type"]=t),n!==void 0&&(r["X-Vercel-AI-Data-Stream"]=n),r}function ha({response:e,status:t,statusText:n,headers:r,stream:a}){e.writeHead(t??200,n,r);const s=a.getReader();(async()=>{try{for(;;){const{done:i,value:u}=await s.read();if(i)break;e.write(u)}}catch(i){throw i}finally{e.end()}})()}var ic=class extends ${constructor(){super({name:"AI_UnsupportedModelVersionError",message:'Unsupported model version. AI SDK 4 only supports models that implement specification version "v1". Please upgrade to AI SDK 5 to use this model.'})}},Gs="AI_InvalidArgumentError",Ws=`vercel.ai.error.${Gs}`,lc=Symbol.for(Ws),Ys,Re=class extends ${constructor({parameter:e,value:t,message:n}){super({name:Gs,message:`Invalid argument for parameter ${e}: ${n}`}),this[Ys]=!0,this.parameter=e,this.value=t}static isInstance(e){return $.hasMarker(e,Ws)}};Ys=lc;var Ks="AI_RetryError",Xs=`vercel.ai.error.${Ks}`,uc=Symbol.for(Xs),Qs,ma=class extends ${constructor({message:e,reason:t,errors:n}){super({name:Ks,message:e}),this[Qs]=!0,this.reason=t,this.errors=n,this.lastError=n[n.length-1]}static isInstance(e){return $.hasMarker(e,Xs)}};Qs=uc;var cc=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2}={})=>async r=>eo(r,{maxRetries:e,delayInMs:t,backoffFactor:n});async function eo(e,{maxRetries:t,delayInMs:n,backoffFactor:r},a=[]){try{return await e()}catch(s){if(en(s)||t===0)throw s;const o=Pi(s),i=[...a,s],u=i.length;if(u>t)throw new ma({message:`Failed after ${u} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:i});if(s instanceof Error&&xe.isInstance(s)&&s.isRetryable===!0&&u<=t)return await Ei(n),eo(e,{maxRetries:t,delayInMs:r*n,backoffFactor:r},i);throw u===1?s:new ma({message:`Failed after ${u} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:i})}}function dc({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new Re({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new Re({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const t=e??2;return{maxRetries:t,retry:cc({maxRetries:t})}}function ur({operationId:e,telemetry:t}){return{"operation.name":`${e}${(t==null?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":t==null?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":t==null?void 0:t.functionId}}function pc({model:e,settings:t,telemetry:n,headers:r}){var a;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((s,[o,i])=>(s[`ai.settings.${o}`]=i,s),{}),...Object.entries((a=n==null?void 0:n.metadata)!=null?a:{}).reduce((s,[o,i])=>(s[`ai.telemetry.metadata.${o}`]=i,s),{}),...Object.entries(r??{}).reduce((s,[o,i])=>(i!==void 0&&(s[`ai.request.headers.${o}`]=i),s),{})}}var fc={startSpan(){return Qt},startActiveSpan(e,t,n,r){if(typeof t=="function")return t(Qt);if(typeof n=="function")return n(Qt);if(typeof r=="function")return r(Qt)}},Qt={spanContext(){return hc},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},hc={traceId:"",spanId:"",traceFlags:0};function mc({isEnabled:e=!1,tracer:t}={}){return e?t||sc.getTracer("ai"):fc}function cr({name:e,tracer:t,attributes:n,fn:r,endWhenDone:a=!0}){return t.startActiveSpan(e,{attributes:n},async s=>{try{const o=await r(s);return a&&s.end(),o}catch(o){try{to(s,o)}finally{s.end()}throw o}})}function to(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:xn.ERROR,message:t.message})):e.setStatus({code:xn.ERROR})}function ft({telemetry:e,attributes:t}){return(e==null?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((n,[r,a])=>{if(a===void 0)return n;if(typeof a=="object"&&"input"in a&&typeof a.input=="function"){if((e==null?void 0:e.recordInputs)===!1)return n;const s=a.input();return s===void 0?n:{...n,[r]:s}}if(typeof a=="object"&&"output"in a&&typeof a.output=="function"){if((e==null?void 0:e.recordOutputs)===!1)return n;const s=a.output();return s===void 0?n:{...n,[r]:s}}return{...n,[r]:a}},{})}var gc=class{constructor({data:e,mimeType:t}){const n=e instanceof Uint8Array;this.base64Data=n?void 0:e,this.uint8ArrayData=n?e:void 0,this.mimeType=t}get base64(){return this.base64Data==null&&(this.base64Data=De(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=Bt(this.base64Data)),this.uint8ArrayData}},yc=class extends gc{constructor(e){super(e),this.type="file"}},vc=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],_c=e=>{const t=typeof e=="string"?Bt(e):e,n=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(n+10)};function bc(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?_c(e):e}function wc({data:e,signatures:t}){const n=bc(e);for(const r of t)if(typeof n=="string"?n.startsWith(r.base64Prefix):n.length>=r.bytesPrefix.length&&r.bytesPrefix.every((a,s)=>n[s]===a))return r.mimeType}var no="AI_NoObjectGeneratedError",ro=`vercel.ai.error.${no}`,xc=Symbol.for(ro),ao,ga=class extends ${constructor({message:e="No object generated.",cause:t,text:n,response:r,usage:a,finishReason:s}){super({name:no,message:e,cause:t}),this[ao]=!0,this.text=n,this.response=r,this.usage=a,this.finishReason=s}static isInstance(e){return $.hasMarker(e,ro)}};ao=xc;var so="AI_DownloadError",oo=`vercel.ai.error.${so}`,kc=Symbol.for(oo),io,Yn=class extends ${constructor({url:e,statusCode:t,statusText:n,cause:r,message:a=r==null?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${r}`}){super({name:so,message:a,cause:r}),this[io]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return $.hasMarker(e,oo)}};io=kc;async function Tc({url:e}){var t;const n=e.toString();try{const r=await fetch(n);if(!r.ok)throw new Yn({url:n,statusCode:r.status,statusText:r.statusText});return{data:new Uint8Array(await r.arrayBuffer()),mimeType:(t=r.headers.get("content-type"))!=null?t:void 0}}catch(r){throw Yn.isInstance(r)?r:new Yn({url:n,cause:r})}}var lo="AI_InvalidDataContentError",uo=`vercel.ai.error.${lo}`,Sc=Symbol.for(uo),co,ya=class extends ${constructor({content:e,cause:t,message:n=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:lo,message:n,cause:t}),this[co]=!0,this.content=e}static isInstance(e){return $.hasMarker(e,uo)}};co=Sc;var po=W([p(),_n(Uint8Array),_n(ArrayBuffer),$s(e=>{var t,n;return(n=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?n:!1},{message:"Must be a Buffer"})]);function Rr(e){return typeof e=="string"?e:e instanceof ArrayBuffer?De(new Uint8Array(e)):De(e)}function Tn(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return Bt(e)}catch(t){throw new ya({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new ya({content:e})}function Ic(e){try{return new TextDecoder().decode(e)}catch{throw new Error("Error decoding Uint8Array to text")}}var fo="AI_InvalidMessageRoleError",ho=`vercel.ai.error.${fo}`,Cc=Symbol.for(ho),mo,Ac=class extends ${constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:fo,message:t}),this[mo]=!0,this.role=e}static isInstance(e){return $.hasMarker(e,ho)}};mo=Cc;function Rc(e){try{const[t,n]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:n}}catch{return{mimeType:void 0,base64Content:void 0}}}async function Ec({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:n=()=>!1,downloadImplementation:r=Tc}){const a=await Oc(e.messages,r,t,n);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(s=>Nc(s,a))]}function Nc(e,t){var n,r,a,s,o,i;const u=e.role;switch(u){case"system":return{role:"system",content:e.content,providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata}:{role:"user",content:e.content.map(l=>Pc(l,t)).filter(l=>l.type!=="text"||l.text!==""),providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(l=>l.type!=="text"||l.text!=="").map(l=>{var c;const h=(c=l.providerOptions)!=null?c:l.experimental_providerMetadata;switch(l.type){case"file":return{type:"file",data:l.data instanceof URL?l.data:Rr(l.data),filename:l.filename,mimeType:l.mimeType,providerMetadata:h};case"reasoning":return{type:"reasoning",text:l.text,signature:l.signature,providerMetadata:h};case"redacted-reasoning":return{type:"redacted-reasoning",data:l.data,providerMetadata:h};case"text":return{type:"text",text:l.text,providerMetadata:h};case"tool-call":return{type:"tool-call",toolCallId:l.toolCallId,toolName:l.toolName,args:l.args,providerMetadata:h}}}),providerMetadata:(o=e.providerOptions)!=null?o:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(l=>{var c;return{type:"tool-result",toolCallId:l.toolCallId,toolName:l.toolName,result:l.result,content:l.experimental_content,isError:l.isError,providerMetadata:(c=l.providerOptions)!=null?c:l.experimental_providerMetadata}}),providerMetadata:(i=e.providerOptions)!=null?i:e.experimental_providerMetadata};default:{const l=u;throw new Ac({role:l})}}}async function Oc(e,t,n,r){const a=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>!(o.type==="image"&&n===!0)).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!r(o)),s=await Promise.all(a.map(async o=>({url:o,data:await t({url:o})})));return Object.fromEntries(s.map(({url:o,data:i})=>[o.toString(),i]))}function Pc(e,t){var n,r,a,s;if(e.type==="text")return{type:"text",text:e.text,providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata};let o=e.mimeType,i,u,l;const c=e.type;switch(c){case"image":i=e.image;break;case"file":i=e.data;break;default:throw new Error(`Unsupported part type: ${c}`)}try{u=typeof i=="string"?new URL(i):i}catch{u=i}if(u instanceof URL)if(u.protocol==="data:"){const{mimeType:h,base64Content:d}=Rc(u.toString());if(h==null||d==null)throw new Error(`Invalid data URL format in part ${c}`);o=h,l=Tn(d)}else{const h=t[u.toString()];h?(l=h.data,o??(o=h.mimeType)):l=u}else l=Tn(u);switch(c){case"image":return l instanceof Uint8Array&&(o=(r=wc({data:l,signatures:vc}))!=null?r:o),{type:"image",image:l,mimeType:o,providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata};case"file":{if(o==null)throw new Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?Rr(l):l,filename:e.filename,mimeType:o,providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata}}}}function Mc({maxTokens:e,temperature:t,topP:n,topK:r,presencePenalty:a,frequencyPenalty:s,stopSequences:o,seed:i}){if(e!=null){if(!Number.isInteger(e))throw new Re({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new Re({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new Re({parameter:"temperature",value:t,message:"temperature must be a number"});if(n!=null&&typeof n!="number")throw new Re({parameter:"topP",value:n,message:"topP must be a number"});if(r!=null&&typeof r!="number")throw new Re({parameter:"topK",value:r,message:"topK must be a number"});if(a!=null&&typeof a!="number")throw new Re({parameter:"presencePenalty",value:a,message:"presencePenalty must be a number"});if(s!=null&&typeof s!="number")throw new Re({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(i!=null&&!Number.isInteger(i))throw new Re({parameter:"seed",value:i,message:"seed must be an integer"});return{maxTokens:e,temperature:t??0,topP:n,topK:r,presencePenalty:a,frequencyPenalty:s,stopSequences:o!=null&&o.length>0?o:void 0,seed:i}}function va(e){var t,n,r;const a=[];for(const s of e){let o;try{o=new URL(s.url)}catch{throw new Error(`Invalid URL: ${s.url}`)}switch(o.protocol){case"http:":case"https:":{if((t=s.contentType)!=null&&t.startsWith("image/"))a.push({type:"image",image:o});else{if(!s.contentType)throw new Error("If the attachment is not an image, it must specify a content type");a.push({type:"file",data:o,mimeType:s.contentType})}break}case"data:":{let i,u,l;try{[i,u]=s.url.split(","),l=i.split(";")[0].split(":")[1]}catch{throw new Error(`Error processing data URL: ${s.url}`)}if(l==null||u==null)throw new Error(`Invalid data URL format: ${s.url}`);if((n=s.contentType)!=null&&n.startsWith("image/"))a.push({type:"image",image:Tn(u)});else if((r=s.contentType)!=null&&r.startsWith("text/"))a.push({type:"text",text:Ic(Tn(u))});else{if(!s.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");a.push({type:"file",data:u,mimeType:s.contentType})}break}default:throw new Error(`Unsupported URL protocol: ${o.protocol}`)}}return a}var go="AI_MessageConversionError",yo=`vercel.ai.error.${go}`,jc=Symbol.for(yo),vo,Kn=class extends ${constructor({originalMessage:e,message:t}){super({name:go,message:t}),this[vo]=!0,this.originalMessage=e}static isInstance(e){return $.hasMarker(e,yo)}};vo=jc;function Dc(e,t){var n,r;const a=(n=t==null?void 0:t.tools)!=null?n:{},s=[];for(let o=0;o<e.length;o++){const i=e[o],u=o===e.length-1,{role:l,content:c,experimental_attachments:h}=i;switch(l){case"system":{s.push({role:"system",content:c});break}case"user":{if(i.parts==null)s.push({role:"user",content:h?[{type:"text",text:c},...va(h)]:c});else{const d=i.parts.filter(g=>g.type==="text").map(g=>({type:"text",text:g.text}));s.push({role:"user",content:h?[...d,...va(h)]:d})}break}case"assistant":{if(i.parts!=null){let _=function(){const x=[];for(const b of v)switch(b.type){case"file":case"text":{x.push(b);break}case"reasoning":{for(const k of b.details)switch(k.type){case"text":x.push({type:"reasoning",text:k.text,signature:k.signature});break;case"redacted":x.push({type:"redacted-reasoning",data:k.data});break}break}case"tool-invocation":x.push({type:"tool-call",toolCallId:b.toolInvocation.toolCallId,toolName:b.toolInvocation.toolName,args:b.toolInvocation.args});break;default:{const k=b;throw new Error(`Unsupported part: ${k}`)}}s.push({role:"assistant",content:x});const R=v.filter(b=>b.type==="tool-invocation").map(b=>b.toolInvocation);R.length>0&&s.push({role:"tool",content:R.map(b=>{if(!("result"in b))throw new Kn({originalMessage:i,message:"ToolInvocation must have a result: "+JSON.stringify(b)});const{toolCallId:k,toolName:I,result:j}=b,C=a[I];return(C==null?void 0:C.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:k,toolName:I,result:C.experimental_toToolResultContent(j),experimental_content:C.experimental_toToolResultContent(j)}:{type:"tool-result",toolCallId:k,toolName:I,result:j}})}),v=[],y=!1,m++},m=0,y=!1,v=[];for(const x of i.parts)switch(x.type){case"text":{y&&_(),v.push(x);break}case"file":case"reasoning":{v.push(x);break}case"tool-invocation":{((r=x.toolInvocation.step)!=null?r:0)!==m&&_(),v.push(x),y=!0;break}}_();break}const d=i.toolInvocations;if(d==null||d.length===0){s.push({role:"assistant",content:c});break}const g=d.reduce((_,m)=>{var y;return Math.max(_,(y=m.step)!=null?y:0)},0);for(let _=0;_<=g;_++){const m=d.filter(y=>{var v;return((v=y.step)!=null?v:0)===_});m.length!==0&&(s.push({role:"assistant",content:[...u&&c&&_===0?[{type:"text",text:c}]:[],...m.map(({toolCallId:y,toolName:v,args:x})=>({type:"tool-call",toolCallId:y,toolName:v,args:x}))]}),s.push({role:"tool",content:m.map(y=>{if(!("result"in y))throw new Kn({originalMessage:i,message:"ToolInvocation must have a result: "+JSON.stringify(y)});const{toolCallId:v,toolName:x,result:R}=y,b=a[x];return(b==null?void 0:b.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:v,toolName:x,result:b.experimental_toToolResultContent(R),experimental_content:b.experimental_toToolResultContent(R)}:{type:"tool-result",toolCallId:v,toolName:x,result:R}})}))}c&&!u&&s.push({role:"assistant",content:c});break}case"data":break;default:{const d=l;throw new Kn({originalMessage:i,message:`Unsupported role: ${d}`})}}}return s}var dr=bl(()=>W([_l(),p(),w(),he(),yt(p(),dr),O(dr)])),re=yt(p(),yt(p(),dr)),$c=O(W([f({type:A("text"),text:p()}),f({type:A("image"),data:p(),mimeType:p().optional()})])),_o=f({type:A("text"),text:p(),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),Lc=f({type:A("image"),image:W([po,_n(URL)]),mimeType:p().optional(),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),bo=f({type:A("file"),data:W([po,_n(URL)]),filename:p().optional(),mimeType:p(),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),Uc=f({type:A("reasoning"),text:p(),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),qc=f({type:A("redacted-reasoning"),data:p(),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),Fc=f({type:A("tool-call"),toolCallId:p(),toolName:p(),args:kt(),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),Zc=f({type:A("tool-result"),toolCallId:p(),toolName:p(),result:kt(),content:$c.optional(),isError:he().optional(),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),Vc=f({role:A("system"),content:p(),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),Bc=f({role:A("user"),content:W([p(),O(W([_o,Lc,bo]))]),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),Jc=f({role:A("assistant"),content:W([p(),O(W([_o,bo,Uc,qc,Fc]))]),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),Hc=f({role:A("tool"),content:O(Zc),providerOptions:re.optional(),experimental_providerMetadata:re.optional()}),zc=W([Vc,Bc,Jc,Hc]);function Gc({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new qe({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new qe({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new qe({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new qe({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){const r=Wc(e.messages)==="ui-messages"?Dc(e.messages,{tools:t}):e.messages;if(r.length===0)throw new qe({prompt:e,message:"messages must not be empty"});const a=bt({value:r,schema:O(zc)});if(!a.success)throw new qe({prompt:e,message:["message must be a CoreMessage or a UI message",`Validation error: ${a.error.message}`].join(`
`),cause:a.error});return{type:"messages",messages:r,system:e.system}}throw new Error("unreachable")}function Wc(e){if(!Array.isArray(e))throw new qe({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received non-array value: ${JSON.stringify(e)}`].join(`
`),cause:e});if(e.length===0)return"messages";const t=e.map(Yc);if(t.some(r=>r==="has-ui-specific-parts"))return"ui-messages";const n=t.findIndex(r=>r!=="has-core-specific-parts"&&r!=="message");if(n===-1)return"messages";throw new qe({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received message of type: "${t[n]}" at index ${n}`,`messages[${n}]: ${JSON.stringify(e[n])}`].join(`
`),cause:e})}function Yc(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function Kc({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function Xc(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}var Qc="JSON schema:",ed="You MUST answer with a JSON object that matches the JSON schema above.",td="You MUST answer with JSON.";function nd({prompt:e,schema:t,schemaPrefix:n=t!=null?Qc:void 0,schemaSuffix:r=t!=null?ed:td}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,n,t!=null?JSON.stringify(t):void 0,r].filter(a=>a!=null).join(`
`)}function Xn(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{const n=t.getReader();return{async next(){const{done:r,value:a}=await n.read();return r?{done:!0,value:void 0}:{done:!1,value:a}}}},t}function rd(e){const t=e.map(n=>({...n,content:typeof n.content=="string"?n.content:n.content.map(ad)}));return JSON.stringify(t)}function ad(e){return e.type==="image"?{...e,image:e.image instanceof Uint8Array?Rr(e.image):e.image}:e}ot({prefix:"aiobj",size:24});var ye=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t}),this.promise)}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&((t=this._reject)==null||t.call(this,e))}};function _a(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}function sd(){let e=[],t=null,n=!1,r=_a();const a=async()=>{if(n&&e.length===0){t==null||t.close();return}if(e.length===0)return r=_a(),await r.promise,a();try{const{value:s,done:o}=await e[0].read();o?(e.shift(),e.length>0?await a():n&&(t==null||t.close())):t==null||t.enqueue(s)}catch(s){t==null||t.error(s),e.shift(),n&&e.length===0&&(t==null||t.close())}};return{stream:new ReadableStream({start(s){t=s},pull:a,async cancel(){for(const s of e)await s.cancel();e=[],n=!0}}),addStream:s=>{if(n)throw new Error("Cannot add inner stream: outer stream is closed");e.push(s.getReader()),r.resolve()},close:()=>{n=!0,r.resolve(),e.length===0&&(t==null||t.close())},terminate:()=>{n=!0,r.resolve(),e.forEach(s=>s.cancel()),e=[],t==null||t.close()}}}function od(){var e,t;return(t=(e=globalThis==null?void 0:globalThis.performance)==null?void 0:e.now())!=null?t:Date.now()}ot({prefix:"aiobj",size:24});var wo="AI_NoOutputSpecifiedError",xo=`vercel.ai.error.${wo}`,id=Symbol.for(xo),ko,ld=class extends ${constructor({message:e="No output specified."}={}){super({name:wo,message:e}),this[ko]=!0}static isInstance(e){return $.hasMarker(e,xo)}};ko=id;var To="AI_ToolExecutionError",So=`vercel.ai.error.${To}`,ud=Symbol.for(So),Io,cd=class extends ${constructor({toolArgs:e,toolName:t,toolCallId:n,cause:r,message:a=`Error executing tool ${t}: ${Zt(r)}`}){super({name:To,message:a,cause:r}),this[Io]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=n}static isInstance(e){return $.hasMarker(e,So)}};Io=ud;function dd(e){return e!=null&&Object.keys(e).length>0}function pd({tools:e,toolChoice:t,activeTools:n}){return dd(e)?{tools:(n!=null?Object.entries(e).filter(([a])=>n.includes(a)):Object.entries(e)).map(([a,s])=>{const o=s.type;switch(o){case void 0:case"function":return{type:"function",name:a,description:s.description,parameters:En(s.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:a,id:s.id,args:s.args};default:{const i=o;throw new Error(`Unsupported tool type: ${i}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var fd=/^([\s\S]*?)(\s+)(\S*)$/;function hd(e){const t=e.match(fd);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}var Co="AI_InvalidToolArgumentsError",Ao=`vercel.ai.error.${Co}`,md=Symbol.for(Ao),Ro,Eo=class extends ${constructor({toolArgs:e,toolName:t,cause:n,message:r=`Invalid arguments for tool ${t}: ${Zt(n)}`}){super({name:Co,message:r,cause:n}),this[Ro]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return $.hasMarker(e,Ao)}};Ro=md;var No="AI_NoSuchToolError",Oo=`vercel.ai.error.${No}`,gd=Symbol.for(Oo),Po,pr=class extends ${constructor({toolName:e,availableTools:t=void 0,message:n=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:No,message:n}),this[Po]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return $.hasMarker(e,Oo)}};Po=gd;var Mo="AI_ToolCallRepairError",jo=`vercel.ai.error.${Mo}`,yd=Symbol.for(jo),Do,vd=class extends ${constructor({cause:e,originalError:t,message:n=`Error repairing tool call: ${Zt(e)}`}){super({name:Mo,message:n,cause:e}),this[Do]=!0,this.originalError=t}static isInstance(e){return $.hasMarker(e,jo)}};Do=yd;async function _d({toolCall:e,tools:t,repairToolCall:n,system:r,messages:a}){if(t==null)throw new pr({toolName:e.toolName});try{return await ba({toolCall:e,tools:t})}catch(s){if(n==null||!(pr.isInstance(s)||Eo.isInstance(s)))throw s;let o=null;try{o=await n({toolCall:e,tools:t,parameterSchema:({toolName:i})=>En(t[i].parameters).jsonSchema,system:r,messages:a,error:s})}catch(i){throw new vd({cause:i,originalError:s})}if(o==null)throw s;return await ba({toolCall:o,tools:t})}}async function ba({toolCall:e,tools:t}){const n=e.toolName,r=t[n];if(r==null)throw new pr({toolName:e.toolName,availableTools:Object.keys(t)});const a=En(r.parameters),s=e.args.trim()===""?bt({value:{},schema:a}):tt({text:e.args,schema:a});if(s.success===!1)throw new Eo({toolName:n,toolArgs:e.args,cause:s.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:n,args:s.value}}function bd(e){const t=e.filter(n=>n.type==="text").map(n=>n.text).join("");return t.length>0?t:void 0}function wa({text:e="",files:t,reasoning:n,tools:r,toolCalls:a,toolResults:s,messageId:o,generateMessageId:i}){const u=[],l=[];return n.length>0&&l.push(...n.map(c=>c.type==="text"?{...c,type:"reasoning"}:{...c,type:"redacted-reasoning"})),t.length>0&&l.push(...t.map(c=>({type:"file",data:c.base64,mimeType:c.mimeType}))),e.length>0&&l.push({type:"text",text:e}),a.length>0&&l.push(...a),l.length>0&&u.push({role:"assistant",content:l,id:o}),s.length>0&&u.push({role:"tool",id:i(),content:s.map(c=>{const h=r[c.toolName];return(h==null?void 0:h.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:c.toolCallId,toolName:c.toolName,result:h.experimental_toToolResultContent(c.result),experimental_content:h.experimental_toToolResultContent(c.result)}:{type:"tool-result",toolCallId:c.toolCallId,toolName:c.toolName,result:c.result}})}),u}ot({prefix:"aitxt",size:24});ot({prefix:"msg",size:24});var wd={};Ar(wd,{object:()=>Sd,text:()=>Td});var $o="AI_InvalidStreamPartError",Lo=`vercel.ai.error.${$o}`,xd=Symbol.for(Lo),Uo,kd=class extends ${constructor({chunk:e,message:t}){super({name:$o,message:t}),this[Uo]=!0,this.chunk=e}static isInstance(e){return $.hasMarker(e,Lo)}};Uo=xd;var Td=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:e}){return e},parsePartial({text:e}){return{partial:e}},parseOutput({text:e}){return e}}),Sd=({schema:e})=>{const t=En(e);return{type:"object",responseFormat:({model:n})=>({type:"json",schema:n.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt({system:n,model:r}){return r.supportsStructuredOutputs?n:nd({prompt:n,schema:t.jsonSchema})},parsePartial({text:n}){const r=au(n);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{const a=r.state;throw new Error(`Unsupported parse state: ${a}`)}}},parseOutput({text:n},r){const a=tt({text:n});if(!a.success)throw new ga({message:"No object generated: could not parse the response.",cause:a.error,text:n,response:r.response,usage:r.usage,finishReason:r.finishReason});const s=bt({value:a.value,schema:t});if(!s.success)throw new ga({message:"No object generated: response did not match schema.",cause:s.error,text:n,response:r.response,usage:r.usage,finishReason:r.finishReason});return s.value}}};function Id(e){return e===void 0?[]:Array.isArray(e)?e:[e]}async function Cd({stream:e,onError:t}){const n=e.getReader();try{for(;;){const{done:r}=await n.read();if(r)break}}catch(r){t==null||t(r)}finally{n.releaseLock()}}function Er(e,t){const n=e.getReader(),r=t.getReader();let a,s,o=!1,i=!1;async function u(c){try{a==null&&(a=n.read());const h=await a;a=void 0,h.done?c.close():c.enqueue(h.value)}catch(h){c.error(h)}}async function l(c){try{s==null&&(s=r.read());const h=await s;s=void 0,h.done?c.close():c.enqueue(h.value)}catch(h){c.error(h)}}return new ReadableStream({async pull(c){try{if(o){await l(c);return}if(i){await u(c);return}a==null&&(a=n.read()),s==null&&(s=r.read());const{result:h,reader:d}=await Promise.race([a.then(g=>({result:g,reader:n})),s.then(g=>({result:g,reader:r}))]);h.done||c.enqueue(h.value),d===n?(a=void 0,h.done&&(await l(c),o=!0)):(s=void 0,h.done&&(i=!0,await u(c)))}catch(h){c.error(h)}},cancel(){n.cancel(),r.cancel()}})}function Ad({tools:e,generatorStream:t,toolCallStreaming:n,tracer:r,telemetry:a,system:s,messages:o,abortSignal:i,repairToolCall:u}){let l=null;const c=new ReadableStream({start(v){l=v}}),h={},d=new Set;let g=!1,_;function m(){g&&d.size===0&&(_!=null&&l.enqueue(_),l.close())}const y=new TransformStream({async transform(v,x){const R=v.type;switch(R){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":{x.enqueue(v);break}case"file":{x.enqueue(new yc({data:v.data,mimeType:v.mimeType}));break}case"tool-call-delta":{n&&(h[v.toolCallId]||(x.enqueue({type:"tool-call-streaming-start",toolCallId:v.toolCallId,toolName:v.toolName}),h[v.toolCallId]=!0),x.enqueue({type:"tool-call-delta",toolCallId:v.toolCallId,toolName:v.toolName,argsTextDelta:v.argsTextDelta}));break}case"tool-call":{try{const b=await _d({toolCall:v,tools:e,repairToolCall:u,system:s,messages:o});x.enqueue(b);const k=e[b.toolName];if(k.execute!=null){const I=ve();d.add(I),cr({name:"ai.toolCall",attributes:ft({telemetry:a,attributes:{...ur({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":b.toolName,"ai.toolCall.id":b.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(b.args)}}}),tracer:r,fn:async j=>k.execute(b.args,{toolCallId:b.toolCallId,messages:o,abortSignal:i}).then(C=>{l.enqueue({...b,type:"tool-result",result:C}),d.delete(I),m();try{j.setAttributes(ft({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(C)}}}))}catch{}},C=>{to(j,C),l.enqueue({type:"error",error:new cd({toolCallId:b.toolCallId,toolName:b.toolName,toolArgs:b.args,cause:C})}),d.delete(I),m()})})}}catch(b){l.enqueue({type:"error",error:b})}break}case"finish":{_={type:"finish",finishReason:v.finishReason,logprobs:v.logprobs,usage:Kc(v.usage),experimental_providerMetadata:v.providerMetadata};break}default:{const b=R;throw new Error(`Unhandled chunk type: ${b}`)}}},flush(){g=!0,m()}});return new ReadableStream({async start(v){return Promise.all([t.pipeThrough(y).pipeTo(new WritableStream({write(x){v.enqueue(x)},close(){}})),c.pipeTo(new WritableStream({write(x){v.enqueue(x)},close(){v.close()}}))])}})}var Rd=ot({prefix:"aitxt",size:24}),Ed=ot({prefix:"msg",size:24});function Nd({model:e,tools:t,toolChoice:n,system:r,prompt:a,messages:s,maxRetries:o,abortSignal:i,headers:u,maxSteps:l=1,experimental_generateMessageId:c=Ed,experimental_output:h,experimental_continueSteps:d=!1,experimental_telemetry:g,experimental_providerMetadata:_,providerOptions:m=_,experimental_toolCallStreaming:y=!1,toolCallStreaming:v=y,experimental_activeTools:x,experimental_repairToolCall:R,experimental_transform:b,onChunk:k,onError:I,onFinish:j,onStepFinish:C,_internal:{now:D=od,generateId:Y=Rd,currentDate:ue=()=>new Date}={},...ce}){if(typeof e=="string"||e.specificationVersion!=="v1")throw new ic;return new Pd({model:e,telemetry:g,headers:u,settings:ce,maxRetries:o,abortSignal:i,system:r,prompt:a,messages:s,tools:t,toolChoice:n,toolCallStreaming:v,transforms:Id(b),activeTools:x,repairToolCall:R,maxSteps:l,output:h,continueSteps:d,providerOptions:m,onChunk:k,onError:I,onFinish:j,onStepFinish:C,now:D,currentDate:ue,generateId:Y,generateMessageId:c})}function Od(e){if(!e)return new TransformStream({transform(s,o){o.enqueue({part:s,partialOutput:void 0})}});let t="",n="",r="";function a({controller:s,partialOutput:o=void 0}){s.enqueue({part:{type:"text-delta",textDelta:n},partialOutput:o}),n=""}return new TransformStream({transform(s,o){if(s.type==="step-finish"&&a({controller:o}),s.type!=="text-delta"){o.enqueue({part:s,partialOutput:void 0});return}t+=s.textDelta,n+=s.textDelta;const i=e.parsePartial({text:t});if(i!=null){const u=JSON.stringify(i.partial);u!==r&&(a({controller:o,partialOutput:i.partial}),r=u)}},flush(s){n.length>0&&a({controller:s})}})}var Pd=class{constructor({model:e,telemetry:t,headers:n,settings:r,maxRetries:a,abortSignal:s,system:o,prompt:i,messages:u,tools:l,toolChoice:c,toolCallStreaming:h,transforms:d,activeTools:g,repairToolCall:_,maxSteps:m,output:y,continueSteps:v,providerOptions:x,now:R,currentDate:b,generateId:k,generateMessageId:I,onChunk:j,onError:C,onFinish:D,onStepFinish:Y}){this.warningsPromise=new ye,this.usagePromise=new ye,this.finishReasonPromise=new ye,this.providerMetadataPromise=new ye,this.textPromise=new ye,this.reasoningPromise=new ye,this.reasoningDetailsPromise=new ye,this.sourcesPromise=new ye,this.filesPromise=new ye,this.toolCallsPromise=new ye,this.toolResultsPromise=new ye,this.requestPromise=new ye,this.responsePromise=new ye,this.stepsPromise=new ye;var ue;if(m<1)throw new Re({parameter:"maxSteps",value:m,message:"maxSteps must be at least 1"});this.output=y;let ce="",K="",Z="",ae=[],Q=[],de,J=[];const ee=[],X={id:k(),timestamp:b(),modelId:e.modelId,messages:[]};let H=[],Tt=[],On,Pn,jr="initial";const We=[];let Mn;const ni=new TransformStream({async transform(Ne,Oe){Oe.enqueue(Ne);const{part:E}=Ne;if((E.type==="text-delta"||E.type==="reasoning"||E.type==="source"||E.type==="tool-call"||E.type==="tool-result"||E.type==="tool-call-streaming-start"||E.type==="tool-call-delta")&&await(j==null?void 0:j({chunk:E})),E.type==="error"&&await(C==null?void 0:C({error:E.error})),E.type==="text-delta"&&(ce+=E.textDelta,K+=E.textDelta,Z+=E.textDelta),E.type==="reasoning"&&(de==null?(de={type:"text",text:E.textDelta},ae.push(de)):de.text+=E.textDelta),E.type==="reasoning-signature"){if(de==null)throw new $({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});de.signature=E.signature,de=void 0}if(E.type==="redacted-reasoning"&&ae.push({type:"redacted",data:E.data}),E.type==="file"&&Q.push(E),E.type==="source"&&(ee.push(E.source),J.push(E.source)),E.type==="tool-call"&&H.push(E),E.type==="tool-result"&&Tt.push(E),E.type==="step-finish"){const be=wa({text:K,files:Q,reasoning:ae,tools:l??{},toolCalls:H,toolResults:Tt,messageId:E.messageId,generateMessageId:I}),Je=We.length;let ke="done";Je+1<m&&(v&&E.finishReason==="length"&&H.length===0?ke="continue":H.length>0&&Tt.length===H.length&&(ke="tool-result"));const Ht={stepType:jr,text:ce,reasoning:bd(ae),reasoningDetails:ae,files:Q,sources:J,toolCalls:H,toolResults:Tt,finishReason:E.finishReason,usage:E.usage,warnings:E.warnings,logprobs:E.logprobs,request:E.request,response:{...E.response,messages:[...X.messages,...be]},providerMetadata:E.experimental_providerMetadata,experimental_providerMetadata:E.experimental_providerMetadata,isContinued:E.isContinued};await(Y==null?void 0:Y(Ht)),We.push(Ht),H=[],Tt=[],ce="",J=[],ae=[],Q=[],de=void 0,ke!=="done"&&(jr=ke),ke!=="continue"&&(X.messages.push(...be),K="")}E.type==="finish"&&(X.id=E.response.id,X.timestamp=E.response.timestamp,X.modelId=E.response.modelId,X.headers=E.response.headers,Pn=E.usage,On=E.finishReason)},async flush(Ne){var Oe;try{if(We.length===0)return;const E=We[We.length-1];ie.warningsPromise.resolve(E.warnings),ie.requestPromise.resolve(E.request),ie.responsePromise.resolve(E.response),ie.toolCallsPromise.resolve(E.toolCalls),ie.toolResultsPromise.resolve(E.toolResults),ie.providerMetadataPromise.resolve(E.experimental_providerMetadata),ie.reasoningPromise.resolve(E.reasoning),ie.reasoningDetailsPromise.resolve(E.reasoningDetails);const be=On??"unknown",Je=Pn??{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};ie.finishReasonPromise.resolve(be),ie.usagePromise.resolve(Je),ie.textPromise.resolve(Z),ie.sourcesPromise.resolve(ee),ie.filesPromise.resolve(E.files),ie.stepsPromise.resolve(We),await(D==null?void 0:D({finishReason:be,logprobs:void 0,usage:Je,text:Z,reasoning:E.reasoning,reasoningDetails:E.reasoningDetails,files:E.files,sources:E.sources,toolCalls:E.toolCalls,toolResults:E.toolResults,request:(Oe=E.request)!=null?Oe:{},response:E.response,warnings:E.warnings,providerMetadata:E.providerMetadata,experimental_providerMetadata:E.experimental_providerMetadata,steps:We})),Mn.setAttributes(ft({telemetry:t,attributes:{"ai.response.finishReason":be,"ai.response.text":{output:()=>Z},"ai.response.toolCalls":{output:()=>{var ke;return(ke=E.toolCalls)!=null&&ke.length?JSON.stringify(E.toolCalls):void 0}},"ai.usage.promptTokens":Je.promptTokens,"ai.usage.completionTokens":Je.completionTokens,"ai.response.providerMetadata":JSON.stringify(E.providerMetadata)}}))}catch(E){Ne.error(E)}finally{Mn.end()}}}),Jt=sd();this.addStream=Jt.addStream,this.closeStream=Jt.close;let jn=Jt.stream;for(const Ne of d)jn=jn.pipeThrough(Ne({tools:l,stopStream(){Jt.terminate()}}));this.baseStream=jn.pipeThrough(Od(y)).pipeThrough(ni);const{maxRetries:ri,retry:ai}=dc({maxRetries:a}),Dn=mc(t),Dr=pc({model:e,telemetry:t,headers:n,settings:{...r,maxRetries:ri}}),$n=Gc({prompt:{system:(ue=y==null?void 0:y.injectIntoSystemPrompt({system:o,model:e}))!=null?ue:o,prompt:i,messages:u},tools:l}),ie=this;cr({name:"ai.streamText",attributes:ft({telemetry:t,attributes:{...ur({operationId:"ai.streamText",telemetry:t}),...Dr,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:i,messages:u})},"ai.settings.maxSteps":m}}),tracer:Dn,endWhenDone:!1,fn:async Ne=>{Mn=Ne;async function Oe({currentStep:E,responseMessages:be,usage:Je,stepType:ke,previousStepText:Ht,hasLeadingWhitespace:si,messageId:zt}){var $r;const Ln=be.length===0?$n.type:"messages",Lr=[...$n.messages,...be],Ur=await Ec({prompt:{type:Ln,system:$n.system,messages:Lr},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:($r=e.supportsUrl)==null?void 0:$r.bind(e)}),Gt={type:"regular",...pd({tools:l,toolChoice:c,activeTools:g})},{result:{stream:oi,warnings:Un,rawResponse:Wt,request:qr},doStreamSpan:ut,startTimestampMs:Fr}=await ai(()=>cr({name:"ai.streamText.doStream",attributes:ft({telemetry:t,attributes:{...ur({operationId:"ai.streamText.doStream",telemetry:t}),...Dr,"ai.prompt.format":{input:()=>Ln},"ai.prompt.messages":{input:()=>rd(Ur)},"ai.prompt.tools":{input:()=>{var q;return(q=Gt.tools)==null?void 0:q.map(se=>JSON.stringify(se))}},"ai.prompt.toolChoice":{input:()=>Gt.toolChoice!=null?JSON.stringify(Gt.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":r.frequencyPenalty,"gen_ai.request.max_tokens":r.maxTokens,"gen_ai.request.presence_penalty":r.presencePenalty,"gen_ai.request.stop_sequences":r.stopSequences,"gen_ai.request.temperature":r.temperature,"gen_ai.request.top_k":r.topK,"gen_ai.request.top_p":r.topP}}),tracer:Dn,endWhenDone:!1,fn:async q=>({startTimestampMs:R(),doStreamSpan:q,result:await e.doStream({mode:Gt,...Mc(r),inputFormat:Ln,responseFormat:y==null?void 0:y.responseFormat({model:e}),prompt:Ur,providerMetadata:x,abortSignal:s,headers:n})})})),ii=Ad({tools:l,generatorStream:oi,toolCallStreaming:h,tracer:Dn,telemetry:t,system:o,messages:Lr,repairToolCall:_,abortSignal:s}),Zr=qr??{},Ye=[],qn=[],Fn=[],Vr=[];let Ke,Xe="unknown",He={promptTokens:0,completionTokens:0,totalTokens:0},ct,Br=!0,St="",Jr=ke==="continue"?Ht:"",Zn,Ie={id:k(),timestamp:b(),modelId:e.modelId},dt="",Hr=!1,zr=!0,Gr=!1;async function Vn({controller:q,chunk:se}){q.enqueue(se),St+=se.textDelta,Jr+=se.textDelta,Hr=!0,Gr=se.textDelta.trimEnd()!==se.textDelta}ie.addStream(ii.pipeThrough(new TransformStream({async transform(q,se){var Pe,It,Qe;if(Br){const Me=R()-Fr;Br=!1,ut.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":Me}),ut.setAttributes({"ai.response.msToFirstChunk":Me}),se.enqueue({type:"step-start",messageId:zt,request:Zr,warnings:Un??[]})}if(q.type==="text-delta"&&q.textDelta.length===0)return;const Wr=q.type;switch(Wr){case"text-delta":{if(v){const Me=zr&&si?q.textDelta.trimStart():q.textDelta;if(Me.length===0)break;zr=!1,dt+=Me;const Yt=hd(dt);Yt!=null&&(dt=Yt.suffix,await Vn({controller:se,chunk:{type:"text-delta",textDelta:Yt.prefix+Yt.whitespace}}))}else await Vn({controller:se,chunk:q});break}case"reasoning":{se.enqueue(q),Ke==null?(Ke={type:"text",text:q.textDelta},Fn.push(Ke)):Ke.text+=q.textDelta;break}case"reasoning-signature":{if(se.enqueue(q),Ke==null)throw new kd({chunk:q,message:"reasoning-signature without reasoning"});Ke.signature=q.signature,Ke=void 0;break}case"redacted-reasoning":{se.enqueue(q),Fn.push({type:"redacted",data:q.data});break}case"tool-call":{se.enqueue(q),Ye.push(q);break}case"tool-result":{se.enqueue(q),qn.push(q);break}case"response-metadata":{Ie={id:(Pe=q.id)!=null?Pe:Ie.id,timestamp:(It=q.timestamp)!=null?It:Ie.timestamp,modelId:(Qe=q.modelId)!=null?Qe:Ie.modelId};break}case"finish":{He=q.usage,Xe=q.finishReason,ct=q.experimental_providerMetadata,Zn=q.logprobs;const Me=R()-Fr;ut.addEvent("ai.stream.finish"),ut.setAttributes({"ai.response.msToFinish":Me,"ai.response.avgCompletionTokensPerSecond":1e3*He.completionTokens/Me});break}case"file":{Vr.push(q),se.enqueue(q);break}case"source":case"tool-call-streaming-start":case"tool-call-delta":{se.enqueue(q);break}case"error":{se.enqueue(q),Xe="error";break}default:{const Me=Wr;throw new Error(`Unknown chunk type: ${Me}`)}}},async flush(q){const se=Ye.length>0?JSON.stringify(Ye):void 0;let Pe="done";E+1<m&&(v&&Xe==="length"&&Ye.length===0?Pe="continue":Ye.length>0&&qn.length===Ye.length&&(Pe="tool-result")),v&&dt.length>0&&(Pe!=="continue"||ke==="continue"&&!Hr)&&(await Vn({controller:q,chunk:{type:"text-delta",textDelta:dt}}),dt="");try{ut.setAttributes(ft({telemetry:t,attributes:{"ai.response.finishReason":Xe,"ai.response.text":{output:()=>St},"ai.response.toolCalls":{output:()=>se},"ai.response.id":Ie.id,"ai.response.model":Ie.modelId,"ai.response.timestamp":Ie.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(ct),"ai.usage.promptTokens":He.promptTokens,"ai.usage.completionTokens":He.completionTokens,"gen_ai.response.finish_reasons":[Xe],"gen_ai.response.id":Ie.id,"gen_ai.response.model":Ie.modelId,"gen_ai.usage.input_tokens":He.promptTokens,"gen_ai.usage.output_tokens":He.completionTokens}}))}catch{}finally{ut.end()}q.enqueue({type:"step-finish",finishReason:Xe,usage:He,providerMetadata:ct,experimental_providerMetadata:ct,logprobs:Zn,request:Zr,response:{...Ie,headers:Wt==null?void 0:Wt.headers},warnings:Un,isContinued:Pe==="continue",messageId:zt});const It=Xc(Je,He);if(Pe==="done")q.enqueue({type:"finish",finishReason:Xe,usage:It,providerMetadata:ct,experimental_providerMetadata:ct,logprobs:Zn,response:{...Ie,headers:Wt==null?void 0:Wt.headers}}),ie.closeStream();else{if(ke==="continue"){const Qe=be[be.length-1];typeof Qe.content=="string"?Qe.content+=St:Qe.content.push({text:St,type:"text"})}else be.push(...wa({text:St,files:Vr,reasoning:Fn,tools:l??{},toolCalls:Ye,toolResults:qn,messageId:zt,generateMessageId:I}));await Oe({currentStep:E+1,responseMessages:be,usage:It,stepType:Pe,previousStepText:Jr,hasLeadingWhitespace:Gr,messageId:Pe==="continue"?zt:I()})}}})))}await Oe({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:I()})}}).catch(Ne=>{ie.addStream(new ReadableStream({start(Oe){Oe.enqueue({type:"error",error:Ne}),Oe.close()}})),ie.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get files(){return this.filesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){const[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return Xn(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type==="text-delta"&&t.enqueue(e.textDelta)}})))}get fullStream(){return Xn(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await Cd({stream:this.fullStream,onError:e==null?void 0:e.onError})}catch(n){(t=e==null?void 0:e.onError)==null||t.call(e,n)}}get experimental_partialOutputStream(){if(this.output==null)throw new ld;return Xn(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:n=!1,sendSources:r=!1,experimental_sendFinish:a=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(s,o)=>{const i=s.type;switch(i){case"text-delta":{o.enqueue(pe("text",s.textDelta));break}case"reasoning":{n&&o.enqueue(pe("reasoning",s.textDelta));break}case"redacted-reasoning":{n&&o.enqueue(pe("redacted_reasoning",{data:s.data}));break}case"reasoning-signature":{n&&o.enqueue(pe("reasoning_signature",{signature:s.signature}));break}case"file":{o.enqueue(pe("file",{mimeType:s.mimeType,data:s.base64}));break}case"source":{r&&o.enqueue(pe("source",s.source));break}case"tool-call-streaming-start":{o.enqueue(pe("tool_call_streaming_start",{toolCallId:s.toolCallId,toolName:s.toolName}));break}case"tool-call-delta":{o.enqueue(pe("tool_call_delta",{toolCallId:s.toolCallId,argsTextDelta:s.argsTextDelta}));break}case"tool-call":{o.enqueue(pe("tool_call",{toolCallId:s.toolCallId,toolName:s.toolName,args:s.args}));break}case"tool-result":{o.enqueue(pe("tool_result",{toolCallId:s.toolCallId,result:s.result}));break}case"error":{o.enqueue(pe("error",e(s.error)));break}case"step-start":{o.enqueue(pe("start_step",{messageId:s.messageId}));break}case"step-finish":{o.enqueue(pe("finish_step",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0,isContinued:s.isContinued}));break}case"finish":{a&&o.enqueue(pe("finish_message",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0}));break}default:{const u=i;throw new Error(`Unknown chunk type: ${u}`)}}}}))}pipeDataStreamToResponse(e,{status:t,statusText:n,headers:r,data:a,getErrorMessage:s,sendUsage:o,sendReasoning:i,sendSources:u,experimental_sendFinish:l}={}){ha({response:e,status:t,statusText:n,headers:fa(r,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:a,getErrorMessage:s,sendUsage:o,sendReasoning:i,sendSources:u,experimental_sendFinish:l})})}pipeTextStreamToResponse(e,t){ha({response:e,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText,headers:fa(t==null?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){const t=this.toDataStreamInternal({getErrorMessage:e==null?void 0:e.getErrorMessage,sendUsage:e==null?void 0:e.sendUsage,sendReasoning:e==null?void 0:e.sendReasoning,sendSources:e==null?void 0:e.sendSources,experimental_sendFinish:e==null?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return e!=null&&e.data?Er(e==null?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:t==null?void 0:t.sendUsage,sendReasoning:t==null?void 0:t.sendReasoning,sendSources:t==null?void 0:t.sendSources,experimental_sendFinish:t==null?void 0:t.experimental_sendFinish}))}toDataStreamResponse({headers:e,status:t,statusText:n,data:r,getErrorMessage:a,sendUsage:s,sendReasoning:o,sendSources:i,experimental_sendFinish:u}={}){return new Response(this.toDataStream({data:r,getErrorMessage:a,sendUsage:s,sendReasoning:o,sendSources:i,experimental_sendFinish:u}),{status:t,statusText:n,headers:kn(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:kn(e==null?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},Md=f({name:p(),version:p()}).passthrough(),Nr=f({_meta:le(f({}).passthrough())}).passthrough(),Ft=Nr,jd=f({method:p(),params:le(Nr)}),Dd=f({experimental:le(f({}).passthrough()),logging:le(f({}).passthrough()),prompts:le(f({listChanged:le(he())}).passthrough()),resources:le(f({subscribe:le(he()),listChanged:le(he())}).passthrough()),tools:le(f({listChanged:le(he())}).passthrough())}).passthrough();Ft.extend({protocolVersion:p(),capabilities:Dd,serverInfo:Md,instructions:le(p())});var $d=Ft.extend({nextCursor:le(p())}),Ld=f({name:p(),description:le(p()),inputSchema:f({type:A("object"),properties:le(f({}).passthrough())}).passthrough()}).passthrough();$d.extend({tools:O(Ld)});var Ud=f({type:A("text"),text:p()}).passthrough(),qd=f({type:A("image"),data:p().base64(),mimeType:p()}).passthrough(),qo=f({uri:p(),mimeType:le(p())}).passthrough(),Fd=qo.extend({text:p()}),Zd=qo.extend({blob:p().base64()}),Vd=f({type:A("resource"),resource:W([Fd,Zd])}).passthrough();Ft.extend({content:O(W([Ud,qd,Vd])),isError:he().default(!1).optional()}).or(Ft.extend({toolResult:kt()}));var Nn="2.0",Bd=f({jsonrpc:A(Nn),id:W([p(),w().int()])}).merge(jd).strict(),Jd=f({jsonrpc:A(Nn),id:W([p(),w().int()]),result:Ft}).strict(),Hd=f({jsonrpc:A(Nn),id:W([p(),w().int()]),error:f({code:w().int(),message:p(),data:le(kt())})}).strict(),zd=f({jsonrpc:A(Nn)}).merge(f({method:p(),params:le(Nr)})).strict();W([Bd,zd,Jd,Hd]);var Gd={};Ar(Gd,{mergeIntoDataStream:()=>Kd,toDataStream:()=>Wd,toDataStreamResponse:()=>Yd});function Fo(e={}){const t=new TextEncoder;let n="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(r,a){a.enqueue(t.encode(r)),n+=r,e.onToken&&await e.onToken(r),e.onText&&typeof r=="string"&&await e.onText(r)},async flush(){e.onCompletion&&await e.onCompletion(n),e.onFinal&&await e.onFinal(n)}})}function Or(e,t){return e.pipeThrough(new TransformStream({transform:async(n,r)=>{var a;if(typeof n=="string"){r.enqueue(n);return}if("event"in n){n.event==="on_chat_model_stream"&&xa((a=n.data)==null?void 0:a.chunk,r);return}xa(n,r)}})).pipeThrough(Fo(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(n,r)=>{r.enqueue(pe("text",n))}}))}function Wd(e,t){return Or(e,t).pipeThrough(new TextEncoderStream)}function Yd(e,t){var n;const r=Or(e,t==null?void 0:t.callbacks).pipeThrough(new TextEncoderStream),a=t==null?void 0:t.data,s=t==null?void 0:t.init,o=a?Er(a.stream,r):r;return new Response(o,{status:(n=s==null?void 0:s.status)!=null?n:200,statusText:s==null?void 0:s.statusText,headers:kn(s==null?void 0:s.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Kd(e,t){t.dataStream.merge(Or(e,t.callbacks))}function xa(e,t){if(typeof e.content=="string")t.enqueue(e.content);else{const n=e.content;for(const r of n)r.type==="text"&&t.enqueue(r.text)}}var Xd={};Ar(Xd,{mergeIntoDataStream:()=>tp,toDataStream:()=>Qd,toDataStreamResponse:()=>ep});function Pr(e,t){const n=np();return Ri(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(r,a){a.enqueue(n(r.delta))}})).pipeThrough(Fo(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,a)=>{a.enqueue(pe("text",r))}}))}function Qd(e,t){return Pr(e,t).pipeThrough(new TextEncoderStream)}function ep(e,t={}){var n;const{init:r,data:a,callbacks:s}=t,o=Pr(e,s).pipeThrough(new TextEncoderStream),i=a?Er(a.stream,o):o;return new Response(i,{status:(n=r==null?void 0:r.status)!=null?n:200,statusText:r==null?void 0:r.statusText,headers:kn(r==null?void 0:r.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function tp(e,t){t.dataStream.merge(Pr(e,t.callbacks))}function np(){let e=!0;return t=>(e&&(t=t.trimStart(),t&&(e=!1)),t)}var rp=f({type:A("error"),error:f({type:p(),message:p()})}),ka=wt({errorSchema:rp,errorToMessage:e=>e.error.message});function ap(e){var t;const n=(t=e.tools)!=null&&t.length?e.tools:void 0,r=[],a=new Set;if(n==null)return{tools:void 0,tool_choice:void 0,toolWarnings:r,betas:a};const s=[];for(const u of n)switch(u.type){case"function":s.push({name:u.name,description:u.description,input_schema:u.parameters});break;case"provider-defined":switch(u.id){case"anthropic.computer_20250124":a.add("computer-use-2025-01-24"),s.push({name:u.name,type:"computer_20250124",display_width_px:u.args.displayWidthPx,display_height_px:u.args.displayHeightPx,display_number:u.args.displayNumber});break;case"anthropic.computer_20241022":a.add("computer-use-2024-10-22"),s.push({name:u.name,type:"computer_20241022",display_width_px:u.args.displayWidthPx,display_height_px:u.args.displayHeightPx,display_number:u.args.displayNumber});break;case"anthropic.text_editor_20250124":a.add("computer-use-2025-01-24"),s.push({name:u.name,type:"text_editor_20250124"});break;case"anthropic.text_editor_20241022":a.add("computer-use-2024-10-22"),s.push({name:u.name,type:"text_editor_20241022"});break;case"anthropic.bash_20250124":a.add("computer-use-2025-01-24"),s.push({name:u.name,type:"bash_20250124"});break;case"anthropic.bash_20241022":a.add("computer-use-2024-10-22"),s.push({name:u.name,type:"bash_20241022"});break;default:r.push({type:"unsupported-tool",tool:u});break}break;default:r.push({type:"unsupported-tool",tool:u});break}const o=e.toolChoice;if(o==null)return{tools:s,tool_choice:void 0,toolWarnings:r,betas:a};const i=o.type;switch(i){case"auto":return{tools:s,tool_choice:{type:"auto"},toolWarnings:r,betas:a};case"required":return{tools:s,tool_choice:{type:"any"},toolWarnings:r,betas:a};case"none":return{tools:void 0,tool_choice:void 0,toolWarnings:r,betas:a};case"tool":return{tools:s,tool_choice:{type:"tool",name:o.toolName},toolWarnings:r,betas:a};default:{const u=i;throw new B({functionality:`Unsupported tool choice type: ${u}`})}}}function sp({prompt:e,sendReasoning:t,warnings:n}){var r,a,s,o;const i=new Set,u=op(e);let l;const c=[];function h(d){var g;const _=d==null?void 0:d.anthropic;return(g=_==null?void 0:_.cacheControl)!=null?g:_==null?void 0:_.cache_control}for(let d=0;d<u.length;d++){const g=u[d],_=d===u.length-1,m=g.type;switch(m){case"system":{if(l!=null)throw new B({functionality:"Multiple system messages that are separated by user/assistant messages"});l=g.messages.map(({content:y,providerMetadata:v})=>({type:"text",text:y,cache_control:h(v)}));break}case"user":{const y=[];for(const v of g.messages){const{role:x,content:R}=v;switch(x){case"user":{for(let b=0;b<R.length;b++){const k=R[b],I=b===R.length-1,j=(r=h(k.providerMetadata))!=null?r:I?h(v.providerMetadata):void 0;switch(k.type){case"text":{y.push({type:"text",text:k.text,cache_control:j});break}case"image":{y.push({type:"image",source:k.image instanceof URL?{type:"url",url:k.image.toString()}:{type:"base64",media_type:(a=k.mimeType)!=null?a:"image/jpeg",data:De(k.image)},cache_control:j});break}case"file":{if(k.mimeType!=="application/pdf")throw new B({functionality:"Non-PDF files in user messages"});i.add("pdfs-2024-09-25"),y.push({type:"document",source:k.data instanceof URL?{type:"url",url:k.data.toString()}:{type:"base64",media_type:"application/pdf",data:k.data},cache_control:j});break}}}break}case"tool":{for(let b=0;b<R.length;b++){const k=R[b],I=b===R.length-1,j=(s=h(k.providerMetadata))!=null?s:I?h(v.providerMetadata):void 0,C=k.content!=null?k.content.map(D=>{var Y;switch(D.type){case"text":return{type:"text",text:D.text,cache_control:void 0};case"image":return{type:"image",source:{type:"base64",media_type:(Y=D.mimeType)!=null?Y:"image/jpeg",data:D.data},cache_control:void 0}}}):JSON.stringify(k.result);y.push({type:"tool_result",tool_use_id:k.toolCallId,content:C,is_error:k.isError,cache_control:j})}break}default:{const b=x;throw new Error(`Unsupported role: ${b}`)}}}c.push({role:"user",content:y});break}case"assistant":{const y=[];for(let v=0;v<g.messages.length;v++){const x=g.messages[v],R=v===g.messages.length-1,{content:b}=x;for(let k=0;k<b.length;k++){const I=b[k],j=k===b.length-1,C=(o=h(I.providerMetadata))!=null?o:j?h(x.providerMetadata):void 0;switch(I.type){case"text":{y.push({type:"text",text:_&&R&&j?I.text.trim():I.text,cache_control:C});break}case"reasoning":{t?y.push({type:"thinking",thinking:I.text,signature:I.signature,cache_control:C}):n.push({type:"other",message:"sending reasoning content is disabled for this model"});break}case"redacted-reasoning":{y.push({type:"redacted_thinking",data:I.data,cache_control:C});break}case"tool-call":{y.push({type:"tool_use",id:I.toolCallId,name:I.toolName,input:I.args,cache_control:C});break}}}}c.push({role:"assistant",content:y});break}default:{const y=m;throw new Error(`Unsupported type: ${y}`)}}}return{prompt:{system:l,messages:c},betas:i}}function op(e){const t=[];let n;for(const r of e){const{role:a}=r;switch(a){case"system":{(n==null?void 0:n.type)!=="system"&&(n={type:"system",messages:[]},t.push(n)),n.messages.push(r);break}case"assistant":{(n==null?void 0:n.type)!=="assistant"&&(n={type:"assistant",messages:[]},t.push(n)),n.messages.push(r);break}case"user":{(n==null?void 0:n.type)!=="user"&&(n={type:"user",messages:[]},t.push(n)),n.messages.push(r);break}case"tool":{(n==null?void 0:n.type)!=="user"&&(n={type:"user",messages:[]},t.push(n)),n.messages.push(r);break}default:{const s=a;throw new Error(`Unsupported role: ${s}`)}}}return t}function Ta(e){switch(e){case"end_turn":case"stop_sequence":return"stop";case"tool_use":return"tool-calls";case"max_tokens":return"length";default:return"unknown"}}var ip=class{constructor(e,t,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.modelId=e,this.settings=t,this.config=n}supportsUrl(e){return e.protocol==="https:"}get provider(){return this.config.provider}get supportsImageUrls(){return this.config.supportsImageUrls}async getArgs({mode:e,prompt:t,maxTokens:n=4096,temperature:r,topP:a,topK:s,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,providerMetadata:h}){var d,g,_;const m=e.type,y=[];o!=null&&y.push({type:"unsupported-setting",setting:"frequencyPenalty"}),i!=null&&y.push({type:"unsupported-setting",setting:"presencePenalty"}),c!=null&&y.push({type:"unsupported-setting",setting:"seed"}),l!=null&&l.type!=="text"&&y.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:v,betas:x}=sp({prompt:t,sendReasoning:(d=this.settings.sendReasoning)!=null?d:!0,warnings:y}),R=it({provider:"anthropic",providerOptions:h,schema:cp}),b=((g=R==null?void 0:R.thinking)==null?void 0:g.type)==="enabled",k=(_=R==null?void 0:R.thinking)==null?void 0:_.budgetTokens,I={model:this.modelId,max_tokens:n,temperature:r,top_k:s,top_p:a,stop_sequences:u,...b&&{thinking:{type:"enabled",budget_tokens:k}},system:v.system,messages:v.messages};if(b){if(k==null)throw new B({functionality:"thinking requires a budget"});I.temperature!=null&&(I.temperature=void 0,y.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported when thinking is enabled"})),s!=null&&(I.top_k=void 0,y.push({type:"unsupported-setting",setting:"topK",details:"topK is not supported when thinking is enabled"})),a!=null&&(I.top_p=void 0,y.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported when thinking is enabled"})),I.max_tokens=n+k}switch(m){case"regular":{const{tools:j,tool_choice:C,toolWarnings:D,betas:Y}=ap(e);return{args:{...I,tools:j,tool_choice:C},warnings:[...y,...D],betas:new Set([...x,...Y])}}case"object-json":throw new B({functionality:"json-mode object generation"});case"object-tool":{const{name:j,description:C,parameters:D}=e.tool;return{args:{...I,tools:[{name:j,description:C,input_schema:D}],tool_choice:{type:"tool",name:j}},warnings:y,betas:x}}default:{const j=m;throw new Error(`Unsupported type: ${j}`)}}}async getHeaders({betas:e,headers:t}){return te(await sn(this.config.headers),e.size>0?{"anthropic-beta":Array.from(e).join(",")}:{},t)}buildRequestUrl(e){var t,n,r;return(r=(n=(t=this.config).buildRequestUrl)==null?void 0:n.call(t,this.config.baseURL,e))!=null?r:`${this.config.baseURL}/messages`}transformRequestBody(e){var t,n,r;return(r=(n=(t=this.config).transformRequestBody)==null?void 0:n.call(t,e))!=null?r:e}async doGenerate(e){var t,n,r,a;const{args:s,warnings:o,betas:i}=await this.getArgs(e),{responseHeaders:u,value:l,rawValue:c}=await ne({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:i,headers:e.headers}),body:this.transformRequestBody(s),failedResponseHandler:ka,successfulResponseHandler:ge(lp),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:h,...d}=s;let g="";for(const y of l.content)y.type==="text"&&(g+=y.text);let _;if(l.content.some(y=>y.type==="tool_use")){_=[];for(const y of l.content)y.type==="tool_use"&&_.push({toolCallType:"function",toolCallId:y.id,toolName:y.name,args:JSON.stringify(y.input)})}const m=l.content.filter(y=>y.type==="redacted_thinking"||y.type==="thinking").map(y=>y.type==="thinking"?{type:"text",text:y.thinking,signature:y.signature}:{type:"redacted",data:y.data});return{text:g,reasoning:m.length>0?m:void 0,toolCalls:_,finishReason:Ta(l.stop_reason),usage:{promptTokens:l.usage.input_tokens,completionTokens:l.usage.output_tokens},rawCall:{rawPrompt:h,rawSettings:d},rawResponse:{headers:u,body:c},response:{id:(t=l.id)!=null?t:void 0,modelId:(n=l.model)!=null?n:void 0},warnings:o,providerMetadata:{anthropic:{cacheCreationInputTokens:(r=l.usage.cache_creation_input_tokens)!=null?r:null,cacheReadInputTokens:(a=l.usage.cache_read_input_tokens)!=null?a:null}},request:{body:JSON.stringify(s)}}}async doStream(e){const{args:t,warnings:n,betas:r}=await this.getArgs(e),a={...t,stream:!0},{responseHeaders:s,value:o}=await ne({url:this.buildRequestUrl(!0),headers:await this.getHeaders({betas:r,headers:e.headers}),body:this.transformRequestBody(a),failedResponseHandler:ka,successfulResponseHandler:lt(up),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:i,...u}=t;let l="unknown";const c={promptTokens:Number.NaN,completionTokens:Number.NaN},h={};let d,g;return{stream:o.pipeThrough(new TransformStream({transform(_,m){var y,v,x,R;if(!_.success){m.enqueue({type:"error",error:_.error});return}const b=_.value;switch(b.type){case"ping":return;case"content_block_start":{const k=b.content_block.type;switch(g=k,k){case"text":case"thinking":return;case"redacted_thinking":{m.enqueue({type:"redacted-reasoning",data:b.content_block.data});return}case"tool_use":{h[b.index]={toolCallId:b.content_block.id,toolName:b.content_block.name,jsonText:""};return}default:{const I=k;throw new Error(`Unsupported content block type: ${I}`)}}}case"content_block_stop":{if(h[b.index]!=null){const k=h[b.index];m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:k.toolCallId,toolName:k.toolName,args:k.jsonText}),delete h[b.index]}g=void 0;return}case"content_block_delta":{const k=b.delta.type;switch(k){case"text_delta":{m.enqueue({type:"text-delta",textDelta:b.delta.text});return}case"thinking_delta":{m.enqueue({type:"reasoning",textDelta:b.delta.thinking});return}case"signature_delta":{g==="thinking"&&m.enqueue({type:"reasoning-signature",signature:b.delta.signature});return}case"input_json_delta":{const I=h[b.index];m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:I.toolCallId,toolName:I.toolName,argsTextDelta:b.delta.partial_json}),I.jsonText+=b.delta.partial_json;return}default:{const I=k;throw new Error(`Unsupported delta type: ${I}`)}}}case"message_start":{c.promptTokens=b.message.usage.input_tokens,c.completionTokens=b.message.usage.output_tokens,d={anthropic:{cacheCreationInputTokens:(y=b.message.usage.cache_creation_input_tokens)!=null?y:null,cacheReadInputTokens:(v=b.message.usage.cache_read_input_tokens)!=null?v:null}},m.enqueue({type:"response-metadata",id:(x=b.message.id)!=null?x:void 0,modelId:(R=b.message.model)!=null?R:void 0});return}case"message_delta":{c.completionTokens=b.usage.output_tokens,l=Ta(b.delta.stop_reason);return}case"message_stop":{m.enqueue({type:"finish",finishReason:l,usage:c,providerMetadata:d});return}case"error":{m.enqueue({type:"error",error:b.error});return}default:{const k=b;throw new Error(`Unsupported chunk type: ${k}`)}}}})),rawCall:{rawPrompt:i,rawSettings:u},rawResponse:{headers:s},warnings:n,request:{body:JSON.stringify(a)}}}},lp=f({type:A("message"),id:p().nullish(),model:p().nullish(),content:O(Ve("type",[f({type:A("text"),text:p()}),f({type:A("thinking"),thinking:p(),signature:p()}),f({type:A("redacted_thinking"),data:p()}),f({type:A("tool_use"),id:p(),name:p(),input:kt()})])),stop_reason:p().nullish(),usage:f({input_tokens:w(),output_tokens:w(),cache_creation_input_tokens:w().nullish(),cache_read_input_tokens:w().nullish()})}),up=Ve("type",[f({type:A("message_start"),message:f({id:p().nullish(),model:p().nullish(),usage:f({input_tokens:w(),output_tokens:w(),cache_creation_input_tokens:w().nullish(),cache_read_input_tokens:w().nullish()})})}),f({type:A("content_block_start"),index:w(),content_block:Ve("type",[f({type:A("text"),text:p()}),f({type:A("thinking"),thinking:p()}),f({type:A("tool_use"),id:p(),name:p()}),f({type:A("redacted_thinking"),data:p()})])}),f({type:A("content_block_delta"),index:w(),delta:Ve("type",[f({type:A("input_json_delta"),partial_json:p()}),f({type:A("text_delta"),text:p()}),f({type:A("thinking_delta"),thinking:p()}),f({type:A("signature_delta"),signature:p()})])}),f({type:A("content_block_stop"),index:w()}),f({type:A("error"),error:f({type:p(),message:p()})}),f({type:A("message_delta"),delta:f({stop_reason:p().nullish()}),usage:f({output_tokens:w()})}),f({type:A("message_stop")}),f({type:A("ping")})]),cp=f({thinking:f({type:W([A("enabled"),A("disabled")]),budgetTokens:w().optional()}).optional()}),dp=f({command:p(),restart:he().optional()});function pp(e={}){return{type:"provider-defined",id:"anthropic.bash_20241022",args:{},parameters:dp,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var fp=f({command:p(),restart:he().optional()});function hp(e={}){return{type:"provider-defined",id:"anthropic.bash_20250124",args:{},parameters:fp,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var mp=f({command:Ee(["view","create","str_replace","insert","undo_edit"]),path:p(),file_text:p().optional(),insert_line:w().int().optional(),new_str:p().optional(),old_str:p().optional(),view_range:O(w().int()).optional()});function gp(e={}){return{type:"provider-defined",id:"anthropic.text_editor_20241022",args:{},parameters:mp,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var yp=f({command:Ee(["view","create","str_replace","insert","undo_edit"]),path:p(),file_text:p().optional(),insert_line:w().int().optional(),new_str:p().optional(),old_str:p().optional(),view_range:O(w().int()).optional()});function vp(e={}){return{type:"provider-defined",id:"anthropic.text_editor_20250124",args:{},parameters:yp,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var _p=f({action:Ee(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),coordinate:O(w().int()).optional(),text:p().optional()});function bp(e){return{type:"provider-defined",id:"anthropic.computer_20241022",args:{displayWidthPx:e.displayWidthPx,displayHeightPx:e.displayHeightPx,displayNumber:e.displayNumber},parameters:_p,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var wp=f({action:Ee(["key","hold_key","type","cursor_position","mouse_move","left_mouse_down","left_mouse_up","left_click","left_click_drag","right_click","middle_click","double_click","triple_click","scroll","wait","screenshot"]),coordinate:la([w().int(),w().int()]).optional(),duration:w().optional(),scroll_amount:w().optional(),scroll_direction:Ee(["up","down","left","right"]).optional(),start_coordinate:la([w().int(),w().int()]).optional(),text:p().optional()});function xp(e){return{type:"provider-defined",id:"anthropic.computer_20250124",args:{displayWidthPx:e.displayWidthPx,displayHeightPx:e.displayHeightPx,displayNumber:e.displayNumber},parameters:wp,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var kp={bash_20241022:pp,bash_20250124:hp,textEditor_20241022:gp,textEditor_20250124:vp,computer_20241022:bp,computer_20250124:xp};function Zo(e={}){var t;const n=(t=xt(e.baseURL))!=null?t:"https://api.anthropic.com/v1",r=()=>({"anthropic-version":"2023-06-01","x-api-key":Vt({apiKey:e.apiKey,environmentVariableName:"ANTHROPIC_API_KEY",description:"Anthropic"}),...e.headers}),a=(o,i={})=>new ip(o,i,{provider:"anthropic.messages",baseURL:n,headers:r,fetch:e.fetch,supportsImageUrls:!0}),s=function(o,i){if(new.target)throw new Error("The Anthropic model function cannot be called with the new keyword.");return a(o,i)};return s.languageModel=a,s.chat=a,s.messages=a,s.textEmbeddingModel=o=>{throw new ys({modelId:o,modelType:"textEmbeddingModel"})},s.tools=kp,s}Zo();function Tp({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:n="system"}){const r=[],a=[];for(const{role:s,content:o}of e)switch(s){case"system":{switch(n){case"system":{r.push({role:"system",content:o});break}case"developer":{r.push({role:"developer",content:o});break}case"remove":{a.push({type:"other",message:"system messages are removed for this model"});break}default:{const i=n;throw new Error(`Unsupported system message mode: ${i}`)}}break}case"user":{if(o.length===1&&o[0].type==="text"){r.push({role:"user",content:o[0].text});break}r.push({role:"user",content:o.map((i,u)=>{var l,c,h,d;switch(i.type){case"text":return{type:"text",text:i.text};case"image":return{type:"image_url",image_url:{url:i.image instanceof URL?i.image.toString():`data:${(l=i.mimeType)!=null?l:"image/jpeg"};base64,${De(i.image)}`,detail:(h=(c=i.providerMetadata)==null?void 0:c.openai)==null?void 0:h.imageDetail}};case"file":{if(i.data instanceof URL)throw new B({functionality:"'File content parts with URL data' functionality not supported."});switch(i.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:i.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:i.data,format:"mp3"}};case"application/pdf":return{type:"file",file:{filename:(d=i.filename)!=null?d:`part-${u}.pdf`,file_data:`data:application/pdf;base64,${i.data}`}};default:throw new B({functionality:`File content part type ${i.mimeType} in user messages`})}}}})});break}case"assistant":{let i="";const u=[];for(const l of o)switch(l.type){case"text":{i+=l.text;break}case"tool-call":{u.push({id:l.toolCallId,type:"function",function:{name:l.toolName,arguments:JSON.stringify(l.args)}});break}}if(t){if(u.length>1)throw new B({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});r.push({role:"assistant",content:i,function_call:u.length>0?u[0].function:void 0})}else r.push({role:"assistant",content:i,tool_calls:u.length>0?u:void 0});break}case"tool":{for(const i of o)t?r.push({role:"function",name:i.toolName,content:JSON.stringify(i.result)}):r.push({role:"tool",tool_call_id:i.toolCallId,content:JSON.stringify(i.result)});break}default:{const i=s;throw new Error(`Unsupported role: ${i}`)}}return{messages:r,warnings:a}}function Sa(e){var t,n;return(n=(t=e==null?void 0:e.content)==null?void 0:t.map(({token:r,logprob:a,top_logprobs:s})=>({token:r,logprob:a,topLogprobs:s?s.map(({token:o,logprob:i})=>({token:o,logprob:i})):[]})))!=null?n:void 0}function Sn(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Mr=f({error:f({message:p(),type:p().nullish(),param:An().nullish(),code:W([p(),w()]).nullish()})}),Le=wt({errorSchema:Mr,errorToMessage:e=>e.error.message});function In({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function Sp({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:n}){var r;const a=(r=e.tools)!=null&&r.length?e.tools:void 0,s=[];if(a==null)return{tools:void 0,tool_choice:void 0,toolWarnings:s};const o=e.toolChoice;if(t){const l=[];for(const h of a)h.type==="provider-defined"?s.push({type:"unsupported-tool",tool:h}):l.push({name:h.name,description:h.description,parameters:h.parameters});if(o==null)return{functions:l,function_call:void 0,toolWarnings:s};switch(o.type){case"auto":case"none":case void 0:return{functions:l,function_call:void 0,toolWarnings:s};case"required":throw new B({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:l,function_call:{name:o.toolName},toolWarnings:s}}}const i=[];for(const l of a)l.type==="provider-defined"?s.push({type:"unsupported-tool",tool:l}):i.push({type:"function",function:{name:l.name,description:l.description,parameters:l.parameters,strict:n?!0:void 0}});if(o==null)return{tools:i,tool_choice:void 0,toolWarnings:s};const u=o.type;switch(u){case"auto":case"none":case"required":return{tools:i,tool_choice:u,toolWarnings:s};case"tool":return{tools:i,tool_choice:{type:"function",function:{name:o.toolName}},toolWarnings:s};default:{const l=u;throw new B({functionality:`Unsupported tool choice type: ${l}`})}}}var Ip=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:fr(this.modelId)}get defaultObjectGenerationMode(){return Rp(this.modelId)?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:n,temperature:r,topP:a,topK:s,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,providerMetadata:h}){var d,g,_,m,y,v,x,R;const b=e.type,k=[];s!=null&&k.push({type:"unsupported-setting",setting:"topK"}),(l==null?void 0:l.type)==="json"&&l.schema!=null&&!this.supportsStructuredOutputs&&k.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const I=this.settings.useLegacyFunctionCalling;if(I&&this.settings.parallelToolCalls===!0)throw new B({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(I&&this.supportsStructuredOutputs)throw new B({functionality:"structuredOutputs with useLegacyFunctionCalling"});const{messages:j,warnings:C}=Tp({prompt:t,useLegacyFunctionCalling:I,systemMessageMode:Ep(this.modelId)});k.push(...C);const D={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:n,temperature:r,top_p:a,frequency_penalty:o,presence_penalty:i,response_format:(l==null?void 0:l.type)==="json"?this.supportsStructuredOutputs&&l.schema!=null?{type:"json_schema",json_schema:{schema:l.schema,strict:!0,name:(d=l.name)!=null?d:"response",description:l.description}}:{type:"json_object"}:void 0,stop:u,seed:c,max_completion_tokens:(g=h==null?void 0:h.openai)==null?void 0:g.maxCompletionTokens,store:(_=h==null?void 0:h.openai)==null?void 0:_.store,metadata:(m=h==null?void 0:h.openai)==null?void 0:m.metadata,prediction:(y=h==null?void 0:h.openai)==null?void 0:y.prediction,reasoning_effort:(x=(v=h==null?void 0:h.openai)==null?void 0:v.reasoningEffort)!=null?x:this.settings.reasoningEffort,messages:j};switch(fr(this.modelId)?(D.temperature!=null&&(D.temperature=void 0,k.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),D.top_p!=null&&(D.top_p=void 0,k.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),D.frequency_penalty!=null&&(D.frequency_penalty=void 0,k.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),D.presence_penalty!=null&&(D.presence_penalty=void 0,k.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),D.logit_bias!=null&&(D.logit_bias=void 0,k.push({type:"other",message:"logitBias is not supported for reasoning models"})),D.logprobs!=null&&(D.logprobs=void 0,k.push({type:"other",message:"logprobs is not supported for reasoning models"})),D.top_logprobs!=null&&(D.top_logprobs=void 0,k.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),D.max_tokens!=null&&(D.max_completion_tokens==null&&(D.max_completion_tokens=D.max_tokens),D.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&D.temperature!=null&&(D.temperature=void 0,k.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),b){case"regular":{const{tools:Y,tool_choice:ue,functions:ce,function_call:K,toolWarnings:Z}=Sp({mode:e,useLegacyFunctionCalling:I,structuredOutputs:this.supportsStructuredOutputs});return{args:{...D,tools:Y,tool_choice:ue,functions:ce,function_call:K},warnings:[...k,...Z]}}case"object-json":return{args:{...D,response_format:this.supportsStructuredOutputs&&e.schema!=null?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:(R=e.name)!=null?R:"response",description:e.description}}:{type:"json_object"}},warnings:k};case"object-tool":return{args:I?{...D,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...D,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:this.supportsStructuredOutputs?!0:void 0}}]},warnings:k};default:{const Y=b;throw new Error(`Unsupported type: ${Y}`)}}}async doGenerate(e){var t,n,r,a,s,o,i,u;const{args:l,warnings:c}=this.getArgs(e),{responseHeaders:h,value:d,rawValue:g}=await ne({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),body:l,failedResponseHandler:Le,successfulResponseHandler:ge(Cp),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:_,...m}=l,y=d.choices[0],v=(t=d.usage)==null?void 0:t.completion_tokens_details,x=(n=d.usage)==null?void 0:n.prompt_tokens_details,R={openai:{}};return(v==null?void 0:v.reasoning_tokens)!=null&&(R.openai.reasoningTokens=v==null?void 0:v.reasoning_tokens),(v==null?void 0:v.accepted_prediction_tokens)!=null&&(R.openai.acceptedPredictionTokens=v==null?void 0:v.accepted_prediction_tokens),(v==null?void 0:v.rejected_prediction_tokens)!=null&&(R.openai.rejectedPredictionTokens=v==null?void 0:v.rejected_prediction_tokens),(x==null?void 0:x.cached_tokens)!=null&&(R.openai.cachedPromptTokens=x==null?void 0:x.cached_tokens),{text:(r=y.message.content)!=null?r:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&y.message.function_call?[{toolCallType:"function",toolCallId:ve(),toolName:y.message.function_call.name,args:y.message.function_call.arguments}]:(a=y.message.tool_calls)==null?void 0:a.map(b=>{var k;return{toolCallType:"function",toolCallId:(k=b.id)!=null?k:ve(),toolName:b.function.name,args:b.function.arguments}}),finishReason:Sn(y.finish_reason),usage:{promptTokens:(o=(s=d.usage)==null?void 0:s.prompt_tokens)!=null?o:NaN,completionTokens:(u=(i=d.usage)==null?void 0:i.completion_tokens)!=null?u:NaN},rawCall:{rawPrompt:_,rawSettings:m},rawResponse:{headers:h,body:g},request:{body:JSON.stringify(l)},response:In(d),warnings:c,logprobs:Sa(y.logprobs),providerMetadata:R}}async doStream(e){if(this.settings.simulateStreaming){const m=await this.doGenerate(e);return{stream:new ReadableStream({start(v){if(v.enqueue({type:"response-metadata",...m.response}),m.text&&v.enqueue({type:"text-delta",textDelta:m.text}),m.toolCalls)for(const x of m.toolCalls)v.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:x.toolCallId,toolName:x.toolName,argsTextDelta:x.args}),v.enqueue({type:"tool-call",...x});v.enqueue({type:"finish",finishReason:m.finishReason,usage:m.usage,logprobs:m.logprobs,providerMetadata:m.providerMetadata}),v.close()}}),rawCall:m.rawCall,rawResponse:m.rawResponse,warnings:m.warnings}}const{args:t,warnings:n}=this.getArgs(e),r={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:a,value:s}=await ne({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),body:r,failedResponseHandler:Le,successfulResponseHandler:lt(Ap),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=t,u=[];let l="unknown",c={promptTokens:void 0,completionTokens:void 0},h,d=!0;const{useLegacyFunctionCalling:g}=this.settings,_={openai:{}};return{stream:s.pipeThrough(new TransformStream({transform(m,y){var v,x,R,b,k,I,j,C,D,Y,ue,ce;if(!m.success){l="error",y.enqueue({type:"error",error:m.error});return}const K=m.value;if("error"in K){l="error",y.enqueue({type:"error",error:K.error});return}if(d&&(d=!1,y.enqueue({type:"response-metadata",...In(K)})),K.usage!=null){const{prompt_tokens:J,completion_tokens:ee,prompt_tokens_details:X,completion_tokens_details:H}=K.usage;c={promptTokens:J??void 0,completionTokens:ee??void 0},(H==null?void 0:H.reasoning_tokens)!=null&&(_.openai.reasoningTokens=H==null?void 0:H.reasoning_tokens),(H==null?void 0:H.accepted_prediction_tokens)!=null&&(_.openai.acceptedPredictionTokens=H==null?void 0:H.accepted_prediction_tokens),(H==null?void 0:H.rejected_prediction_tokens)!=null&&(_.openai.rejectedPredictionTokens=H==null?void 0:H.rejected_prediction_tokens),(X==null?void 0:X.cached_tokens)!=null&&(_.openai.cachedPromptTokens=X==null?void 0:X.cached_tokens)}const Z=K.choices[0];if((Z==null?void 0:Z.finish_reason)!=null&&(l=Sn(Z.finish_reason)),(Z==null?void 0:Z.delta)==null)return;const ae=Z.delta;ae.content!=null&&y.enqueue({type:"text-delta",textDelta:ae.content});const Q=Sa(Z==null?void 0:Z.logprobs);Q!=null&&Q.length&&(h===void 0&&(h=[]),h.push(...Q));const de=g&&ae.function_call!=null?[{type:"function",id:ve(),function:ae.function_call,index:0}]:ae.tool_calls;if(de!=null)for(const J of de){const ee=J.index;if(u[ee]==null){if(J.type!=="function")throw new ht({data:J,message:"Expected 'function' type."});if(J.id==null)throw new ht({data:J,message:"Expected 'id' to be a string."});if(((v=J.function)==null?void 0:v.name)==null)throw new ht({data:J,message:"Expected 'function.name' to be a string."});u[ee]={id:J.id,type:"function",function:{name:J.function.name,arguments:(x=J.function.arguments)!=null?x:""},hasFinished:!1};const H=u[ee];((R=H.function)==null?void 0:R.name)!=null&&((b=H.function)==null?void 0:b.arguments)!=null&&(H.function.arguments.length>0&&y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:H.id,toolName:H.function.name,argsTextDelta:H.function.arguments}),an(H.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(k=H.id)!=null?k:ve(),toolName:H.function.name,args:H.function.arguments}),H.hasFinished=!0));continue}const X=u[ee];X.hasFinished||(((I=J.function)==null?void 0:I.arguments)!=null&&(X.function.arguments+=(C=(j=J.function)==null?void 0:j.arguments)!=null?C:""),y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:X.id,toolName:X.function.name,argsTextDelta:(D=J.function.arguments)!=null?D:""}),((Y=X.function)==null?void 0:Y.name)!=null&&((ue=X.function)==null?void 0:ue.arguments)!=null&&an(X.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(ce=X.id)!=null?ce:ve(),toolName:X.function.name,args:X.function.arguments}),X.hasFinished=!0))}},flush(m){var y,v;m.enqueue({type:"finish",finishReason:l,logprobs:h,usage:{promptTokens:(y=c.promptTokens)!=null?y:NaN,completionTokens:(v=c.completionTokens)!=null?v:NaN},..._!=null?{providerMetadata:_}:{}})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:a},request:{body:JSON.stringify(r)},warnings:n}}},Vo=f({prompt_tokens:w().nullish(),completion_tokens:w().nullish(),prompt_tokens_details:f({cached_tokens:w().nullish()}).nullish(),completion_tokens_details:f({reasoning_tokens:w().nullish(),accepted_prediction_tokens:w().nullish(),rejected_prediction_tokens:w().nullish()}).nullish()}).nullish(),Cp=f({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(f({message:f({role:A("assistant").nullish(),content:p().nullish(),function_call:f({arguments:p(),name:p()}).nullish(),tool_calls:O(f({id:p().nullish(),type:A("function"),function:f({name:p(),arguments:p()})})).nullish()}),index:w(),logprobs:f({content:O(f({token:p(),logprob:w(),top_logprobs:O(f({token:p(),logprob:w()}))})).nullable()}).nullish(),finish_reason:p().nullish()})),usage:Vo}),Ap=W([f({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(f({delta:f({role:Ee(["assistant"]).nullish(),content:p().nullish(),function_call:f({name:p().optional(),arguments:p().optional()}).nullish(),tool_calls:O(f({index:w(),id:p().nullish(),type:A("function").nullish(),function:f({name:p().nullish(),arguments:p().nullish()})})).nullish()}).nullish(),logprobs:f({content:O(f({token:p(),logprob:w(),top_logprobs:O(f({token:p(),logprob:w()}))})).nullable()}).nullish(),finish_reason:p().nullish(),index:w()})),usage:Vo}),Mr]);function fr(e){return e.startsWith("o")||e.startsWith("gpt-5")}function Rp(e){return e.startsWith("gpt-4o-audio-preview")}function Ep(e){var t,n;return fr(e)?(n=(t=Np[e])==null?void 0:t.systemMessageMode)!=null?n:"developer":"system"}var Np={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function Op({prompt:e,inputFormat:t,user:n="user",assistant:r="assistant"}){if(t==="prompt"&&e.length===1&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0].type==="text")return{prompt:e[0].content[0].text};let a="";e[0].role==="system"&&(a+=`${e[0].content}

`,e=e.slice(1));for(const{role:s,content:o}of e)switch(s){case"system":throw new qe({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{const i=o.map(u=>{switch(u.type){case"text":return u.text;case"image":throw new B({functionality:"images"})}}).join("");a+=`${n}:
${i}

`;break}case"assistant":{const i=o.map(u=>{switch(u.type){case"text":return u.text;case"tool-call":throw new B({functionality:"tool-call messages"})}}).join("");a+=`${r}:
${i}

`;break}case"tool":throw new B({functionality:"tool messages"});default:{const i=s;throw new Error(`Unsupported role: ${i}`)}}return a+=`${r}:
`,{prompt:a,stopSequences:[`
${n}:`]}}function Ia(e){return e==null?void 0:e.tokens.map((t,n)=>({token:t,logprob:e.token_logprobs[n],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[n]).map(([r,a])=>({token:r,logprob:a})):[]}))}var Pp=class{constructor(e,t,n){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:n,maxTokens:r,temperature:a,topP:s,topK:o,frequencyPenalty:i,presencePenalty:u,stopSequences:l,responseFormat:c,seed:h}){var d;const g=e.type,_=[];o!=null&&_.push({type:"unsupported-setting",setting:"topK"}),c!=null&&c.type!=="text"&&_.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:m,stopSequences:y}=Op({prompt:n,inputFormat:t}),v=[...y??[],...l??[]],x={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:r,temperature:a,top_p:s,frequency_penalty:i,presence_penalty:u,seed:h,prompt:m,stop:v.length>0?v:void 0};switch(g){case"regular":{if((d=e.tools)!=null&&d.length)throw new B({functionality:"tools"});if(e.toolChoice)throw new B({functionality:"toolChoice"});return{args:x,warnings:_}}case"object-json":throw new B({functionality:"object-json mode"});case"object-tool":throw new B({functionality:"object-tool mode"});default:{const R=g;throw new Error(`Unsupported type: ${R}`)}}}async doGenerate(e){const{args:t,warnings:n}=this.getArgs(e),{responseHeaders:r,value:a,rawValue:s}=await ne({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),body:t,failedResponseHandler:Le,successfulResponseHandler:ge(Mp),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...i}=t,u=a.choices[0];return{text:u.text,usage:{promptTokens:a.usage.prompt_tokens,completionTokens:a.usage.completion_tokens},finishReason:Sn(u.finish_reason),logprobs:Ia(u.logprobs),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:r,body:s},response:In(a),warnings:n,request:{body:JSON.stringify(t)}}}async doStream(e){const{args:t,warnings:n}=this.getArgs(e),r={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:a,value:s}=await ne({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),body:r,failedResponseHandler:Le,successfulResponseHandler:lt(jp),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...i}=t;let u="unknown",l={promptTokens:Number.NaN,completionTokens:Number.NaN},c,h=!0;return{stream:s.pipeThrough(new TransformStream({transform(d,g){if(!d.success){u="error",g.enqueue({type:"error",error:d.error});return}const _=d.value;if("error"in _){u="error",g.enqueue({type:"error",error:_.error});return}h&&(h=!1,g.enqueue({type:"response-metadata",...In(_)})),_.usage!=null&&(l={promptTokens:_.usage.prompt_tokens,completionTokens:_.usage.completion_tokens});const m=_.choices[0];(m==null?void 0:m.finish_reason)!=null&&(u=Sn(m.finish_reason)),(m==null?void 0:m.text)!=null&&g.enqueue({type:"text-delta",textDelta:m.text});const y=Ia(m==null?void 0:m.logprobs);y!=null&&y.length&&(c===void 0&&(c=[]),c.push(...y))},flush(d){d.enqueue({type:"finish",finishReason:u,logprobs:c,usage:l})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:a},warnings:n,request:{body:JSON.stringify(r)}}}},Mp=f({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(f({text:p(),finish_reason:p(),logprobs:f({tokens:O(p()),token_logprobs:O(w()),top_logprobs:O(yt(p(),w())).nullable()}).nullish()})),usage:f({prompt_tokens:w(),completion_tokens:w()})}),jp=W([f({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(f({text:p(),finish_reason:p().nullish(),index:w(),logprobs:f({tokens:O(p()),token_logprobs:O(w()),top_logprobs:O(yt(p(),w())).nullable()}).nullish()})),usage:f({prompt_tokens:w(),completion_tokens:w()}).nullish()}),Mr]),Dp=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)!=null?e:!0}async doEmbed({values:e,headers:t,abortSignal:n}){if(e.length>this.maxEmbeddingsPerCall)throw new Cn({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:r,value:a}=await ne({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:te(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:Le,successfulResponseHandler:ge($p),abortSignal:n,fetch:this.config.fetch});return{embeddings:a.data.map(s=>s.embedding),usage:a.usage?{tokens:a.usage.prompt_tokens}:void 0,rawResponse:{headers:r}}}},$p=f({data:O(f({embedding:O(w())})),usage:f({prompt_tokens:w()}).nullish()}),Lp={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},Up=new Set(["gpt-image-1"]),qp=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return(t=(e=this.settings.maxImagesPerCall)!=null?e:Lp[this.modelId])!=null?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:a,providerOptions:s,headers:o,abortSignal:i}){var u,l,c,h;const d=[];r!=null&&d.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),a!=null&&d.push({type:"unsupported-setting",setting:"seed"});const g=(c=(l=(u=this.config._internal)==null?void 0:u.currentDate)==null?void 0:l.call(u))!=null?c:new Date,{value:_,responseHeaders:m}=await ne({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:te(this.config.headers(),o),body:{model:this.modelId,prompt:e,n:t,size:n,...(h=s.openai)!=null?h:{},...Up.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:Le,successfulResponseHandler:ge(Fp),abortSignal:i,fetch:this.config.fetch});return{images:_.data.map(y=>y.b64_json),warnings:d,response:{timestamp:g,modelId:this.modelId,headers:m}}}},Fp=f({data:O(f({b64_json:p()}))}),Zp=f({include:O(p()).nullish(),language:p().nullish(),prompt:p().nullish(),temperature:w().min(0).max(1).nullish().default(0),timestampGranularities:O(Ee(["word","segment"])).nullish().default(["segment"])}),Ca={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},Vp=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:n}){var r,a,s,o,i;const u=[],l=it({provider:"openai",providerOptions:n,schema:Zp}),c=new FormData,h=e instanceof Uint8Array?new Blob([e]):new Blob([Bt(e)]);if(c.append("model",this.modelId),c.append("file",new File([h],"audio",{type:t})),l){const d={include:(r=l.include)!=null?r:void 0,language:(a=l.language)!=null?a:void 0,prompt:(s=l.prompt)!=null?s:void 0,temperature:(o=l.temperature)!=null?o:void 0,timestamp_granularities:(i=l.timestampGranularities)!=null?i:void 0};for(const g in d){const _=d[g];_!==void 0&&c.append(g,String(_))}}return{formData:c,warnings:u}}async doGenerate(e){var t,n,r,a,s,o;const i=(r=(n=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:n.call(t))!=null?r:new Date,{formData:u,warnings:l}=this.getArgs(e),{value:c,responseHeaders:h,rawValue:d}=await Rs({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),formData:u,failedResponseHandler:Le,successfulResponseHandler:ge(Bp),abortSignal:e.abortSignal,fetch:this.config.fetch}),g=c.language!=null&&c.language in Ca?Ca[c.language]:void 0;return{text:c.text,segments:(s=(a=c.words)==null?void 0:a.map(_=>({text:_.word,startSecond:_.start,endSecond:_.end})))!=null?s:[],language:g,durationInSeconds:(o=c.duration)!=null?o:void 0,warnings:l,response:{timestamp:i,modelId:this.modelId,headers:h,body:d}}}},Bp=f({text:p(),language:p().nullish(),duration:w().nullish(),words:O(f({word:p(),start:w(),end:w()})).nullish()});function Jp({prompt:e,systemMessageMode:t}){const n=[],r=[];for(const{role:a,content:s}of e)switch(a){case"system":{switch(t){case"system":{n.push({role:"system",content:s});break}case"developer":{n.push({role:"developer",content:s});break}case"remove":{r.push({type:"other",message:"system messages are removed for this model"});break}default:{const o=t;throw new Error(`Unsupported system message mode: ${o}`)}}break}case"user":{n.push({role:"user",content:s.map((o,i)=>{var u,l,c,h;switch(o.type){case"text":return{type:"input_text",text:o.text};case"image":return{type:"input_image",image_url:o.image instanceof URL?o.image.toString():`data:${(u=o.mimeType)!=null?u:"image/jpeg"};base64,${De(o.image)}`,detail:(c=(l=o.providerMetadata)==null?void 0:l.openai)==null?void 0:c.imageDetail};case"file":{if(o.data instanceof URL)throw new B({functionality:"File URLs in user messages"});switch(o.mimeType){case"application/pdf":return{type:"input_file",filename:(h=o.filename)!=null?h:`part-${i}.pdf`,file_data:`data:application/pdf;base64,${o.data}`};default:throw new B({functionality:"Only PDF files are supported in user messages"})}}}})});break}case"assistant":{for(const o of s)switch(o.type){case"text":{n.push({role:"assistant",content:[{type:"output_text",text:o.text}]});break}case"tool-call":{n.push({type:"function_call",call_id:o.toolCallId,name:o.toolName,arguments:JSON.stringify(o.args)});break}}break}case"tool":{for(const o of s)n.push({type:"function_call_output",call_id:o.toolCallId,output:JSON.stringify(o.result)});break}default:{const o=a;throw new Error(`Unsupported role: ${o}`)}}return{messages:n,warnings:r}}function Aa({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}function Hp({mode:e,strict:t}){var n;const r=(n=e.tools)!=null&&n.length?e.tools:void 0,a=[];if(r==null)return{tools:void 0,tool_choice:void 0,toolWarnings:a};const s=e.toolChoice,o=[];for(const u of r)switch(u.type){case"function":o.push({type:"function",name:u.name,description:u.description,parameters:u.parameters,strict:t?!0:void 0});break;case"provider-defined":switch(u.id){case"openai.web_search_preview":o.push({type:"web_search_preview",search_context_size:u.args.searchContextSize,user_location:u.args.userLocation});break;default:a.push({type:"unsupported-tool",tool:u});break}break;default:a.push({type:"unsupported-tool",tool:u});break}if(s==null)return{tools:o,tool_choice:void 0,toolWarnings:a};const i=s.type;switch(i){case"auto":case"none":case"required":return{tools:o,tool_choice:i,toolWarnings:a};case"tool":return s.toolName==="web_search_preview"?{tools:o,tool_choice:{type:"web_search_preview"},toolWarnings:a}:{tools:o,tool_choice:{type:"function",name:s.toolName},toolWarnings:a};default:{const u=i;throw new B({functionality:`Unsupported tool choice type: ${u}`})}}}var zp=class{constructor(e,t){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}getArgs({mode:e,maxTokens:t,temperature:n,stopSequences:r,topP:a,topK:s,presencePenalty:o,frequencyPenalty:i,seed:u,prompt:l,providerMetadata:c,responseFormat:h}){var d,g,_;const m=[],y=hf(this.modelId),v=e.type;s!=null&&m.push({type:"unsupported-setting",setting:"topK"}),u!=null&&m.push({type:"unsupported-setting",setting:"seed"}),o!=null&&m.push({type:"unsupported-setting",setting:"presencePenalty"}),i!=null&&m.push({type:"unsupported-setting",setting:"frequencyPenalty"}),r!=null&&m.push({type:"unsupported-setting",setting:"stopSequences"});const{messages:x,warnings:R}=Jp({prompt:l,systemMessageMode:y.systemMessageMode});m.push(...R);const b=it({provider:"openai",providerOptions:c,schema:mf}),k=(d=b==null?void 0:b.strictSchemas)!=null?d:!0,I={model:this.modelId,input:x,temperature:n,top_p:a,max_output_tokens:t,...(h==null?void 0:h.type)==="json"&&{text:{format:h.schema!=null?{type:"json_schema",strict:k,name:(g=h.name)!=null?g:"response",description:h.description,schema:h.schema}:{type:"json_object"}}},metadata:b==null?void 0:b.metadata,parallel_tool_calls:b==null?void 0:b.parallelToolCalls,previous_response_id:b==null?void 0:b.previousResponseId,store:b==null?void 0:b.store,user:b==null?void 0:b.user,instructions:b==null?void 0:b.instructions,...y.isReasoningModel&&((b==null?void 0:b.reasoningEffort)!=null||(b==null?void 0:b.reasoningSummary)!=null)&&{reasoning:{...(b==null?void 0:b.reasoningEffort)!=null&&{effort:b.reasoningEffort},...(b==null?void 0:b.reasoningSummary)!=null&&{summary:b.reasoningSummary}}},...y.requiredAutoTruncation&&{truncation:"auto"}};switch(y.isReasoningModel&&(I.temperature!=null&&(I.temperature=void 0,m.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),I.top_p!=null&&(I.top_p=void 0,m.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),v){case"regular":{const{tools:j,tool_choice:C,toolWarnings:D}=Hp({mode:e,strict:k});return{args:{...I,tools:j,tool_choice:C},warnings:[...m,...D]}}case"object-json":return{args:{...I,text:{format:e.schema!=null?{type:"json_schema",strict:k,name:(_=e.name)!=null?_:"response",description:e.description,schema:e.schema}:{type:"json_object"}}},warnings:m};case"object-tool":return{args:{...I,tool_choice:{type:"function",name:e.tool.name},tools:[{type:"function",name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:k}]},warnings:m};default:{const j=v;throw new Error(`Unsupported type: ${j}`)}}}async doGenerate(e){var t,n,r,a,s,o,i;const{args:u,warnings:l}=this.getArgs(e),c=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:h,value:d,rawValue:g}=await ne({url:c,headers:te(this.config.headers(),e.headers),body:u,failedResponseHandler:Le,successfulResponseHandler:ge(f({id:p(),created_at:w(),error:f({message:p(),code:p()}).nullish(),model:p(),output:O(Ve("type",[f({type:A("message"),role:A("assistant"),content:O(f({type:A("output_text"),text:p(),annotations:O(f({type:A("url_citation"),start_index:w(),end_index:w(),url:p(),title:p()}))}))}),f({type:A("function_call"),call_id:p(),name:p(),arguments:p()}),f({type:A("web_search_call")}),f({type:A("computer_call")}),f({type:A("reasoning"),summary:O(f({type:A("summary_text"),text:p()}))})])),incomplete_details:f({reason:p()}).nullable(),usage:Bo})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(d.error)throw new xe({message:d.error.message,url:c,requestBodyValues:u,statusCode:400,responseHeaders:h,responseBody:g,isRetryable:!1});const _=d.output.filter(v=>v.type==="message").flatMap(v=>v.content).filter(v=>v.type==="output_text"),m=d.output.filter(v=>v.type==="function_call").map(v=>({toolCallType:"function",toolCallId:v.call_id,toolName:v.name,args:v.arguments})),y=(n=(t=d.output.find(v=>v.type==="reasoning"))==null?void 0:t.summary)!=null?n:null;return{text:_.map(v=>v.text).join(`
`),sources:_.flatMap(v=>v.annotations.map(x=>{var R,b,k;return{sourceType:"url",id:(k=(b=(R=this.config).generateId)==null?void 0:b.call(R))!=null?k:ve(),url:x.url,title:x.title}})),finishReason:Aa({finishReason:(r=d.incomplete_details)==null?void 0:r.reason,hasToolCalls:m.length>0}),toolCalls:m.length>0?m:void 0,reasoning:y?y.map(v=>({type:"text",text:v.text})):void 0,usage:{promptTokens:d.usage.input_tokens,completionTokens:d.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:h,body:g},request:{body:JSON.stringify(u)},response:{id:d.id,timestamp:new Date(d.created_at*1e3),modelId:d.model},providerMetadata:{openai:{responseId:d.id,cachedPromptTokens:(s=(a=d.usage.input_tokens_details)==null?void 0:a.cached_tokens)!=null?s:null,reasoningTokens:(i=(o=d.usage.output_tokens_details)==null?void 0:o.reasoning_tokens)!=null?i:null}},warnings:l}}async doStream(e){const{args:t,warnings:n}=this.getArgs(e),{responseHeaders:r,value:a}=await ne({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:Le,successfulResponseHandler:lt(rf),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=this;let o="unknown",i=NaN,u=NaN,l=null,c=null,h=null;const d={};let g=!1;return{stream:a.pipeThrough(new TransformStream({transform(_,m){var y,v,x,R,b,k,I,j;if(!_.success){o="error",m.enqueue({type:"error",error:_.error});return}const C=_.value;if(cf(C))C.item.type==="function_call"&&(d[C.output_index]={toolName:C.item.name,toolCallId:C.item.call_id},m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:C.item.call_id,toolName:C.item.name,argsTextDelta:C.item.arguments}));else if(uf(C)){const D=d[C.output_index];D!=null&&m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:D.toolCallId,toolName:D.toolName,argsTextDelta:C.delta})}else lf(C)?(h=C.response.id,m.enqueue({type:"response-metadata",id:C.response.id,timestamp:new Date(C.response.created_at*1e3),modelId:C.response.model})):af(C)?m.enqueue({type:"text-delta",textDelta:C.delta}):pf(C)?m.enqueue({type:"reasoning",textDelta:C.delta}):sf(C)&&C.item.type==="function_call"?(d[C.output_index]=void 0,g=!0,m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:C.item.call_id,toolName:C.item.name,args:C.item.arguments})):of(C)?(o=Aa({finishReason:(y=C.response.incomplete_details)==null?void 0:y.reason,hasToolCalls:g}),i=C.response.usage.input_tokens,u=C.response.usage.output_tokens,l=(x=(v=C.response.usage.input_tokens_details)==null?void 0:v.cached_tokens)!=null?x:l,c=(b=(R=C.response.usage.output_tokens_details)==null?void 0:R.reasoning_tokens)!=null?b:c):df(C)?m.enqueue({type:"source",source:{sourceType:"url",id:(j=(I=(k=s.config).generateId)==null?void 0:I.call(k))!=null?j:ve(),url:C.annotation.url,title:C.annotation.title}}):ff(C)&&m.enqueue({type:"error",error:C})},flush(_){_.enqueue({type:"finish",finishReason:o,usage:{promptTokens:i,completionTokens:u},...(l!=null||c!=null)&&{providerMetadata:{openai:{responseId:h,cachedPromptTokens:l,reasoningTokens:c}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:r},request:{body:JSON.stringify(t)},warnings:n}}},Bo=f({input_tokens:w(),input_tokens_details:f({cached_tokens:w().nullish()}).nullish(),output_tokens:w(),output_tokens_details:f({reasoning_tokens:w().nullish()}).nullish()}),Gp=f({type:A("response.output_text.delta"),delta:p()}),Wp=f({type:Ee(["response.completed","response.incomplete"]),response:f({incomplete_details:f({reason:p()}).nullish(),usage:Bo})}),Yp=f({type:A("response.created"),response:f({id:p(),created_at:w(),model:p()})}),Kp=f({type:A("response.output_item.done"),output_index:w(),item:Ve("type",[f({type:A("message")}),f({type:A("function_call"),id:p(),call_id:p(),name:p(),arguments:p(),status:A("completed")})])}),Xp=f({type:A("response.function_call_arguments.delta"),item_id:p(),output_index:w(),delta:p()}),Qp=f({type:A("response.output_item.added"),output_index:w(),item:Ve("type",[f({type:A("message")}),f({type:A("function_call"),id:p(),call_id:p(),name:p(),arguments:p()})])}),ef=f({type:A("response.output_text.annotation.added"),annotation:f({type:A("url_citation"),url:p(),title:p()})}),tf=f({type:A("response.reasoning_summary_text.delta"),item_id:p(),output_index:w(),summary_index:w(),delta:p()}),nf=f({type:A("error"),code:p(),message:p(),param:p().nullish(),sequence_number:w()}),rf=W([Gp,Wp,Yp,Kp,Xp,Qp,ef,tf,nf,f({type:p()}).passthrough()]);function af(e){return e.type==="response.output_text.delta"}function sf(e){return e.type==="response.output_item.done"}function of(e){return e.type==="response.completed"||e.type==="response.incomplete"}function lf(e){return e.type==="response.created"}function uf(e){return e.type==="response.function_call_arguments.delta"}function cf(e){return e.type==="response.output_item.added"}function df(e){return e.type==="response.output_text.annotation.added"}function pf(e){return e.type==="response.reasoning_summary_text.delta"}function ff(e){return e.type==="error"}function hf(e){return e.startsWith("o")||e.startsWith("gpt-5")?e.startsWith("o1-mini")||e.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1}:{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1}}var mf=f({metadata:An().nullish(),parallelToolCalls:he().nullish(),previousResponseId:p().nullish(),store:he().nullish(),user:p().nullish(),reasoningEffort:p().nullish(),strictSchemas:he().nullish(),instructions:p().nullish(),reasoningSummary:p().nullish()}),gf=f({});function yf({searchContextSize:e,userLocation:t}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:e,userLocation:t},parameters:gf}}var vf={webSearchPreview:yf},_f=f({instructions:p().nullish(),speed:w().min(.25).max(4).default(1).nullish()}),bf=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({text:e,voice:t="alloy",outputFormat:n="mp3",speed:r,instructions:a,providerOptions:s}){const o=[],i=it({provider:"openai",providerOptions:s,schema:_f}),u={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:r,instructions:a};if(n&&(["mp3","opus","aac","flac","wav","pcm"].includes(n)?u.response_format=n:o.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${n}. Using mp3 instead.`})),i){const l={};for(const c in l){const h=l[c];h!==void 0&&(u[c]=h)}}return{requestBody:u,warnings:o}}async doGenerate(e){var t,n,r;const a=(r=(n=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:n.call(t))!=null?r:new Date,{requestBody:s,warnings:o}=this.getArgs(e),{value:i,responseHeaders:u,rawValue:l}=await ne({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),body:s,failedResponseHandler:Le,successfulResponseHandler:Zi(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:i,warnings:o,request:{body:JSON.stringify(s)},response:{timestamp:a,modelId:this.modelId,headers:u,body:l}}}};function Jo(e={}){var t,n,r;const a=(t=xt(e.baseURL))!=null?t:"https://api.openai.com/v1",s=(n=e.compatibility)!=null?n:"compatible",o=(r=e.name)!=null?r:"openai",i=()=>({Authorization:`Bearer ${Vt({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),u=(v,x={})=>new Ip(v,x,{provider:`${o}.chat`,url:({path:R})=>`${a}${R}`,headers:i,compatibility:s,fetch:e.fetch}),l=(v,x={})=>new Pp(v,x,{provider:`${o}.completion`,url:({path:R})=>`${a}${R}`,headers:i,compatibility:s,fetch:e.fetch}),c=(v,x={})=>new Dp(v,x,{provider:`${o}.embedding`,url:({path:R})=>`${a}${R}`,headers:i,fetch:e.fetch}),h=(v,x={})=>new qp(v,x,{provider:`${o}.image`,url:({path:R})=>`${a}${R}`,headers:i,fetch:e.fetch}),d=v=>new Vp(v,{provider:`${o}.transcription`,url:({path:x})=>`${a}${x}`,headers:i,fetch:e.fetch}),g=v=>new bf(v,{provider:`${o}.speech`,url:({path:x})=>`${a}${x}`,headers:i,fetch:e.fetch}),_=(v,x)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return v==="gpt-3.5-turbo-instruct"?l(v,x):u(v,x)},m=v=>new zp(v,{provider:`${o}.responses`,url:({path:x})=>`${a}${x}`,headers:i,fetch:e.fetch}),y=function(v,x){return _(v,x)};return y.languageModel=_,y.chat=u,y.completion=l,y.responses=m,y.embedding=c,y.textEmbedding=c,y.textEmbeddingModel=c,y.image=h,y.imageModel=h,y.transcription=d,y.transcriptionModel=d,y.speech=g,y.speechModel=g,y.tools=vf,y}Jo({compatibility:"strict"});function Te(e){if(wf(e))return;if(typeof e=="boolean")return{type:"boolean",properties:{}};const{type:t,description:n,required:r,properties:a,items:s,allOf:o,anyOf:i,oneOf:u,format:l,const:c,minLength:h,enum:d}=e,g={};if(n&&(g.description=n),r&&(g.required=r),l&&(g.format=l),c!==void 0&&(g.enum=[c]),t&&(Array.isArray(t)?t.includes("null")?(g.type=t.filter(_=>_!=="null")[0],g.nullable=!0):g.type=t:t==="null"?g.type="null":g.type=t),d!==void 0&&(g.enum=d),a!=null&&(g.properties=Object.entries(a).reduce((_,[m,y])=>(_[m]=Te(y),_),{})),s&&(g.items=Array.isArray(s)?s.map(Te):Te(s)),o&&(g.allOf=o.map(Te)),i)if(i.some(_=>typeof _=="object"&&(_==null?void 0:_.type)==="null")){const _=i.filter(m=>!(typeof m=="object"&&(m==null?void 0:m.type)==="null"));if(_.length===1){const m=Te(_[0]);typeof m=="object"&&(g.nullable=!0,Object.assign(g,m))}else g.anyOf=_.map(Te),g.nullable=!0}else g.anyOf=i.map(Te);return u&&(g.oneOf=u.map(Te)),h!==void 0&&(g.minLength=h),g}function wf(e){return e!=null&&typeof e=="object"&&e.type==="object"&&(e.properties==null||Object.keys(e.properties).length===0)&&!e.additionalProperties}function xf(e){var t,n;const r=[],a=[];let s=!0;for(const{role:o,content:i}of e)switch(o){case"system":{if(!s)throw new B({functionality:"system messages are only supported at the beginning of the conversation"});r.push({text:i});break}case"user":{s=!1;const u=[];for(const l of i)switch(l.type){case"text":{u.push({text:l.text});break}case"image":{u.push(l.image instanceof URL?{fileData:{mimeType:(t=l.mimeType)!=null?t:"image/jpeg",fileUri:l.image.toString()}}:{inlineData:{mimeType:(n=l.mimeType)!=null?n:"image/jpeg",data:De(l.image)}});break}case"file":{u.push(l.data instanceof URL?{fileData:{mimeType:l.mimeType,fileUri:l.data.toString()}}:{inlineData:{mimeType:l.mimeType,data:l.data}});break}}a.push({role:"user",parts:u});break}case"assistant":{s=!1,a.push({role:"model",parts:i.map(u=>{switch(u.type){case"text":return u.text.length===0?void 0:{text:u.text};case"file":{if(u.mimeType!=="image/png")throw new B({functionality:"Only PNG images are supported in assistant messages"});if(u.data instanceof URL)throw new B({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:u.mimeType,data:u.data}}}case"tool-call":return{functionCall:{name:u.toolName,args:u.args}}}}).filter(u=>u!==void 0)});break}case"tool":{s=!1,a.push({role:"user",parts:i.map(u=>({functionResponse:{name:u.toolName,response:{name:u.toolName,content:u.result}}}))});break}}return{systemInstruction:r.length>0?{parts:r}:void 0,contents:a}}function Ra(e){return e.includes("/")?e:`models/${e}`}var kf=f({error:f({code:w().nullable(),message:p(),status:p()})}),hr=wt({errorSchema:kf,errorToMessage:e=>e.error.message});function Tf(e,t,n,r){var a,s;const o=(a=e.tools)!=null&&a.length?e.tools:void 0,i=[],u=r.includes("gemini-2"),l=r.includes("gemini-1.5-flash")&&!r.includes("-8b");if(t)return{tools:u?{googleSearch:{}}:{googleSearchRetrieval:!l||!n?{}:{dynamicRetrievalConfig:n}},toolConfig:void 0,toolWarnings:i};if(o==null)return{tools:void 0,toolConfig:void 0,toolWarnings:i};const c=[];for(const g of o)g.type==="provider-defined"?i.push({type:"unsupported-tool",tool:g}):c.push({name:g.name,description:(s=g.description)!=null?s:"",parameters:Te(g.parameters)});const h=e.toolChoice;if(h==null)return{tools:{functionDeclarations:c},toolConfig:void 0,toolWarnings:i};const d=h.type;switch(d){case"auto":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:i};case"none":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:i};case"required":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:i};case"tool":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[h.toolName]}},toolWarnings:i};default:{const g=d;throw new B({functionality:`Unsupported tool choice type: ${g}`})}}}function Ea({finishReason:e,hasToolCalls:t}){switch(e){case"STOP":return t?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";case"MALFORMED_FUNCTION_CALL":return"error";default:return"unknown"}}var Sf=class{constructor(e,t,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=n}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:!0}get provider(){return this.config.provider}async getArgs({mode:e,prompt:t,maxTokens:n,temperature:r,topP:a,topK:s,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,providerMetadata:h}){var d,g,_;const m=e.type,y=[],v=it({provider:"google",providerOptions:h,schema:Rf});((d=v==null?void 0:v.thinkingConfig)==null?void 0:d.includeThoughts)===!0&&!this.config.provider.startsWith("google.vertex.")&&y.push({type:"other",message:`The 'includeThoughts' option is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});const x={maxOutputTokens:n,temperature:r,topK:s,topP:a,frequencyPenalty:o,presencePenalty:i,stopSequences:u,seed:c,responseMimeType:(l==null?void 0:l.type)==="json"?"application/json":void 0,responseSchema:(l==null?void 0:l.type)==="json"&&l.schema!=null&&this.supportsStructuredOutputs?Te(l.schema):void 0,...this.settings.audioTimestamp&&{audioTimestamp:this.settings.audioTimestamp},responseModalities:v==null?void 0:v.responseModalities,thinkingConfig:v==null?void 0:v.thinkingConfig},{contents:R,systemInstruction:b}=xf(t);switch(m){case"regular":{const{tools:k,toolConfig:I,toolWarnings:j}=Tf(e,(g=this.settings.useSearchGrounding)!=null?g:!1,this.settings.dynamicRetrievalConfig,this.modelId);return{args:{generationConfig:x,contents:R,systemInstruction:b,safetySettings:this.settings.safetySettings,tools:k,toolConfig:I,cachedContent:this.settings.cachedContent},warnings:[...y,...j]}}case"object-json":return{args:{generationConfig:{...x,responseMimeType:"application/json",responseSchema:e.schema!=null&&this.supportsStructuredOutputs?Te(e.schema):void 0},contents:R,systemInstruction:b,safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:y};case"object-tool":return{args:{generationConfig:x,contents:R,systemInstruction:b,tools:{functionDeclarations:[{name:e.tool.name,description:(_=e.tool.description)!=null?_:"",parameters:Te(e.tool.parameters)}]},toolConfig:{functionCallingConfig:{mode:"ANY"}},safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:y};default:{const k=m;throw new Error(`Unsupported type: ${k}`)}}}supportsUrl(e){return this.config.isSupportedUrl(e)}async doGenerate(e){var t,n,r,a,s;const{args:o,warnings:i}=await this.getArgs(e),u=JSON.stringify(o),l=te(await sn(this.config.headers),e.headers),{responseHeaders:c,value:h,rawValue:d}=await ne({url:`${this.config.baseURL}/${Ra(this.modelId)}:generateContent`,headers:l,body:o,failedResponseHandler:hr,successfulResponseHandler:ge(Cf),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:g,..._}=o,m=h.candidates[0],y=m.content==null||typeof m.content!="object"||!("parts"in m.content)?[]:m.content.parts,v=Na({parts:y,generateId:this.config.generateId}),x=h.usageMetadata;return{text:Oa(y),reasoning:Pa(y),files:(t=Ma(y))==null?void 0:t.map(R=>({data:R.inlineData.data,mimeType:R.inlineData.mimeType})),toolCalls:v,finishReason:Ea({finishReason:m.finishReason,hasToolCalls:v!=null&&v.length>0}),usage:{promptTokens:(n=x==null?void 0:x.promptTokenCount)!=null?n:NaN,completionTokens:(r=x==null?void 0:x.candidatesTokenCount)!=null?r:NaN},rawCall:{rawPrompt:g,rawSettings:_},rawResponse:{headers:c,body:d},warnings:i,providerMetadata:{google:{groundingMetadata:(a=m.groundingMetadata)!=null?a:null,safetyRatings:(s=m.safetyRatings)!=null?s:null}},sources:ja({groundingMetadata:m.groundingMetadata,generateId:this.config.generateId}),request:{body:u}}}async doStream(e){const{args:t,warnings:n}=await this.getArgs(e),r=JSON.stringify(t),a=te(await sn(this.config.headers),e.headers),{responseHeaders:s,value:o}=await ne({url:`${this.config.baseURL}/${Ra(this.modelId)}:streamGenerateContent?alt=sse`,headers:a,body:t,failedResponseHandler:hr,successfulResponseHandler:lt(Af),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:i,...u}=t;let l="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},h;const d=this.config.generateId;let g=!1;return{stream:o.pipeThrough(new TransformStream({transform(_,m){var y,v,x,R,b,k;if(!_.success){m.enqueue({type:"error",error:_.error});return}const I=_.value,j=I.usageMetadata;j!=null&&(c={promptTokens:(y=j.promptTokenCount)!=null?y:NaN,completionTokens:(v=j.candidatesTokenCount)!=null?v:NaN});const C=(x=I.candidates)==null?void 0:x[0];if(C==null)return;const D=C.content;if(D!=null){const Y=Oa(D.parts);Y!=null&&m.enqueue({type:"text-delta",textDelta:Y});const ue=Pa(D.parts);if(ue!=null)for(const Z of ue)m.enqueue({type:"reasoning",textDelta:Z.text});const ce=Ma(D.parts);if(ce!=null)for(const Z of ce)m.enqueue({type:"file",mimeType:Z.inlineData.mimeType,data:Z.inlineData.data});const K=Na({parts:D.parts,generateId:d});if(K!=null)for(const Z of K)m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:Z.toolCallId,toolName:Z.toolName,argsTextDelta:Z.args}),m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:Z.toolCallId,toolName:Z.toolName,args:Z.args}),g=!0}if(C.finishReason!=null){l=Ea({finishReason:C.finishReason,hasToolCalls:g});const Y=(R=ja({groundingMetadata:C.groundingMetadata,generateId:d}))!=null?R:[];for(const ue of Y)m.enqueue({type:"source",source:ue});h={google:{groundingMetadata:(b=C.groundingMetadata)!=null?b:null,safetyRatings:(k=C.safetyRatings)!=null?k:null}}}},flush(_){_.enqueue({type:"finish",finishReason:l,usage:c,providerMetadata:h})}})),rawCall:{rawPrompt:i,rawSettings:u},rawResponse:{headers:s},warnings:n,request:{body:r}}}};function Na({parts:e,generateId:t}){const n=e==null?void 0:e.filter(r=>"functionCall"in r);return n==null||n.length===0?void 0:n.map(r=>({toolCallType:"function",toolCallId:t(),toolName:r.functionCall.name,args:JSON.stringify(r.functionCall.args)}))}function Oa(e){const t=e==null?void 0:e.filter(n=>"text"in n&&n.thought!==!0);return t==null||t.length===0?void 0:t.map(n=>n.text).join("")}function Pa(e){const t=e==null?void 0:e.filter(n=>"text"in n&&n.thought===!0&&n.text!=null);return t==null||t.length===0?void 0:t.map(n=>({type:"text",text:n.text}))}function Ma(e){return e==null?void 0:e.filter(t=>"inlineData"in t)}function ja({groundingMetadata:e,generateId:t}){var n;return(n=e==null?void 0:e.groundingChunks)==null?void 0:n.filter(r=>r.web!=null).map(r=>({sourceType:"url",id:t(),url:r.web.uri,title:r.web.title}))}var Ho=f({parts:O(W([f({functionCall:f({name:p(),args:kt()})}),f({inlineData:f({mimeType:p(),data:p()})}),f({text:p().nullish(),thought:he().nullish()})])).nullish()}),If=f({web:f({uri:p(),title:p()}).nullish(),retrievedContext:f({uri:p(),title:p()}).nullish()}),zo=f({webSearchQueries:O(p()).nullish(),retrievalQueries:O(p()).nullish(),searchEntryPoint:f({renderedContent:p()}).nullish(),groundingChunks:O(If).nullish(),groundingSupports:O(f({segment:f({startIndex:w().nullish(),endIndex:w().nullish(),text:p().nullish()}),segment_text:p().nullish(),groundingChunkIndices:O(w()).nullish(),supportChunkIndices:O(w()).nullish(),confidenceScores:O(w()).nullish(),confidenceScore:O(w()).nullish()})).nullish(),retrievalMetadata:W([f({webDynamicRetrievalScore:w()}),f({})]).nullish()}),Go=f({category:p().nullish(),probability:p().nullish(),probabilityScore:w().nullish(),severity:p().nullish(),severityScore:w().nullish(),blocked:he().nullish()}),Cf=f({candidates:O(f({content:Ho.nullish().or(f({}).strict()),finishReason:p().nullish(),safetyRatings:O(Go).nullish(),groundingMetadata:zo.nullish()})),usageMetadata:f({promptTokenCount:w().nullish(),candidatesTokenCount:w().nullish(),totalTokenCount:w().nullish()}).nullish()}),Af=f({candidates:O(f({content:Ho.nullish(),finishReason:p().nullish(),safetyRatings:O(Go).nullish(),groundingMetadata:zo.nullish()})).nullish(),usageMetadata:f({promptTokenCount:w().nullish(),candidatesTokenCount:w().nullish(),totalTokenCount:w().nullish()}).nullish()}),Rf=f({responseModalities:O(Ee(["TEXT","IMAGE"])).nullish(),thinkingConfig:f({thinkingBudget:w().nullish(),includeThoughts:he().nullish()}).nullish()}),Ef=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){return 2048}get supportsParallelCalls(){return!0}async doEmbed({values:e,headers:t,abortSignal:n}){if(e.length>this.maxEmbeddingsPerCall)throw new Cn({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const r=te(await sn(this.config.headers),t),{responseHeaders:a,value:s}=await ne({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:r,body:{requests:e.map(o=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:o}]},outputDimensionality:this.settings.outputDimensionality,taskType:this.settings.taskType}))},failedResponseHandler:hr,successfulResponseHandler:ge(Nf),abortSignal:n,fetch:this.config.fetch});return{embeddings:s.embeddings.map(o=>o.values),usage:void 0,rawResponse:{headers:a}}}},Nf=f({embeddings:O(f({values:O(w())}))});function Of(e){return e.toString().startsWith("https://generativelanguage.googleapis.com/v1beta/files/")}function Wo(e={}){var t;const n=(t=xt(e.baseURL))!=null?t:"https://generativelanguage.googleapis.com/v1beta",r=()=>({"x-goog-api-key":Vt({apiKey:e.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...e.headers}),a=(i,u={})=>{var l;return new Sf(i,u,{provider:"google.generative-ai",baseURL:n,headers:r,generateId:(l=e.generateId)!=null?l:ve,isSupportedUrl:Of,fetch:e.fetch})},s=(i,u={})=>new Ef(i,u,{provider:"google.generative-ai",baseURL:n,headers:r,fetch:e.fetch}),o=function(i,u){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return a(i,u)};return o.languageModel=a,o.chat=a,o.generativeAI=a,o.embedding=s,o.textEmbedding=s,o.textEmbeddingModel=s,o}Wo();function Pf(e){const t=[];for(const{role:n,content:r}of e)switch(n){case"system":{t.push({role:"system",content:r});break}case"user":{if(r.length===1&&r[0].type==="text"){t.push({role:"user",content:r[0].text});break}t.push({role:"user",content:r.map(a=>{var s;switch(a.type){case"text":return{type:"text",text:a.text};case"image":return{type:"image_url",image_url:{url:a.image instanceof URL?a.image.toString():`data:${(s=a.mimeType)!=null?s:"image/jpeg"};base64,${De(a.image)}`}};case"file":throw new B({functionality:"File content parts in user messages"})}})});break}case"assistant":{let a="";const s=[];for(const o of r)switch(o.type){case"text":{a+=o.text;break}case"tool-call":{s.push({id:o.toolCallId,type:"function",function:{name:o.toolName,arguments:JSON.stringify(o.args)}});break}}t.push({role:"assistant",content:a,tool_calls:s.length>0?s:void 0});break}case"tool":{for(const a of r)t.push({role:"tool",tool_call_id:a.toolCallId,content:JSON.stringify(a.result)});break}default:{const a=n;throw new Error(`Unsupported role: ${a}`)}}return t}function Da({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}var Yo=f({error:f({message:p(),type:p()})}),mr=wt({errorSchema:Yo,errorToMessage:e=>e.error.message});function Mf({mode:e}){var t;const n=(t=e.tools)!=null&&t.length?e.tools:void 0,r=[];if(n==null)return{tools:void 0,tool_choice:void 0,toolWarnings:r};const a=e.toolChoice,s=[];for(const i of n)i.type==="provider-defined"?r.push({type:"unsupported-tool",tool:i}):s.push({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}});if(a==null)return{tools:s,tool_choice:void 0,toolWarnings:r};const o=a.type;switch(o){case"auto":case"none":case"required":return{tools:s,tool_choice:o,toolWarnings:r};case"tool":return{tools:s,tool_choice:{type:"function",function:{name:a.toolName}},toolWarnings:r};default:{const i=o;throw new B({functionality:`Unsupported tool choice type: ${i}`})}}}function $a(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var jf=class{constructor(e,t,n){this.specificationVersion="v1",this.supportsStructuredOutputs=!1,this.defaultObjectGenerationMode="json",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:n,temperature:r,topP:a,topK:s,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,stream:h,providerMetadata:d}){const g=e.type,_=[];s!=null&&_.push({type:"unsupported-setting",setting:"topK"}),l!=null&&l.type==="json"&&l.schema!=null&&_.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is not supported"});const m=it({provider:"groq",providerOptions:d,schema:f({reasoningFormat:Ee(["parsed","raw","hidden"]).nullish()})}),y={model:this.modelId,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:n,temperature:r,top_p:a,frequency_penalty:o,presence_penalty:i,stop:u,seed:c,response_format:h===!1&&(l==null?void 0:l.type)==="json"?{type:"json_object"}:void 0,reasoning_format:m==null?void 0:m.reasoningFormat,messages:Pf(t)};switch(g){case"regular":{const{tools:v,tool_choice:x,toolWarnings:R}=Mf({mode:e});return{args:{...y,tools:v,tool_choice:x},warnings:[..._,...R]}}case"object-json":return{args:{...y,response_format:h===!1?{type:"json_object"}:void 0},warnings:_};case"object-tool":return{args:{...y,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}}]},warnings:_};default:{const v=g;throw new Error(`Unsupported type: ${v}`)}}}async doGenerate(e){var t,n,r,a,s,o,i;const{args:u,warnings:l}=this.getArgs({...e,stream:!1}),c=JSON.stringify(u),{responseHeaders:h,value:d,rawValue:g}=await ne({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),body:u,failedResponseHandler:mr,successfulResponseHandler:ge(Df),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:_,...m}=u,y=d.choices[0];return{text:(t=y.message.content)!=null?t:void 0,reasoning:(n=y.message.reasoning)!=null?n:void 0,toolCalls:(r=y.message.tool_calls)==null?void 0:r.map(v=>{var x;return{toolCallType:"function",toolCallId:(x=v.id)!=null?x:ve(),toolName:v.function.name,args:v.function.arguments}}),finishReason:$a(y.finish_reason),usage:{promptTokens:(s=(a=d.usage)==null?void 0:a.prompt_tokens)!=null?s:NaN,completionTokens:(i=(o=d.usage)==null?void 0:o.completion_tokens)!=null?i:NaN},rawCall:{rawPrompt:_,rawSettings:m},rawResponse:{headers:h,body:g},response:Da(d),warnings:l,request:{body:c}}}async doStream(e){const{args:t,warnings:n}=this.getArgs({...e,stream:!0}),r=JSON.stringify({...t,stream:!0}),{responseHeaders:a,value:s}=await ne({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:mr,successfulResponseHandler:lt($f),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=t,u=[];let l="unknown",c={promptTokens:void 0,completionTokens:void 0},h=!0;return{stream:s.pipeThrough(new TransformStream({transform(d,g){var _,m,y,v,x,R,b,k,I,j,C,D,Y,ue,ce;if(!d.success){l="error",g.enqueue({type:"error",error:d.error});return}const K=d.value;if("error"in K){l="error",g.enqueue({type:"error",error:K.error});return}h&&(h=!1,g.enqueue({type:"response-metadata",...Da(K)})),((_=K.x_groq)==null?void 0:_.usage)!=null&&(c={promptTokens:(m=K.x_groq.usage.prompt_tokens)!=null?m:void 0,completionTokens:(y=K.x_groq.usage.completion_tokens)!=null?y:void 0});const Z=K.choices[0];if((Z==null?void 0:Z.finish_reason)!=null&&(l=$a(Z.finish_reason)),(Z==null?void 0:Z.delta)==null)return;const ae=Z.delta;if(ae.reasoning!=null&&ae.reasoning.length>0&&g.enqueue({type:"reasoning",textDelta:ae.reasoning}),ae.content!=null&&ae.content.length>0&&g.enqueue({type:"text-delta",textDelta:ae.content}),ae.tool_calls!=null)for(const Q of ae.tool_calls){const de=Q.index;if(u[de]==null){if(Q.type!=="function")throw new ht({data:Q,message:"Expected 'function' type."});if(Q.id==null)throw new ht({data:Q,message:"Expected 'id' to be a string."});if(((v=Q.function)==null?void 0:v.name)==null)throw new ht({data:Q,message:"Expected 'function.name' to be a string."});u[de]={id:Q.id,type:"function",function:{name:Q.function.name,arguments:(x=Q.function.arguments)!=null?x:""},hasFinished:!1};const ee=u[de];((R=ee.function)==null?void 0:R.name)!=null&&((b=ee.function)==null?void 0:b.arguments)!=null&&(ee.function.arguments.length>0&&g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:ee.id,toolName:ee.function.name,argsTextDelta:ee.function.arguments}),an(ee.function.arguments)&&(g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(k=ee.id)!=null?k:ve(),toolName:ee.function.name,args:ee.function.arguments}),ee.hasFinished=!0));continue}const J=u[de];J.hasFinished||(((I=Q.function)==null?void 0:I.arguments)!=null&&(J.function.arguments+=(C=(j=Q.function)==null?void 0:j.arguments)!=null?C:""),g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:J.id,toolName:J.function.name,argsTextDelta:(D=Q.function.arguments)!=null?D:""}),((Y=J.function)==null?void 0:Y.name)!=null&&((ue=J.function)==null?void 0:ue.arguments)!=null&&an(J.function.arguments)&&(g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(ce=J.id)!=null?ce:ve(),toolName:J.function.name,args:J.function.arguments}),J.hasFinished=!0))}},flush(d){var g,_;d.enqueue({type:"finish",finishReason:l,usage:{promptTokens:(g=c.promptTokens)!=null?g:NaN,completionTokens:(_=c.completionTokens)!=null?_:NaN}})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:a},warnings:n,request:{body:r}}}},Df=f({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(f({message:f({content:p().nullish(),reasoning:p().nullish(),tool_calls:O(f({id:p().nullish(),type:A("function"),function:f({name:p(),arguments:p()})})).nullish()}),index:w(),finish_reason:p().nullish()})),usage:f({prompt_tokens:w().nullish(),completion_tokens:w().nullish()}).nullish()}),$f=W([f({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(f({delta:f({content:p().nullish(),reasoning:p().nullish(),tool_calls:O(f({index:w(),id:p().nullish(),type:A("function").optional(),function:f({name:p().nullish(),arguments:p().nullish()})})).nullish()}).nullish(),finish_reason:p().nullable().optional(),index:w()})),x_groq:f({usage:f({prompt_tokens:w().nullish(),completion_tokens:w().nullish()}).nullish()}).nullish()}),Yo]),Lf=f({language:p().nullish(),prompt:p().nullish(),responseFormat:p().nullish(),temperature:w().min(0).max(1).nullish(),timestampGranularities:O(p()).nullish()}),Uf=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:n}){var r,a,s,o,i;const u=[],l=it({provider:"groq",providerOptions:n,schema:Lf}),c=new FormData,h=e instanceof Uint8Array?new Blob([e]):new Blob([Bt(e)]);if(c.append("model",this.modelId),c.append("file",new File([h],"audio",{type:t})),l){const d={language:(r=l.language)!=null?r:void 0,prompt:(a=l.prompt)!=null?a:void 0,response_format:(s=l.responseFormat)!=null?s:void 0,temperature:(o=l.temperature)!=null?o:void 0,timestamp_granularities:(i=l.timestampGranularities)!=null?i:void 0};for(const g in d){const _=d[g];_!==void 0&&c.append(g,String(_))}}return{formData:c,warnings:u}}async doGenerate(e){var t,n,r,a,s;const o=(r=(n=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:n.call(t))!=null?r:new Date,{formData:i,warnings:u}=this.getArgs(e),{value:l,responseHeaders:c,rawValue:h}=await Rs({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:te(this.config.headers(),e.headers),formData:i,failedResponseHandler:mr,successfulResponseHandler:ge(qf),abortSignal:e.abortSignal,fetch:this.config.fetch});return{text:l.text,segments:(s=(a=l.segments)==null?void 0:a.map(d=>({text:d.text,startSecond:d.start,endSecond:d.end})))!=null?s:[],language:l.language,durationInSeconds:l.duration,warnings:u,response:{timestamp:o,modelId:this.modelId,headers:c,body:h}}}},qf=f({task:p(),language:p(),duration:w(),text:p(),segments:O(f({id:w(),seek:w(),start:w(),end:w(),text:p(),tokens:O(w()),temperature:w(),avg_logprob:w(),compression_ratio:w(),no_speech_prob:w()})),x_groq:f({id:p()})});function Ko(e={}){var t;const n=(t=xt(e.baseURL))!=null?t:"https://api.groq.com/openai/v1",r=()=>({Authorization:`Bearer ${Vt({apiKey:e.apiKey,environmentVariableName:"GROQ_API_KEY",description:"Groq"})}`,...e.headers}),a=(u,l={})=>new jf(u,l,{provider:"groq.chat",url:({path:c})=>`${n}${c}`,headers:r,fetch:e.fetch}),s=(u,l)=>{if(new.target)throw new Error("The Groq model function cannot be called with the new keyword.");return a(u,l)},o=u=>new Uf(u,{provider:"groq.transcription",url:({path:l})=>`${n}${l}`,headers:r,fetch:e.fetch}),i=function(u,l){return s(u,l)};return i.languageModel=s,i.chat=a,i.textEmbeddingModel=u=>{throw new ys({modelId:u,modelType:"textEmbeddingModel"})},i.transcription=o,i}Ko();function Ff(e){const t=[];for(let n=0;n<e.length;n++){const{role:r,content:a}=e[n],s=n===e.length-1;switch(r){case"system":{t.push({role:"system",content:a});break}case"user":{t.push({role:"user",content:a.map(o=>{var i;switch(o.type){case"text":return{type:"text",text:o.text};case"image":return{type:"image_url",image_url:o.image instanceof URL?o.image.toString():`data:${(i=o.mimeType)!=null?i:"image/jpeg"};base64,${De(o.image)}`};case"file":{if(!(o.data instanceof URL))throw new B({functionality:"File content parts in user messages"});switch(o.mimeType){case"application/pdf":return{type:"document_url",document_url:o.data.toString()};default:throw new B({functionality:"Only PDF files are supported in user messages"})}}}})});break}case"assistant":{let o="";const i=[];for(const u of a)switch(u.type){case"text":{o+=u.text;break}case"tool-call":{i.push({id:u.toolCallId,type:"function",function:{name:u.toolName,arguments:JSON.stringify(u.args)}});break}}t.push({role:"assistant",content:o,prefix:s?!0:void 0,tool_calls:i.length>0?i:void 0});break}case"tool":{for(const o of a)t.push({role:"tool",name:o.toolName,content:JSON.stringify(o.result),tool_call_id:o.toolCallId});break}default:{const o=r;throw new Error(`Unsupported role: ${o}`)}}}return t}function La(e){switch(e){case"stop":return"stop";case"length":case"model_length":return"length";case"tool_calls":return"tool-calls";default:return"unknown"}}var Zf=f({object:A("error"),message:p(),type:p(),param:p().nullable(),code:p().nullable()}),gr=wt({errorSchema:Zf,errorToMessage:e=>e.message});function Ua({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function Vf(e){var t;const n=(t=e.tools)!=null&&t.length?e.tools:void 0,r=[];if(n==null)return{tools:void 0,tool_choice:void 0,toolWarnings:r};const a=[];for(const i of n)i.type==="provider-defined"?r.push({type:"unsupported-tool",tool:i}):a.push({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}});const s=e.toolChoice;if(s==null)return{tools:a,tool_choice:void 0,toolWarnings:r};const o=s.type;switch(o){case"auto":case"none":return{tools:a,tool_choice:o,toolWarnings:r};case"required":return{tools:a,tool_choice:"any",toolWarnings:r};case"tool":return{tools:a.filter(i=>i.function.name===s.toolName),tool_choice:"any",toolWarnings:r};default:{const i=o;throw new B({functionality:`Unsupported tool choice type: ${i}`})}}}var Bf=class{constructor(e,t,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}supportsUrl(e){return e.protocol==="https:"}getArgs({mode:e,prompt:t,maxTokens:n,temperature:r,topP:a,topK:s,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,providerMetadata:h}){var d,g;const _=e.type,m=[];s!=null&&m.push({type:"unsupported-setting",setting:"topK"}),o!=null&&m.push({type:"unsupported-setting",setting:"frequencyPenalty"}),i!=null&&m.push({type:"unsupported-setting",setting:"presencePenalty"}),u!=null&&m.push({type:"unsupported-setting",setting:"stopSequences"}),l!=null&&l.type==="json"&&l.schema!=null&&m.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is not supported"});const y={model:this.modelId,safe_prompt:this.settings.safePrompt,max_tokens:n,temperature:r,top_p:a,random_seed:c,response_format:(l==null?void 0:l.type)==="json"?{type:"json_object"}:void 0,document_image_limit:(d=h==null?void 0:h.mistral)==null?void 0:d.documentImageLimit,document_page_limit:(g=h==null?void 0:h.mistral)==null?void 0:g.documentPageLimit,messages:Ff(t)};switch(_){case"regular":{const{tools:v,tool_choice:x,toolWarnings:R}=Vf(e);return{args:{...y,tools:v,tool_choice:x},warnings:[...m,...R]}}case"object-json":return{args:{...y,response_format:{type:"json_object"}},warnings:m};case"object-tool":return{args:{...y,tool_choice:"any",tools:[{type:"function",function:e.tool}]},warnings:m};default:{const v=_;throw new Error(`Unsupported type: ${v}`)}}}async doGenerate(e){var t;const{args:n,warnings:r}=this.getArgs(e),{responseHeaders:a,value:s,rawValue:o}=await ne({url:`${this.config.baseURL}/chat/completions`,headers:te(this.config.headers(),e.headers),body:n,failedResponseHandler:gr,successfulResponseHandler:ge(Jf),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:i,...u}=n,l=s.choices[0];let c=qa(l.message.content);const h=i[i.length-1];return h.role==="assistant"&&(c!=null&&c.startsWith(h.content))&&(c=c.slice(h.content.length)),{text:c,toolCalls:(t=l.message.tool_calls)==null?void 0:t.map(d=>({toolCallType:"function",toolCallId:d.id,toolName:d.function.name,args:d.function.arguments})),finishReason:La(l.finish_reason),usage:{promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens},rawCall:{rawPrompt:i,rawSettings:u},rawResponse:{headers:a,body:o},request:{body:JSON.stringify(n)},response:Ua(s),warnings:r}}async doStream(e){const{args:t,warnings:n}=this.getArgs(e),r={...t,stream:!0},{responseHeaders:a,value:s}=await ne({url:`${this.config.baseURL}/chat/completions`,headers:te(this.config.headers(),e.headers),body:r,failedResponseHandler:gr,successfulResponseHandler:lt(Hf),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=t;let u="unknown",l={promptTokens:Number.NaN,completionTokens:Number.NaN},c=0,h=!1;return{stream:s.pipeThrough(new TransformStream({transform(d,g){if(!d.success){g.enqueue({type:"error",error:d.error});return}c++;const _=d.value;c===1&&g.enqueue({type:"response-metadata",...Ua(_)}),_.usage!=null&&(l={promptTokens:_.usage.prompt_tokens,completionTokens:_.usage.completion_tokens});const m=_.choices[0];if((m==null?void 0:m.finish_reason)!=null&&(u=La(m.finish_reason)),(m==null?void 0:m.delta)==null)return;const y=m.delta,v=qa(y.content);if(c<=2){const x=o[o.length-1];if(x.role==="assistant"&&v===x.content.trimEnd()){v.length<x.content.length&&(h=!0);return}}if(v!=null&&(g.enqueue({type:"text-delta",textDelta:h?v.trimStart():v}),h=!1),y.tool_calls!=null)for(const x of y.tool_calls)g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:x.id,toolName:x.function.name,argsTextDelta:x.function.arguments}),g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:x.id,toolName:x.function.name,args:x.function.arguments})},flush(d){d.enqueue({type:"finish",finishReason:u,usage:l})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:a},request:{body:JSON.stringify(r)},warnings:n}}};function qa(e){if(typeof e=="string")return e;if(e==null)return;const t=[];for(const n of e){const{type:r}=n;switch(r){case"text":t.push(n.text);break;case"image_url":case"reference":break;default:{const a=r;throw new Error(`Unsupported type: ${a}`)}}}return t.length?t.join(""):void 0}var Xo=W([p(),O(Ve("type",[f({type:A("text"),text:p()}),f({type:A("image_url"),image_url:W([p(),f({url:p(),detail:p().nullable()})])}),f({type:A("reference"),reference_ids:O(w())})]))]).nullish(),Jf=f({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(f({message:f({role:A("assistant"),content:Xo,tool_calls:O(f({id:p(),function:f({name:p(),arguments:p()})})).nullish()}),index:w(),finish_reason:p().nullish()})),object:A("chat.completion"),usage:f({prompt_tokens:w(),completion_tokens:w()})}),Hf=f({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(f({delta:f({role:Ee(["assistant"]).optional(),content:Xo,tool_calls:O(f({id:p(),function:f({name:p(),arguments:p()})})).nullish()}),finish_reason:p().nullish(),index:w()})),usage:f({prompt_tokens:w(),completion_tokens:w()}).nullish()}),zf=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:32}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)!=null?e:!1}async doEmbed({values:e,abortSignal:t,headers:n}){if(e.length>this.maxEmbeddingsPerCall)throw new Cn({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:r,value:a}=await ne({url:`${this.config.baseURL}/embeddings`,headers:te(this.config.headers(),n),body:{model:this.modelId,input:e,encoding_format:"float"},failedResponseHandler:gr,successfulResponseHandler:ge(Gf),abortSignal:t,fetch:this.config.fetch});return{embeddings:a.data.map(s=>s.embedding),usage:a.usage?{tokens:a.usage.prompt_tokens}:void 0,rawResponse:{headers:r}}}},Gf=f({data:O(f({embedding:O(w())})),usage:f({prompt_tokens:w()}).nullish()});function Qo(e={}){var t;const n=(t=xt(e.baseURL))!=null?t:"https://api.mistral.ai/v1",r=()=>({Authorization:`Bearer ${Vt({apiKey:e.apiKey,environmentVariableName:"MISTRAL_API_KEY",description:"Mistral"})}`,...e.headers}),a=(i,u={})=>new Bf(i,u,{provider:"mistral.chat",baseURL:n,headers:r,fetch:e.fetch}),s=(i,u={})=>new zf(i,u,{provider:"mistral.embedding",baseURL:n,headers:r,fetch:e.fetch}),o=function(i,u){if(new.target)throw new Error("The Mistral model function cannot be called with the new keyword.");return a(i,u)};return o.languageModel=a,o.chat=a,o.embedding=s,o.textEmbedding=s,o.textEmbeddingModel=s,o}Qo();var ei={},yr={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Allow=e.ALL=e.COLLECTION=e.ATOM=e.SPECIAL=e.INF=e._INFINITY=e.INFINITY=e.NAN=e.BOOL=e.NULL=e.OBJ=e.ARR=e.NUM=e.STR=void 0,e.STR=1,e.NUM=2,e.ARR=4,e.OBJ=8,e.NULL=16,e.BOOL=32,e.NAN=64,e.INFINITY=128,e._INFINITY=256,e.INF=e.INFINITY|e._INFINITY,e.SPECIAL=e.NULL|e.BOOL|e.INF|e.NAN,e.ATOM=e.STR|e.NUM|e.SPECIAL,e.COLLECTION=e.ARR|e.OBJ,e.ALL=e.ATOM|e.COLLECTION,e.Allow={STR:e.STR,NUM:e.NUM,ARR:e.ARR,OBJ:e.OBJ,NULL:e.NULL,BOOL:e.BOOL,NAN:e.NAN,INFINITY:e.INFINITY,_INFINITY:e._INFINITY,INF:e.INF,SPECIAL:e.SPECIAL,ATOM:e.ATOM,COLLECTION:e.COLLECTION,ALL:e.ALL},e.default=e.Allow})(yr);(function(e){var t=Kt&&Kt.__createBinding||(Object.create?function(l,c,h,d){d===void 0&&(d=h);var g=Object.getOwnPropertyDescriptor(c,h);(!g||("get"in g?!c.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return c[h]}}),Object.defineProperty(l,d,g)}:function(l,c,h,d){d===void 0&&(d=h),l[d]=c[h]}),n=Kt&&Kt.__exportStar||function(l,c){for(var h in l)h!=="default"&&!Object.prototype.hasOwnProperty.call(c,h)&&t(c,l,h)};Object.defineProperty(e,"__esModule",{value:!0}),e.Allow=e.MalformedJSON=e.PartialJSON=e.parseJSON=e.parse=void 0;const r=yr;Object.defineProperty(e,"Allow",{enumerable:!0,get:function(){return r.Allow}}),n(yr,e);class a extends Error{}e.PartialJSON=a;class s extends Error{}e.MalformedJSON=s;function o(l,c=r.Allow.ALL){if(typeof l!="string")throw new TypeError(`expecting str, got ${typeof l}`);if(!l.trim())throw new Error(`${l} is empty`);return i(l.trim(),c)}e.parseJSON=o;const i=(l,c)=>{const h=l.length;let d=0;const g=k=>{throw new a(`${k} at position ${d}`)},_=k=>{throw new s(`${k} at position ${d}`)},m=()=>(b(),d>=h&&g("Unexpected end of input"),l[d]==='"'?y():l[d]==="{"?v():l[d]==="["?x():l.substring(d,d+4)==="null"||r.Allow.NULL&c&&h-d<4&&"null".startsWith(l.substring(d))?(d+=4,null):l.substring(d,d+4)==="true"||r.Allow.BOOL&c&&h-d<4&&"true".startsWith(l.substring(d))?(d+=4,!0):l.substring(d,d+5)==="false"||r.Allow.BOOL&c&&h-d<5&&"false".startsWith(l.substring(d))?(d+=5,!1):l.substring(d,d+8)==="Infinity"||r.Allow.INFINITY&c&&h-d<8&&"Infinity".startsWith(l.substring(d))?(d+=8,1/0):l.substring(d,d+9)==="-Infinity"||r.Allow._INFINITY&c&&1<h-d&&h-d<9&&"-Infinity".startsWith(l.substring(d))?(d+=9,-1/0):l.substring(d,d+3)==="NaN"||r.Allow.NAN&c&&h-d<3&&"NaN".startsWith(l.substring(d))?(d+=3,NaN):R()),y=()=>{const k=d;let I=!1;for(d++;d<h&&(l[d]!=='"'||I&&l[d-1]==="\\");)I=l[d]==="\\"?!I:!1,d++;if(l.charAt(d)=='"')try{return JSON.parse(l.substring(k,++d-Number(I)))}catch(j){_(String(j))}else if(r.Allow.STR&c)try{return JSON.parse(l.substring(k,d-Number(I))+'"')}catch{return JSON.parse(l.substring(k,l.lastIndexOf("\\"))+'"')}g("Unterminated string literal")},v=()=>{d++,b();const k={};try{for(;l[d]!=="}";){if(b(),d>=h&&r.Allow.OBJ&c)return k;const I=y();b(),d++;try{const j=m();k[I]=j}catch(j){if(r.Allow.OBJ&c)return k;throw j}b(),l[d]===","&&d++}}catch{if(r.Allow.OBJ&c)return k;g("Expected '}' at end of object")}return d++,k},x=()=>{d++;const k=[];try{for(;l[d]!=="]";)k.push(m()),b(),l[d]===","&&d++}catch{if(r.Allow.ARR&c)return k;g("Expected ']' at end of array")}return d++,k},R=()=>{if(d===0){l==="-"&&_("Not sure what '-' is");try{return JSON.parse(l)}catch(I){if(r.Allow.NUM&c)try{return JSON.parse(l.substring(0,l.lastIndexOf("e")))}catch{}_(String(I))}}const k=d;for(l[d]==="-"&&d++;l[d]&&",]}".indexOf(l[d])===-1;)d++;d==h&&!(r.Allow.NUM&c)&&g("Unterminated number literal");try{return JSON.parse(l.substring(k,d))}catch{l.substring(k,d)==="-"&&g("Not sure what '-' is");try{return JSON.parse(l.substring(k,l.lastIndexOf("e")))}catch(j){_(String(j))}}},b=()=>{for(;d<h&&` 
\r	`.includes(l[d]);)d++};return m()},u=o;e.parse=u})(ei);function Qn(e){const t=[];for(const{content:n,role:r}of e)switch(r){case"system":{t.push({content:n,role:"system"});break}case"user":{t.push({...n.reduce((a,s)=>{if(s.type==="text")a.content+=s.text;else{if(s.type==="image"&&s.image instanceof URL)throw new B({functionality:"Image URLs in user messages"});s.type==="image"&&s.image instanceof Uint8Array&&(a.images=a.images||[],a.images.push(De(s.image)))}return a},{content:""}),role:"user"});break}case"assistant":{const a=[],s=[];for(const o of n)switch(o.type){case"text":{a.push(o.text);break}case"tool-call":{s.push({function:{arguments:o.args,name:o.toolName},id:o.toolCallId,type:"function"});break}default:{const i=o;throw new Error(`Unsupported part: ${i}`)}}t.push({content:a.join(","),role:"assistant",tool_calls:s.length>0?s:void 0});break}case"tool":{t.push(...n.map(a=>({content:typeof a.result=="object"?JSON.stringify(a.result):`${a.result}`,role:"tool",tool_call_id:a.toolCallId})));break}default:{const a=r;throw new Error(`Unsupported role: ${a}`)}}return t}var Wf=class{constructor({tools:e,type:t}){this._firstMessage=!0,this._tools=e,this._toolPartial="",this._toolCalls=[],this._type=t,this._detectedToolCall=!1}get toolCalls(){return this._toolCalls}get detectedToolCall(){return this._detectedToolCall}parse({controller:e,delta:t}){var n;if(this.detectToolCall(t),!this._detectedToolCall)return!1;this._toolPartial+=t;let r=ei.parse(this._toolPartial);Array.isArray(r)||(r=[r]);for(const[a,s]of r.entries()){const o=(n=JSON.stringify(s==null?void 0:s.parameters))!=null?n:"";if(o==="")continue;this._toolCalls[a]||(this._toolCalls[a]={function:{arguments:"",name:s.name},id:ve(),type:"function"});const i=this._toolCalls[a];i.function.arguments=o,e.enqueue({argsTextDelta:t,toolCallId:i.id,toolCallType:"function",toolName:i.function.name,type:"tool-call-delta"})}return!0}finish({controller:e}){for(const t of this.toolCalls)e.enqueue({args:t.function.arguments,toolCallId:t.id,toolCallType:"function",toolName:t.function.name,type:"tool-call"});return this.finishReason()}detectToolCall(e){!this._tools||this._tools.length===0||this._firstMessage&&(this._type==="object-tool"?this._detectedToolCall=!0:this._type==="regular"&&(e.trim().startsWith("{")||e.trim().startsWith("["))&&(this._detectedToolCall=!0),this._firstMessage=!1)}finishReason(){return this.detectedToolCall?this._type==="object-tool"?"stop":"tool-calls":"stop"}};function Yf({finishReason:e,hasToolCalls:t}){switch(e){case"stop":return t?"tool-calls":"stop";default:return"other"}}var Kf=f({error:f({code:p().nullable(),message:p(),param:An().nullable(),type:p()})}),vr=wt({errorSchema:Kf,errorToMessage:e=>e.error.message});function Xf({mode:e}){var t;const n=(t=e.tools)!=null&&t.length?e.tools:void 0,r=[],a=e.toolChoice;if(n===void 0)return{tools:void 0,toolWarnings:r};const s=[];for(const i of n)i.type==="provider-defined"?r.push({tool:i,type:"unsupported-tool"}):s.push({function:{description:i.description,name:i.name,parameters:i.parameters},type:"function"});if(a===void 0)return{tools:s,toolWarnings:r};const o=a.type;switch(o){case"auto":return{tools:s,toolWarnings:r};case"none":return{tools:void 0,toolWarnings:r};default:{const i=o;throw new B({functionality:`Unsupported tool choice type: ${i}`})}}}function Qf(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}var eh=class extends TransformStream{constructor(){super({flush:e=>{this.buffer.length!==0&&e.enqueue(this.buffer)},transform:(e,t)=>{for(e=this.buffer+e;;){const n=e.indexOf(`
`);if(n===-1)break;t.enqueue(e.slice(0,n)),e=e.slice(n+1)}this.buffer=e}}),this.buffer=""}},th=e=>async({response:t})=>{const n=_t(t);if(t.body===null)throw new Ka({});return{responseHeaders:n,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new eh).pipeThrough(new TransformStream({transform(r,a){a.enqueue(tt({schema:e,text:r}))}}))}},nh=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:!1}get provider(){return this.config.provider}getArguments({frequencyPenalty:e,maxTokens:t,mode:n,presencePenalty:r,prompt:a,responseFormat:s,seed:o,stopSequences:i,temperature:u,topK:l,topP:c}){const h=n.type,d=[];s!==void 0&&s.type==="json"&&s.schema!==void 0&&!this.supportsStructuredOutputs&&d.push({details:"JSON response format schema is only supported with structuredOutputs",setting:"responseFormat",type:"unsupported-setting"});const g={format:s==null?void 0:s.type,model:this.modelId,options:Qf({f16_kv:this.settings.f16Kv,frequency_penalty:e,low_vram:this.settings.lowVram,main_gpu:this.settings.mainGpu,min_p:this.settings.minP,mirostat:this.settings.mirostat,mirostat_eta:this.settings.mirostatEta,mirostat_tau:this.settings.mirostatTau,num_batch:this.settings.numBatch,num_ctx:this.settings.numCtx,num_gpu:this.settings.numGpu,num_keep:this.settings.numKeep,num_predict:t,num_thread:this.settings.numThread,numa:this.settings.numa,penalize_newline:this.settings.penalizeNewline,presence_penalty:r,repeat_last_n:this.settings.repeatLastN,repeat_penalty:this.settings.repeatPenalty,seed:o,stop:i,temperature:u,tfs_z:this.settings.tfsZ,top_k:l,top_p:c,typical_p:this.settings.typicalP,use_mlock:this.settings.useMlock,use_mmap:this.settings.useMmap,vocab_only:this.settings.vocabOnly})};switch(h){case"regular":{const{tools:_,toolWarnings:m}=Xf({mode:n});return{args:{...g,messages:Qn(a),tools:_},type:h,warnings:[...d,...m]}}case"object-json":return{args:{...g,format:this.supportsStructuredOutputs&&n.schema!==void 0?n.schema:"json",messages:Qn(a)},type:h,warnings:d};case"object-tool":return{args:{...g,messages:Qn(a),tool_choice:{function:{name:n.tool.name},type:"function"},tools:[{function:{description:n.tool.description,name:n.tool.name,parameters:n.tool.parameters},type:"function"}]},type:h,warnings:d};default:{const _=h;throw new Error(`Unsupported type: ${_}`)}}}async doGenerate(e){var t,n;const{args:r,warnings:a}=this.getArguments(e),s={...r,stream:!1},{responseHeaders:o,value:i}=await ne({abortSignal:e.abortSignal,body:s,failedResponseHandler:vr,fetch:this.config.fetch,headers:te(this.config.headers(),e.headers),successfulResponseHandler:ge(rh),url:`${this.config.baseURL}/chat`}),{messages:u,...l}=s,c=(t=i.message.tool_calls)==null?void 0:t.map(h=>{var d;return{args:JSON.stringify(h.function.arguments),toolCallId:(d=h.id)!=null?d:ve(),toolCallType:"function",toolName:h.function.name}});return{finishReason:Yf({finishReason:i.done_reason,hasToolCalls:c!==void 0&&c.length>0}),rawCall:{rawPrompt:u,rawSettings:l},rawResponse:{headers:o},request:{body:JSON.stringify(s)},text:(n=i.message.content)!=null?n:void 0,toolCalls:c,usage:{completionTokens:i.eval_count||0,promptTokens:i.prompt_eval_count||0},warnings:a}}async doStream(e){if(this.settings.simulateStreaming){const g=await this.doGenerate(e),_=new ReadableStream({start(m){if(m.enqueue({type:"response-metadata",...g.response}),g.text&&m.enqueue({textDelta:g.text,type:"text-delta"}),g.toolCalls)for(const y of g.toolCalls)m.enqueue({argsTextDelta:y.args,toolCallId:y.toolCallId,toolCallType:"function",toolName:y.toolName,type:"tool-call-delta"}),m.enqueue({type:"tool-call",...y});m.enqueue({finishReason:g.finishReason,logprobs:g.logprobs,providerMetadata:g.providerMetadata,type:"finish",usage:g.usage}),m.close()}});return{rawCall:g.rawCall,rawResponse:g.rawResponse,stream:_,warnings:g.warnings}}const{args:t,type:n,warnings:r}=this.getArguments(e),{responseHeaders:a,value:s}=await ne({abortSignal:e.abortSignal,body:t,failedResponseHandler:vr,fetch:this.config.fetch,headers:te(this.config.headers(),e.headers),successfulResponseHandler:th(ah),url:`${this.config.baseURL}/chat`}),{messages:o,...i}=t,u=e.mode.type==="regular"?e.mode.tools:e.mode.type==="object-tool"?[e.mode.tool]:void 0,l=new Wf({tools:u,type:n});let c="other",h={completionTokens:Number.NaN,promptTokens:Number.NaN};const{experimentalStreamTools:d=!0}=this.settings;return{rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:a},request:{body:JSON.stringify(t)},stream:s.pipeThrough(new TransformStream({async flush(g){g.enqueue({finishReason:c,type:"finish",usage:h})},async transform(g,_){if(!g.success){_.enqueue({error:g.error,type:"error"});return}const m=g.value;if(m.done){c=l.finish({controller:_}),h={completionTokens:m.eval_count,promptTokens:m.prompt_eval_count||0};return}d&&l.parse({controller:_,delta:m.message.content})||m.message.content!==null&&_.enqueue({textDelta:m.message.content,type:"text-delta"})}})),warnings:r}}},rh=f({created_at:p(),done:A(!0),done_reason:p().optional().nullable(),eval_count:w(),eval_duration:w(),load_duration:w().optional(),message:f({content:p(),role:p(),tool_calls:O(f({function:f({arguments:yt(An()),name:p()}),id:p().optional()})).optional().nullable()}),model:p(),prompt_eval_count:w().optional(),prompt_eval_duration:w().optional(),total_duration:w()}),ah=Ve("done",[f({created_at:p(),done:A(!1),message:f({content:p(),role:p()}),model:p()}),f({created_at:p(),done:A(!0),eval_count:w(),eval_duration:w(),load_duration:w().optional(),model:p(),prompt_eval_count:w().optional(),prompt_eval_duration:w().optional(),total_duration:w()})]),sh=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){return!1}async doEmbed({abortSignal:e,values:t}){if(t.length>this.maxEmbeddingsPerCall)throw new Cn({maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,modelId:this.modelId,provider:this.provider,values:t});const{responseHeaders:n,value:r}=await ne({abortSignal:e,body:{input:t,model:this.modelId},failedResponseHandler:vr,fetch:this.config.fetch,headers:this.config.headers(),successfulResponseHandler:ge(oh),url:`${this.config.baseURL}/embed`});return{embeddings:r.embeddings,rawResponse:{headers:n},usage:r.prompt_eval_count?{tokens:r.prompt_eval_count}:void 0}}},oh=f({embeddings:O(O(w())),prompt_eval_count:w().nullable()});function ti(e={}){var t;const n=(t=xt(e.baseURL))!=null?t:"http://127.0.0.1:11434/api",r=()=>({...e.headers}),a=(i,u={})=>new nh(i,u,{baseURL:n,fetch:e.fetch,headers:r,provider:"ollama.chat"}),s=(i,u={})=>new sh(i,u,{baseURL:n,fetch:e.fetch,headers:r,provider:"ollama.embedding"}),o=function(i,u){if(new.target)throw new Error("The Ollama model function cannot be called with the new keyword.");return a(i,u)};return o.chat=a,o.embedding=s,o.languageModel=a,o.textEmbedding=s,o.textEmbeddingModel=s,o}ti();chrome.runtime.onMessage.addListener((e,t,n)=>{var r;if(e.type==="GET_SETTINGS")return chrome.storage.sync.get(li,a=>{n(a)}),!0;if(e.type==="SAVE_SETTINGS")return chrome.storage.sync.set(e.payload,()=>{n({ok:!0})}),!0;if(e.type==="CHAT_STREAM"){const a=(r=t.tab)==null?void 0:r.id;return uh({...e.payload,tabId:a},n),!0}if(e.type==="GET_CAPTION_TRACKS")return ih(e.payload.videoId,n),!0;if(e.type==="FETCH_TRANSCRIPT_URL")return lh(e.payload.url,n),!0;if(e.type==="EMBED_TEXT")return dh(e.payload.text,n),!0});async function ih(e,t){var n,r;try{const a=await fetch("https://www.youtube.com/youtubei/v1/player?prettyPrint=false",{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"com.google.android.youtube/19.09.37 (Linux; U; Android 11) gzip","X-YouTube-Client-Name":"3","X-YouTube-Client-Version":"19.09.37"},body:JSON.stringify({context:{client:{clientName:"ANDROID",clientVersion:"19.09.37",androidSdkVersion:30,hl:"en",gl:"US"}},videoId:e})});if(!a.ok){t({error:`Innertube player returned ${a.status}`});return}const s=await a.json(),o=(r=(n=s==null?void 0:s.captions)==null?void 0:n.playerCaptionsTracklistRenderer)==null?void 0:r.captionTracks;t({tracks:Array.isArray(o)?o:[]})}catch(a){t({error:a instanceof Error?a.message:String(a)})}}async function lh(e,t){try{const n=await fetch(e,{headers:{"Accept-Language":"en-US,en;q=0.9"}});if(!n.ok){t({error:`HTTP ${n.status}`});return}const r=await n.text();t({text:r})}catch(n){t({error:n instanceof Error?n.message:String(n)})}}async function uh(e,t){const{messages:n,systemPrompt:r,provider:a,model:s,apiKey:o,ollamaBaseUrl:i,tabId:u}=e;try{let l;switch(a){case"anthropic":l=Zo({apiKey:o});break;case"openai":l=Jo({apiKey:o});break;case"google":l=Wo({apiKey:o});break;case"groq":l=Ko({apiKey:o});break;case"mistral":l=Qo({apiKey:o});break;case"ollama":l=ti({baseURL:(i??"http://localhost:11434")+"/api"});break;default:t({error:`Unknown provider: ${a}`});return}const c=await Nd({model:l(s),system:r,messages:n.map(d=>({role:d.role,content:d.content}))});let h="";for await(const d of c.textStream)h+=d,u!=null&&chrome.tabs.sendMessage(u,{type:"CHAT_CHUNK",payload:{chunk:d,fullText:h}}).catch(()=>{});t({ok:!0,fullText:h})}catch(l){const c=l instanceof Error?l.message:String(l);t({error:c})}}const Fa=chrome.runtime.getURL("src/offscreen/index.html");async function ch(){(await chrome.runtime.getContexts({contextTypes:["OFFSCREEN_DOCUMENT"],documentUrls:[Fa]})).length===0&&await chrome.offscreen.createDocument({url:Fa,reasons:["BLOBS"],justification:"Run ML embedding inference (WASM/ORT) outside service worker"})}async function dh(e,t){try{await ch(),chrome.runtime.sendMessage({type:"OFFSCREEN_EMBED_TEXT",payload:{text:e}},n=>{chrome.runtime.lastError?t({error:chrome.runtime.lastError.message}):t(n)})}catch(n){t({error:n instanceof Error?n.message:String(n)})}}
