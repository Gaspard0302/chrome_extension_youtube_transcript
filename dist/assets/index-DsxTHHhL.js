import{M as Z,N as ee,O as W,o as g,Y as ne,R as V,P as E,z as H,H as D,a0 as B,S as te,V as z,W as oe,U as Y,c as se,h as ae,a2 as re,_ as le,b as S,a as r,q as d,l as Q,u as ie}from"./types-B0luv8fm.js";function ue(e){const n=[];for(const{role:l,content:s}of e)switch(l){case"system":{n.push({role:"system",content:s});break}case"user":{if(s.length===1&&s[0].type==="text"){n.push({role:"user",content:s[0].text});break}n.push({role:"user",content:s.map(t=>{var a;switch(t.type){case"text":return{type:"text",text:t.text};case"image":return{type:"image_url",image_url:{url:t.image instanceof URL?t.image.toString():`data:${(a=t.mimeType)!=null?a:"image/jpeg"};base64,${se(t.image)}`}};case"file":throw new Y({functionality:"File content parts in user messages"})}})});break}case"assistant":{let t="";const a=[];for(const c of s)switch(c.type){case"text":{t+=c.text;break}case"tool-call":{a.push({id:c.toolCallId,type:"function",function:{name:c.toolName,arguments:JSON.stringify(c.args)}});break}}n.push({role:"assistant",content:t,tool_calls:a.length>0?a:void 0});break}case"tool":{for(const t of s)n.push({role:"tool",tool_call_id:t.toolCallId,content:JSON.stringify(t.result)});break}default:{const t=l;throw new Error(`Unsupported role: ${t}`)}}return n}function K({id:e,model:n,created:l}){return{id:e??void 0,modelId:n??void 0,timestamp:l!=null?new Date(l*1e3):void 0}}var X=g({error:g({message:r(),type:r()})}),M=le({errorSchema:X,errorToMessage:e=>e.error.message});function ce({mode:e}){var n;const l=(n=e.tools)!=null&&n.length?e.tools:void 0,s=[];if(l==null)return{tools:void 0,tool_choice:void 0,toolWarnings:s};const t=e.toolChoice,a=[];for(const i of l)i.type==="provider-defined"?s.push({type:"unsupported-tool",tool:i}):a.push({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}});if(t==null)return{tools:a,tool_choice:void 0,toolWarnings:s};const c=t.type;switch(c){case"auto":case"none":case"required":return{tools:a,tool_choice:c,toolWarnings:s};case"tool":return{tools:a,tool_choice:{type:"function",function:{name:t.toolName}},toolWarnings:s};default:{const i=c;throw new Y({functionality:`Unsupported tool choice type: ${i}`})}}}function L(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var pe=class{constructor(e,n,l){this.specificationVersion="v1",this.supportsStructuredOutputs=!1,this.defaultObjectGenerationMode="json",this.modelId=e,this.settings=n,this.config=l}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:n,maxTokens:l,temperature:s,topP:t,topK:a,frequencyPenalty:c,presencePenalty:i,stopSequences:u,responseFormat:o,seed:m,stream:v,providerMetadata:h}){const p=e.type,f=[];a!=null&&f.push({type:"unsupported-setting",setting:"topK"}),o!=null&&o.type==="json"&&o.schema!=null&&f.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is not supported"});const T=W({provider:"groq",providerOptions:h,schema:g({reasoningFormat:ne(["parsed","raw","hidden"]).nullish()})}),y={model:this.modelId,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:l,temperature:s,top_p:t,frequency_penalty:c,presence_penalty:i,stop:u,seed:m,response_format:v===!1&&(o==null?void 0:o.type)==="json"?{type:"json_object"}:void 0,reasoning_format:T==null?void 0:T.reasoningFormat,messages:ue(n)};switch(p){case"regular":{const{tools:q,tool_choice:k,toolWarnings:I}=ce({mode:e});return{args:{...y,tools:q,tool_choice:k},warnings:[...f,...I]}}case"object-json":return{args:{...y,response_format:v===!1?{type:"json_object"}:void 0},warnings:f};case"object-tool":return{args:{...y,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}}]},warnings:f};default:{const q=p;throw new Error(`Unsupported type: ${q}`)}}}async doGenerate(e){var n,l,s,t,a,c,i;const{args:u,warnings:o}=this.getArgs({...e,stream:!1}),m=JSON.stringify(u),{responseHeaders:v,value:h,rawValue:p}=await V({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:E(this.config.headers(),e.headers),body:u,failedResponseHandler:M,successfulResponseHandler:z(de),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:f,...T}=u,y=h.choices[0];return{text:(n=y.message.content)!=null?n:void 0,reasoning:(l=y.message.reasoning)!=null?l:void 0,toolCalls:(s=y.message.tool_calls)==null?void 0:s.map(q=>{var k;return{toolCallType:"function",toolCallId:(k=q.id)!=null?k:H(),toolName:q.function.name,args:q.function.arguments}}),finishReason:L(y.finish_reason),usage:{promptTokens:(a=(t=h.usage)==null?void 0:t.prompt_tokens)!=null?a:NaN,completionTokens:(i=(c=h.usage)==null?void 0:c.completion_tokens)!=null?i:NaN},rawCall:{rawPrompt:f,rawSettings:T},rawResponse:{headers:v,body:p},response:K(h),warnings:o,request:{body:m}}}async doStream(e){const{args:n,warnings:l}=this.getArgs({...e,stream:!0}),s=JSON.stringify({...n,stream:!0}),{responseHeaders:t,value:a}=await V({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:E(this.config.headers(),e.headers),body:{...n,stream:!0},failedResponseHandler:M,successfulResponseHandler:oe(ge),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:c,...i}=n,u=[];let o="unknown",m={promptTokens:void 0,completionTokens:void 0},v=!0;return{stream:a.pipeThrough(new TransformStream({transform(h,p){var f,T,y,q,k,I,O,j,A,F,G,U,$,J,P;if(!h.success){o="error",p.enqueue({type:"error",error:h.error});return}const C=h.value;if("error"in C){o="error",p.enqueue({type:"error",error:C.error});return}v&&(v=!1,p.enqueue({type:"response-metadata",...K(C)})),((f=C.x_groq)==null?void 0:f.usage)!=null&&(m={promptTokens:(T=C.x_groq.usage.prompt_tokens)!=null?T:void 0,completionTokens:(y=C.x_groq.usage.completion_tokens)!=null?y:void 0});const R=C.choices[0];if((R==null?void 0:R.finish_reason)!=null&&(o=L(R.finish_reason)),(R==null?void 0:R.delta)==null)return;const x=R.delta;if(x.reasoning!=null&&x.reasoning.length>0&&p.enqueue({type:"reasoning",textDelta:x.reasoning}),x.content!=null&&x.content.length>0&&p.enqueue({type:"text-delta",textDelta:x.content}),x.tool_calls!=null)for(const _ of x.tool_calls){const N=_.index;if(u[N]==null){if(_.type!=="function")throw new D({data:_,message:"Expected 'function' type."});if(_.id==null)throw new D({data:_,message:"Expected 'id' to be a string."});if(((q=_.function)==null?void 0:q.name)==null)throw new D({data:_,message:"Expected 'function.name' to be a string."});u[N]={id:_.id,type:"function",function:{name:_.function.name,arguments:(k=_.function.arguments)!=null?k:""},hasFinished:!1};const b=u[N];((I=b.function)==null?void 0:I.name)!=null&&((O=b.function)==null?void 0:O.arguments)!=null&&(b.function.arguments.length>0&&p.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:b.id,toolName:b.function.name,argsTextDelta:b.function.arguments}),B(b.function.arguments)&&(p.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(j=b.id)!=null?j:H(),toolName:b.function.name,args:b.function.arguments}),b.hasFinished=!0));continue}const w=u[N];w.hasFinished||(((A=_.function)==null?void 0:A.arguments)!=null&&(w.function.arguments+=(G=(F=_.function)==null?void 0:F.arguments)!=null?G:""),p.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:w.id,toolName:w.function.name,argsTextDelta:(U=_.function.arguments)!=null?U:""}),(($=w.function)==null?void 0:$.name)!=null&&((J=w.function)==null?void 0:J.arguments)!=null&&B(w.function.arguments)&&(p.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(P=w.id)!=null?P:H(),toolName:w.function.name,args:w.function.arguments}),w.hasFinished=!0))}},flush(h){var p,f;h.enqueue({type:"finish",finishReason:o,usage:{promptTokens:(p=m.promptTokens)!=null?p:NaN,completionTokens:(f=m.completionTokens)!=null?f:NaN}})}})),rawCall:{rawPrompt:c,rawSettings:i},rawResponse:{headers:t},warnings:l,request:{body:s}}}},de=g({id:r().nullish(),created:d().nullish(),model:r().nullish(),choices:S(g({message:g({content:r().nullish(),reasoning:r().nullish(),tool_calls:S(g({id:r().nullish(),type:Q("function"),function:g({name:r(),arguments:r()})})).nullish()}),index:d(),finish_reason:r().nullish()})),usage:g({prompt_tokens:d().nullish(),completion_tokens:d().nullish()}).nullish()}),ge=ie([g({id:r().nullish(),created:d().nullish(),model:r().nullish(),choices:S(g({delta:g({content:r().nullish(),reasoning:r().nullish(),tool_calls:S(g({index:d(),id:r().nullish(),type:Q("function").optional(),function:g({name:r().nullish(),arguments:r().nullish()})})).nullish()}).nullish(),finish_reason:r().nullable().optional(),index:d()})),x_groq:g({usage:g({prompt_tokens:d().nullish(),completion_tokens:d().nullish()}).nullish()}).nullish()}),X]),he=g({language:r().nullish(),prompt:r().nullish(),responseFormat:r().nullish(),temperature:d().min(0).max(1).nullish(),timestampGranularities:S(r()).nullish()}),me=class{constructor(e,n){this.modelId=e,this.config=n,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:n,providerOptions:l}){var s,t,a,c,i;const u=[],o=W({provider:"groq",providerOptions:l,schema:he}),m=new FormData,v=e instanceof Uint8Array?new Blob([e]):new Blob([ae(e)]);if(m.append("model",this.modelId),m.append("file",new File([v],"audio",{type:n})),o){const h={language:(s=o.language)!=null?s:void 0,prompt:(t=o.prompt)!=null?t:void 0,response_format:(a=o.responseFormat)!=null?a:void 0,temperature:(c=o.temperature)!=null?c:void 0,timestamp_granularities:(i=o.timestampGranularities)!=null?i:void 0};for(const p in h){const f=h[p];f!==void 0&&m.append(p,String(f))}}return{formData:m,warnings:u}}async doGenerate(e){var n,l,s,t,a;const c=(s=(l=(n=this.config._internal)==null?void 0:n.currentDate)==null?void 0:l.call(n))!=null?s:new Date,{formData:i,warnings:u}=this.getArgs(e),{value:o,responseHeaders:m,rawValue:v}=await re({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:E(this.config.headers(),e.headers),formData:i,failedResponseHandler:M,successfulResponseHandler:z(fe),abortSignal:e.abortSignal,fetch:this.config.fetch});return{text:o.text,segments:(a=(t=o.segments)==null?void 0:t.map(h=>({text:h.text,startSecond:h.start,endSecond:h.end})))!=null?a:[],language:o.language,durationInSeconds:o.duration,warnings:u,response:{timestamp:c,modelId:this.modelId,headers:m,body:v}}}},fe=g({task:r(),language:r(),duration:d(),text:r(),segments:S(g({id:d(),seek:d(),start:d(),end:d(),text:r(),tokens:S(d()),temperature:d(),avg_logprob:d(),compression_ratio:d(),no_speech_prob:d()})),x_groq:g({id:r()})});function _e(e={}){var n;const l=(n=Z(e.baseURL))!=null?n:"https://api.groq.com/openai/v1",s=()=>({Authorization:`Bearer ${te({apiKey:e.apiKey,environmentVariableName:"GROQ_API_KEY",description:"Groq"})}`,...e.headers}),t=(u,o={})=>new pe(u,o,{provider:"groq.chat",url:({path:m})=>`${l}${m}`,headers:s,fetch:e.fetch}),a=(u,o)=>{if(new.target)throw new Error("The Groq model function cannot be called with the new keyword.");return t(u,o)},c=u=>new me(u,{provider:"groq.transcription",url:({path:o})=>`${l}${o}`,headers:s,fetch:e.fetch}),i=function(u,o){return a(u,o)};return i.languageModel=a,i.chat=t,i.textEmbeddingModel=u=>{throw new ee({modelId:u,modelType:"textEmbeddingModel"})},i.transcription=c,i}var ye=_e();export{_e as createGroq,ye as groq};
