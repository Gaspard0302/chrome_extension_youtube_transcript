const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-8Gn8JPIE.js","assets/types-B0luv8fm.js","assets/index-CnjmXom8.js","assets/index-CJOPnOUA.js","assets/index-DDviwPPI.js","assets/index-DsxTHHhL.js","assets/index-BAOKEl7B.js","assets/index-DI8bcMTT.js"])))=>i.map(i=>d[i]);
import{D as h}from"./providers-D_NaGG7O.js";const T="modulepreload",p=function(e){return"/"+e},E={},_=function(n,t,m){let y=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),o=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));y=Promise.allSettled(t.map(c=>{if(c=p(c),c in E)return;E[c]=!0;const i=c.endsWith(".css"),f=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const u=document.createElement("link");if(u.rel=i?"stylesheet":T,i||(u.as="script"),u.crossOrigin="",u.href=c,o&&u.setAttribute("nonce",o),document.head.appendChild(u),i)return new Promise((a,s)=>{u.addEventListener("load",a),u.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return y.then(r=>{for(const o of r||[])o.status==="rejected"&&l(o.reason);return n().catch(l)})};chrome.runtime.onMessage.addListener((e,n,t)=>{if(e.type==="GET_SETTINGS")return chrome.storage.sync.get(h,m=>{t(m)}),!0;if(e.type==="SAVE_SETTINGS")return chrome.storage.sync.set(e.payload,()=>{t({ok:!0})}),!0;if(e.type==="CHAT_STREAM")return A(e.payload,t),!0;if(e.type==="GET_CAPTION_TRACKS")return w(e.payload.videoId,t),!0;if(e.type==="FETCH_TRANSCRIPT_URL")return S(e.payload.url,t),!0;if(e.type==="EMBED_TEXT")return O(e.payload.text,t),!0});async function w(e,n){var m,y;const t="AIzaSyAO_FJ2SlqU8Q4STEHLGCilw_Y9_11qcW8";try{const l=await fetch(`https://www.youtube.com/youtubei/v1/player?key=${t}&prettyPrint=false`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:{client:{clientName:"ANDROID",clientVersion:"20.10.38"}},videoId:e})});if(!l.ok){n({error:`Innertube player returned ${l.status}`});return}const r=await l.json(),o=(y=(m=r==null?void 0:r.captions)==null?void 0:m.playerCaptionsTracklistRenderer)==null?void 0:y.captionTracks;n({tracks:Array.isArray(o)?o:[]})}catch(l){n({error:l instanceof Error?l.message:String(l)})}}async function S(e,n){try{const t=await fetch(e,{headers:{"Accept-Language":"en-US,en;q=0.9"}});if(!t.ok){n({error:`HTTP ${t.status}`});return}const m=await t.text();n({text:m})}catch(t){n({error:t instanceof Error?t.message:String(t)})}}async function A(e,n){const{messages:t,systemPrompt:m,provider:y,model:l,apiKey:r,ollamaBaseUrl:o}=e;try{const{streamText:c}=await _(async()=>{const{streamText:a}=await import("./index-8Gn8JPIE.js");return{streamText:a}},__vite__mapDeps([0,1]));let i;switch(y){case"anthropic":{const{createAnthropic:a}=await _(async()=>{const{createAnthropic:s}=await import("./index-CnjmXom8.js");return{createAnthropic:s}},__vite__mapDeps([2,1]));i=a({apiKey:r});break}case"openai":{const{createOpenAI:a}=await _(async()=>{const{createOpenAI:s}=await import("./index-CJOPnOUA.js");return{createOpenAI:s}},__vite__mapDeps([3,1]));i=a({apiKey:r});break}case"google":{const{createGoogleGenerativeAI:a}=await _(async()=>{const{createGoogleGenerativeAI:s}=await import("./index-DDviwPPI.js");return{createGoogleGenerativeAI:s}},__vite__mapDeps([4,1]));i=a({apiKey:r});break}case"groq":{const{createGroq:a}=await _(async()=>{const{createGroq:s}=await import("./index-DsxTHHhL.js");return{createGroq:s}},__vite__mapDeps([5,1]));i=a({apiKey:r});break}case"mistral":{const{createMistral:a}=await _(async()=>{const{createMistral:s}=await import("./index-BAOKEl7B.js");return{createMistral:s}},__vite__mapDeps([6,1]));i=a({apiKey:r});break}case"ollama":{const{createOllama:a}=await _(async()=>{const{createOllama:s}=await import("./index-DI8bcMTT.js");return{createOllama:s}},__vite__mapDeps([7,1]));i=a({baseURL:o+"/api"});break}default:n({error:`Unknown provider: ${y}`});return}const f=await c({model:i(l),system:m,messages:t.map(a=>({role:a.role,content:a.content}))});let u="";for await(const a of f.textStream)u+=a,chrome.runtime.sendMessage({type:"CHAT_CHUNK",payload:{chunk:a,fullText:u}}).catch(()=>{});n({ok:!0,fullText:u})}catch(c){const i=c instanceof Error?c.message:String(c);n({error:i})}}const d=chrome.runtime.getURL("src/offscreen/index.html");async function g(){(await chrome.runtime.getContexts({contextTypes:["OFFSCREEN_DOCUMENT"],documentUrls:[d]})).length===0&&await chrome.offscreen.createDocument({url:d,reasons:["BLOBS"],justification:"Run ML embedding inference (WASM/ORT) outside service worker"})}async function O(e,n){try{await g(),chrome.runtime.sendMessage({type:"OFFSCREEN_EMBED_TEXT",payload:{text:e}},t=>{chrome.runtime.lastError?n({error:chrome.runtime.lastError.message}):n(t)})}catch(t){n({error:t instanceof Error?t.message:String(t)})}}
