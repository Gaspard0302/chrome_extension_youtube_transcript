const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-8Gn8JPIE.js","assets/types-B0luv8fm.js","assets/index-CnjmXom8.js","assets/index-CJOPnOUA.js","assets/index-DDviwPPI.js","assets/index-DsxTHHhL.js","assets/index-BAOKEl7B.js","assets/index-DI8bcMTT.js"])))=>i.map(i=>d[i]);
import{_ as o}from"./preload-helper-D7HrI6pR.js";import{D as y}from"./providers-D_NaGG7O.js";chrome.runtime.onMessage.addListener((a,s,c)=>{if(a.type==="GET_SETTINGS")return chrome.storage.sync.get(y,_=>{c(_)}),!0;if(a.type==="SAVE_SETTINGS")return chrome.storage.sync.set(a.payload,()=>{c({ok:!0})}),!0;if(a.type==="CHAT_STREAM")return T(a.payload,c),!0});async function T(a,s){const{messages:c,systemPrompt:_,provider:l,model:u,apiKey:n,ollamaBaseUrl:p}=a;try{const{streamText:i}=await o(async()=>{const{streamText:t}=await import("./index-8Gn8JPIE.js");return{streamText:t}},__vite__mapDeps([0,1]));let r;switch(l){case"anthropic":{const{createAnthropic:t}=await o(async()=>{const{createAnthropic:e}=await import("./index-CnjmXom8.js");return{createAnthropic:e}},__vite__mapDeps([2,1]));r=t({apiKey:n});break}case"openai":{const{createOpenAI:t}=await o(async()=>{const{createOpenAI:e}=await import("./index-CJOPnOUA.js");return{createOpenAI:e}},__vite__mapDeps([3,1]));r=t({apiKey:n});break}case"google":{const{createGoogleGenerativeAI:t}=await o(async()=>{const{createGoogleGenerativeAI:e}=await import("./index-DDviwPPI.js");return{createGoogleGenerativeAI:e}},__vite__mapDeps([4,1]));r=t({apiKey:n});break}case"groq":{const{createGroq:t}=await o(async()=>{const{createGroq:e}=await import("./index-DsxTHHhL.js");return{createGroq:e}},__vite__mapDeps([5,1]));r=t({apiKey:n});break}case"mistral":{const{createMistral:t}=await o(async()=>{const{createMistral:e}=await import("./index-BAOKEl7B.js");return{createMistral:e}},__vite__mapDeps([6,1]));r=t({apiKey:n});break}case"ollama":{const{createOllama:t}=await o(async()=>{const{createOllama:e}=await import("./index-DI8bcMTT.js");return{createOllama:e}},__vite__mapDeps([7,1]));r=t({baseURL:p+"/api"});break}default:s({error:`Unknown provider: ${l}`});return}const E=await i({model:r(u),system:_,messages:c.map(t=>({role:t.role,content:t.content}))});let m="";for await(const t of E.textStream)m+=t,chrome.runtime.sendMessage({type:"CHAT_CHUNK",payload:{chunk:t,fullText:m}}).catch(()=>{});s({ok:!0,fullText:m})}catch(i){const r=i instanceof Error?i.message:String(i);s({error:r})}}
