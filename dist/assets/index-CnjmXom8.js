import{M as O,N as $,O as W,U as q,P as J,Q as V,R as I,S as D,V as K,W as F,c as G,o as a,a as r,X as j,q as _,Y as U,b as H,f as L,u as Y,l as h,_ as z,$ as M,e as Q}from"./types-B0luv8fm.js";var X=a({type:h("error"),error:a({type:r(),message:r()})}),B=z({errorSchema:X,errorToMessage:e=>e.error.message});function Z(e){var p;const s=(p=e.tools)!=null&&p.length?e.tools:void 0,i=[],l=new Set;if(s==null)return{tools:void 0,tool_choice:void 0,toolWarnings:i,betas:l};const c=[];for(const u of s)switch(u.type){case"function":c.push({name:u.name,description:u.description,input_schema:u.parameters});break;case"provider-defined":switch(u.id){case"anthropic.computer_20250124":l.add("computer-use-2025-01-24"),c.push({name:u.name,type:"computer_20250124",display_width_px:u.args.displayWidthPx,display_height_px:u.args.displayHeightPx,display_number:u.args.displayNumber});break;case"anthropic.computer_20241022":l.add("computer-use-2024-10-22"),c.push({name:u.name,type:"computer_20241022",display_width_px:u.args.displayWidthPx,display_height_px:u.args.displayHeightPx,display_number:u.args.displayNumber});break;case"anthropic.text_editor_20250124":l.add("computer-use-2025-01-24"),c.push({name:u.name,type:"text_editor_20250124"});break;case"anthropic.text_editor_20241022":l.add("computer-use-2024-10-22"),c.push({name:u.name,type:"text_editor_20241022"});break;case"anthropic.bash_20250124":l.add("computer-use-2025-01-24"),c.push({name:u.name,type:"bash_20250124"});break;case"anthropic.bash_20241022":l.add("computer-use-2024-10-22"),c.push({name:u.name,type:"bash_20241022"});break;default:i.push({type:"unsupported-tool",tool:u});break}break;default:i.push({type:"unsupported-tool",tool:u});break}const k=e.toolChoice;if(k==null)return{tools:c,tool_choice:void 0,toolWarnings:i,betas:l};const w=k.type;switch(w){case"auto":return{tools:c,tool_choice:{type:"auto"},toolWarnings:i,betas:l};case"required":return{tools:c,tool_choice:{type:"any"},toolWarnings:i,betas:l};case"none":return{tools:void 0,tool_choice:void 0,toolWarnings:i,betas:l};case"tool":return{tools:c,tool_choice:{type:"tool",name:k.toolName},toolWarnings:i,betas:l};default:{const u=w;throw new q({functionality:`Unsupported tool choice type: ${u}`})}}}function ee({prompt:e,sendReasoning:p,warnings:s}){var i,l,c,k;const w=new Set,u=te(e);let g;const R=[];function f(T){var y;const b=T==null?void 0:T.anthropic;return(y=b==null?void 0:b.cacheControl)!=null?y:b==null?void 0:b.cache_control}for(let T=0;T<u.length;T++){const y=u[T],b=T===u.length-1,m=y.type;switch(m){case"system":{if(g!=null)throw new q({functionality:"Multiple system messages that are separated by user/assistant messages"});g=y.messages.map(({content:t,providerMetadata:x})=>({type:"text",text:t,cache_control:f(x)}));break}case"user":{const t=[];for(const x of y.messages){const{role:P,content:v}=x;switch(P){case"user":{for(let o=0;o<v.length;o++){const n=v[o],d=o===v.length-1,C=(i=f(n.providerMetadata))!=null?i:d?f(x.providerMetadata):void 0;switch(n.type){case"text":{t.push({type:"text",text:n.text,cache_control:C});break}case"image":{t.push({type:"image",source:n.image instanceof URL?{type:"url",url:n.image.toString()}:{type:"base64",media_type:(l=n.mimeType)!=null?l:"image/jpeg",data:G(n.image)},cache_control:C});break}case"file":{if(n.mimeType!=="application/pdf")throw new q({functionality:"Non-PDF files in user messages"});w.add("pdfs-2024-09-25"),t.push({type:"document",source:n.data instanceof URL?{type:"url",url:n.data.toString()}:{type:"base64",media_type:"application/pdf",data:n.data},cache_control:C});break}}}break}case"tool":{for(let o=0;o<v.length;o++){const n=v[o],d=o===v.length-1,C=(c=f(n.providerMetadata))!=null?c:d?f(x.providerMetadata):void 0,N=n.content!=null?n.content.map(S=>{var E;switch(S.type){case"text":return{type:"text",text:S.text,cache_control:void 0};case"image":return{type:"image",source:{type:"base64",media_type:(E=S.mimeType)!=null?E:"image/jpeg",data:S.data},cache_control:void 0}}}):JSON.stringify(n.result);t.push({type:"tool_result",tool_use_id:n.toolCallId,content:N,is_error:n.isError,cache_control:C})}break}default:{const o=P;throw new Error(`Unsupported role: ${o}`)}}}R.push({role:"user",content:t});break}case"assistant":{const t=[];for(let x=0;x<y.messages.length;x++){const P=y.messages[x],v=x===y.messages.length-1,{content:o}=P;for(let n=0;n<o.length;n++){const d=o[n],C=n===o.length-1,N=(k=f(d.providerMetadata))!=null?k:C?f(P.providerMetadata):void 0;switch(d.type){case"text":{t.push({type:"text",text:b&&v&&C?d.text.trim():d.text,cache_control:N});break}case"reasoning":{p?t.push({type:"thinking",thinking:d.text,signature:d.signature,cache_control:N}):s.push({type:"other",message:"sending reasoning content is disabled for this model"});break}case"redacted-reasoning":{t.push({type:"redacted_thinking",data:d.data,cache_control:N});break}case"tool-call":{t.push({type:"tool_use",id:d.toolCallId,name:d.toolName,input:d.args,cache_control:N});break}}}}R.push({role:"assistant",content:t});break}default:{const t=m;throw new Error(`Unsupported type: ${t}`)}}}return{prompt:{system:g,messages:R},betas:w}}function te(e){const p=[];let s;for(const i of e){const{role:l}=i;switch(l){case"system":{(s==null?void 0:s.type)!=="system"&&(s={type:"system",messages:[]},p.push(s)),s.messages.push(i);break}case"assistant":{(s==null?void 0:s.type)!=="assistant"&&(s={type:"assistant",messages:[]},p.push(s)),s.messages.push(i);break}case"user":{(s==null?void 0:s.type)!=="user"&&(s={type:"user",messages:[]},p.push(s)),s.messages.push(i);break}case"tool":{(s==null?void 0:s.type)!=="user"&&(s={type:"user",messages:[]},p.push(s)),s.messages.push(i);break}default:{const c=l;throw new Error(`Unsupported role: ${c}`)}}}return p}function A(e){switch(e){case"end_turn":case"stop_sequence":return"stop";case"tool_use":return"tool-calls";case"max_tokens":return"length";default:return"unknown"}}var oe=class{constructor(e,p,s){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.modelId=e,this.settings=p,this.config=s}supportsUrl(e){return e.protocol==="https:"}get provider(){return this.config.provider}get supportsImageUrls(){return this.config.supportsImageUrls}async getArgs({mode:e,prompt:p,maxTokens:s=4096,temperature:i,topP:l,topK:c,frequencyPenalty:k,presencePenalty:w,stopSequences:u,responseFormat:g,seed:R,providerMetadata:f}){var T,y,b;const m=e.type,t=[];k!=null&&t.push({type:"unsupported-setting",setting:"frequencyPenalty"}),w!=null&&t.push({type:"unsupported-setting",setting:"presencePenalty"}),R!=null&&t.push({type:"unsupported-setting",setting:"seed"}),g!=null&&g.type!=="text"&&t.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:x,betas:P}=ee({prompt:p,sendReasoning:(T=this.settings.sendReasoning)!=null?T:!0,warnings:t}),v=W({provider:"anthropic",providerOptions:f,schema:ae}),o=((y=v==null?void 0:v.thinking)==null?void 0:y.type)==="enabled",n=(b=v==null?void 0:v.thinking)==null?void 0:b.budgetTokens,d={model:this.modelId,max_tokens:s,temperature:i,top_k:c,top_p:l,stop_sequences:u,...o&&{thinking:{type:"enabled",budget_tokens:n}},system:x.system,messages:x.messages};if(o){if(n==null)throw new q({functionality:"thinking requires a budget"});d.temperature!=null&&(d.temperature=void 0,t.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported when thinking is enabled"})),c!=null&&(d.top_k=void 0,t.push({type:"unsupported-setting",setting:"topK",details:"topK is not supported when thinking is enabled"})),l!=null&&(d.top_p=void 0,t.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported when thinking is enabled"})),d.max_tokens=s+n}switch(m){case"regular":{const{tools:C,tool_choice:N,toolWarnings:S,betas:E}=Z(e);return{args:{...d,tools:C,tool_choice:N},warnings:[...t,...S],betas:new Set([...P,...E])}}case"object-json":throw new q({functionality:"json-mode object generation"});case"object-tool":{const{name:C,description:N,parameters:S}=e.tool;return{args:{...d,tools:[{name:C,description:N,input_schema:S}],tool_choice:{type:"tool",name:C}},warnings:t,betas:P}}default:{const C=m;throw new Error(`Unsupported type: ${C}`)}}}async getHeaders({betas:e,headers:p}){return J(await V(this.config.headers),e.size>0?{"anthropic-beta":Array.from(e).join(",")}:{},p)}buildRequestUrl(e){var p,s,i;return(i=(s=(p=this.config).buildRequestUrl)==null?void 0:s.call(p,this.config.baseURL,e))!=null?i:`${this.config.baseURL}/messages`}transformRequestBody(e){var p,s,i;return(i=(s=(p=this.config).transformRequestBody)==null?void 0:s.call(p,e))!=null?i:e}async doGenerate(e){var p,s,i,l;const{args:c,warnings:k,betas:w}=await this.getArgs(e),{responseHeaders:u,value:g,rawValue:R}=await I({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:w,headers:e.headers}),body:this.transformRequestBody(c),failedResponseHandler:B,successfulResponseHandler:K(se),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:f,...T}=c;let y="";for(const t of g.content)t.type==="text"&&(y+=t.text);let b;if(g.content.some(t=>t.type==="tool_use")){b=[];for(const t of g.content)t.type==="tool_use"&&b.push({toolCallType:"function",toolCallId:t.id,toolName:t.name,args:JSON.stringify(t.input)})}const m=g.content.filter(t=>t.type==="redacted_thinking"||t.type==="thinking").map(t=>t.type==="thinking"?{type:"text",text:t.thinking,signature:t.signature}:{type:"redacted",data:t.data});return{text:y,reasoning:m.length>0?m:void 0,toolCalls:b,finishReason:A(g.stop_reason),usage:{promptTokens:g.usage.input_tokens,completionTokens:g.usage.output_tokens},rawCall:{rawPrompt:f,rawSettings:T},rawResponse:{headers:u,body:R},response:{id:(p=g.id)!=null?p:void 0,modelId:(s=g.model)!=null?s:void 0},warnings:k,providerMetadata:{anthropic:{cacheCreationInputTokens:(i=g.usage.cache_creation_input_tokens)!=null?i:null,cacheReadInputTokens:(l=g.usage.cache_read_input_tokens)!=null?l:null}},request:{body:JSON.stringify(c)}}}async doStream(e){const{args:p,warnings:s,betas:i}=await this.getArgs(e),l={...p,stream:!0},{responseHeaders:c,value:k}=await I({url:this.buildRequestUrl(!0),headers:await this.getHeaders({betas:i,headers:e.headers}),body:this.transformRequestBody(l),failedResponseHandler:B,successfulResponseHandler:F(ne),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:w,...u}=p;let g="unknown";const R={promptTokens:Number.NaN,completionTokens:Number.NaN},f={};let T,y;return{stream:k.pipeThrough(new TransformStream({transform(b,m){var t,x,P,v;if(!b.success){m.enqueue({type:"error",error:b.error});return}const o=b.value;switch(o.type){case"ping":return;case"content_block_start":{const n=o.content_block.type;switch(y=n,n){case"text":case"thinking":return;case"redacted_thinking":{m.enqueue({type:"redacted-reasoning",data:o.content_block.data});return}case"tool_use":{f[o.index]={toolCallId:o.content_block.id,toolName:o.content_block.name,jsonText:""};return}default:{const d=n;throw new Error(`Unsupported content block type: ${d}`)}}}case"content_block_stop":{if(f[o.index]!=null){const n=f[o.index];m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:n.toolCallId,toolName:n.toolName,args:n.jsonText}),delete f[o.index]}y=void 0;return}case"content_block_delta":{const n=o.delta.type;switch(n){case"text_delta":{m.enqueue({type:"text-delta",textDelta:o.delta.text});return}case"thinking_delta":{m.enqueue({type:"reasoning",textDelta:o.delta.thinking});return}case"signature_delta":{y==="thinking"&&m.enqueue({type:"reasoning-signature",signature:o.delta.signature});return}case"input_json_delta":{const d=f[o.index];m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:d.toolCallId,toolName:d.toolName,argsTextDelta:o.delta.partial_json}),d.jsonText+=o.delta.partial_json;return}default:{const d=n;throw new Error(`Unsupported delta type: ${d}`)}}}case"message_start":{R.promptTokens=o.message.usage.input_tokens,R.completionTokens=o.message.usage.output_tokens,T={anthropic:{cacheCreationInputTokens:(t=o.message.usage.cache_creation_input_tokens)!=null?t:null,cacheReadInputTokens:(x=o.message.usage.cache_read_input_tokens)!=null?x:null}},m.enqueue({type:"response-metadata",id:(P=o.message.id)!=null?P:void 0,modelId:(v=o.message.model)!=null?v:void 0});return}case"message_delta":{R.completionTokens=o.usage.output_tokens,g=A(o.delta.stop_reason);return}case"message_stop":{m.enqueue({type:"finish",finishReason:g,usage:R,providerMetadata:T});return}case"error":{m.enqueue({type:"error",error:o.error});return}default:{const n=o;throw new Error(`Unsupported chunk type: ${n}`)}}}})),rawCall:{rawPrompt:w,rawSettings:u},rawResponse:{headers:c},warnings:s,request:{body:JSON.stringify(l)}}}},se=a({type:h("message"),id:r().nullish(),model:r().nullish(),content:H(M("type",[a({type:h("text"),text:r()}),a({type:h("thinking"),thinking:r(),signature:r()}),a({type:h("redacted_thinking"),data:r()}),a({type:h("tool_use"),id:r(),name:r(),input:Q()})])),stop_reason:r().nullish(),usage:a({input_tokens:_(),output_tokens:_(),cache_creation_input_tokens:_().nullish(),cache_read_input_tokens:_().nullish()})}),ne=M("type",[a({type:h("message_start"),message:a({id:r().nullish(),model:r().nullish(),usage:a({input_tokens:_(),output_tokens:_(),cache_creation_input_tokens:_().nullish(),cache_read_input_tokens:_().nullish()})})}),a({type:h("content_block_start"),index:_(),content_block:M("type",[a({type:h("text"),text:r()}),a({type:h("thinking"),thinking:r()}),a({type:h("tool_use"),id:r(),name:r()}),a({type:h("redacted_thinking"),data:r()})])}),a({type:h("content_block_delta"),index:_(),delta:M("type",[a({type:h("input_json_delta"),partial_json:r()}),a({type:h("text_delta"),text:r()}),a({type:h("thinking_delta"),thinking:r()}),a({type:h("signature_delta"),signature:r()})])}),a({type:h("content_block_stop"),index:_()}),a({type:h("error"),error:a({type:r(),message:r()})}),a({type:h("message_delta"),delta:a({stop_reason:r().nullish()}),usage:a({output_tokens:_()})}),a({type:h("message_stop")}),a({type:h("ping")})]),ae=a({thinking:a({type:Y([h("enabled"),h("disabled")]),budgetTokens:_().optional()}).optional()}),re=a({command:r(),restart:L().optional()});function ie(e={}){return{type:"provider-defined",id:"anthropic.bash_20241022",args:{},parameters:re,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var le=a({command:r(),restart:L().optional()});function ce(e={}){return{type:"provider-defined",id:"anthropic.bash_20250124",args:{},parameters:le,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var pe=a({command:U(["view","create","str_replace","insert","undo_edit"]),path:r(),file_text:r().optional(),insert_line:_().int().optional(),new_str:r().optional(),old_str:r().optional(),view_range:H(_().int()).optional()});function ue(e={}){return{type:"provider-defined",id:"anthropic.text_editor_20241022",args:{},parameters:pe,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var de=a({command:U(["view","create","str_replace","insert","undo_edit"]),path:r(),file_text:r().optional(),insert_line:_().int().optional(),new_str:r().optional(),old_str:r().optional(),view_range:H(_().int()).optional()});function he(e={}){return{type:"provider-defined",id:"anthropic.text_editor_20250124",args:{},parameters:de,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var _e=a({action:U(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),coordinate:H(_().int()).optional(),text:r().optional()});function ge(e){return{type:"provider-defined",id:"anthropic.computer_20241022",args:{displayWidthPx:e.displayWidthPx,displayHeightPx:e.displayHeightPx,displayNumber:e.displayNumber},parameters:_e,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var me=a({action:U(["key","hold_key","type","cursor_position","mouse_move","left_mouse_down","left_mouse_up","left_click","left_click_drag","right_click","middle_click","double_click","triple_click","scroll","wait","screenshot"]),coordinate:j([_().int(),_().int()]).optional(),duration:_().optional(),scroll_amount:_().optional(),scroll_direction:U(["up","down","left","right"]).optional(),start_coordinate:j([_().int(),_().int()]).optional(),text:r().optional()});function ye(e){return{type:"provider-defined",id:"anthropic.computer_20250124",args:{displayWidthPx:e.displayWidthPx,displayHeightPx:e.displayHeightPx,displayNumber:e.displayNumber},parameters:me,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var ke={bash_20241022:ie,bash_20250124:ce,textEditor_20241022:ue,textEditor_20250124:he,computer_20241022:ge,computer_20250124:ye};function fe(e={}){var p;const s=(p=O(e.baseURL))!=null?p:"https://api.anthropic.com/v1",i=()=>({"anthropic-version":"2023-06-01","x-api-key":D({apiKey:e.apiKey,environmentVariableName:"ANTHROPIC_API_KEY",description:"Anthropic"}),...e.headers}),l=(k,w={})=>new oe(k,w,{provider:"anthropic.messages",baseURL:s,headers:i,fetch:e.fetch,supportsImageUrls:!0}),c=function(k,w){if(new.target)throw new Error("The Anthropic model function cannot be called with the new keyword.");return l(k,w)};return c.languageModel=l,c.chat=l,c.messages=l,c.textEmbeddingModel=k=>{throw new $({modelId:k,modelType:"textEmbeddingModel"})},c.tools=ke,c}var xe=fe();export{xe as anthropic,fe as createAnthropic};
