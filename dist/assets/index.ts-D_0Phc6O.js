import{g as Ni,c as Tn,D as Ei}from"./providers-B-uW_wjG.js";var Qs="vercel.ai.error",Oi=Symbol.for(Qs),ea,Pi=class ta extends Error{constructor({name:t,message:n,cause:r}){super(n),this[ea]=!0,this.name=t,this.cause=r}static isInstance(t){return ta.hasMarker(t,Qs)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}};ea=Oi;var $=Pi,na="AI_APICallError",ra=`vercel.ai.error.${na}`,Mi=Symbol.for(ra),sa,Ae=class extends ${constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:s,responseBody:a,cause:o,isRetryable:i=r!=null&&(r===408||r===409||r===429||r>=500),data:u}){super({name:na,message:e,cause:o}),this[sa]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=s,this.responseBody=a,this.isRetryable=i,this.data=u}static isInstance(e){return $.hasMarker(e,ra)}};sa=Mi;var aa="AI_EmptyResponseBodyError",oa=`vercel.ai.error.${aa}`,Di=Symbol.for(oa),ia,la=class extends ${constructor({message:e="Empty response body"}={}){super({name:aa,message:e}),this[ia]=!0}static isInstance(e){return $.hasMarker(e,oa)}};ia=Di;function yn(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var ua="AI_InvalidArgumentError",ca=`vercel.ai.error.${ua}`,ji=Symbol.for(ca),da,pa=class extends ${constructor({message:t,cause:n,argument:r}){super({name:ua,message:t,cause:n}),this[da]=!0,this.argument=r}static isInstance(t){return $.hasMarker(t,ca)}};da=ji;var fa="AI_InvalidPromptError",ha=`vercel.ai.error.${fa}`,$i=Symbol.for(ha),ma,tt=class extends ${constructor({prompt:e,message:t,cause:n}){super({name:fa,message:`Invalid prompt: ${t}`,cause:n}),this[ma]=!0,this.prompt=e}static isInstance(e){return $.hasMarker(e,ha)}};ma=$i;var ga="AI_InvalidResponseDataError",ya=`vercel.ai.error.${ga}`,qi=Symbol.for(ya),va,jt=class extends ${constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:ga,message:t}),this[va]=!0,this.data=e}static isInstance(e){return $.hasMarker(e,ya)}};va=qi;var _a="AI_JSONParseError",ba=`vercel.ai.error.${_a}`,Li=Symbol.for(ba),wa,In=class extends ${constructor({text:e,cause:t}){super({name:_a,message:`JSON parsing failed: Text: ${e}.
Error message: ${yn(t)}`,cause:t}),this[wa]=!0,this.text=e}static isInstance(e){return $.hasMarker(e,ba)}};wa=Li;var xa="AI_LoadAPIKeyError",Ta=`vercel.ai.error.${xa}`,Ui=Symbol.for(Ta),ka,kn=class extends ${constructor({message:e}){super({name:xa,message:e}),this[ka]=!0}static isInstance(e){return $.hasMarker(e,Ta)}};ka=Ui;var Sa="AI_NoSuchModelError",Ca=`vercel.ai.error.${Sa}`,Fi=Symbol.for(Ca),Ia,Ra=class extends ${constructor({errorName:e=Sa,modelId:t,modelType:n,message:r=`No such ${n}: ${t}`}){super({name:e,message:r}),this[Ia]=!0,this.modelId=t,this.modelType=n}static isInstance(e){return $.hasMarker(e,Ca)}};Ia=Fi;var Aa="AI_TooManyEmbeddingValuesForCallError",Na=`vercel.ai.error.${Aa}`,Zi=Symbol.for(Na),Ea,Xn=class extends ${constructor(e){super({name:Aa,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Ea]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return $.hasMarker(e,Na)}};Ea=Zi;var Oa="AI_TypeValidationError",Pa=`vercel.ai.error.${Oa}`,Vi=Symbol.for(Pa),Ma,Bi=class vr extends ${constructor({value:t,cause:n}){super({name:Oa,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${yn(n)}`,cause:n}),this[Ma]=!0,this.value=t}static isInstance(t){return $.hasMarker(t,Pa)}static wrap({value:t,cause:n}){return vr.isInstance(n)&&n.value===t?n:new vr({value:t,cause:n})}};Ma=Vi;var Rn=Bi,Da="AI_UnsupportedFunctionalityError",ja=`vercel.ai.error.${Da}`,Ji=Symbol.for(ja),$a,G=class extends ${constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Da,message:t}),this[$a]=!0,this.functionality=e}static isInstance(e){return $.hasMarker(e,ja)}};$a=Ji;let Hi=(e,t=21)=>(n=t)=>{let r="",s=n|0;for(;s--;)r+=e[Math.random()*e.length|0];return r};var Zt={exports:{}};const Gi=typeof Buffer<"u",os=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,is=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function qa(e,t,n){n==null&&t!==null&&typeof t=="object"&&(n=t,t=void 0),Gi&&Buffer.isBuffer(e)&&(e=e.toString()),e&&e.charCodeAt(0)===65279&&(e=e.slice(1));const r=JSON.parse(e,t);if(r===null||typeof r!="object")return r;const s=n&&n.protoAction||"error",a=n&&n.constructorAction||"error";if(s==="ignore"&&a==="ignore")return r;if(s!=="ignore"&&a!=="ignore"){if(os.test(e)===!1&&is.test(e)===!1)return r}else if(s!=="ignore"&&a==="ignore"){if(os.test(e)===!1)return r}else if(is.test(e)===!1)return r;return La(r,{protoAction:s,constructorAction:a,safe:n&&n.safe})}function La(e,{protoAction:t="error",constructorAction:n="error",safe:r}={}){let s=[e];for(;s.length;){const a=s;s=[];for(const o of a){if(t!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"__proto__")){if(r===!0)return null;if(t==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.__proto__}if(n!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"constructor")&&Object.prototype.hasOwnProperty.call(o.constructor,"prototype")){if(r===!0)return null;if(n==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.constructor}for(const i in o){const u=o[i];u&&typeof u=="object"&&s.push(u)}}}return e}function $r(e,t,n){const r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return qa(e,t,n)}finally{Error.stackTraceLimit=r}}function zi(e,t){const n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return qa(e,t,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=n}}Zt.exports=$r;Zt.exports.default=$r;Zt.exports.parse=$r;Zt.exports.safeParse=zi;Zt.exports.scan=La;var Wi=Zt.exports;const qr=Ni(Wi);var Yi={};function re(...e){return e.reduce((t,n)=>({...t,...n??{}}),{})}function Ki(e){return new ReadableStream({async pull(t){try{const{value:n,done:r}=await e.next();r?t.close():t.enqueue(n)}catch(n){t.error(n)}},cancel(){}})}async function Xi(e){return e==null?Promise.resolve():new Promise(t=>setTimeout(t,e))}function Qi(){let e="",t,n=[],r,s;function a(u,l){if(u===""){o(l);return}if(u.startsWith(":"))return;const c=u.indexOf(":");if(c===-1){i(u,"");return}const f=u.slice(0,c),d=c+1,m=d<u.length&&u[d]===" "?u.slice(d+1):u.slice(d);i(f,m)}function o(u){n.length>0&&(u.enqueue({event:t,data:n.join(`
`),id:r,retry:s}),n=[],t=void 0,s=void 0)}function i(u,l){switch(u){case"event":t=l;break;case"data":n.push(l);break;case"id":r=l;break;case"retry":const c=parseInt(l,10);isNaN(c)||(s=c);break}}return new TransformStream({transform(u,l){const{lines:c,incompleteLine:f}=el(e,u);e=f;for(let d=0;d<c.length;d++)a(c[d],l)},flush(u){a(e,u),o(u)}})}function el(e,t){const n=[];let r=e;for(let s=0;s<t.length;){const a=t[s++];a===`
`?(n.push(r),r=""):a==="\r"?(n.push(r),r="",t[s]===`
`&&s++):r+=a}return{lines:n,incompleteLine:r}}function Vt(e){const t={};return e.headers.forEach((n,r)=>{t[r]=n}),t}var St=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const s=Hi(n,t);if(e==null)return s;if(n.includes(r))throw new pa({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return a=>`${e}${r}${s(a)}`},Se=St();function tl(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function nl(e){return Object.fromEntries(Object.entries(e).filter(([t,n])=>n!=null))}function Cn(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function vn({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:r}){if(typeof e=="string")return e;if(e!=null)throw new kn({message:`${r} API key must be a string.`});if(typeof process>"u")throw new kn({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(e=Yi[t],e==null)throw new kn({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new kn({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var An=Symbol.for("vercel.ai.validator");function rl(e){return{[An]:!0,validate:e}}function sl(e){return typeof e=="object"&&e!==null&&An in e&&e[An]===!0&&"validate"in e}function al(e){return sl(e)?e:ol(e)}function ol(e){return rl(t=>{const n=e.safeParse(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function il({value:e,schema:t}){const n=Bt({value:e,schema:t});if(!n.success)throw Rn.wrap({value:e,cause:n.error});return n.value}function Bt({value:e,schema:t}){const n=al(t);try{if(n.validate==null)return{success:!0,value:e};const r=n.validate(e);return r.success?r:{success:!1,error:Rn.wrap({value:e,cause:r.error})}}catch(r){return{success:!1,error:Rn.wrap({value:e,cause:r})}}}function ll({text:e,schema:t}){try{const n=qr.parse(e);return t==null?n:il({value:n,schema:t})}catch(n){throw In.isInstance(n)||Rn.isInstance(n)?n:new In({text:e,cause:n})}}function bt({text:e,schema:t}){try{const n=qr.parse(e);if(t==null)return{success:!0,value:n,rawValue:n};const r=Bt({value:n,schema:t});return r.success?{...r,rawValue:n}:r}catch(n){return{success:!1,error:In.isInstance(n)?n:new In({text:e,cause:n})}}}function Nn(e){try{return qr.parse(e),!0}catch{return!1}}function Ct({provider:e,providerOptions:t,schema:n}){if((t==null?void 0:t[e])==null)return;const r=Bt({value:t[e],schema:n});if(!r.success)throw new pa({argument:"providerOptions",message:`invalid ${e} provider options`,cause:r.error});return r.value}var ul=()=>globalThis.fetch,se=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:s,abortSignal:a,fetch:o})=>Fa({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:s,abortSignal:a,fetch:o}),Ua=async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:s,abortSignal:a,fetch:o})=>Fa({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:s,abortSignal:a,fetch:o}),Fa=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:s,abortSignal:a,fetch:o=ul()})=>{try{const i=await o(e,{method:"POST",headers:nl(t),body:n.content,signal:a}),u=Vt(i);if(!i.ok){let l;try{l=await s({response:i,url:e,requestBodyValues:n.values})}catch(c){throw Cn(c)||Ae.isInstance(c)?c:new Ae({message:"Failed to process error response",cause:c,statusCode:i.status,url:e,responseHeaders:u,requestBodyValues:n.values})}throw l.value}try{return await r({response:i,url:e,requestBodyValues:n.values})}catch(l){throw l instanceof Error&&(Cn(l)||Ae.isInstance(l))?l:new Ae({message:"Failed to process successful response",cause:l,statusCode:i.status,url:e,responseHeaders:u,requestBodyValues:n.values})}}catch(i){if(Cn(i))throw i;if(i instanceof TypeError&&i.message==="fetch failed"){const u=i.cause;if(u!=null)throw new Ae({message:`Cannot connect to API: ${u.message}`,cause:u,url:e,requestBodyValues:n.values,isRetryable:!0})}throw i}};async function En(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}var Jt=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:s,requestBodyValues:a})=>{const o=await r.text(),i=Vt(r);if(o.trim()==="")return{responseHeaders:i,value:new Ae({message:r.statusText,url:s,requestBodyValues:a,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:n==null?void 0:n(r)})};try{const u=ll({text:o,schema:e});return{responseHeaders:i,value:new Ae({message:t(u),url:s,requestBodyValues:a,statusCode:r.status,responseHeaders:i,responseBody:o,data:u,isRetryable:n==null?void 0:n(r,u)})}}catch{return{responseHeaders:i,value:new Ae({message:r.statusText,url:s,requestBodyValues:a,statusCode:r.status,responseHeaders:i,responseBody:o,isRetryable:n==null?void 0:n(r)})}}},It=e=>async({response:t})=>{const n=Vt(t);if(t.body==null)throw new la({});return{responseHeaders:n,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(Qi()).pipeThrough(new TransformStream({transform({data:r},s){r!=="[DONE]"&&s.enqueue(bt({text:r,schema:e}))}}))}},we=e=>async({response:t,url:n,requestBodyValues:r})=>{const s=await t.text(),a=bt({text:s,schema:e}),o=Vt(t);if(!a.success)throw new Ae({message:"Invalid JSON response",cause:a.error,statusCode:t.status,responseHeaders:o,responseBody:s,url:n,requestBodyValues:r});return{responseHeaders:o,value:a.value,rawValue:a.rawValue}},cl=()=>async({response:e,url:t,requestBodyValues:n})=>{const r=Vt(e);if(!e.body)throw new Ae({message:"Response body is empty",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0});try{const s=await e.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(s)}}catch(s){throw new Ae({message:"Failed to read response as array buffer",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0,cause:s})}},{btoa:dl,atob:pl}=globalThis;function _n(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=pl(t);return Uint8Array.from(n,r=>r.codePointAt(0))}function Ge(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return dl(t)}function Ht(e){return e==null?void 0:e.replace(/\/$/,"")}const fl=Symbol("Let zodToJsonSchema decide on which parser to use"),ls={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},hl=e=>typeof e=="string"?{...ls,name:e}:{...ls,...e},ml=e=>{const t=hl(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function Za(e,t,n,r){r!=null&&r.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function W(e,t,n,r,s){e[t]=n,Za(e,t,r,s)}const Va=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};var H;(function(e){e.assertEqual=s=>{};function t(s){}e.assertIs=t;function n(s){throw new Error}e.assertNever=n,e.arrayToEnum=s=>{const a={};for(const o of s)a[o]=o;return a},e.getValidEnumValues=s=>{const a=e.objectKeys(s).filter(i=>typeof s[s[i]]!="number"),o={};for(const i of a)o[i]=s[i];return e.objectValues(o)},e.objectValues=s=>e.objectKeys(s).map(function(a){return s[a]}),e.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&a.push(o);return a},e.find=(s,a)=>{for(const o of s)if(a(o))return o},e.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,a=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(a)}e.joinValues=r,e.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(H||(H={}));var us;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(us||(us={}));const P=H.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ut=e=>{switch(typeof e){case"undefined":return P.undefined;case"string":return P.string;case"number":return Number.isNaN(e)?P.nan:P.number;case"boolean":return P.boolean;case"function":return P.function;case"bigint":return P.bigint;case"symbol":return P.symbol;case"object":return Array.isArray(e)?P.array:e===null?P.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?P.promise:typeof Map<"u"&&e instanceof Map?P.map:typeof Set<"u"&&e instanceof Set?P.set:typeof Date<"u"&&e instanceof Date?P.date:P.object;default:return P.unknown}},S=H.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class at extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(a){return a.message},r={_errors:[]},s=a=>{for(const o of a.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)r._errors.push(n(o));else{let i=r,u=0;for(;u<o.path.length;){const l=o.path[u];u===o.path.length-1?(i[l]=i[l]||{_errors:[]},i[l]._errors.push(n(o))):i[l]=i[l]||{_errors:[]},i=i[l],u++}}};return s(this),r}static assert(t){if(!(t instanceof at))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,H.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const s of this.issues)if(s.path.length>0){const a=s.path[0];n[a]=n[a]||[],n[a].push(t(s))}else r.push(t(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}at.create=e=>new at(e);const _r=(e,t)=>{let n;switch(e.code){case S.invalid_type:e.received===P.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case S.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,H.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:n=`Unrecognized key(s) in object: ${H.joinValues(e.keys,", ")}`;break;case S.invalid_union:n="Invalid input";break;case S.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${H.joinValues(e.options)}`;break;case S.invalid_enum_value:n=`Invalid enum value. Expected ${H.joinValues(e.options)}, received '${e.received}'`;break;case S.invalid_arguments:n="Invalid function arguments";break;case S.invalid_return_type:n="Invalid function return type";break;case S.invalid_date:n="Invalid date";break;case S.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:H.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case S.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case S.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case S.custom:n="Invalid input";break;case S.invalid_intersection_types:n="Intersection results could not be merged";break;case S.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case S.not_finite:n="Number must be finite";break;default:n=t.defaultError,H.assertNever(e)}return{message:n}};let gl=_r;function yl(){return gl}const vl=e=>{const{data:t,path:n,errorMaps:r,issueData:s}=e,a=[...n,...s.path||[]],o={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let i="";const u=r.filter(l=>!!l).slice().reverse();for(const l of u)i=l(o,{data:t,defaultError:i}).message;return{...s,path:a,message:i}};function E(e,t){const n=yl(),r=vl({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===_r?void 0:_r].filter(s=>!!s)});e.common.issues.push(r)}class be{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const s of n){if(s.status==="aborted")return q;s.status==="dirty"&&t.dirty(),r.push(s.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const s of n){const a=await s.key,o=await s.value;r.push({key:a,value:o})}return be.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const s of n){const{key:a,value:o}=s;if(a.status==="aborted"||o.status==="aborted")return q;a.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),a.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(r[a.value]=o.value)}return{status:t.value,value:r}}}const q=Object.freeze({status:"aborted"}),nn=e=>({status:"dirty",value:e}),De=e=>({status:"valid",value:e}),cs=e=>e.status==="aborted",ds=e=>e.status==="dirty",$t=e=>e.status==="valid",On=e=>typeof Promise<"u"&&e instanceof Promise;var j;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(j||(j={}));class ze{constructor(t,n,r,s){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const ps=(e,t)=>{if($t(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new at(e.common.issues);return this._error=n,this._error}}};function U(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:s}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(o,i)=>{const{message:u}=e;return o.code==="invalid_enum_value"?{message:u??i.defaultError}:typeof i.data>"u"?{message:u??r??i.defaultError}:o.code!=="invalid_type"?{message:i.defaultError}:{message:u??n??i.defaultError}},description:s}}class V{get description(){return this._def.description}_getType(t){return ut(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:ut(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new be,ctx:{common:t.parent.common,data:t.data,parsedType:ut(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(On(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ut(t)},s=this._parseSync({data:t,path:r.path,parent:r});return ps(r,s)}"~validate"(t){var r,s;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ut(t)};if(!this["~standard"].async)try{const a=this._parseSync({data:t,path:[],parent:n});return $t(a)?{value:a.value}:{issues:n.common.issues}}catch(a){(s=(r=a==null?void 0:a.message)==null?void 0:r.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(a=>$t(a)?{value:a.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ut(t)},s=this._parse({data:t,path:r.path,parent:r}),a=await(On(s)?s:Promise.resolve(s));return ps(r,a)}refine(t,n){const r=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,a)=>{const o=t(s),i=()=>a.addIssue({code:S.custom,...r(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(i(),!1)):o?!0:(i(),!1)})}refinement(t,n){return this._refinement((r,s)=>t(r)?!0:(s.addIssue(typeof n=="function"?n(r,s):n),!1))}_refinement(t){return new Tt({schema:this,typeName:C.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return rt.create(this,this._def)}nullable(){return kt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return He.create(this)}promise(){return Un.create(this,this._def)}or(t){return Dn.create([this,t],this._def)}and(t){return jn.create(this,t,this._def)}transform(t){return new Tt({...U(this._def),schema:this,typeName:C.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new Fn({...U(this._def),innerType:this,defaultValue:n,typeName:C.ZodDefault})}brand(){return new Ga({typeName:C.ZodBranded,type:this,...U(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new Zn({...U(this._def),innerType:this,catchValue:n,typeName:C.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return Ur.create(this,t)}readonly(){return Vn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const _l=/^c[^\s-]{8,}$/i,bl=/^[0-9a-z]+$/,wl=/^[0-9A-HJKMNP-TV-Z]{26}$/i,xl=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Tl=/^[a-z0-9_-]{21}$/i,kl=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Sl=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Cl=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Il="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ir;const Rl=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Al=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Nl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,El=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ol=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Pl=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ba="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ml=new RegExp(`^${Ba}$`);function Ja(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function Dl(e){return new RegExp(`^${Ja(e)}$`)}function jl(e){let t=`${Ba}T${Ja(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function $l(e,t){return!!((t==="v4"||!t)&&Rl.test(e)||(t==="v6"||!t)&&Nl.test(e))}function ql(e,t){if(!kl.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||t&&s.alg!==t)}catch{return!1}}function Ll(e,t){return!!((t==="v4"||!t)&&Al.test(e)||(t==="v6"||!t)&&El.test(e))}class nt extends V{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==P.string){const a=this._getOrReturnCtx(t);return E(a,{code:S.invalid_type,expected:P.string,received:a.parsedType}),q}const r=new be;let s;for(const a of this._def.checks)if(a.kind==="min")t.data.length<a.value&&(s=this._getOrReturnCtx(t,s),E(s,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")t.data.length>a.value&&(s=this._getOrReturnCtx(t,s),E(s,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const o=t.data.length>a.value,i=t.data.length<a.value;(o||i)&&(s=this._getOrReturnCtx(t,s),o?E(s,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):i&&E(s,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")Cl.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")ir||(ir=new RegExp(Il,"u")),ir.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")xl.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")Tl.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")_l.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")bl.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")wl.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(t.data)}catch{s=this._getOrReturnCtx(t,s),E(s,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?t.data=t.data.trim():a.kind==="includes"?t.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(t,s),E(s,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?t.data=t.data.toLowerCase():a.kind==="toUpperCase"?t.data=t.data.toUpperCase():a.kind==="startsWith"?t.data.startsWith(a.value)||(s=this._getOrReturnCtx(t,s),E(s,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?t.data.endsWith(a.value)||(s=this._getOrReturnCtx(t,s),E(s,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?jl(a).test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?Ml.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?Dl(a).test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?Sl.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?$l(t.data,a.version)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?ql(t.data,a.alg)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?Ll(t.data,a.version)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?Ol.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?Pl.test(t.data)||(s=this._getOrReturnCtx(t,s),E(s,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):H.assertNever(a);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(s=>t.test(s),{validation:n,code:S.invalid_string,...j.errToObj(r)})}_addCheck(t){return new nt({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...j.errToObj(t)})}url(t){return this._addCheck({kind:"url",...j.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...j.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...j.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...j.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...j.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...j.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...j.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...j.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...j.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...j.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...j.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...j.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...j.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...j.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...j.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...j.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...j.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...j.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...j.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...j.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...j.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...j.errToObj(n)})}nonempty(t){return this.min(1,j.errToObj(t))}trim(){return new nt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new nt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new nt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}nt.create=e=>new nt({checks:[],typeName:C.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...U(e)});function Ul(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,s=n>r?n:r,a=Number.parseInt(e.toFixed(s).replace(".","")),o=Number.parseInt(t.toFixed(s).replace(".",""));return a%o/10**s}class qt extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==P.number){const a=this._getOrReturnCtx(t);return E(a,{code:S.invalid_type,expected:P.number,received:a.parsedType}),q}let r;const s=new be;for(const a of this._def.checks)a.kind==="int"?H.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),E(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(r=this._getOrReturnCtx(t,r),E(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(r=this._getOrReturnCtx(t,r),E(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?Ul(t.data,a.value)!==0&&(r=this._getOrReturnCtx(t,r),E(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),E(r,{code:S.not_finite,message:a.message}),s.dirty()):H.assertNever(a);return{status:s.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,j.toString(n))}gt(t,n){return this.setLimit("min",t,!1,j.toString(n))}lte(t,n){return this.setLimit("max",t,!0,j.toString(n))}lt(t,n){return this.setLimit("max",t,!1,j.toString(n))}setLimit(t,n,r,s){return new qt({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:j.toString(s)}]})}_addCheck(t){return new qt({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:j.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:j.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:j.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:j.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:j.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:j.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:j.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:j.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:j.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&H.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}}qt.create=e=>new qt({checks:[],typeName:C.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...U(e)});class sn extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==P.bigint)return this._getInvalidInput(t);let r;const s=new be;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(r=this._getOrReturnCtx(t,r),E(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(r=this._getOrReturnCtx(t,r),E(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?t.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),E(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):H.assertNever(a);return{status:s.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return E(n,{code:S.invalid_type,expected:P.bigint,received:n.parsedType}),q}gte(t,n){return this.setLimit("min",t,!0,j.toString(n))}gt(t,n){return this.setLimit("min",t,!1,j.toString(n))}lte(t,n){return this.setLimit("max",t,!0,j.toString(n))}lt(t,n){return this.setLimit("max",t,!1,j.toString(n))}setLimit(t,n,r,s){return new sn({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:j.toString(s)}]})}_addCheck(t){return new sn({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:j.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:j.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:j.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:j.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:j.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}sn.create=e=>new sn({checks:[],typeName:C.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...U(e)});class br extends V{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==P.boolean){const r=this._getOrReturnCtx(t);return E(r,{code:S.invalid_type,expected:P.boolean,received:r.parsedType}),q}return De(t.data)}}br.create=e=>new br({typeName:C.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...U(e)});class Pn extends V{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==P.date){const a=this._getOrReturnCtx(t);return E(a,{code:S.invalid_type,expected:P.date,received:a.parsedType}),q}if(Number.isNaN(t.data.getTime())){const a=this._getOrReturnCtx(t);return E(a,{code:S.invalid_date}),q}const r=new be;let s;for(const a of this._def.checks)a.kind==="min"?t.data.getTime()<a.value&&(s=this._getOrReturnCtx(t,s),E(s,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?t.data.getTime()>a.value&&(s=this._getOrReturnCtx(t,s),E(s,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):H.assertNever(a);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Pn({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:j.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:j.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}Pn.create=e=>new Pn({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:C.ZodDate,...U(e)});class fs extends V{_parse(t){if(this._getType(t)!==P.symbol){const r=this._getOrReturnCtx(t);return E(r,{code:S.invalid_type,expected:P.symbol,received:r.parsedType}),q}return De(t.data)}}fs.create=e=>new fs({typeName:C.ZodSymbol,...U(e)});class wr extends V{_parse(t){if(this._getType(t)!==P.undefined){const r=this._getOrReturnCtx(t);return E(r,{code:S.invalid_type,expected:P.undefined,received:r.parsedType}),q}return De(t.data)}}wr.create=e=>new wr({typeName:C.ZodUndefined,...U(e)});class Mn extends V{_parse(t){if(this._getType(t)!==P.null){const r=this._getOrReturnCtx(t);return E(r,{code:S.invalid_type,expected:P.null,received:r.parsedType}),q}return De(t.data)}}Mn.create=e=>new Mn({typeName:C.ZodNull,...U(e)});class an extends V{constructor(){super(...arguments),this._any=!0}_parse(t){return De(t.data)}}an.create=e=>new an({typeName:C.ZodAny,...U(e)});class xr extends V{constructor(){super(...arguments),this._unknown=!0}_parse(t){return De(t.data)}}xr.create=e=>new xr({typeName:C.ZodUnknown,...U(e)});class ct extends V{_parse(t){const n=this._getOrReturnCtx(t);return E(n,{code:S.invalid_type,expected:P.never,received:n.parsedType}),q}}ct.create=e=>new ct({typeName:C.ZodNever,...U(e)});class hs extends V{_parse(t){if(this._getType(t)!==P.undefined){const r=this._getOrReturnCtx(t);return E(r,{code:S.invalid_type,expected:P.void,received:r.parsedType}),q}return De(t.data)}}hs.create=e=>new hs({typeName:C.ZodVoid,...U(e)});class He extends V{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),s=this._def;if(n.parsedType!==P.array)return E(n,{code:S.invalid_type,expected:P.array,received:n.parsedType}),q;if(s.exactLength!==null){const o=n.data.length>s.exactLength.value,i=n.data.length<s.exactLength.value;(o||i)&&(E(n,{code:o?S.too_big:S.too_small,minimum:i?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(E(n,{code:S.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(E(n,{code:S.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((o,i)=>s.type._parseAsync(new ze(n,o,n.path,i)))).then(o=>be.mergeArray(r,o));const a=[...n.data].map((o,i)=>s.type._parseSync(new ze(n,o,n.path,i)));return be.mergeArray(r,a)}get element(){return this._def.type}min(t,n){return new He({...this._def,minLength:{value:t,message:j.toString(n)}})}max(t,n){return new He({...this._def,maxLength:{value:t,message:j.toString(n)}})}length(t,n){return new He({...this._def,exactLength:{value:t,message:j.toString(n)}})}nonempty(t){return this.min(1,t)}}He.create=(e,t)=>new He({type:e,minLength:null,maxLength:null,exactLength:null,typeName:C.ZodArray,...U(t)});function Dt(e){if(e instanceof ce){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=rt.create(Dt(r))}return new ce({...e._def,shape:()=>t})}else return e instanceof He?new He({...e._def,type:Dt(e.element)}):e instanceof rt?rt.create(Dt(e.unwrap())):e instanceof kt?kt.create(Dt(e.unwrap())):e instanceof wt?wt.create(e.items.map(t=>Dt(t))):e}class ce extends V{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=H.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==P.object){const l=this._getOrReturnCtx(t);return E(l,{code:S.invalid_type,expected:P.object,received:l.parsedType}),q}const{status:r,ctx:s}=this._processInputParams(t),{shape:a,keys:o}=this._getCached(),i=[];if(!(this._def.catchall instanceof ct&&this._def.unknownKeys==="strip"))for(const l in s.data)o.includes(l)||i.push(l);const u=[];for(const l of o){const c=a[l],f=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ze(s,f,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof ct){const l=this._def.unknownKeys;if(l==="passthrough")for(const c of i)u.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(l==="strict")i.length>0&&(E(s,{code:S.unrecognized_keys,keys:i}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const c of i){const f=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ze(s,f,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const c of u){const f=await c.key,d=await c.value;l.push({key:f,value:d,alwaysSet:c.alwaysSet})}return l}).then(l=>be.mergeObjectSync(r,l)):be.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(t){return j.errToObj,new ce({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var a,o;const s=((o=(a=this._def).errorMap)==null?void 0:o.call(a,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:j.errToObj(t).message??s}:{message:s}}}:{}})}strip(){return new ce({...this._def,unknownKeys:"strip"})}passthrough(){return new ce({...this._def,unknownKeys:"passthrough"})}extend(t){return new ce({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new ce({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:C.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new ce({...this._def,catchall:t})}pick(t){const n={};for(const r of H.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new ce({...this._def,shape:()=>n})}omit(t){const n={};for(const r of H.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new ce({...this._def,shape:()=>n})}deepPartial(){return Dt(this)}partial(t){const n={};for(const r of H.objectKeys(this.shape)){const s=this.shape[r];t&&!t[r]?n[r]=s:n[r]=s.optional()}return new ce({...this._def,shape:()=>n})}required(t){const n={};for(const r of H.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof rt;)a=a._def.innerType;n[r]=a}return new ce({...this._def,shape:()=>n})}keyof(){return Ha(H.objectKeys(this.shape))}}ce.create=(e,t)=>new ce({shape:()=>e,unknownKeys:"strip",catchall:ct.create(),typeName:C.ZodObject,...U(t)});ce.strictCreate=(e,t)=>new ce({shape:()=>e,unknownKeys:"strict",catchall:ct.create(),typeName:C.ZodObject,...U(t)});ce.lazycreate=(e,t)=>new ce({shape:e,unknownKeys:"strip",catchall:ct.create(),typeName:C.ZodObject,...U(t)});class Dn extends V{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function s(a){for(const i of a)if(i.result.status==="valid")return i.result;for(const i of a)if(i.result.status==="dirty")return n.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(i=>new at(i.ctx.common.issues));return E(n,{code:S.invalid_union,unionErrors:o}),q}if(n.common.async)return Promise.all(r.map(async a=>{const o={...n,common:{...n.common,issues:[]},parent:null};return{result:await a._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}})).then(s);{let a;const o=[];for(const u of r){const l={...n,common:{...n.common,issues:[]},parent:null},c=u._parseSync({data:n.data,path:n.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;const i=o.map(u=>new at(u));return E(n,{code:S.invalid_union,unionErrors:i}),q}}get options(){return this._def.options}}Dn.create=(e,t)=>new Dn({options:e,typeName:C.ZodUnion,...U(t)});const et=e=>e instanceof qn?et(e.schema):e instanceof Tt?et(e.innerType()):e instanceof Ln?[e.value]:e instanceof xt?e.options:e instanceof kr?H.objectValues(e.enum):e instanceof Fn?et(e._def.innerType):e instanceof wr?[void 0]:e instanceof Mn?[null]:e instanceof rt?[void 0,...et(e.unwrap())]:e instanceof kt?[null,...et(e.unwrap())]:e instanceof Ga||e instanceof Vn?et(e.unwrap()):e instanceof Zn?et(e._def.innerType):[];class Lr extends V{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==P.object)return E(n,{code:S.invalid_type,expected:P.object,received:n.parsedType}),q;const r=this.discriminator,s=n.data[r],a=this.optionsMap.get(s);return a?n.common.async?a._parseAsync({data:n.data,path:n.path,parent:n}):a._parseSync({data:n.data,path:n.path,parent:n}):(E(n,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),q)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const s=new Map;for(const a of n){const o=et(a.shape[t]);if(!o.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const i of o){if(s.has(i))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(i)}`);s.set(i,a)}}return new Lr({typeName:C.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:s,...U(r)})}}function Tr(e,t){const n=ut(e),r=ut(t);if(e===t)return{valid:!0,data:e};if(n===P.object&&r===P.object){const s=H.objectKeys(t),a=H.objectKeys(e).filter(i=>s.indexOf(i)!==-1),o={...e,...t};for(const i of a){const u=Tr(e[i],t[i]);if(!u.valid)return{valid:!1};o[i]=u.data}return{valid:!0,data:o}}else if(n===P.array&&r===P.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let a=0;a<e.length;a++){const o=e[a],i=t[a],u=Tr(o,i);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return n===P.date&&r===P.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class jn extends V{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),s=(a,o)=>{if(cs(a)||cs(o))return q;const i=Tr(a.value,o.value);return i.valid?((ds(a)||ds(o))&&n.dirty(),{status:n.value,value:i.data}):(E(r,{code:S.invalid_intersection_types}),q)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,o])=>s(a,o)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}jn.create=(e,t,n)=>new jn({left:e,right:t,typeName:C.ZodIntersection,...U(n)});class wt extends V{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==P.array)return E(r,{code:S.invalid_type,expected:P.array,received:r.parsedType}),q;if(r.data.length<this._def.items.length)return E(r,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),q;!this._def.rest&&r.data.length>this._def.items.length&&(E(r,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...r.data].map((o,i)=>{const u=this._def.items[i]||this._def.rest;return u?u._parse(new ze(r,o,r.path,i)):null}).filter(o=>!!o);return r.common.async?Promise.all(a).then(o=>be.mergeArray(n,o)):be.mergeArray(n,a)}get items(){return this._def.items}rest(t){return new wt({...this._def,rest:t})}}wt.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new wt({items:e,typeName:C.ZodTuple,rest:null,...U(t)})};class $n extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==P.object)return E(r,{code:S.invalid_type,expected:P.object,received:r.parsedType}),q;const s=[],a=this._def.keyType,o=this._def.valueType;for(const i in r.data)s.push({key:a._parse(new ze(r,i,r.path,i)),value:o._parse(new ze(r,r.data[i],r.path,i)),alwaysSet:i in r.data});return r.common.async?be.mergeObjectAsync(n,s):be.mergeObjectSync(n,s)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof V?new $n({keyType:t,valueType:n,typeName:C.ZodRecord,...U(r)}):new $n({keyType:nt.create(),valueType:t,typeName:C.ZodRecord,...U(n)})}}class ms extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==P.map)return E(r,{code:S.invalid_type,expected:P.map,received:r.parsedType}),q;const s=this._def.keyType,a=this._def.valueType,o=[...r.data.entries()].map(([i,u],l)=>({key:s._parse(new ze(r,i,r.path,[l,"key"])),value:a._parse(new ze(r,u,r.path,[l,"value"]))}));if(r.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const u of o){const l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return q;(l.status==="dirty"||c.status==="dirty")&&n.dirty(),i.set(l.value,c.value)}return{status:n.value,value:i}})}else{const i=new Map;for(const u of o){const l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return q;(l.status==="dirty"||c.status==="dirty")&&n.dirty(),i.set(l.value,c.value)}return{status:n.value,value:i}}}}ms.create=(e,t,n)=>new ms({valueType:t,keyType:e,typeName:C.ZodMap,...U(n)});class on extends V{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==P.set)return E(r,{code:S.invalid_type,expected:P.set,received:r.parsedType}),q;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(E(r,{code:S.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(E(r,{code:S.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const a=this._def.valueType;function o(u){const l=new Set;for(const c of u){if(c.status==="aborted")return q;c.status==="dirty"&&n.dirty(),l.add(c.value)}return{status:n.value,value:l}}const i=[...r.data.values()].map((u,l)=>a._parse(new ze(r,u,r.path,l)));return r.common.async?Promise.all(i).then(u=>o(u)):o(i)}min(t,n){return new on({...this._def,minSize:{value:t,message:j.toString(n)}})}max(t,n){return new on({...this._def,maxSize:{value:t,message:j.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}on.create=(e,t)=>new on({valueType:e,minSize:null,maxSize:null,typeName:C.ZodSet,...U(t)});class qn extends V{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}qn.create=(e,t)=>new qn({getter:e,typeName:C.ZodLazy,...U(t)});class Ln extends V{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return E(n,{received:n.data,code:S.invalid_literal,expected:this._def.value}),q}return{status:"valid",value:t.data}}get value(){return this._def.value}}Ln.create=(e,t)=>new Ln({value:e,typeName:C.ZodLiteral,...U(t)});function Ha(e,t){return new xt({values:e,typeName:C.ZodEnum,...U(t)})}class xt extends V{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return E(n,{expected:H.joinValues(r),received:n.parsedType,code:S.invalid_type}),q}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return E(n,{received:n.data,code:S.invalid_enum_value,options:r}),q}return De(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return xt.create(t,{...this._def,...n})}exclude(t,n=this._def){return xt.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}}xt.create=Ha;class kr extends V{_parse(t){const n=H.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==P.string&&r.parsedType!==P.number){const s=H.objectValues(n);return E(r,{expected:H.joinValues(s),received:r.parsedType,code:S.invalid_type}),q}if(this._cache||(this._cache=new Set(H.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const s=H.objectValues(n);return E(r,{received:r.data,code:S.invalid_enum_value,options:s}),q}return De(t.data)}get enum(){return this._def.values}}kr.create=(e,t)=>new kr({values:e,typeName:C.ZodNativeEnum,...U(t)});class Un extends V{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==P.promise&&n.common.async===!1)return E(n,{code:S.invalid_type,expected:P.promise,received:n.parsedType}),q;const r=n.parsedType===P.promise?n.data:Promise.resolve(n.data);return De(r.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Un.create=(e,t)=>new Un({type:e,typeName:C.ZodPromise,...U(t)});class Tt extends V{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===C.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),s=this._def.effect||null,a={addIssue:o=>{E(r,o),o.fatal?n.abort():n.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const o=s.transform(r.data,a);if(r.common.async)return Promise.resolve(o).then(async i=>{if(n.value==="aborted")return q;const u=await this._def.schema._parseAsync({data:i,path:r.path,parent:r});return u.status==="aborted"?q:u.status==="dirty"||n.value==="dirty"?nn(u.value):u});{if(n.value==="aborted")return q;const i=this._def.schema._parseSync({data:o,path:r.path,parent:r});return i.status==="aborted"?q:i.status==="dirty"||n.value==="dirty"?nn(i.value):i}}if(s.type==="refinement"){const o=i=>{const u=s.refinement(i,a);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?q:(i.status==="dirty"&&n.dirty(),o(i.value),{status:n.value,value:i.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>i.status==="aborted"?q:(i.status==="dirty"&&n.dirty(),o(i.value).then(()=>({status:n.value,value:i.value}))))}if(s.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!$t(o))return q;const i=s.transform(o.value,a);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:i}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>$t(o)?Promise.resolve(s.transform(o.value,a)).then(i=>({status:n.value,value:i})):q);H.assertNever(s)}}Tt.create=(e,t,n)=>new Tt({schema:e,typeName:C.ZodEffects,effect:t,...U(n)});Tt.createWithPreprocess=(e,t,n)=>new Tt({schema:t,effect:{type:"preprocess",transform:e},typeName:C.ZodEffects,...U(n)});class rt extends V{_parse(t){return this._getType(t)===P.undefined?De(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}rt.create=(e,t)=>new rt({innerType:e,typeName:C.ZodOptional,...U(t)});class kt extends V{_parse(t){return this._getType(t)===P.null?De(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}kt.create=(e,t)=>new kt({innerType:e,typeName:C.ZodNullable,...U(t)});class Fn extends V{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===P.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}Fn.create=(e,t)=>new Fn({innerType:e,typeName:C.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...U(t)});class Zn extends V{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return On(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new at(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new at(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Zn.create=(e,t)=>new Zn({innerType:e,typeName:C.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...U(t)});class gs extends V{_parse(t){if(this._getType(t)!==P.nan){const r=this._getOrReturnCtx(t);return E(r,{code:S.invalid_type,expected:P.nan,received:r.parsedType}),q}return{status:"valid",value:t.data}}}gs.create=e=>new gs({typeName:C.ZodNaN,...U(e)});class Ga extends V{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class Ur extends V{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?q:a.status==="dirty"?(n.dirty(),nn(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?q:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(t,n){return new Ur({in:t,out:n,typeName:C.ZodPipeline})}}class Vn extends V{_parse(t){const n=this._def.innerType._parse(t),r=s=>($t(s)&&(s.value=Object.freeze(s.value)),s);return On(n)?n.then(s=>r(s)):r(n)}unwrap(){return this._def.innerType}}Vn.create=(e,t)=>new Vn({innerType:e,typeName:C.ZodReadonly,...U(t)});function ys(e,t){const n=typeof e=="function"?e(t):typeof e=="string"?{message:e}:e;return typeof n=="string"?{message:n}:n}function za(e,t={},n){return e?an.create().superRefine((r,s)=>{const a=e(r);if(a instanceof Promise)return a.then(o=>{if(!o){const i=ys(t,r),u=i.fatal??n??!0;s.addIssue({code:"custom",...i,fatal:u})}});if(!a){const o=ys(t,r),i=o.fatal??n??!0;s.addIssue({code:"custom",...o,fatal:i})}}):an.create()}var C;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(C||(C={}));const Bn=(e,t={message:`Input not instance of ${e.name}`})=>za(n=>n instanceof e,t),p=nt.create,w=qt.create,_e=br.create,Fl=Mn.create,Qn=an.create,Gt=xr.create;ct.create;const O=He.create,h=ce.create,X=Dn.create,st=Lr.create;jn.create;const vs=wt.create,Lt=$n.create,Zl=qn.create,N=Ln.create,Fe=xt.create;Un.create;const fe=rt.create;kt.create;function Ce(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?Va(t,e.currentPath):t.join("/")}}function Vl(e,t){var r,s,a;const n={type:"array"};return(r=e.type)!=null&&r._def&&((a=(s=e.type)==null?void 0:s._def)==null?void 0:a.typeName)!==C.ZodAny&&(n.items=z(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&W(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&W(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(W(n,"minItems",e.exactLength.value,e.exactLength.message,t),W(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function Bl(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?W(n,"minimum",r.value,r.message,t):W(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),W(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?W(n,"maximum",r.value,r.message,t):W(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),W(n,"maximum",r.value,r.message,t));break;case"multipleOf":W(n,"multipleOf",r.value,r.message,t);break}return n}function Jl(){return{type:"boolean"}}function Wa(e,t){return z(e.type._def,t)}const Hl=(e,t)=>z(e.innerType._def,t);function Ya(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>Ya(e,t,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Gl(e,t)}}const Gl=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":W(n,"minimum",r.value,r.message,t);break;case"max":W(n,"maximum",r.value,r.message,t);break}return n};function zl(e,t){return{...z(e.innerType._def,t),default:e.defaultValue()}}function Wl(e,t){return t.effectStrategy==="input"?z(e.schema._def,t):Ce(t)}function Yl(e){return{type:"string",enum:Array.from(e.values)}}const Kl=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Xl(e,t){const n=[z(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),z(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(a=>!!a);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(a=>{if(Kl(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let o=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:i,...u}=a;o=u}else r=void 0;s.push(o)}}),s.length?{allOf:s,...r}:void 0}function Ql(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let lr;const Le={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(lr===void 0&&(lr=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),lr),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Ka(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":W(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":W(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Ue(n,"email",r.message,t);break;case"format:idn-email":Ue(n,"idn-email",r.message,t);break;case"pattern:zod":ve(n,Le.email,r.message,t);break}break;case"url":Ue(n,"uri",r.message,t);break;case"uuid":Ue(n,"uuid",r.message,t);break;case"regex":ve(n,r.regex,r.message,t);break;case"cuid":ve(n,Le.cuid,r.message,t);break;case"cuid2":ve(n,Le.cuid2,r.message,t);break;case"startsWith":ve(n,RegExp(`^${ur(r.value,t)}`),r.message,t);break;case"endsWith":ve(n,RegExp(`${ur(r.value,t)}$`),r.message,t);break;case"datetime":Ue(n,"date-time",r.message,t);break;case"date":Ue(n,"date",r.message,t);break;case"time":Ue(n,"time",r.message,t);break;case"duration":Ue(n,"duration",r.message,t);break;case"length":W(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t),W(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":{ve(n,RegExp(ur(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&Ue(n,"ipv4",r.message,t),r.version!=="v4"&&Ue(n,"ipv6",r.message,t);break}case"base64url":ve(n,Le.base64url,r.message,t);break;case"jwt":ve(n,Le.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&ve(n,Le.ipv4Cidr,r.message,t),r.version!=="v4"&&ve(n,Le.ipv6Cidr,r.message,t);break}case"emoji":ve(n,Le.emoji(),r.message,t);break;case"ulid":{ve(n,Le.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Ue(n,"binary",r.message,t);break}case"contentEncoding:base64":{W(n,"contentEncoding","base64",r.message,t);break}case"pattern:zod":{ve(n,Le.base64,r.message,t);break}}break}case"nanoid":ve(n,Le.nanoid,r.message,t)}return n}function ur(e,t){return t.patternStrategy==="escape"?tu(e):e}const eu=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function tu(e){let t="";for(let n=0;n<e.length;n++)eu.has(e[n])||(t+="\\"),t+=e[n];return t}function Ue(e,t,n,r){var s;e.format||(s=e.anyOf)!=null&&s.some(a=>a.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):W(e,"format",t,n,r)}function ve(e,t,n,r){var s;e.pattern||(s=e.allOf)!=null&&s.some(a=>a.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:_s(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):W(e,"pattern",_s(t,r),n,r)}function _s(e,t){var u;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=n.i?e.source.toLowerCase():e.source;let s="",a=!1,o=!1,i=!1;for(let l=0;l<r.length;l++){if(a){s+=r[l],a=!1;continue}if(n.i){if(o){if(r[l].match(/[a-z]/)){i?(s+=r[l],s+=`${r[l-2]}-${r[l]}`.toUpperCase(),i=!1):r[l+1]==="-"&&((u=r[l+2])!=null&&u.match(/[a-z]/))?(s+=r[l],i=!0):s+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){s+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(n.m){if(r[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(n.s&&r[l]==="."){s+=o?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}s+=r[l],r[l]==="\\"?a=!0:o&&r[l]==="]"?o=!1:!o&&r[l]==="["&&(o=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function Xa(e,t){var r,s,a,o,i,u;if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===C.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((l,c)=>({...l,[c]:z(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",c]})??Ce(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:z(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return n;if(((s=e.keyType)==null?void 0:s._def.typeName)===C.ZodString&&((a=e.keyType._def.checks)!=null&&a.length)){const{type:l,...c}=Ka(e.keyType._def,t);return{...n,propertyNames:c}}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===C.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(((i=e.keyType)==null?void 0:i._def.typeName)===C.ZodBranded&&e.keyType._def.type._def.typeName===C.ZodString&&((u=e.keyType._def.type._def.checks)!=null&&u.length)){const{type:l,...c}=Wa(e.keyType._def,t);return{...n,propertyNames:c}}}return n}function nu(e,t){if(t.mapStrategy==="record")return Xa(e,t);const n=z(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Ce(t),r=z(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Ce(t);return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function ru(e){const t=e.values,r=Object.keys(e.values).filter(a=>typeof t[t[a]]!="number").map(a=>t[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function su(e){return e.target==="openAi"?void 0:{not:Ce({...e,currentPath:[...e.currentPath,"not"]})}}function au(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Jn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ou(e,t){if(t.target==="openApi3")return bs(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in Jn&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,a)=>{const o=Jn[a._def.typeName];return o&&!s.includes(o)?[...s,o]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,a)=>{const o=typeof a._def.value;switch(o){case"string":case"number":case"boolean":return[...s,o];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((a,o,i)=>i.indexOf(a)===o);return{type:s.length>1?s:s[0],enum:n.reduce((a,o)=>a.includes(o._def.value)?a:[...a,o._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return bs(e,t)}const bs=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,s)=>z(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function iu(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:Jn[e.innerType._def.typeName],nullable:!0}:{type:[Jn[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=z(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=z(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function lu(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",Za(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?W(n,"minimum",r.value,r.message,t):W(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),W(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?W(n,"maximum",r.value,r.message,t):W(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),W(n,"maximum",r.value,r.message,t));break;case"multipleOf":W(n,"multipleOf",r.value,r.message,t);break}return n}function uu(e,t){const n=t.target==="openAi",r={type:"object",properties:{}},s=[],a=e.shape();for(const i in a){let u=a[i];if(u===void 0||u._def===void 0)continue;let l=du(u);l&&n&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);const c=z(u._def,{...t,currentPath:[...t.currentPath,"properties",i],propertyPath:[...t.currentPath,"properties",i]});c!==void 0&&(r.properties[i]=c,l||s.push(i))}s.length&&(r.required=s);const o=cu(e,t);return o!==void 0&&(r.additionalProperties=o),r}function cu(e,t){if(e.catchall._def.typeName!=="ZodNever")return z(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function du(e){try{return e.isOptional()}catch{return!0}}const pu=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return z(e.innerType._def,t);const n=z(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:Ce(t)},n]}:Ce(t)},fu=(e,t)=>{if(t.pipeStrategy==="input")return z(e.in._def,t);if(t.pipeStrategy==="output")return z(e.out._def,t);const n=z(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=z(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function hu(e,t){return z(e.type._def,t)}function mu(e,t){const r={type:"array",uniqueItems:!0,items:z(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&W(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&W(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}function gu(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>z(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:z(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>z(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function yu(e){return{not:Ce(e)}}function vu(e){return Ce(e)}const _u=(e,t)=>z(e.innerType._def,t),bu=(e,t,n)=>{switch(t){case C.ZodString:return Ka(e,n);case C.ZodNumber:return lu(e,n);case C.ZodObject:return uu(e,n);case C.ZodBigInt:return Bl(e,n);case C.ZodBoolean:return Jl();case C.ZodDate:return Ya(e,n);case C.ZodUndefined:return yu(n);case C.ZodNull:return au(n);case C.ZodArray:return Vl(e,n);case C.ZodUnion:case C.ZodDiscriminatedUnion:return ou(e,n);case C.ZodIntersection:return Xl(e,n);case C.ZodTuple:return gu(e,n);case C.ZodRecord:return Xa(e,n);case C.ZodLiteral:return Ql(e,n);case C.ZodEnum:return Yl(e);case C.ZodNativeEnum:return ru(e);case C.ZodNullable:return iu(e,n);case C.ZodOptional:return pu(e,n);case C.ZodMap:return nu(e,n);case C.ZodSet:return mu(e,n);case C.ZodLazy:return()=>e.getter()._def;case C.ZodPromise:return hu(e,n);case C.ZodNaN:case C.ZodNever:return su(n);case C.ZodEffects:return Wl(e,n);case C.ZodAny:return Ce(n);case C.ZodUnknown:return vu(n);case C.ZodDefault:return zl(e,n);case C.ZodBranded:return Wa(e,n);case C.ZodReadonly:return _u(e,n);case C.ZodCatch:return Hl(e,n);case C.ZodPipeline:return fu(e,n);case C.ZodFunction:case C.ZodVoid:case C.ZodSymbol:return;default:return(r=>{})()}};function z(e,t,n=!1){var i;const r=t.seen.get(e);if(t.override){const u=(i=t.override)==null?void 0:i.call(t,e,t,r,n);if(u!==fl)return u}if(r&&!n){const u=wu(r,t);if(u!==void 0)return u}const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);const a=bu(e,e.typeName,t),o=typeof a=="function"?z(a(),t):a;if(o&&xu(e,t,o),t.postProcess){const u=t.postProcess(o,e,t);return s.jsonSchema=o,u}return s.jsonSchema=o,o}const wu=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Va(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Ce(t)):t.$refStrategy==="seen"?Ce(t):void 0}},xu=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),Tu=(e,t)=>{const n=ml(t);let r=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[l,c])=>({...u,[l]:z(c._def,{...n,currentPath:[...n.basePath,n.definitionPath,l]},!0)??Ce(n)}),{}):void 0;const s=typeof t=="string"?t:(t==null?void 0:t.nameStrategy)==="title"||t==null?void 0:t.name,a=z(e._def,s===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,s]},!1)??Ce(n),o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(a.title=o),n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:n.$refStrategy==="relative"?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const i=s===void 0?r?{...a,[n.definitionPath]:r}:a:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...r,[s]:a}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};var ln={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},un={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},cn={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},dn={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},pn={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},ku=[ln,un,cn,dn,pn];ln.code+"",un.code+"",cn.code+"",dn.code+"",pn.code+"";ln.name+"",ln.code,un.name+"",un.code,cn.name+"",cn.code,dn.name+"",dn.code,pn.name+"",pn.code;ku.map(e=>e.code);function Su(e){const t=["ROOT"];let n=-1,r=null;function s(u,l,c){switch(u){case'"':{n=l,t.pop(),t.push(c),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{n=l,r=l,t.pop(),t.push(c),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=l,t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"{":{n=l,t.pop(),t.push(c),t.push("INSIDE_OBJECT_START");break}case"[":{n=l,t.pop(),t.push(c),t.push("INSIDE_ARRAY_START");break}}}function a(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=l,t.pop();break}}}function o(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=l,t.pop();break}}}for(let u=0;u<e.length;u++){const l=e[u];switch(t[t.length-1]){case"ROOT":s(l,u,"FINISH");break;case"INSIDE_OBJECT_START":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{n=u,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(l){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{s(l,u,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{a(l,u);break}case"INSIDE_STRING":{switch(l){case'"':{t.pop(),n=u;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:n=u}break}case"INSIDE_ARRAY_START":{switch(l){case"]":{n=u,t.pop();break}default:{n=u,s(l,u,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=u,t.pop();break}default:{n=u;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{s(l,u,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),n=u;break}case"INSIDE_NUMBER":{switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=u;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&a(l,u);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&a(l,u);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const f=e.substring(r,u+1);!"false".startsWith(f)&&!"true".startsWith(f)&&!"null".startsWith(f)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?a(l,u):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u)):n=u;break}}}let i=e.slice(0,n+1);for(let u=t.length-1;u>=0;u--)switch(t[u]){case"INSIDE_STRING":{i+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{i+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{i+="]";break}case"INSIDE_LITERAL":{const c=e.substring(r,e.length);"true".startsWith(c)?i+="true".slice(c.length):"false".startsWith(c)?i+="false".slice(c.length):"null".startsWith(c)&&(i+="null".slice(c.length))}}return i}function Cu(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=bt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=bt({text:Su(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var Iu={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},Ru={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},Au={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},Nu={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},Eu={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},Ou={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},Pu={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},Mu={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},Du={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},ju={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},$u={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},qu={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},Lu={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},Uu={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},Fu={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},Zu={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}},er=[Iu,Ru,Au,Nu,Eu,Ou,Pu,Mu,Du,ju,$u,qu,Lu,Uu,Fu,Zu];Object.fromEntries(er.map(e=>[e.code,e]));Object.fromEntries(er.map(e=>[e.name,e.code]));er.map(e=>e.code);function ge(e,t){const n=er.find(r=>r.name===e);if(!n)throw new Error(`Invalid stream part type: ${e}`);return`${n.code}:${JSON.stringify(t)}
`}function Vu(e,t){var n;const r=(n=void 0)!=null?n:!1;return Qa(Tu(e,{$refStrategy:r?"root":"none",target:"jsonSchema7"}),{validate:s=>{const a=e.safeParse(s);return a.success?{success:!0,value:a.data}:{success:!1,error:a.error}}})}var Sr=Symbol.for("vercel.ai.schema");function Qa(e,{validate:t}={}){return{[Sr]:!0,_type:void 0,[An]:!0,jsonSchema:e,validate:t}}function Bu(e){return typeof e=="object"&&e!==null&&Sr in e&&e[Sr]===!0&&"jsonSchema"in e&&"validate"in e}function tr(e){return Bu(e)?e:Vu(e)}var Ju=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},_t="1.9.0",ws=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Hu(e){var t=new Set([e]),n=new Set,r=e.match(ws);if(!r)return function(){return!1};var s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(s.prerelease!=null)return function(u){return u===e};function a(i){return n.add(i),!1}function o(i){return t.add(i),!0}return function(u){if(t.has(u))return!0;if(n.has(u))return!1;var l=u.match(ws);if(!l)return a(u);var c={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return c.prerelease!=null||s.major!==c.major?a(u):s.major===0?s.minor===c.minor&&s.patch<=c.patch?o(u):a(u):s.minor<=c.minor?o(u):a(u)}}var Gu=Hu(_t),zu=_t.split(".")[0],fn=Symbol.for("opentelemetry.js.api."+zu),hn=Ju;function Fr(e,t,n,r){var s;r===void 0&&(r=!1);var a=hn[fn]=(s=hn[fn])!==null&&s!==void 0?s:{version:_t};if(!r&&a[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(o.stack||o.message),!1}if(a.version!==_t){var o=new Error("@opentelemetry/api: Registration of version v"+a.version+" for "+e+" does not match previously registered API v"+_t);return n.error(o.stack||o.message),!1}return a[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+_t+"."),!0}function mn(e){var t,n,r=(t=hn[fn])===null||t===void 0?void 0:t.version;if(!(!r||!Gu(r)))return(n=hn[fn])===null||n===void 0?void 0:n[e]}function Zr(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+_t+".");var n=hn[fn];n&&delete n[e]}var Wu=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,a=[],o;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)a.push(s.value)}catch(i){o={error:i}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Yu=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,a;r<s;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},Ku=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return tn("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return tn("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return tn("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return tn("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return tn("verbose",this._namespace,t)},e}();function tn(e,t,n){var r=mn("diag");if(r)return n.unshift(t),r[e].apply(r,Yu([],Wu(n),!1))}var Re;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(Re||(Re={}));function Xu(e,t){e<Re.NONE?e=Re.NONE:e>Re.ALL&&(e=Re.ALL),t=t||{};function n(r,s){var a=t[r];return typeof a=="function"&&e>=s?a.bind(t):function(){}}return{error:n("error",Re.ERROR),warn:n("warn",Re.WARN),info:n("info",Re.INFO),debug:n("debug",Re.DEBUG),verbose:n("verbose",Re.VERBOSE)}}var Qu=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,a=[],o;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)a.push(s.value)}catch(i){o={error:i}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},ec=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,a;r<s;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},tc="diag",Hn=function(){function e(){function t(s){return function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var i=mn("diag");if(i)return i[s].apply(i,ec([],Qu(a),!1))}}var n=this,r=function(s,a){var o,i,u;if(a===void 0&&(a={logLevel:Re.INFO}),s===n){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof a=="number"&&(a={logLevel:a});var c=mn("diag"),f=Xu((i=a.logLevel)!==null&&i!==void 0?i:Re.INFO,s);if(c&&!a.suppressOverrideMessage){var d=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+d),f.warn("Current logger will overwrite one already registered from "+d)}return Fr("diag",f,n,!0)};n.setLogger=r,n.disable=function(){Zr(tc,n)},n.createComponentLogger=function(s){return new Ku(s)},n.verbose=t("verbose"),n.debug=t("debug"),n.info=t("info"),n.warn=t("warn"),n.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function nc(e){return Symbol.for(e)}var rc=function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,s){var a=new e(n._currentContext);return a._currentContext.set(r,s),a},n.deleteValue=function(r){var s=new e(n._currentContext);return s._currentContext.delete(r),s}}return e}(),sc=new rc,ac=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,a=[],o;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)a.push(s.value)}catch(i){o={error:i}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},oc=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,a;r<s;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},ic=function(){function e(){}return e.prototype.active=function(){return sc},e.prototype.with=function(t,n,r){for(var s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];return n.call.apply(n,oc([r],ac(s),!1))},e.prototype.bind=function(t,n){return n},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),lc=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,a=[],o;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)a.push(s.value)}catch(i){o={error:i}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},uc=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,a;r<s;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},cr="context",cc=new ic,eo=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return Fr(cr,t,Hn.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,n,r){for(var s,a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];return(s=this._getContextManager()).with.apply(s,uc([t,n,r],lc(a),!1))},e.prototype.bind=function(t,n){return this._getContextManager().bind(t,n)},e.prototype._getContextManager=function(){return mn(cr)||cc},e.prototype.disable=function(){this._getContextManager().disable(),Zr(cr,Hn.instance())},e}(),Cr;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(Cr||(Cr={}));var to="0000000000000000",no="00000000000000000000000000000000",dc={traceId:no,spanId:to,traceFlags:Cr.NONE},rn=function(){function e(t){t===void 0&&(t=dc),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,n){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,n){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,n){},e}(),Vr=nc("OpenTelemetry Context Key SPAN");function Br(e){return e.getValue(Vr)||void 0}function pc(){return Br(eo.getInstance().active())}function Jr(e,t){return e.setValue(Vr,t)}function fc(e){return e.deleteValue(Vr)}function hc(e,t){return Jr(e,new rn(t))}function ro(e){var t;return(t=Br(e))===null||t===void 0?void 0:t.spanContext()}var mc=/^([0-9a-f]{32})$/i,gc=/^[0-9a-f]{16}$/i;function yc(e){return mc.test(e)&&e!==no}function vc(e){return gc.test(e)&&e!==to}function so(e){return yc(e.traceId)&&vc(e.spanId)}function _c(e){return new rn(e)}var dr=eo.getInstance(),ao=function(){function e(){}return e.prototype.startSpan=function(t,n,r){r===void 0&&(r=dr.active());var s=!!(n!=null&&n.root);if(s)return new rn;var a=r&&ro(r);return bc(a)&&so(a)?new rn(a):new rn},e.prototype.startActiveSpan=function(t,n,r,s){var a,o,i;if(!(arguments.length<2)){arguments.length===2?i=n:arguments.length===3?(a=n,i=r):(a=n,o=r,i=s);var u=o??dr.active(),l=this.startSpan(t,a,u),c=Jr(u,l);return dr.with(c,i,void 0,l)}},e}();function bc(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var wc=new ao,xc=function(){function e(t,n,r,s){this._provider=t,this.name=n,this.version=r,this.options=s}return e.prototype.startSpan=function(t,n,r){return this._getTracer().startSpan(t,n,r)},e.prototype.startActiveSpan=function(t,n,r,s){var a=this._getTracer();return Reflect.apply(a.startActiveSpan,a,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):wc},e}(),Tc=function(){function e(){}return e.prototype.getTracer=function(t,n,r){return new ao},e}(),kc=new Tc,xs=function(){function e(){}return e.prototype.getTracer=function(t,n,r){var s;return(s=this.getDelegateTracer(t,n,r))!==null&&s!==void 0?s:new xc(this,t,n,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:kc},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,n,r){var s;return(s=this._delegate)===null||s===void 0?void 0:s.getTracer(t,n,r)},e}(),Gn;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(Gn||(Gn={}));var pr="trace",Sc=function(){function e(){this._proxyTracerProvider=new xs,this.wrapSpanContext=_c,this.isSpanContextValid=so,this.deleteSpan=fc,this.getSpan=Br,this.getActiveSpan=pc,this.getSpanContext=ro,this.setSpan=Jr,this.setSpanContext=hc}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var n=Fr(pr,this._proxyTracerProvider,Hn.instance());return n&&this._proxyTracerProvider.setDelegate(t),n},e.prototype.getTracerProvider=function(){return mn(pr)||this._proxyTracerProvider},e.prototype.getTracer=function(t,n){return this.getTracerProvider().getTracer(t,n)},e.prototype.disable=function(){Zr(pr,Hn.instance()),this._proxyTracerProvider=new xs},e}(),Cc=Sc.getInstance(),Ic=Object.defineProperty,Hr=(e,t)=>{for(var n in t)Ic(e,n,{get:t[n],enumerable:!0})};function zn(e,{contentType:t,dataStreamVersion:n}){const r=new Headers(e??{});return r.has("Content-Type")||r.set("Content-Type",t),n!==void 0&&r.set("X-Vercel-AI-Data-Stream",n),r}function Ts(e,{contentType:t,dataStreamVersion:n}){const r={};if(e!=null)for(const[s,a]of Object.entries(e))r[s]=a;return r["Content-Type"]==null&&(r["Content-Type"]=t),n!==void 0&&(r["X-Vercel-AI-Data-Stream"]=n),r}function ks({response:e,status:t,statusText:n,headers:r,stream:s}){e.writeHead(t??200,n,r);const a=s.getReader();(async()=>{try{for(;;){const{done:i,value:u}=await a.read();if(i)break;e.write(u)}}catch(i){throw i}finally{e.end()}})()}var oo=class extends ${constructor(){super({name:"AI_UnsupportedModelVersionError",message:'Unsupported model version. AI SDK 4 only supports models that implement specification version "v1". Please upgrade to AI SDK 5 to use this model.'})}},io="AI_InvalidArgumentError",lo=`vercel.ai.error.${io}`,Rc=Symbol.for(lo),uo,Oe=class extends ${constructor({parameter:e,value:t,message:n}){super({name:io,message:`Invalid argument for parameter ${e}: ${n}`}),this[uo]=!0,this.parameter=e,this.value=t}static isInstance(e){return $.hasMarker(e,lo)}};uo=Rc;var co="AI_RetryError",po=`vercel.ai.error.${co}`,Ac=Symbol.for(po),fo,Ss=class extends ${constructor({message:e,reason:t,errors:n}){super({name:co,message:e}),this[fo]=!0,this.reason=t,this.errors=n,this.lastError=n[n.length-1]}static isInstance(e){return $.hasMarker(e,po)}};fo=Ac;var Nc=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2}={})=>async r=>ho(r,{maxRetries:e,delayInMs:t,backoffFactor:n});async function ho(e,{maxRetries:t,delayInMs:n,backoffFactor:r},s=[]){try{return await e()}catch(a){if(Cn(a)||t===0)throw a;const o=tl(a),i=[...s,a],u=i.length;if(u>t)throw new Ss({message:`Failed after ${u} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:i});if(a instanceof Error&&Ae.isInstance(a)&&a.isRetryable===!0&&u<=t)return await Xi(n),ho(e,{maxRetries:t,delayInMs:r*n,backoffFactor:r},i);throw u===1?a:new Ss({message:`Failed after ${u} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:i})}}function mo({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new Oe({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new Oe({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const t=e??2;return{maxRetries:t,retry:Nc({maxRetries:t})}}function Ut({operationId:e,telemetry:t}){return{"operation.name":`${e}${(t==null?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":t==null?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":t==null?void 0:t.functionId}}function go({model:e,settings:t,telemetry:n,headers:r}){var s;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((a,[o,i])=>(a[`ai.settings.${o}`]=i,a),{}),...Object.entries((s=n==null?void 0:n.metadata)!=null?s:{}).reduce((a,[o,i])=>(a[`ai.telemetry.metadata.${o}`]=i,a),{}),...Object.entries(r??{}).reduce((a,[o,i])=>(i!==void 0&&(a[`ai.request.headers.${o}`]=i),a),{})}}var Ec={startSpan(){return Sn},startActiveSpan(e,t,n,r){if(typeof t=="function")return t(Sn);if(typeof n=="function")return n(Sn);if(typeof r=="function")return r(Sn)}},Sn={spanContext(){return Oc},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Oc={traceId:"",spanId:"",traceFlags:0};function yo({isEnabled:e=!1,tracer:t}={}){return e?t||Cc.getTracer("ai"):Ec}function Ft({name:e,tracer:t,attributes:n,fn:r,endWhenDone:s=!0}){return t.startActiveSpan(e,{attributes:n},async a=>{try{const o=await r(a);return s&&a.end(),o}catch(o){try{Gr(a,o)}finally{a.end()}throw o}})}function Gr(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:Gn.ERROR,message:t.message})):e.setStatus({code:Gn.ERROR})}function Me({telemetry:e,attributes:t}){return(e==null?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((n,[r,s])=>{if(s===void 0)return n;if(typeof s=="object"&&"input"in s&&typeof s.input=="function"){if((e==null?void 0:e.recordInputs)===!1)return n;const a=s.input();return a===void 0?n:{...n,[r]:a}}if(typeof s=="object"&&"output"in s&&typeof s.output=="function"){if((e==null?void 0:e.recordOutputs)===!1)return n;const a=s.output();return a===void 0?n:{...n,[r]:a}}return{...n,[r]:s}},{})}var vo=class{constructor({data:e,mimeType:t}){const n=e instanceof Uint8Array;this.base64Data=n?void 0:e,this.uint8ArrayData=n?e:void 0,this.mimeType=t}get base64(){return this.base64Data==null&&(this.base64Data=Ge(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=_n(this.base64Data)),this.uint8ArrayData}},Pc=class extends vo{constructor(e){super(e),this.type="file"}},Mc=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],Dc=e=>{const t=typeof e=="string"?_n(e):e,n=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(n+10)};function jc(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?Dc(e):e}function $c({data:e,signatures:t}){const n=jc(e);for(const r of t)if(typeof n=="string"?n.startsWith(r.base64Prefix):n.length>=r.bytesPrefix.length&&r.bytesPrefix.every((s,a)=>n[a]===s))return r.mimeType}var _o="AI_NoObjectGeneratedError",bo=`vercel.ai.error.${_o}`,qc=Symbol.for(bo),wo,Cs=class extends ${constructor({message:e="No object generated.",cause:t,text:n,response:r,usage:s,finishReason:a}){super({name:_o,message:e,cause:t}),this[wo]=!0,this.text=n,this.response=r,this.usage=s,this.finishReason=a}static isInstance(e){return $.hasMarker(e,bo)}};wo=qc;var xo="AI_DownloadError",To=`vercel.ai.error.${xo}`,Lc=Symbol.for(To),ko,fr=class extends ${constructor({url:e,statusCode:t,statusText:n,cause:r,message:s=r==null?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${r}`}){super({name:xo,message:s,cause:r}),this[ko]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return $.hasMarker(e,To)}};ko=Lc;async function Uc({url:e}){var t;const n=e.toString();try{const r=await fetch(n);if(!r.ok)throw new fr({url:n,statusCode:r.status,statusText:r.statusText});return{data:new Uint8Array(await r.arrayBuffer()),mimeType:(t=r.headers.get("content-type"))!=null?t:void 0}}catch(r){throw fr.isInstance(r)?r:new fr({url:n,cause:r})}}var So="AI_InvalidDataContentError",Co=`vercel.ai.error.${So}`,Fc=Symbol.for(Co),Io,Is=class extends ${constructor({content:e,cause:t,message:n=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:So,message:n,cause:t}),this[Io]=!0,this.content=e}static isInstance(e){return $.hasMarker(e,Co)}};Io=Fc;var Ro=X([p(),Bn(Uint8Array),Bn(ArrayBuffer),za(e=>{var t,n;return(n=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?n:!1},{message:"Must be a Buffer"})]);function zr(e){return typeof e=="string"?e:e instanceof ArrayBuffer?Ge(new Uint8Array(e)):Ge(e)}function Wn(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return _n(e)}catch(t){throw new Is({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Is({content:e})}function Zc(e){try{return new TextDecoder().decode(e)}catch{throw new Error("Error decoding Uint8Array to text")}}var Ao="AI_InvalidMessageRoleError",No=`vercel.ai.error.${Ao}`,Vc=Symbol.for(No),Eo,Bc=class extends ${constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Ao,message:t}),this[Eo]=!0,this.role=e}static isInstance(e){return $.hasMarker(e,No)}};Eo=Vc;function Jc(e){try{const[t,n]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:n}}catch{return{mimeType:void 0,base64Content:void 0}}}async function Oo({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:n=()=>!1,downloadImplementation:r=Uc}){const s=await Gc(e.messages,r,t,n);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(a=>Hc(a,s))]}function Hc(e,t){var n,r,s,a,o,i;const u=e.role;switch(u){case"system":return{role:"system",content:e.content,providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata}:{role:"user",content:e.content.map(l=>zc(l,t)).filter(l=>l.type!=="text"||l.text!==""),providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(l=>l.type!=="text"||l.text!=="").map(l=>{var c;const f=(c=l.providerOptions)!=null?c:l.experimental_providerMetadata;switch(l.type){case"file":return{type:"file",data:l.data instanceof URL?l.data:zr(l.data),filename:l.filename,mimeType:l.mimeType,providerMetadata:f};case"reasoning":return{type:"reasoning",text:l.text,signature:l.signature,providerMetadata:f};case"redacted-reasoning":return{type:"redacted-reasoning",data:l.data,providerMetadata:f};case"text":return{type:"text",text:l.text,providerMetadata:f};case"tool-call":return{type:"tool-call",toolCallId:l.toolCallId,toolName:l.toolName,args:l.args,providerMetadata:f}}}),providerMetadata:(o=e.providerOptions)!=null?o:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(l=>{var c;return{type:"tool-result",toolCallId:l.toolCallId,toolName:l.toolName,result:l.result,content:l.experimental_content,isError:l.isError,providerMetadata:(c=l.providerOptions)!=null?c:l.experimental_providerMetadata}}),providerMetadata:(i=e.providerOptions)!=null?i:e.experimental_providerMetadata};default:{const l=u;throw new Bc({role:l})}}}async function Gc(e,t,n,r){const s=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>!(o.type==="image"&&n===!0)).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!r(o)),a=await Promise.all(s.map(async o=>({url:o,data:await t({url:o})})));return Object.fromEntries(a.map(({url:o,data:i})=>[o.toString(),i]))}function zc(e,t){var n,r,s,a;if(e.type==="text")return{type:"text",text:e.text,providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata};let o=e.mimeType,i,u,l;const c=e.type;switch(c){case"image":i=e.image;break;case"file":i=e.data;break;default:throw new Error(`Unsupported part type: ${c}`)}try{u=typeof i=="string"?new URL(i):i}catch{u=i}if(u instanceof URL)if(u.protocol==="data:"){const{mimeType:f,base64Content:d}=Jc(u.toString());if(f==null||d==null)throw new Error(`Invalid data URL format in part ${c}`);o=f,l=Wn(d)}else{const f=t[u.toString()];f?(l=f.data,o??(o=f.mimeType)):l=u}else l=Wn(u);switch(c){case"image":return l instanceof Uint8Array&&(o=(r=$c({data:l,signatures:Mc}))!=null?r:o),{type:"image",image:l,mimeType:o,providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata};case"file":{if(o==null)throw new Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?zr(l):l,filename:e.filename,mimeType:o,providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata}}}}function Po({maxTokens:e,temperature:t,topP:n,topK:r,presencePenalty:s,frequencyPenalty:a,stopSequences:o,seed:i}){if(e!=null){if(!Number.isInteger(e))throw new Oe({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new Oe({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new Oe({parameter:"temperature",value:t,message:"temperature must be a number"});if(n!=null&&typeof n!="number")throw new Oe({parameter:"topP",value:n,message:"topP must be a number"});if(r!=null&&typeof r!="number")throw new Oe({parameter:"topK",value:r,message:"topK must be a number"});if(s!=null&&typeof s!="number")throw new Oe({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(a!=null&&typeof a!="number")throw new Oe({parameter:"frequencyPenalty",value:a,message:"frequencyPenalty must be a number"});if(i!=null&&!Number.isInteger(i))throw new Oe({parameter:"seed",value:i,message:"seed must be an integer"});return{maxTokens:e,temperature:t??0,topP:n,topK:r,presencePenalty:s,frequencyPenalty:a,stopSequences:o!=null&&o.length>0?o:void 0,seed:i}}function Rs(e){var t,n,r;const s=[];for(const a of e){let o;try{o=new URL(a.url)}catch{throw new Error(`Invalid URL: ${a.url}`)}switch(o.protocol){case"http:":case"https:":{if((t=a.contentType)!=null&&t.startsWith("image/"))s.push({type:"image",image:o});else{if(!a.contentType)throw new Error("If the attachment is not an image, it must specify a content type");s.push({type:"file",data:o,mimeType:a.contentType})}break}case"data:":{let i,u,l;try{[i,u]=a.url.split(","),l=i.split(";")[0].split(":")[1]}catch{throw new Error(`Error processing data URL: ${a.url}`)}if(l==null||u==null)throw new Error(`Invalid data URL format: ${a.url}`);if((n=a.contentType)!=null&&n.startsWith("image/"))s.push({type:"image",image:Wn(u)});else if((r=a.contentType)!=null&&r.startsWith("text/"))s.push({type:"text",text:Zc(Wn(u))});else{if(!a.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");s.push({type:"file",data:u,mimeType:a.contentType})}break}default:throw new Error(`Unsupported URL protocol: ${o.protocol}`)}}return s}var Mo="AI_MessageConversionError",Do=`vercel.ai.error.${Mo}`,Wc=Symbol.for(Do),jo,hr=class extends ${constructor({originalMessage:e,message:t}){super({name:Mo,message:t}),this[jo]=!0,this.originalMessage=e}static isInstance(e){return $.hasMarker(e,Do)}};jo=Wc;function Yc(e,t){var n,r;const s=(n=t==null?void 0:t.tools)!=null?n:{},a=[];for(let o=0;o<e.length;o++){const i=e[o],u=o===e.length-1,{role:l,content:c,experimental_attachments:f}=i;switch(l){case"system":{a.push({role:"system",content:c});break}case"user":{if(i.parts==null)a.push({role:"user",content:f?[{type:"text",text:c},...Rs(f)]:c});else{const d=i.parts.filter(m=>m.type==="text").map(m=>({type:"text",text:m.text}));a.push({role:"user",content:f?[...d,...Rs(f)]:d})}break}case"assistant":{if(i.parts!=null){let _=function(){const x=[];for(const b of v)switch(b.type){case"file":case"text":{x.push(b);break}case"reasoning":{for(const T of b.details)switch(T.type){case"text":x.push({type:"reasoning",text:T.text,signature:T.signature});break;case"redacted":x.push({type:"redacted-reasoning",data:T.data});break}break}case"tool-invocation":x.push({type:"tool-call",toolCallId:b.toolInvocation.toolCallId,toolName:b.toolInvocation.toolName,args:b.toolInvocation.args});break;default:{const T=b;throw new Error(`Unsupported part: ${T}`)}}a.push({role:"assistant",content:x});const A=v.filter(b=>b.type==="tool-invocation").map(b=>b.toolInvocation);A.length>0&&a.push({role:"tool",content:A.map(b=>{if(!("result"in b))throw new hr({originalMessage:i,message:"ToolInvocation must have a result: "+JSON.stringify(b)});const{toolCallId:T,toolName:k,result:M}=b,R=s[k];return(R==null?void 0:R.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:T,toolName:k,result:R.experimental_toToolResultContent(M),experimental_content:R.experimental_toToolResultContent(M)}:{type:"tool-result",toolCallId:T,toolName:k,result:M}})}),v=[],y=!1,g++},g=0,y=!1,v=[];for(const x of i.parts)switch(x.type){case"text":{y&&_(),v.push(x);break}case"file":case"reasoning":{v.push(x);break}case"tool-invocation":{((r=x.toolInvocation.step)!=null?r:0)!==g&&_(),v.push(x),y=!0;break}}_();break}const d=i.toolInvocations;if(d==null||d.length===0){a.push({role:"assistant",content:c});break}const m=d.reduce((_,g)=>{var y;return Math.max(_,(y=g.step)!=null?y:0)},0);for(let _=0;_<=m;_++){const g=d.filter(y=>{var v;return((v=y.step)!=null?v:0)===_});g.length!==0&&(a.push({role:"assistant",content:[...u&&c&&_===0?[{type:"text",text:c}]:[],...g.map(({toolCallId:y,toolName:v,args:x})=>({type:"tool-call",toolCallId:y,toolName:v,args:x}))]}),a.push({role:"tool",content:g.map(y=>{if(!("result"in y))throw new hr({originalMessage:i,message:"ToolInvocation must have a result: "+JSON.stringify(y)});const{toolCallId:v,toolName:x,result:A}=y,b=s[x];return(b==null?void 0:b.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:v,toolName:x,result:b.experimental_toToolResultContent(A),experimental_content:b.experimental_toToolResultContent(A)}:{type:"tool-result",toolCallId:v,toolName:x,result:A}})}))}c&&!u&&a.push({role:"assistant",content:c});break}case"data":break;default:{const d=l;throw new hr({originalMessage:i,message:`Unsupported role: ${d}`})}}}return a}var Ir=Zl(()=>X([Fl(),p(),w(),_e(),Lt(p(),Ir),O(Ir)])),ae=Lt(p(),Lt(p(),Ir)),Kc=O(X([h({type:N("text"),text:p()}),h({type:N("image"),data:p(),mimeType:p().optional()})])),$o=h({type:N("text"),text:p(),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),Xc=h({type:N("image"),image:X([Ro,Bn(URL)]),mimeType:p().optional(),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),qo=h({type:N("file"),data:X([Ro,Bn(URL)]),filename:p().optional(),mimeType:p(),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),Qc=h({type:N("reasoning"),text:p(),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),ed=h({type:N("redacted-reasoning"),data:p(),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),td=h({type:N("tool-call"),toolCallId:p(),toolName:p(),args:Gt(),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),nd=h({type:N("tool-result"),toolCallId:p(),toolName:p(),result:Gt(),content:Kc.optional(),isError:_e().optional(),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),rd=h({role:N("system"),content:p(),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),sd=h({role:N("user"),content:X([p(),O(X([$o,Xc,qo]))]),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),ad=h({role:N("assistant"),content:X([p(),O(X([$o,qo,Qc,ed,td]))]),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),od=h({role:N("tool"),content:O(nd),providerOptions:ae.optional(),experimental_providerMetadata:ae.optional()}),id=X([rd,sd,ad,od]);function Lo({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new tt({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new tt({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new tt({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new tt({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){const r=ld(e.messages)==="ui-messages"?Yc(e.messages,{tools:t}):e.messages;if(r.length===0)throw new tt({prompt:e,message:"messages must not be empty"});const s=Bt({value:r,schema:O(id)});if(!s.success)throw new tt({prompt:e,message:["message must be a CoreMessage or a UI message",`Validation error: ${s.error.message}`].join(`
`),cause:s.error});return{type:"messages",messages:r,system:e.system}}throw new Error("unreachable")}function ld(e){if(!Array.isArray(e))throw new tt({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received non-array value: ${JSON.stringify(e)}`].join(`
`),cause:e});if(e.length===0)return"messages";const t=e.map(ud);if(t.some(r=>r==="has-ui-specific-parts"))return"ui-messages";const n=t.findIndex(r=>r!=="has-core-specific-parts"&&r!=="message");if(n===-1)return"messages";throw new tt({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received message of type: "${t[n]}" at index ${n}`,`messages[${n}]: ${JSON.stringify(e[n])}`].join(`
`),cause:e})}function ud(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function Uo({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function Fo(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}var cd="JSON schema:",dd="You MUST answer with a JSON object that matches the JSON schema above.",pd="You MUST answer with JSON.";function fd({prompt:e,schema:t,schemaPrefix:n=t!=null?cd:void 0,schemaSuffix:r=t!=null?dd:pd}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,n,t!=null?JSON.stringify(t):void 0,r].filter(s=>s!=null).join(`
`)}function mr(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{const n=t.getReader();return{async next(){const{done:r,value:s}=await n.read();return r?{done:!0,value:void 0}:{done:!1,value:s}}}},t}function Zo(e){const t=e.map(n=>({...n,content:typeof n.content=="string"?n.content:n.content.map(hd)}));return JSON.stringify(t)}function hd(e){return e.type==="image"?{...e,image:e.image instanceof Uint8Array?zr(e.image):e.image}:e}St({prefix:"aiobj",size:24});var ke=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t}),this.promise)}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&((t=this._reject)==null||t.call(this,e))}};function As(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),resolve:e,reject:t}}function md(){let e=[],t=null,n=!1,r=As();const s=async()=>{if(n&&e.length===0){t==null||t.close();return}if(e.length===0)return r=As(),await r.promise,s();try{const{value:a,done:o}=await e[0].read();o?(e.shift(),e.length>0?await s():n&&(t==null||t.close())):t==null||t.enqueue(a)}catch(a){t==null||t.error(a),e.shift(),n&&e.length===0&&(t==null||t.close())}};return{stream:new ReadableStream({start(a){t=a},pull:s,async cancel(){for(const a of e)await a.cancel();e=[],n=!0}}),addStream:a=>{if(n)throw new Error("Cannot add inner stream: outer stream is closed");e.push(a.getReader()),r.resolve()},close:()=>{n=!0,r.resolve(),e.length===0&&(t==null||t.close())},terminate:()=>{n=!0,r.resolve(),e.forEach(a=>a.cancel()),e=[],t==null||t.close()}}}function gd(){var e,t;return(t=(e=globalThis==null?void 0:globalThis.performance)==null?void 0:e.now())!=null?t:Date.now()}St({prefix:"aiobj",size:24});var Vo="AI_NoOutputSpecifiedError",Bo=`vercel.ai.error.${Vo}`,yd=Symbol.for(Bo),Jo,Ho=class extends ${constructor({message:e="No output specified."}={}){super({name:Vo,message:e}),this[Jo]=!0}static isInstance(e){return $.hasMarker(e,Bo)}};Jo=yd;var Go="AI_ToolExecutionError",zo=`vercel.ai.error.${Go}`,vd=Symbol.for(zo),Wo,Yo=class extends ${constructor({toolArgs:e,toolName:t,toolCallId:n,cause:r,message:s=`Error executing tool ${t}: ${yn(r)}`}){super({name:Go,message:s,cause:r}),this[Wo]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=n}static isInstance(e){return $.hasMarker(e,zo)}};Wo=vd;function _d(e){return e!=null&&Object.keys(e).length>0}function Ko({tools:e,toolChoice:t,activeTools:n}){return _d(e)?{tools:(n!=null?Object.entries(e).filter(([s])=>n.includes(s)):Object.entries(e)).map(([s,a])=>{const o=a.type;switch(o){case void 0:case"function":return{type:"function",name:s,description:a.description,parameters:tr(a.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:s,id:a.id,args:a.args};default:{const i=o;throw new Error(`Unsupported tool type: ${i}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var bd=/^([\s\S]*?)(\s+)(\S*)$/;function Xo(e){const t=e.match(bd);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}function wd(e){const t=Xo(e);return t?t.prefix+t.whitespace:e}var Qo="AI_InvalidToolArgumentsError",ei=`vercel.ai.error.${Qo}`,xd=Symbol.for(ei),ti,ni=class extends ${constructor({toolArgs:e,toolName:t,cause:n,message:r=`Invalid arguments for tool ${t}: ${yn(n)}`}){super({name:Qo,message:r,cause:n}),this[ti]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return $.hasMarker(e,ei)}};ti=xd;var ri="AI_NoSuchToolError",si=`vercel.ai.error.${ri}`,Td=Symbol.for(si),ai,Rr=class extends ${constructor({toolName:e,availableTools:t=void 0,message:n=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:ri,message:n}),this[ai]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return $.hasMarker(e,si)}};ai=Td;var oi="AI_ToolCallRepairError",ii=`vercel.ai.error.${oi}`,kd=Symbol.for(ii),li,Sd=class extends ${constructor({cause:e,originalError:t,message:n=`Error repairing tool call: ${yn(e)}`}){super({name:oi,message:n,cause:e}),this[li]=!0,this.originalError=t}static isInstance(e){return $.hasMarker(e,ii)}};li=kd;async function ui({toolCall:e,tools:t,repairToolCall:n,system:r,messages:s}){if(t==null)throw new Rr({toolName:e.toolName});try{return await Ns({toolCall:e,tools:t})}catch(a){if(n==null||!(Rr.isInstance(a)||ni.isInstance(a)))throw a;let o=null;try{o=await n({toolCall:e,tools:t,parameterSchema:({toolName:i})=>tr(t[i].parameters).jsonSchema,system:r,messages:s,error:a})}catch(i){throw new Sd({cause:i,originalError:a})}if(o==null)throw a;return await Ns({toolCall:o,tools:t})}}async function Ns({toolCall:e,tools:t}){const n=e.toolName,r=t[n];if(r==null)throw new Rr({toolName:e.toolName,availableTools:Object.keys(t)});const s=tr(r.parameters),a=e.args.trim()===""?Bt({value:{},schema:s}):bt({text:e.args,schema:s});if(a.success===!1)throw new ni({toolName:n,toolArgs:e.args,cause:a.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:n,args:a.value}}function Ar(e){const t=e.filter(n=>n.type==="text").map(n=>n.text).join("");return t.length>0?t:void 0}function Nr({text:e="",files:t,reasoning:n,tools:r,toolCalls:s,toolResults:a,messageId:o,generateMessageId:i}){const u=[],l=[];return n.length>0&&l.push(...n.map(c=>c.type==="text"?{...c,type:"reasoning"}:{...c,type:"redacted-reasoning"})),t.length>0&&l.push(...t.map(c=>({type:"file",data:c.base64,mimeType:c.mimeType}))),e.length>0&&l.push({type:"text",text:e}),s.length>0&&l.push(...s),l.length>0&&u.push({role:"assistant",content:l,id:o}),a.length>0&&u.push({role:"tool",id:i(),content:a.map(c=>{const f=r[c.toolName];return(f==null?void 0:f.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:c.toolCallId,toolName:c.toolName,result:f.experimental_toToolResultContent(c.result),experimental_content:f.experimental_toToolResultContent(c.result)}:{type:"tool-result",toolCallId:c.toolCallId,toolName:c.toolName,result:c.result}})}),u}var Cd=St({prefix:"aitxt",size:24}),Id=St({prefix:"msg",size:24});async function Rd({model:e,tools:t,toolChoice:n,system:r,prompt:s,messages:a,maxRetries:o,abortSignal:i,headers:u,maxSteps:l=1,experimental_generateMessageId:c=Id,experimental_output:f,experimental_continueSteps:d=!1,experimental_telemetry:m,experimental_providerMetadata:_,providerOptions:g=_,experimental_activeTools:y,experimental_prepareStep:v,experimental_repairToolCall:x,_internal:{generateId:A=Cd,currentDate:b=()=>new Date}={},onStepFinish:T,...k}){var M;if(typeof e=="string"||e.specificationVersion!=="v1")throw new oo;if(l<1)throw new Oe({parameter:"maxSteps",value:l,message:"maxSteps must be at least 1"});const{maxRetries:R,retry:D}=mo({maxRetries:o}),Y=go({model:e,telemetry:m,headers:u,settings:{...k,maxRetries:R}}),oe=Lo({prompt:{system:(M=f==null?void 0:f.injectIntoSystemPrompt({system:r,model:e}))!=null?M:r,prompt:s,messages:a},tools:t}),ue=yo(m);return Ft({name:"ai.generateText",attributes:Me({telemetry:m,attributes:{...Ut({operationId:"ai.generateText",telemetry:m}),...Y,"ai.model.provider":e.provider,"ai.model.id":e.modelId,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:s,messages:a})},"ai.settings.maxSteps":l}}),tracer:ue,fn:async Q=>{var Z,ne,ee,de,B,te,K,J,ot,Rt,At,zt,Ze,Nt;const rr=Po(k);let L,Ne=[],dt=[],pt=[],ft=0;const Ye=[];let je="";const ie=[],xe=[];let ye={completionTokens:0,promptTokens:0,totalTokens:0},I="initial";do{const he=ft===0?oe.type:"messages",Ee=[...oe.messages,...Ye],pe=await(v==null?void 0:v({model:e,steps:xe,maxSteps:l,stepNumber:ft})),Et=(Z=pe==null?void 0:pe.toolChoice)!=null?Z:n,sr=(ne=pe==null?void 0:pe.experimental_activeTools)!=null?ne:y,Te=(ee=pe==null?void 0:pe.model)!=null?ee:e,Wt=await Oo({prompt:{type:he,system:oe.system,messages:Ee},modelSupportsImageUrls:Te.supportsImageUrls,modelSupportsUrl:(de=Te.supportsUrl)==null?void 0:de.bind(Te)}),it={type:"regular",...Ko({tools:t,toolChoice:Et,activeTools:sr})};L=await D(()=>Ft({name:"ai.generateText.doGenerate",attributes:Me({telemetry:m,attributes:{...Ut({operationId:"ai.generateText.doGenerate",telemetry:m}),...Y,"ai.model.provider":Te.provider,"ai.model.id":Te.modelId,"ai.prompt.format":{input:()=>he},"ai.prompt.messages":{input:()=>Zo(Wt)},"ai.prompt.tools":{input:()=>{var Ie;return(Ie=it.tools)==null?void 0:Ie.map($e=>JSON.stringify($e))}},"ai.prompt.toolChoice":{input:()=>it.toolChoice!=null?JSON.stringify(it.toolChoice):void 0},"gen_ai.system":Te.provider,"gen_ai.request.model":Te.modelId,"gen_ai.request.frequency_penalty":k.frequencyPenalty,"gen_ai.request.max_tokens":k.maxTokens,"gen_ai.request.presence_penalty":k.presencePenalty,"gen_ai.request.stop_sequences":k.stopSequences,"gen_ai.request.temperature":k.temperature,"gen_ai.request.top_k":k.topK,"gen_ai.request.top_p":k.topP}}),tracer:ue,fn:async Ie=>{var $e,Kt,wn,Xt,Ve,Ot;const me=await Te.doGenerate({mode:it,...rr,inputFormat:he,responseFormat:f==null?void 0:f.responseFormat({model:e}),prompt:Wt,providerMetadata:g,abortSignal:i,headers:u}),Qe={id:(Kt=($e=me.response)==null?void 0:$e.id)!=null?Kt:A(),timestamp:(Xt=(wn=me.response)==null?void 0:wn.timestamp)!=null?Xt:b(),modelId:(Ot=(Ve=me.response)==null?void 0:Ve.modelId)!=null?Ot:Te.modelId};return Ie.setAttributes(Me({telemetry:m,attributes:{"ai.response.finishReason":me.finishReason,"ai.response.text":{output:()=>me.text},"ai.response.toolCalls":{output:()=>JSON.stringify(me.toolCalls)},"ai.response.id":Qe.id,"ai.response.model":Qe.modelId,"ai.response.timestamp":Qe.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(me.providerMetadata),"ai.usage.promptTokens":me.usage.promptTokens,"ai.usage.completionTokens":me.usage.completionTokens,"gen_ai.response.finish_reasons":[me.finishReason],"gen_ai.response.id":Qe.id,"gen_ai.response.model":Qe.modelId,"gen_ai.usage.input_tokens":me.usage.promptTokens,"gen_ai.usage.output_tokens":me.usage.completionTokens}})),{...me,response:Qe}}})),Ne=await Promise.all(((B=L.toolCalls)!=null?B:[]).map(Ie=>ui({toolCall:Ie,tools:t,repairToolCall:x,system:r,messages:Ee}))),dt=t==null?[]:await Ad({toolCalls:Ne,tools:t,tracer:ue,telemetry:m,messages:Ee,abortSignal:i});const Yt=Uo(L.usage);ye=Fo(ye,Yt);let Ke="done";++ft<l&&(d&&L.finishReason==="length"&&Ne.length===0?Ke="continue":Ne.length>0&&dt.length===Ne.length&&(Ke="tool-result"));const ht=(te=L.text)!=null?te:"",bn=I==="continue"&&je.trimEnd()!==je?ht.trimStart():ht,Xe=Ke==="continue"?wd(bn):bn;if(je=Ke==="continue"||I==="continue"?je+Xe:Xe,pt=Es(L.reasoning),ie.push(...(K=L.sources)!=null?K:[]),I==="continue"){const Ie=Ye[Ye.length-1];typeof Ie.content=="string"?Ie.content+=Xe:Ie.content.push({text:Xe,type:"text"})}else Ye.push(...Nr({text:je,files:gr(L.files),reasoning:Es(L.reasoning),tools:t??{},toolCalls:Ne,toolResults:dt,messageId:c(),generateMessageId:c}));const mt={stepType:I,text:Xe,reasoning:Ar(pt),reasoningDetails:pt,files:gr(L.files),sources:(J=L.sources)!=null?J:[],toolCalls:Ne,toolResults:dt,finishReason:L.finishReason,usage:Yt,warnings:L.warnings,logprobs:L.logprobs,request:(ot=L.request)!=null?ot:{},response:{...L.response,headers:(Rt=L.rawResponse)==null?void 0:Rt.headers,body:(At=L.rawResponse)==null?void 0:At.body,messages:structuredClone(Ye)},providerMetadata:L.providerMetadata,experimental_providerMetadata:L.providerMetadata,isContinued:Ke==="continue"};xe.push(mt),await(T==null?void 0:T(mt)),I=Ke}while(I!=="done");return Q.setAttributes(Me({telemetry:m,attributes:{"ai.response.finishReason":L.finishReason,"ai.response.text":{output:()=>L.text},"ai.response.toolCalls":{output:()=>JSON.stringify(L.toolCalls)},"ai.usage.promptTokens":L.usage.promptTokens,"ai.usage.completionTokens":L.usage.completionTokens,"ai.response.providerMetadata":JSON.stringify(L.providerMetadata)}})),new Nd({text:je,files:gr(L.files),reasoning:Ar(pt),reasoningDetails:pt,sources:ie,outputResolver:()=>{if(f==null)throw new Ho;return f.parseOutput({text:je},{response:L.response,usage:ye,finishReason:L.finishReason})},toolCalls:Ne,toolResults:dt,finishReason:L.finishReason,usage:ye,warnings:L.warnings,request:(zt=L.request)!=null?zt:{},response:{...L.response,headers:(Ze=L.rawResponse)==null?void 0:Ze.headers,body:(Nt=L.rawResponse)==null?void 0:Nt.body,messages:Ye},logprobs:L.logprobs,steps:xe,providerMetadata:L.providerMetadata})}})}async function Ad({toolCalls:e,tools:t,tracer:n,telemetry:r,messages:s,abortSignal:a}){return(await Promise.all(e.map(async({toolCallId:i,toolName:u,args:l})=>{const c=t[u];if((c==null?void 0:c.execute)==null)return;const f=await Ft({name:"ai.toolCall",attributes:Me({telemetry:r,attributes:{...Ut({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":u,"ai.toolCall.id":i,"ai.toolCall.args":{output:()=>JSON.stringify(l)}}}),tracer:n,fn:async d=>{try{const m=await c.execute(l,{toolCallId:i,messages:s,abortSignal:a});try{d.setAttributes(Me({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(m)}}}))}catch{}return m}catch(m){throw Gr(d,m),new Yo({toolCallId:i,toolName:u,toolArgs:l,cause:m})}}});return{type:"tool-result",toolCallId:i,toolName:u,args:l,result:f}}))).filter(i=>i!=null)}var Nd=class{constructor(e){this.text=e.text,this.files=e.files,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};function Es(e){return e==null?[]:typeof e=="string"?[{type:"text",text:e}]:e}function gr(e){var t;return(t=e==null?void 0:e.map(n=>new vo(n)))!=null?t:[]}var Ed={};Hr(Ed,{object:()=>Dd,text:()=>Md});var ci="AI_InvalidStreamPartError",di=`vercel.ai.error.${ci}`,Od=Symbol.for(di),pi,Pd=class extends ${constructor({chunk:e,message:t}){super({name:ci,message:t}),this[pi]=!0,this.chunk=e}static isInstance(e){return $.hasMarker(e,di)}};pi=Od;var Md=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:e}){return e},parsePartial({text:e}){return{partial:e}},parseOutput({text:e}){return e}}),Dd=({schema:e})=>{const t=tr(e);return{type:"object",responseFormat:({model:n})=>({type:"json",schema:n.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt({system:n,model:r}){return r.supportsStructuredOutputs?n:fd({prompt:n,schema:t.jsonSchema})},parsePartial({text:n}){const r=Cu(n);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{const s=r.state;throw new Error(`Unsupported parse state: ${s}`)}}},parseOutput({text:n},r){const s=bt({text:n});if(!s.success)throw new Cs({message:"No object generated: could not parse the response.",cause:s.error,text:n,response:r.response,usage:r.usage,finishReason:r.finishReason});const a=Bt({value:s.value,schema:t});if(!a.success)throw new Cs({message:"No object generated: response did not match schema.",cause:a.error,text:n,response:r.response,usage:r.usage,finishReason:r.finishReason});return a.value}}};function jd(e){return e===void 0?[]:Array.isArray(e)?e:[e]}async function $d({stream:e,onError:t}){const n=e.getReader();try{for(;;){const{done:r}=await n.read();if(r)break}}catch(r){t==null||t(r)}finally{n.releaseLock()}}function Wr(e,t){const n=e.getReader(),r=t.getReader();let s,a,o=!1,i=!1;async function u(c){try{s==null&&(s=n.read());const f=await s;s=void 0,f.done?c.close():c.enqueue(f.value)}catch(f){c.error(f)}}async function l(c){try{a==null&&(a=r.read());const f=await a;a=void 0,f.done?c.close():c.enqueue(f.value)}catch(f){c.error(f)}}return new ReadableStream({async pull(c){try{if(o){await l(c);return}if(i){await u(c);return}s==null&&(s=n.read()),a==null&&(a=r.read());const{result:f,reader:d}=await Promise.race([s.then(m=>({result:m,reader:n})),a.then(m=>({result:m,reader:r}))]);f.done||c.enqueue(f.value),d===n?(s=void 0,f.done&&(await l(c),o=!0)):(a=void 0,f.done&&(i=!0,await u(c)))}catch(f){c.error(f)}},cancel(){n.cancel(),r.cancel()}})}function qd({tools:e,generatorStream:t,toolCallStreaming:n,tracer:r,telemetry:s,system:a,messages:o,abortSignal:i,repairToolCall:u}){let l=null;const c=new ReadableStream({start(v){l=v}}),f={},d=new Set;let m=!1,_;function g(){m&&d.size===0&&(_!=null&&l.enqueue(_),l.close())}const y=new TransformStream({async transform(v,x){const A=v.type;switch(A){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":{x.enqueue(v);break}case"file":{x.enqueue(new Pc({data:v.data,mimeType:v.mimeType}));break}case"tool-call-delta":{n&&(f[v.toolCallId]||(x.enqueue({type:"tool-call-streaming-start",toolCallId:v.toolCallId,toolName:v.toolName}),f[v.toolCallId]=!0),x.enqueue({type:"tool-call-delta",toolCallId:v.toolCallId,toolName:v.toolName,argsTextDelta:v.argsTextDelta}));break}case"tool-call":{try{const b=await ui({toolCall:v,tools:e,repairToolCall:u,system:a,messages:o});x.enqueue(b);const T=e[b.toolName];if(T.execute!=null){const k=Se();d.add(k),Ft({name:"ai.toolCall",attributes:Me({telemetry:s,attributes:{...Ut({operationId:"ai.toolCall",telemetry:s}),"ai.toolCall.name":b.toolName,"ai.toolCall.id":b.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(b.args)}}}),tracer:r,fn:async M=>T.execute(b.args,{toolCallId:b.toolCallId,messages:o,abortSignal:i}).then(R=>{l.enqueue({...b,type:"tool-result",result:R}),d.delete(k),g();try{M.setAttributes(Me({telemetry:s,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(R)}}}))}catch{}},R=>{Gr(M,R),l.enqueue({type:"error",error:new Yo({toolCallId:b.toolCallId,toolName:b.toolName,toolArgs:b.args,cause:R})}),d.delete(k),g()})})}}catch(b){l.enqueue({type:"error",error:b})}break}case"finish":{_={type:"finish",finishReason:v.finishReason,logprobs:v.logprobs,usage:Uo(v.usage),experimental_providerMetadata:v.providerMetadata};break}default:{const b=A;throw new Error(`Unhandled chunk type: ${b}`)}}},flush(){m=!0,g()}});return new ReadableStream({async start(v){return Promise.all([t.pipeThrough(y).pipeTo(new WritableStream({write(x){v.enqueue(x)},close(){}})),c.pipeTo(new WritableStream({write(x){v.enqueue(x)},close(){v.close()}}))])}})}var Ld=St({prefix:"aitxt",size:24}),Ud=St({prefix:"msg",size:24});function Fd({model:e,tools:t,toolChoice:n,system:r,prompt:s,messages:a,maxRetries:o,abortSignal:i,headers:u,maxSteps:l=1,experimental_generateMessageId:c=Ud,experimental_output:f,experimental_continueSteps:d=!1,experimental_telemetry:m,experimental_providerMetadata:_,providerOptions:g=_,experimental_toolCallStreaming:y=!1,toolCallStreaming:v=y,experimental_activeTools:x,experimental_repairToolCall:A,experimental_transform:b,onChunk:T,onError:k,onFinish:M,onStepFinish:R,_internal:{now:D=gd,generateId:Y=Ld,currentDate:oe=()=>new Date}={},...ue}){if(typeof e=="string"||e.specificationVersion!=="v1")throw new oo;return new Vd({model:e,telemetry:m,headers:u,settings:ue,maxRetries:o,abortSignal:i,system:r,prompt:s,messages:a,tools:t,toolChoice:n,toolCallStreaming:v,transforms:jd(b),activeTools:x,repairToolCall:A,maxSteps:l,output:f,continueSteps:d,providerOptions:g,onChunk:T,onError:k,onFinish:M,onStepFinish:R,now:D,currentDate:oe,generateId:Y,generateMessageId:c})}function Zd(e){if(!e)return new TransformStream({transform(a,o){o.enqueue({part:a,partialOutput:void 0})}});let t="",n="",r="";function s({controller:a,partialOutput:o=void 0}){a.enqueue({part:{type:"text-delta",textDelta:n},partialOutput:o}),n=""}return new TransformStream({transform(a,o){if(a.type==="step-finish"&&s({controller:o}),a.type!=="text-delta"){o.enqueue({part:a,partialOutput:void 0});return}t+=a.textDelta,n+=a.textDelta;const i=e.parsePartial({text:t});if(i!=null){const u=JSON.stringify(i.partial);u!==r&&(s({controller:o,partialOutput:i.partial}),r=u)}},flush(a){n.length>0&&s({controller:a})}})}var Vd=class{constructor({model:e,telemetry:t,headers:n,settings:r,maxRetries:s,abortSignal:a,system:o,prompt:i,messages:u,tools:l,toolChoice:c,toolCallStreaming:f,transforms:d,activeTools:m,repairToolCall:_,maxSteps:g,output:y,continueSteps:v,providerOptions:x,now:A,currentDate:b,generateId:T,generateMessageId:k,onChunk:M,onError:R,onFinish:D,onStepFinish:Y}){this.warningsPromise=new ke,this.usagePromise=new ke,this.finishReasonPromise=new ke,this.providerMetadataPromise=new ke,this.textPromise=new ke,this.reasoningPromise=new ke,this.reasoningDetailsPromise=new ke,this.sourcesPromise=new ke,this.filesPromise=new ke,this.toolCallsPromise=new ke,this.toolResultsPromise=new ke,this.requestPromise=new ke,this.responsePromise=new ke,this.stepsPromise=new ke;var oe;if(g<1)throw new Oe({parameter:"maxSteps",value:g,message:"maxSteps must be at least 1"});this.output=y;let ue="",Q="",Z="",ne=[],ee=[],de,B=[];const te=[],K={id:T(),timestamp:b(),modelId:e.modelId,messages:[]};let J=[],ot=[],Rt,At,zt="initial";const Ze=[];let Nt;const rr=new TransformStream({async transform(xe,ye){ye.enqueue(xe);const{part:I}=xe;if((I.type==="text-delta"||I.type==="reasoning"||I.type==="source"||I.type==="tool-call"||I.type==="tool-result"||I.type==="tool-call-streaming-start"||I.type==="tool-call-delta")&&await(M==null?void 0:M({chunk:I})),I.type==="error"&&await(R==null?void 0:R({error:I.error})),I.type==="text-delta"&&(ue+=I.textDelta,Q+=I.textDelta,Z+=I.textDelta),I.type==="reasoning"&&(de==null?(de={type:"text",text:I.textDelta},ne.push(de)):de.text+=I.textDelta),I.type==="reasoning-signature"){if(de==null)throw new $({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});de.signature=I.signature,de=void 0}if(I.type==="redacted-reasoning"&&ne.push({type:"redacted",data:I.data}),I.type==="file"&&ee.push(I),I.type==="source"&&(te.push(I.source),B.push(I.source)),I.type==="tool-call"&&J.push(I),I.type==="tool-result"&&ot.push(I),I.type==="step-finish"){const he=Nr({text:Q,files:ee,reasoning:ne,tools:l??{},toolCalls:J,toolResults:ot,messageId:I.messageId,generateMessageId:k}),Ee=Ze.length;let pe="done";Ee+1<g&&(v&&I.finishReason==="length"&&J.length===0?pe="continue":J.length>0&&ot.length===J.length&&(pe="tool-result"));const Et={stepType:zt,text:ue,reasoning:Ar(ne),reasoningDetails:ne,files:ee,sources:B,toolCalls:J,toolResults:ot,finishReason:I.finishReason,usage:I.usage,warnings:I.warnings,logprobs:I.logprobs,request:I.request,response:{...I.response,messages:[...K.messages,...he]},providerMetadata:I.experimental_providerMetadata,experimental_providerMetadata:I.experimental_providerMetadata,isContinued:I.isContinued};await(Y==null?void 0:Y(Et)),Ze.push(Et),J=[],ot=[],ue="",B=[],ne=[],ee=[],de=void 0,pe!=="done"&&(zt=pe),pe!=="continue"&&(K.messages.push(...he),Q="")}I.type==="finish"&&(K.id=I.response.id,K.timestamp=I.response.timestamp,K.modelId=I.response.modelId,K.headers=I.response.headers,At=I.usage,Rt=I.finishReason)},async flush(xe){var ye;try{if(Ze.length===0)return;const I=Ze[Ze.length-1];ie.warningsPromise.resolve(I.warnings),ie.requestPromise.resolve(I.request),ie.responsePromise.resolve(I.response),ie.toolCallsPromise.resolve(I.toolCalls),ie.toolResultsPromise.resolve(I.toolResults),ie.providerMetadataPromise.resolve(I.experimental_providerMetadata),ie.reasoningPromise.resolve(I.reasoning),ie.reasoningDetailsPromise.resolve(I.reasoningDetails);const he=Rt??"unknown",Ee=At??{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};ie.finishReasonPromise.resolve(he),ie.usagePromise.resolve(Ee),ie.textPromise.resolve(Z),ie.sourcesPromise.resolve(te),ie.filesPromise.resolve(I.files),ie.stepsPromise.resolve(Ze),await(D==null?void 0:D({finishReason:he,logprobs:void 0,usage:Ee,text:Z,reasoning:I.reasoning,reasoningDetails:I.reasoningDetails,files:I.files,sources:I.sources,toolCalls:I.toolCalls,toolResults:I.toolResults,request:(ye=I.request)!=null?ye:{},response:I.response,warnings:I.warnings,providerMetadata:I.providerMetadata,experimental_providerMetadata:I.experimental_providerMetadata,steps:Ze})),Nt.setAttributes(Me({telemetry:t,attributes:{"ai.response.finishReason":he,"ai.response.text":{output:()=>Z},"ai.response.toolCalls":{output:()=>{var pe;return(pe=I.toolCalls)!=null&&pe.length?JSON.stringify(I.toolCalls):void 0}},"ai.usage.promptTokens":Ee.promptTokens,"ai.usage.completionTokens":Ee.completionTokens,"ai.response.providerMetadata":JSON.stringify(I.providerMetadata)}}))}catch(I){xe.error(I)}finally{Nt.end()}}}),L=md();this.addStream=L.addStream,this.closeStream=L.close;let Ne=L.stream;for(const xe of d)Ne=Ne.pipeThrough(xe({tools:l,stopStream(){L.terminate()}}));this.baseStream=Ne.pipeThrough(Zd(y)).pipeThrough(rr);const{maxRetries:dt,retry:pt}=mo({maxRetries:s}),ft=yo(t),Ye=go({model:e,telemetry:t,headers:n,settings:{...r,maxRetries:dt}}),je=Lo({prompt:{system:(oe=y==null?void 0:y.injectIntoSystemPrompt({system:o,model:e}))!=null?oe:o,prompt:i,messages:u},tools:l}),ie=this;Ft({name:"ai.streamText",attributes:Me({telemetry:t,attributes:{...Ut({operationId:"ai.streamText",telemetry:t}),...Ye,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:i,messages:u})},"ai.settings.maxSteps":g}}),tracer:ft,endWhenDone:!1,fn:async xe=>{Nt=xe;async function ye({currentStep:I,responseMessages:he,usage:Ee,stepType:pe,previousStepText:Et,hasLeadingWhitespace:sr,messageId:Te}){var Wt;const it=he.length===0?je.type:"messages",Yt=[...je.messages,...he],Ke=await Oo({prompt:{type:it,system:je.system,messages:Yt},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(Wt=e.supportsUrl)==null?void 0:Wt.bind(e)}),ht={type:"regular",...Ko({tools:l,toolChoice:c,activeTools:m})},{result:{stream:bn,warnings:Xe,rawResponse:mt,request:Ie},doStreamSpan:$e,startTimestampMs:Kt}=await pt(()=>Ft({name:"ai.streamText.doStream",attributes:Me({telemetry:t,attributes:{...Ut({operationId:"ai.streamText.doStream",telemetry:t}),...Ye,"ai.prompt.format":{input:()=>it},"ai.prompt.messages":{input:()=>Zo(Ke)},"ai.prompt.tools":{input:()=>{var F;return(F=ht.tools)==null?void 0:F.map(le=>JSON.stringify(le))}},"ai.prompt.toolChoice":{input:()=>ht.toolChoice!=null?JSON.stringify(ht.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":r.frequencyPenalty,"gen_ai.request.max_tokens":r.maxTokens,"gen_ai.request.presence_penalty":r.presencePenalty,"gen_ai.request.stop_sequences":r.stopSequences,"gen_ai.request.temperature":r.temperature,"gen_ai.request.top_k":r.topK,"gen_ai.request.top_p":r.topP}}),tracer:ft,endWhenDone:!1,fn:async F=>({startTimestampMs:A(),doStreamSpan:F,result:await e.doStream({mode:ht,...Po(r),inputFormat:it,responseFormat:y==null?void 0:y.responseFormat({model:e}),prompt:Ke,providerMetadata:x,abortSignal:a,headers:n})})})),wn=qd({tools:l,generatorStream:bn,toolCallStreaming:f,tracer:ft,telemetry:t,system:o,messages:Yt,repairToolCall:_,abortSignal:a}),Xt=Ie??{},Ve=[],Ot=[],me=[],Qe=[];let gt,yt="unknown",lt={promptTokens:0,completionTokens:0,totalTokens:0},Pt,es=!0,Qt="",ts=pe==="continue"?Et:"",ar,qe={id:T(),timestamp:b(),modelId:e.modelId},Mt="",ns=!1,rs=!0,ss=!1;async function or({controller:F,chunk:le}){F.enqueue(le),Qt+=le.textDelta,ts+=le.textDelta,ns=!0,ss=le.textDelta.trimEnd()!==le.textDelta}ie.addStream(wn.pipeThrough(new TransformStream({async transform(F,le){var Be,en,vt;if(es){const Je=A()-Kt;es=!1,$e.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":Je}),$e.setAttributes({"ai.response.msToFirstChunk":Je}),le.enqueue({type:"step-start",messageId:Te,request:Xt,warnings:Xe??[]})}if(F.type==="text-delta"&&F.textDelta.length===0)return;const as=F.type;switch(as){case"text-delta":{if(v){const Je=rs&&sr?F.textDelta.trimStart():F.textDelta;if(Je.length===0)break;rs=!1,Mt+=Je;const xn=Xo(Mt);xn!=null&&(Mt=xn.suffix,await or({controller:le,chunk:{type:"text-delta",textDelta:xn.prefix+xn.whitespace}}))}else await or({controller:le,chunk:F});break}case"reasoning":{le.enqueue(F),gt==null?(gt={type:"text",text:F.textDelta},me.push(gt)):gt.text+=F.textDelta;break}case"reasoning-signature":{if(le.enqueue(F),gt==null)throw new Pd({chunk:F,message:"reasoning-signature without reasoning"});gt.signature=F.signature,gt=void 0;break}case"redacted-reasoning":{le.enqueue(F),me.push({type:"redacted",data:F.data});break}case"tool-call":{le.enqueue(F),Ve.push(F);break}case"tool-result":{le.enqueue(F),Ot.push(F);break}case"response-metadata":{qe={id:(Be=F.id)!=null?Be:qe.id,timestamp:(en=F.timestamp)!=null?en:qe.timestamp,modelId:(vt=F.modelId)!=null?vt:qe.modelId};break}case"finish":{lt=F.usage,yt=F.finishReason,Pt=F.experimental_providerMetadata,ar=F.logprobs;const Je=A()-Kt;$e.addEvent("ai.stream.finish"),$e.setAttributes({"ai.response.msToFinish":Je,"ai.response.avgCompletionTokensPerSecond":1e3*lt.completionTokens/Je});break}case"file":{Qe.push(F),le.enqueue(F);break}case"source":case"tool-call-streaming-start":case"tool-call-delta":{le.enqueue(F);break}case"error":{le.enqueue(F),yt="error";break}default:{const Je=as;throw new Error(`Unknown chunk type: ${Je}`)}}},async flush(F){const le=Ve.length>0?JSON.stringify(Ve):void 0;let Be="done";I+1<g&&(v&&yt==="length"&&Ve.length===0?Be="continue":Ve.length>0&&Ot.length===Ve.length&&(Be="tool-result")),v&&Mt.length>0&&(Be!=="continue"||pe==="continue"&&!ns)&&(await or({controller:F,chunk:{type:"text-delta",textDelta:Mt}}),Mt="");try{$e.setAttributes(Me({telemetry:t,attributes:{"ai.response.finishReason":yt,"ai.response.text":{output:()=>Qt},"ai.response.toolCalls":{output:()=>le},"ai.response.id":qe.id,"ai.response.model":qe.modelId,"ai.response.timestamp":qe.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Pt),"ai.usage.promptTokens":lt.promptTokens,"ai.usage.completionTokens":lt.completionTokens,"gen_ai.response.finish_reasons":[yt],"gen_ai.response.id":qe.id,"gen_ai.response.model":qe.modelId,"gen_ai.usage.input_tokens":lt.promptTokens,"gen_ai.usage.output_tokens":lt.completionTokens}}))}catch{}finally{$e.end()}F.enqueue({type:"step-finish",finishReason:yt,usage:lt,providerMetadata:Pt,experimental_providerMetadata:Pt,logprobs:ar,request:Xt,response:{...qe,headers:mt==null?void 0:mt.headers},warnings:Xe,isContinued:Be==="continue",messageId:Te});const en=Fo(Ee,lt);if(Be==="done")F.enqueue({type:"finish",finishReason:yt,usage:en,providerMetadata:Pt,experimental_providerMetadata:Pt,logprobs:ar,response:{...qe,headers:mt==null?void 0:mt.headers}}),ie.closeStream();else{if(pe==="continue"){const vt=he[he.length-1];typeof vt.content=="string"?vt.content+=Qt:vt.content.push({text:Qt,type:"text"})}else he.push(...Nr({text:Qt,files:Qe,reasoning:me,tools:l??{},toolCalls:Ve,toolResults:Ot,messageId:Te,generateMessageId:k}));await ye({currentStep:I+1,responseMessages:he,usage:en,stepType:Be,previousStepText:ts,hasLeadingWhitespace:ss,messageId:Be==="continue"?Te:k()})}}})))}await ye({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:k()})}}).catch(xe=>{ie.addStream(new ReadableStream({start(ye){ye.enqueue({type:"error",error:xe}),ye.close()}})),ie.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get files(){return this.filesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){const[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return mr(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type==="text-delta"&&t.enqueue(e.textDelta)}})))}get fullStream(){return mr(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await $d({stream:this.fullStream,onError:e==null?void 0:e.onError})}catch(n){(t=e==null?void 0:e.onError)==null||t.call(e,n)}}get experimental_partialOutputStream(){if(this.output==null)throw new Ho;return mr(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:n=!1,sendSources:r=!1,experimental_sendFinish:s=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(a,o)=>{const i=a.type;switch(i){case"text-delta":{o.enqueue(ge("text",a.textDelta));break}case"reasoning":{n&&o.enqueue(ge("reasoning",a.textDelta));break}case"redacted-reasoning":{n&&o.enqueue(ge("redacted_reasoning",{data:a.data}));break}case"reasoning-signature":{n&&o.enqueue(ge("reasoning_signature",{signature:a.signature}));break}case"file":{o.enqueue(ge("file",{mimeType:a.mimeType,data:a.base64}));break}case"source":{r&&o.enqueue(ge("source",a.source));break}case"tool-call-streaming-start":{o.enqueue(ge("tool_call_streaming_start",{toolCallId:a.toolCallId,toolName:a.toolName}));break}case"tool-call-delta":{o.enqueue(ge("tool_call_delta",{toolCallId:a.toolCallId,argsTextDelta:a.argsTextDelta}));break}case"tool-call":{o.enqueue(ge("tool_call",{toolCallId:a.toolCallId,toolName:a.toolName,args:a.args}));break}case"tool-result":{o.enqueue(ge("tool_result",{toolCallId:a.toolCallId,result:a.result}));break}case"error":{o.enqueue(ge("error",e(a.error)));break}case"step-start":{o.enqueue(ge("start_step",{messageId:a.messageId}));break}case"step-finish":{o.enqueue(ge("finish_step",{finishReason:a.finishReason,usage:t?{promptTokens:a.usage.promptTokens,completionTokens:a.usage.completionTokens}:void 0,isContinued:a.isContinued}));break}case"finish":{s&&o.enqueue(ge("finish_message",{finishReason:a.finishReason,usage:t?{promptTokens:a.usage.promptTokens,completionTokens:a.usage.completionTokens}:void 0}));break}default:{const u=i;throw new Error(`Unknown chunk type: ${u}`)}}}}))}pipeDataStreamToResponse(e,{status:t,statusText:n,headers:r,data:s,getErrorMessage:a,sendUsage:o,sendReasoning:i,sendSources:u,experimental_sendFinish:l}={}){ks({response:e,status:t,statusText:n,headers:Ts(r,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:s,getErrorMessage:a,sendUsage:o,sendReasoning:i,sendSources:u,experimental_sendFinish:l})})}pipeTextStreamToResponse(e,t){ks({response:e,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText,headers:Ts(t==null?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){const t=this.toDataStreamInternal({getErrorMessage:e==null?void 0:e.getErrorMessage,sendUsage:e==null?void 0:e.sendUsage,sendReasoning:e==null?void 0:e.sendReasoning,sendSources:e==null?void 0:e.sendSources,experimental_sendFinish:e==null?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return e!=null&&e.data?Wr(e==null?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:t==null?void 0:t.sendUsage,sendReasoning:t==null?void 0:t.sendReasoning,sendSources:t==null?void 0:t.sendSources,experimental_sendFinish:t==null?void 0:t.experimental_sendFinish}))}toDataStreamResponse({headers:e,status:t,statusText:n,data:r,getErrorMessage:s,sendUsage:a,sendReasoning:o,sendSources:i,experimental_sendFinish:u}={}){return new Response(this.toDataStream({data:r,getErrorMessage:s,sendUsage:a,sendReasoning:o,sendSources:i,experimental_sendFinish:u}),{status:t,statusText:n,headers:zn(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:zn(e==null?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}};var Bd=h({name:p(),version:p()}).passthrough(),Yr=h({_meta:fe(h({}).passthrough())}).passthrough(),gn=Yr,Jd=h({method:p(),params:fe(Yr)}),Hd=h({experimental:fe(h({}).passthrough()),logging:fe(h({}).passthrough()),prompts:fe(h({listChanged:fe(_e())}).passthrough()),resources:fe(h({subscribe:fe(_e()),listChanged:fe(_e())}).passthrough()),tools:fe(h({listChanged:fe(_e())}).passthrough())}).passthrough();gn.extend({protocolVersion:p(),capabilities:Hd,serverInfo:Bd,instructions:fe(p())});var Gd=gn.extend({nextCursor:fe(p())}),zd=h({name:p(),description:fe(p()),inputSchema:h({type:N("object"),properties:fe(h({}).passthrough())}).passthrough()}).passthrough();Gd.extend({tools:O(zd)});var Wd=h({type:N("text"),text:p()}).passthrough(),Yd=h({type:N("image"),data:p().base64(),mimeType:p()}).passthrough(),fi=h({uri:p(),mimeType:fe(p())}).passthrough(),Kd=fi.extend({text:p()}),Xd=fi.extend({blob:p().base64()}),Qd=h({type:N("resource"),resource:X([Kd,Xd])}).passthrough();gn.extend({content:O(X([Wd,Yd,Qd])),isError:_e().default(!1).optional()}).or(gn.extend({toolResult:Gt()}));var nr="2.0",ep=h({jsonrpc:N(nr),id:X([p(),w().int()])}).merge(Jd).strict(),tp=h({jsonrpc:N(nr),id:X([p(),w().int()]),result:gn}).strict(),np=h({jsonrpc:N(nr),id:X([p(),w().int()]),error:h({code:w().int(),message:p(),data:fe(Gt())})}).strict(),rp=h({jsonrpc:N(nr)}).merge(h({method:p(),params:fe(Yr)})).strict();X([ep,rp,tp,np]);var sp={};Hr(sp,{mergeIntoDataStream:()=>ip,toDataStream:()=>ap,toDataStreamResponse:()=>op});function hi(e={}){const t=new TextEncoder;let n="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(r,s){s.enqueue(t.encode(r)),n+=r,e.onToken&&await e.onToken(r),e.onText&&typeof r=="string"&&await e.onText(r)},async flush(){e.onCompletion&&await e.onCompletion(n),e.onFinal&&await e.onFinal(n)}})}function Kr(e,t){return e.pipeThrough(new TransformStream({transform:async(n,r)=>{var s;if(typeof n=="string"){r.enqueue(n);return}if("event"in n){n.event==="on_chat_model_stream"&&Os((s=n.data)==null?void 0:s.chunk,r);return}Os(n,r)}})).pipeThrough(hi(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(n,r)=>{r.enqueue(ge("text",n))}}))}function ap(e,t){return Kr(e,t).pipeThrough(new TextEncoderStream)}function op(e,t){var n;const r=Kr(e,t==null?void 0:t.callbacks).pipeThrough(new TextEncoderStream),s=t==null?void 0:t.data,a=t==null?void 0:t.init,o=s?Wr(s.stream,r):r;return new Response(o,{status:(n=a==null?void 0:a.status)!=null?n:200,statusText:a==null?void 0:a.statusText,headers:zn(a==null?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function ip(e,t){t.dataStream.merge(Kr(e,t.callbacks))}function Os(e,t){if(typeof e.content=="string")t.enqueue(e.content);else{const n=e.content;for(const r of n)r.type==="text"&&t.enqueue(r.text)}}var lp={};Hr(lp,{mergeIntoDataStream:()=>dp,toDataStream:()=>up,toDataStreamResponse:()=>cp});function Xr(e,t){const n=pp();return Ki(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(r,s){s.enqueue(n(r.delta))}})).pipeThrough(hi(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,s)=>{s.enqueue(ge("text",r))}}))}function up(e,t){return Xr(e,t).pipeThrough(new TextEncoderStream)}function cp(e,t={}){var n;const{init:r,data:s,callbacks:a}=t,o=Xr(e,a).pipeThrough(new TextEncoderStream),i=s?Wr(s.stream,o):o;return new Response(i,{status:(n=r==null?void 0:r.status)!=null?n:200,statusText:r==null?void 0:r.statusText,headers:zn(r==null?void 0:r.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function dp(e,t){t.dataStream.merge(Xr(e,t.callbacks))}function pp(){let e=!0;return t=>(e&&(t=t.trimStart(),t&&(e=!1)),t)}var fp=h({type:N("error"),error:h({type:p(),message:p()})}),Ps=Jt({errorSchema:fp,errorToMessage:e=>e.error.message});function hp(e){var t;const n=(t=e.tools)!=null&&t.length?e.tools:void 0,r=[],s=new Set;if(n==null)return{tools:void 0,tool_choice:void 0,toolWarnings:r,betas:s};const a=[];for(const u of n)switch(u.type){case"function":a.push({name:u.name,description:u.description,input_schema:u.parameters});break;case"provider-defined":switch(u.id){case"anthropic.computer_20250124":s.add("computer-use-2025-01-24"),a.push({name:u.name,type:"computer_20250124",display_width_px:u.args.displayWidthPx,display_height_px:u.args.displayHeightPx,display_number:u.args.displayNumber});break;case"anthropic.computer_20241022":s.add("computer-use-2024-10-22"),a.push({name:u.name,type:"computer_20241022",display_width_px:u.args.displayWidthPx,display_height_px:u.args.displayHeightPx,display_number:u.args.displayNumber});break;case"anthropic.text_editor_20250124":s.add("computer-use-2025-01-24"),a.push({name:u.name,type:"text_editor_20250124"});break;case"anthropic.text_editor_20241022":s.add("computer-use-2024-10-22"),a.push({name:u.name,type:"text_editor_20241022"});break;case"anthropic.bash_20250124":s.add("computer-use-2025-01-24"),a.push({name:u.name,type:"bash_20250124"});break;case"anthropic.bash_20241022":s.add("computer-use-2024-10-22"),a.push({name:u.name,type:"bash_20241022"});break;default:r.push({type:"unsupported-tool",tool:u});break}break;default:r.push({type:"unsupported-tool",tool:u});break}const o=e.toolChoice;if(o==null)return{tools:a,tool_choice:void 0,toolWarnings:r,betas:s};const i=o.type;switch(i){case"auto":return{tools:a,tool_choice:{type:"auto"},toolWarnings:r,betas:s};case"required":return{tools:a,tool_choice:{type:"any"},toolWarnings:r,betas:s};case"none":return{tools:void 0,tool_choice:void 0,toolWarnings:r,betas:s};case"tool":return{tools:a,tool_choice:{type:"tool",name:o.toolName},toolWarnings:r,betas:s};default:{const u=i;throw new G({functionality:`Unsupported tool choice type: ${u}`})}}}function mp({prompt:e,sendReasoning:t,warnings:n}){var r,s,a,o;const i=new Set,u=gp(e);let l;const c=[];function f(d){var m;const _=d==null?void 0:d.anthropic;return(m=_==null?void 0:_.cacheControl)!=null?m:_==null?void 0:_.cache_control}for(let d=0;d<u.length;d++){const m=u[d],_=d===u.length-1,g=m.type;switch(g){case"system":{if(l!=null)throw new G({functionality:"Multiple system messages that are separated by user/assistant messages"});l=m.messages.map(({content:y,providerMetadata:v})=>({type:"text",text:y,cache_control:f(v)}));break}case"user":{const y=[];for(const v of m.messages){const{role:x,content:A}=v;switch(x){case"user":{for(let b=0;b<A.length;b++){const T=A[b],k=b===A.length-1,M=(r=f(T.providerMetadata))!=null?r:k?f(v.providerMetadata):void 0;switch(T.type){case"text":{y.push({type:"text",text:T.text,cache_control:M});break}case"image":{y.push({type:"image",source:T.image instanceof URL?{type:"url",url:T.image.toString()}:{type:"base64",media_type:(s=T.mimeType)!=null?s:"image/jpeg",data:Ge(T.image)},cache_control:M});break}case"file":{if(T.mimeType!=="application/pdf")throw new G({functionality:"Non-PDF files in user messages"});i.add("pdfs-2024-09-25"),y.push({type:"document",source:T.data instanceof URL?{type:"url",url:T.data.toString()}:{type:"base64",media_type:"application/pdf",data:T.data},cache_control:M});break}}}break}case"tool":{for(let b=0;b<A.length;b++){const T=A[b],k=b===A.length-1,M=(a=f(T.providerMetadata))!=null?a:k?f(v.providerMetadata):void 0,R=T.content!=null?T.content.map(D=>{var Y;switch(D.type){case"text":return{type:"text",text:D.text,cache_control:void 0};case"image":return{type:"image",source:{type:"base64",media_type:(Y=D.mimeType)!=null?Y:"image/jpeg",data:D.data},cache_control:void 0}}}):JSON.stringify(T.result);y.push({type:"tool_result",tool_use_id:T.toolCallId,content:R,is_error:T.isError,cache_control:M})}break}default:{const b=x;throw new Error(`Unsupported role: ${b}`)}}}c.push({role:"user",content:y});break}case"assistant":{const y=[];for(let v=0;v<m.messages.length;v++){const x=m.messages[v],A=v===m.messages.length-1,{content:b}=x;for(let T=0;T<b.length;T++){const k=b[T],M=T===b.length-1,R=(o=f(k.providerMetadata))!=null?o:M?f(x.providerMetadata):void 0;switch(k.type){case"text":{y.push({type:"text",text:_&&A&&M?k.text.trim():k.text,cache_control:R});break}case"reasoning":{t?y.push({type:"thinking",thinking:k.text,signature:k.signature,cache_control:R}):n.push({type:"other",message:"sending reasoning content is disabled for this model"});break}case"redacted-reasoning":{y.push({type:"redacted_thinking",data:k.data,cache_control:R});break}case"tool-call":{y.push({type:"tool_use",id:k.toolCallId,name:k.toolName,input:k.args,cache_control:R});break}}}}c.push({role:"assistant",content:y});break}default:{const y=g;throw new Error(`Unsupported type: ${y}`)}}}return{prompt:{system:l,messages:c},betas:i}}function gp(e){const t=[];let n;for(const r of e){const{role:s}=r;switch(s){case"system":{(n==null?void 0:n.type)!=="system"&&(n={type:"system",messages:[]},t.push(n)),n.messages.push(r);break}case"assistant":{(n==null?void 0:n.type)!=="assistant"&&(n={type:"assistant",messages:[]},t.push(n)),n.messages.push(r);break}case"user":{(n==null?void 0:n.type)!=="user"&&(n={type:"user",messages:[]},t.push(n)),n.messages.push(r);break}case"tool":{(n==null?void 0:n.type)!=="user"&&(n={type:"user",messages:[]},t.push(n)),n.messages.push(r);break}default:{const a=s;throw new Error(`Unsupported role: ${a}`)}}}return t}function Ms(e){switch(e){case"end_turn":case"stop_sequence":return"stop";case"tool_use":return"tool-calls";case"max_tokens":return"length";default:return"unknown"}}var yp=class{constructor(e,t,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.modelId=e,this.settings=t,this.config=n}supportsUrl(e){return e.protocol==="https:"}get provider(){return this.config.provider}get supportsImageUrls(){return this.config.supportsImageUrls}async getArgs({mode:e,prompt:t,maxTokens:n=4096,temperature:r,topP:s,topK:a,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,providerMetadata:f}){var d,m,_;const g=e.type,y=[];o!=null&&y.push({type:"unsupported-setting",setting:"frequencyPenalty"}),i!=null&&y.push({type:"unsupported-setting",setting:"presencePenalty"}),c!=null&&y.push({type:"unsupported-setting",setting:"seed"}),l!=null&&l.type!=="text"&&y.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:v,betas:x}=mp({prompt:t,sendReasoning:(d=this.settings.sendReasoning)!=null?d:!0,warnings:y}),A=Ct({provider:"anthropic",providerOptions:f,schema:bp}),b=((m=A==null?void 0:A.thinking)==null?void 0:m.type)==="enabled",T=(_=A==null?void 0:A.thinking)==null?void 0:_.budgetTokens,k={model:this.modelId,max_tokens:n,temperature:r,top_k:a,top_p:s,stop_sequences:u,...b&&{thinking:{type:"enabled",budget_tokens:T}},system:v.system,messages:v.messages};if(b){if(T==null)throw new G({functionality:"thinking requires a budget"});k.temperature!=null&&(k.temperature=void 0,y.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported when thinking is enabled"})),a!=null&&(k.top_k=void 0,y.push({type:"unsupported-setting",setting:"topK",details:"topK is not supported when thinking is enabled"})),s!=null&&(k.top_p=void 0,y.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported when thinking is enabled"})),k.max_tokens=n+T}switch(g){case"regular":{const{tools:M,tool_choice:R,toolWarnings:D,betas:Y}=hp(e);return{args:{...k,tools:M,tool_choice:R},warnings:[...y,...D],betas:new Set([...x,...Y])}}case"object-json":throw new G({functionality:"json-mode object generation"});case"object-tool":{const{name:M,description:R,parameters:D}=e.tool;return{args:{...k,tools:[{name:M,description:R,input_schema:D}],tool_choice:{type:"tool",name:M}},warnings:y,betas:x}}default:{const M=g;throw new Error(`Unsupported type: ${M}`)}}}async getHeaders({betas:e,headers:t}){return re(await En(this.config.headers),e.size>0?{"anthropic-beta":Array.from(e).join(",")}:{},t)}buildRequestUrl(e){var t,n,r;return(r=(n=(t=this.config).buildRequestUrl)==null?void 0:n.call(t,this.config.baseURL,e))!=null?r:`${this.config.baseURL}/messages`}transformRequestBody(e){var t,n,r;return(r=(n=(t=this.config).transformRequestBody)==null?void 0:n.call(t,e))!=null?r:e}async doGenerate(e){var t,n,r,s;const{args:a,warnings:o,betas:i}=await this.getArgs(e),{responseHeaders:u,value:l,rawValue:c}=await se({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:i,headers:e.headers}),body:this.transformRequestBody(a),failedResponseHandler:Ps,successfulResponseHandler:we(vp),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:f,...d}=a;let m="";for(const y of l.content)y.type==="text"&&(m+=y.text);let _;if(l.content.some(y=>y.type==="tool_use")){_=[];for(const y of l.content)y.type==="tool_use"&&_.push({toolCallType:"function",toolCallId:y.id,toolName:y.name,args:JSON.stringify(y.input)})}const g=l.content.filter(y=>y.type==="redacted_thinking"||y.type==="thinking").map(y=>y.type==="thinking"?{type:"text",text:y.thinking,signature:y.signature}:{type:"redacted",data:y.data});return{text:m,reasoning:g.length>0?g:void 0,toolCalls:_,finishReason:Ms(l.stop_reason),usage:{promptTokens:l.usage.input_tokens,completionTokens:l.usage.output_tokens},rawCall:{rawPrompt:f,rawSettings:d},rawResponse:{headers:u,body:c},response:{id:(t=l.id)!=null?t:void 0,modelId:(n=l.model)!=null?n:void 0},warnings:o,providerMetadata:{anthropic:{cacheCreationInputTokens:(r=l.usage.cache_creation_input_tokens)!=null?r:null,cacheReadInputTokens:(s=l.usage.cache_read_input_tokens)!=null?s:null}},request:{body:JSON.stringify(a)}}}async doStream(e){const{args:t,warnings:n,betas:r}=await this.getArgs(e),s={...t,stream:!0},{responseHeaders:a,value:o}=await se({url:this.buildRequestUrl(!0),headers:await this.getHeaders({betas:r,headers:e.headers}),body:this.transformRequestBody(s),failedResponseHandler:Ps,successfulResponseHandler:It(_p),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:i,...u}=t;let l="unknown";const c={promptTokens:Number.NaN,completionTokens:Number.NaN},f={};let d,m;return{stream:o.pipeThrough(new TransformStream({transform(_,g){var y,v,x,A;if(!_.success){g.enqueue({type:"error",error:_.error});return}const b=_.value;switch(b.type){case"ping":return;case"content_block_start":{const T=b.content_block.type;switch(m=T,T){case"text":case"thinking":return;case"redacted_thinking":{g.enqueue({type:"redacted-reasoning",data:b.content_block.data});return}case"tool_use":{f[b.index]={toolCallId:b.content_block.id,toolName:b.content_block.name,jsonText:""};return}default:{const k=T;throw new Error(`Unsupported content block type: ${k}`)}}}case"content_block_stop":{if(f[b.index]!=null){const T=f[b.index];g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:T.toolCallId,toolName:T.toolName,args:T.jsonText}),delete f[b.index]}m=void 0;return}case"content_block_delta":{const T=b.delta.type;switch(T){case"text_delta":{g.enqueue({type:"text-delta",textDelta:b.delta.text});return}case"thinking_delta":{g.enqueue({type:"reasoning",textDelta:b.delta.thinking});return}case"signature_delta":{m==="thinking"&&g.enqueue({type:"reasoning-signature",signature:b.delta.signature});return}case"input_json_delta":{const k=f[b.index];g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:k.toolCallId,toolName:k.toolName,argsTextDelta:b.delta.partial_json}),k.jsonText+=b.delta.partial_json;return}default:{const k=T;throw new Error(`Unsupported delta type: ${k}`)}}}case"message_start":{c.promptTokens=b.message.usage.input_tokens,c.completionTokens=b.message.usage.output_tokens,d={anthropic:{cacheCreationInputTokens:(y=b.message.usage.cache_creation_input_tokens)!=null?y:null,cacheReadInputTokens:(v=b.message.usage.cache_read_input_tokens)!=null?v:null}},g.enqueue({type:"response-metadata",id:(x=b.message.id)!=null?x:void 0,modelId:(A=b.message.model)!=null?A:void 0});return}case"message_delta":{c.completionTokens=b.usage.output_tokens,l=Ms(b.delta.stop_reason);return}case"message_stop":{g.enqueue({type:"finish",finishReason:l,usage:c,providerMetadata:d});return}case"error":{g.enqueue({type:"error",error:b.error});return}default:{const T=b;throw new Error(`Unsupported chunk type: ${T}`)}}}})),rawCall:{rawPrompt:i,rawSettings:u},rawResponse:{headers:a},warnings:n,request:{body:JSON.stringify(s)}}}},vp=h({type:N("message"),id:p().nullish(),model:p().nullish(),content:O(st("type",[h({type:N("text"),text:p()}),h({type:N("thinking"),thinking:p(),signature:p()}),h({type:N("redacted_thinking"),data:p()}),h({type:N("tool_use"),id:p(),name:p(),input:Gt()})])),stop_reason:p().nullish(),usage:h({input_tokens:w(),output_tokens:w(),cache_creation_input_tokens:w().nullish(),cache_read_input_tokens:w().nullish()})}),_p=st("type",[h({type:N("message_start"),message:h({id:p().nullish(),model:p().nullish(),usage:h({input_tokens:w(),output_tokens:w(),cache_creation_input_tokens:w().nullish(),cache_read_input_tokens:w().nullish()})})}),h({type:N("content_block_start"),index:w(),content_block:st("type",[h({type:N("text"),text:p()}),h({type:N("thinking"),thinking:p()}),h({type:N("tool_use"),id:p(),name:p()}),h({type:N("redacted_thinking"),data:p()})])}),h({type:N("content_block_delta"),index:w(),delta:st("type",[h({type:N("input_json_delta"),partial_json:p()}),h({type:N("text_delta"),text:p()}),h({type:N("thinking_delta"),thinking:p()}),h({type:N("signature_delta"),signature:p()})])}),h({type:N("content_block_stop"),index:w()}),h({type:N("error"),error:h({type:p(),message:p()})}),h({type:N("message_delta"),delta:h({stop_reason:p().nullish()}),usage:h({output_tokens:w()})}),h({type:N("message_stop")}),h({type:N("ping")})]),bp=h({thinking:h({type:X([N("enabled"),N("disabled")]),budgetTokens:w().optional()}).optional()}),wp=h({command:p(),restart:_e().optional()});function xp(e={}){return{type:"provider-defined",id:"anthropic.bash_20241022",args:{},parameters:wp,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var Tp=h({command:p(),restart:_e().optional()});function kp(e={}){return{type:"provider-defined",id:"anthropic.bash_20250124",args:{},parameters:Tp,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var Sp=h({command:Fe(["view","create","str_replace","insert","undo_edit"]),path:p(),file_text:p().optional(),insert_line:w().int().optional(),new_str:p().optional(),old_str:p().optional(),view_range:O(w().int()).optional()});function Cp(e={}){return{type:"provider-defined",id:"anthropic.text_editor_20241022",args:{},parameters:Sp,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var Ip=h({command:Fe(["view","create","str_replace","insert","undo_edit"]),path:p(),file_text:p().optional(),insert_line:w().int().optional(),new_str:p().optional(),old_str:p().optional(),view_range:O(w().int()).optional()});function Rp(e={}){return{type:"provider-defined",id:"anthropic.text_editor_20250124",args:{},parameters:Ip,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var Ap=h({action:Fe(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),coordinate:O(w().int()).optional(),text:p().optional()});function Np(e){return{type:"provider-defined",id:"anthropic.computer_20241022",args:{displayWidthPx:e.displayWidthPx,displayHeightPx:e.displayHeightPx,displayNumber:e.displayNumber},parameters:Ap,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var Ep=h({action:Fe(["key","hold_key","type","cursor_position","mouse_move","left_mouse_down","left_mouse_up","left_click","left_click_drag","right_click","middle_click","double_click","triple_click","scroll","wait","screenshot"]),coordinate:vs([w().int(),w().int()]).optional(),duration:w().optional(),scroll_amount:w().optional(),scroll_direction:Fe(["up","down","left","right"]).optional(),start_coordinate:vs([w().int(),w().int()]).optional(),text:p().optional()});function Op(e){return{type:"provider-defined",id:"anthropic.computer_20250124",args:{displayWidthPx:e.displayWidthPx,displayHeightPx:e.displayHeightPx,displayNumber:e.displayNumber},parameters:Ep,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var Pp={bash_20241022:xp,bash_20250124:kp,textEditor_20241022:Cp,textEditor_20250124:Rp,computer_20241022:Np,computer_20250124:Op};function mi(e={}){var t;const n=(t=Ht(e.baseURL))!=null?t:"https://api.anthropic.com/v1",r=()=>({"anthropic-version":"2023-06-01","x-api-key":vn({apiKey:e.apiKey,environmentVariableName:"ANTHROPIC_API_KEY",description:"Anthropic"}),...e.headers}),s=(o,i={})=>new yp(o,i,{provider:"anthropic.messages",baseURL:n,headers:r,fetch:e.fetch,supportsImageUrls:!0}),a=function(o,i){if(new.target)throw new Error("The Anthropic model function cannot be called with the new keyword.");return s(o,i)};return a.languageModel=s,a.chat=s,a.messages=s,a.textEmbeddingModel=o=>{throw new Ra({modelId:o,modelType:"textEmbeddingModel"})},a.tools=Pp,a}mi();function Mp({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:n="system"}){const r=[],s=[];for(const{role:a,content:o}of e)switch(a){case"system":{switch(n){case"system":{r.push({role:"system",content:o});break}case"developer":{r.push({role:"developer",content:o});break}case"remove":{s.push({type:"other",message:"system messages are removed for this model"});break}default:{const i=n;throw new Error(`Unsupported system message mode: ${i}`)}}break}case"user":{if(o.length===1&&o[0].type==="text"){r.push({role:"user",content:o[0].text});break}r.push({role:"user",content:o.map((i,u)=>{var l,c,f,d;switch(i.type){case"text":return{type:"text",text:i.text};case"image":return{type:"image_url",image_url:{url:i.image instanceof URL?i.image.toString():`data:${(l=i.mimeType)!=null?l:"image/jpeg"};base64,${Ge(i.image)}`,detail:(f=(c=i.providerMetadata)==null?void 0:c.openai)==null?void 0:f.imageDetail}};case"file":{if(i.data instanceof URL)throw new G({functionality:"'File content parts with URL data' functionality not supported."});switch(i.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:i.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:i.data,format:"mp3"}};case"application/pdf":return{type:"file",file:{filename:(d=i.filename)!=null?d:`part-${u}.pdf`,file_data:`data:application/pdf;base64,${i.data}`}};default:throw new G({functionality:`File content part type ${i.mimeType} in user messages`})}}}})});break}case"assistant":{let i="";const u=[];for(const l of o)switch(l.type){case"text":{i+=l.text;break}case"tool-call":{u.push({id:l.toolCallId,type:"function",function:{name:l.toolName,arguments:JSON.stringify(l.args)}});break}}if(t){if(u.length>1)throw new G({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});r.push({role:"assistant",content:i,function_call:u.length>0?u[0].function:void 0})}else r.push({role:"assistant",content:i,tool_calls:u.length>0?u:void 0});break}case"tool":{for(const i of o)t?r.push({role:"function",name:i.toolName,content:JSON.stringify(i.result)}):r.push({role:"tool",tool_call_id:i.toolCallId,content:JSON.stringify(i.result)});break}default:{const i=a;throw new Error(`Unsupported role: ${i}`)}}return{messages:r,warnings:s}}function Ds(e){var t,n;return(n=(t=e==null?void 0:e.content)==null?void 0:t.map(({token:r,logprob:s,top_logprobs:a})=>({token:r,logprob:s,topLogprobs:a?a.map(({token:o,logprob:i})=>({token:o,logprob:i})):[]})))!=null?n:void 0}function Yn(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Qr=h({error:h({message:p(),type:p().nullish(),param:Qn().nullish(),code:X([p(),w()]).nullish()})}),We=Jt({errorSchema:Qr,errorToMessage:e=>e.error.message});function Kn({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function Dp({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:n}){var r;const s=(r=e.tools)!=null&&r.length?e.tools:void 0,a=[];if(s==null)return{tools:void 0,tool_choice:void 0,toolWarnings:a};const o=e.toolChoice;if(t){const l=[];for(const f of s)f.type==="provider-defined"?a.push({type:"unsupported-tool",tool:f}):l.push({name:f.name,description:f.description,parameters:f.parameters});if(o==null)return{functions:l,function_call:void 0,toolWarnings:a};switch(o.type){case"auto":case"none":case void 0:return{functions:l,function_call:void 0,toolWarnings:a};case"required":throw new G({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:l,function_call:{name:o.toolName},toolWarnings:a}}}const i=[];for(const l of s)l.type==="provider-defined"?a.push({type:"unsupported-tool",tool:l}):i.push({type:"function",function:{name:l.name,description:l.description,parameters:l.parameters,strict:n?!0:void 0}});if(o==null)return{tools:i,tool_choice:void 0,toolWarnings:a};const u=o.type;switch(u){case"auto":case"none":case"required":return{tools:i,tool_choice:u,toolWarnings:a};case"tool":return{tools:i,tool_choice:{type:"function",function:{name:o.toolName}},toolWarnings:a};default:{const l=u;throw new G({functionality:`Unsupported tool choice type: ${l}`})}}}var jp=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:Er(this.modelId)}get defaultObjectGenerationMode(){return Lp(this.modelId)?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:n,temperature:r,topP:s,topK:a,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,providerMetadata:f}){var d,m,_,g,y,v,x,A;const b=e.type,T=[];a!=null&&T.push({type:"unsupported-setting",setting:"topK"}),(l==null?void 0:l.type)==="json"&&l.schema!=null&&!this.supportsStructuredOutputs&&T.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const k=this.settings.useLegacyFunctionCalling;if(k&&this.settings.parallelToolCalls===!0)throw new G({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(k&&this.supportsStructuredOutputs)throw new G({functionality:"structuredOutputs with useLegacyFunctionCalling"});const{messages:M,warnings:R}=Mp({prompt:t,useLegacyFunctionCalling:k,systemMessageMode:Up(this.modelId)});T.push(...R);const D={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:n,temperature:r,top_p:s,frequency_penalty:o,presence_penalty:i,response_format:(l==null?void 0:l.type)==="json"?this.supportsStructuredOutputs&&l.schema!=null?{type:"json_schema",json_schema:{schema:l.schema,strict:!0,name:(d=l.name)!=null?d:"response",description:l.description}}:{type:"json_object"}:void 0,stop:u,seed:c,max_completion_tokens:(m=f==null?void 0:f.openai)==null?void 0:m.maxCompletionTokens,store:(_=f==null?void 0:f.openai)==null?void 0:_.store,metadata:(g=f==null?void 0:f.openai)==null?void 0:g.metadata,prediction:(y=f==null?void 0:f.openai)==null?void 0:y.prediction,reasoning_effort:(x=(v=f==null?void 0:f.openai)==null?void 0:v.reasoningEffort)!=null?x:this.settings.reasoningEffort,messages:M};switch(Er(this.modelId)?(D.temperature!=null&&(D.temperature=void 0,T.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),D.top_p!=null&&(D.top_p=void 0,T.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),D.frequency_penalty!=null&&(D.frequency_penalty=void 0,T.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),D.presence_penalty!=null&&(D.presence_penalty=void 0,T.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),D.logit_bias!=null&&(D.logit_bias=void 0,T.push({type:"other",message:"logitBias is not supported for reasoning models"})),D.logprobs!=null&&(D.logprobs=void 0,T.push({type:"other",message:"logprobs is not supported for reasoning models"})),D.top_logprobs!=null&&(D.top_logprobs=void 0,T.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),D.max_tokens!=null&&(D.max_completion_tokens==null&&(D.max_completion_tokens=D.max_tokens),D.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&D.temperature!=null&&(D.temperature=void 0,T.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),b){case"regular":{const{tools:Y,tool_choice:oe,functions:ue,function_call:Q,toolWarnings:Z}=Dp({mode:e,useLegacyFunctionCalling:k,structuredOutputs:this.supportsStructuredOutputs});return{args:{...D,tools:Y,tool_choice:oe,functions:ue,function_call:Q},warnings:[...T,...Z]}}case"object-json":return{args:{...D,response_format:this.supportsStructuredOutputs&&e.schema!=null?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:(A=e.name)!=null?A:"response",description:e.description}}:{type:"json_object"}},warnings:T};case"object-tool":return{args:k?{...D,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...D,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:this.supportsStructuredOutputs?!0:void 0}}]},warnings:T};default:{const Y=b;throw new Error(`Unsupported type: ${Y}`)}}}async doGenerate(e){var t,n,r,s,a,o,i,u;const{args:l,warnings:c}=this.getArgs(e),{responseHeaders:f,value:d,rawValue:m}=await se({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),body:l,failedResponseHandler:We,successfulResponseHandler:we($p),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:_,...g}=l,y=d.choices[0],v=(t=d.usage)==null?void 0:t.completion_tokens_details,x=(n=d.usage)==null?void 0:n.prompt_tokens_details,A={openai:{}};return(v==null?void 0:v.reasoning_tokens)!=null&&(A.openai.reasoningTokens=v==null?void 0:v.reasoning_tokens),(v==null?void 0:v.accepted_prediction_tokens)!=null&&(A.openai.acceptedPredictionTokens=v==null?void 0:v.accepted_prediction_tokens),(v==null?void 0:v.rejected_prediction_tokens)!=null&&(A.openai.rejectedPredictionTokens=v==null?void 0:v.rejected_prediction_tokens),(x==null?void 0:x.cached_tokens)!=null&&(A.openai.cachedPromptTokens=x==null?void 0:x.cached_tokens),{text:(r=y.message.content)!=null?r:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&y.message.function_call?[{toolCallType:"function",toolCallId:Se(),toolName:y.message.function_call.name,args:y.message.function_call.arguments}]:(s=y.message.tool_calls)==null?void 0:s.map(b=>{var T;return{toolCallType:"function",toolCallId:(T=b.id)!=null?T:Se(),toolName:b.function.name,args:b.function.arguments}}),finishReason:Yn(y.finish_reason),usage:{promptTokens:(o=(a=d.usage)==null?void 0:a.prompt_tokens)!=null?o:NaN,completionTokens:(u=(i=d.usage)==null?void 0:i.completion_tokens)!=null?u:NaN},rawCall:{rawPrompt:_,rawSettings:g},rawResponse:{headers:f,body:m},request:{body:JSON.stringify(l)},response:Kn(d),warnings:c,logprobs:Ds(y.logprobs),providerMetadata:A}}async doStream(e){if(this.settings.simulateStreaming){const g=await this.doGenerate(e);return{stream:new ReadableStream({start(v){if(v.enqueue({type:"response-metadata",...g.response}),g.text&&v.enqueue({type:"text-delta",textDelta:g.text}),g.toolCalls)for(const x of g.toolCalls)v.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:x.toolCallId,toolName:x.toolName,argsTextDelta:x.args}),v.enqueue({type:"tool-call",...x});v.enqueue({type:"finish",finishReason:g.finishReason,usage:g.usage,logprobs:g.logprobs,providerMetadata:g.providerMetadata}),v.close()}}),rawCall:g.rawCall,rawResponse:g.rawResponse,warnings:g.warnings}}const{args:t,warnings:n}=this.getArgs(e),r={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:s,value:a}=await se({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),body:r,failedResponseHandler:We,successfulResponseHandler:It(qp),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=t,u=[];let l="unknown",c={promptTokens:void 0,completionTokens:void 0},f,d=!0;const{useLegacyFunctionCalling:m}=this.settings,_={openai:{}};return{stream:a.pipeThrough(new TransformStream({transform(g,y){var v,x,A,b,T,k,M,R,D,Y,oe,ue;if(!g.success){l="error",y.enqueue({type:"error",error:g.error});return}const Q=g.value;if("error"in Q){l="error",y.enqueue({type:"error",error:Q.error});return}if(d&&(d=!1,y.enqueue({type:"response-metadata",...Kn(Q)})),Q.usage!=null){const{prompt_tokens:B,completion_tokens:te,prompt_tokens_details:K,completion_tokens_details:J}=Q.usage;c={promptTokens:B??void 0,completionTokens:te??void 0},(J==null?void 0:J.reasoning_tokens)!=null&&(_.openai.reasoningTokens=J==null?void 0:J.reasoning_tokens),(J==null?void 0:J.accepted_prediction_tokens)!=null&&(_.openai.acceptedPredictionTokens=J==null?void 0:J.accepted_prediction_tokens),(J==null?void 0:J.rejected_prediction_tokens)!=null&&(_.openai.rejectedPredictionTokens=J==null?void 0:J.rejected_prediction_tokens),(K==null?void 0:K.cached_tokens)!=null&&(_.openai.cachedPromptTokens=K==null?void 0:K.cached_tokens)}const Z=Q.choices[0];if((Z==null?void 0:Z.finish_reason)!=null&&(l=Yn(Z.finish_reason)),(Z==null?void 0:Z.delta)==null)return;const ne=Z.delta;ne.content!=null&&y.enqueue({type:"text-delta",textDelta:ne.content});const ee=Ds(Z==null?void 0:Z.logprobs);ee!=null&&ee.length&&(f===void 0&&(f=[]),f.push(...ee));const de=m&&ne.function_call!=null?[{type:"function",id:Se(),function:ne.function_call,index:0}]:ne.tool_calls;if(de!=null)for(const B of de){const te=B.index;if(u[te]==null){if(B.type!=="function")throw new jt({data:B,message:"Expected 'function' type."});if(B.id==null)throw new jt({data:B,message:"Expected 'id' to be a string."});if(((v=B.function)==null?void 0:v.name)==null)throw new jt({data:B,message:"Expected 'function.name' to be a string."});u[te]={id:B.id,type:"function",function:{name:B.function.name,arguments:(x=B.function.arguments)!=null?x:""},hasFinished:!1};const J=u[te];((A=J.function)==null?void 0:A.name)!=null&&((b=J.function)==null?void 0:b.arguments)!=null&&(J.function.arguments.length>0&&y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:J.id,toolName:J.function.name,argsTextDelta:J.function.arguments}),Nn(J.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(T=J.id)!=null?T:Se(),toolName:J.function.name,args:J.function.arguments}),J.hasFinished=!0));continue}const K=u[te];K.hasFinished||(((k=B.function)==null?void 0:k.arguments)!=null&&(K.function.arguments+=(R=(M=B.function)==null?void 0:M.arguments)!=null?R:""),y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:K.id,toolName:K.function.name,argsTextDelta:(D=B.function.arguments)!=null?D:""}),((Y=K.function)==null?void 0:Y.name)!=null&&((oe=K.function)==null?void 0:oe.arguments)!=null&&Nn(K.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(ue=K.id)!=null?ue:Se(),toolName:K.function.name,args:K.function.arguments}),K.hasFinished=!0))}},flush(g){var y,v;g.enqueue({type:"finish",finishReason:l,logprobs:f,usage:{promptTokens:(y=c.promptTokens)!=null?y:NaN,completionTokens:(v=c.completionTokens)!=null?v:NaN},..._!=null?{providerMetadata:_}:{}})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:s},request:{body:JSON.stringify(r)},warnings:n}}},gi=h({prompt_tokens:w().nullish(),completion_tokens:w().nullish(),prompt_tokens_details:h({cached_tokens:w().nullish()}).nullish(),completion_tokens_details:h({reasoning_tokens:w().nullish(),accepted_prediction_tokens:w().nullish(),rejected_prediction_tokens:w().nullish()}).nullish()}).nullish(),$p=h({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(h({message:h({role:N("assistant").nullish(),content:p().nullish(),function_call:h({arguments:p(),name:p()}).nullish(),tool_calls:O(h({id:p().nullish(),type:N("function"),function:h({name:p(),arguments:p()})})).nullish()}),index:w(),logprobs:h({content:O(h({token:p(),logprob:w(),top_logprobs:O(h({token:p(),logprob:w()}))})).nullable()}).nullish(),finish_reason:p().nullish()})),usage:gi}),qp=X([h({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(h({delta:h({role:Fe(["assistant"]).nullish(),content:p().nullish(),function_call:h({name:p().optional(),arguments:p().optional()}).nullish(),tool_calls:O(h({index:w(),id:p().nullish(),type:N("function").nullish(),function:h({name:p().nullish(),arguments:p().nullish()})})).nullish()}).nullish(),logprobs:h({content:O(h({token:p(),logprob:w(),top_logprobs:O(h({token:p(),logprob:w()}))})).nullable()}).nullish(),finish_reason:p().nullish(),index:w()})),usage:gi}),Qr]);function Er(e){return e.startsWith("o")||e.startsWith("gpt-5")}function Lp(e){return e.startsWith("gpt-4o-audio-preview")}function Up(e){var t,n;return Er(e)?(n=(t=Fp[e])==null?void 0:t.systemMessageMode)!=null?n:"developer":"system"}var Fp={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function Zp({prompt:e,inputFormat:t,user:n="user",assistant:r="assistant"}){if(t==="prompt"&&e.length===1&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0].type==="text")return{prompt:e[0].content[0].text};let s="";e[0].role==="system"&&(s+=`${e[0].content}

`,e=e.slice(1));for(const{role:a,content:o}of e)switch(a){case"system":throw new tt({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{const i=o.map(u=>{switch(u.type){case"text":return u.text;case"image":throw new G({functionality:"images"})}}).join("");s+=`${n}:
${i}

`;break}case"assistant":{const i=o.map(u=>{switch(u.type){case"text":return u.text;case"tool-call":throw new G({functionality:"tool-call messages"})}}).join("");s+=`${r}:
${i}

`;break}case"tool":throw new G({functionality:"tool messages"});default:{const i=a;throw new Error(`Unsupported role: ${i}`)}}return s+=`${r}:
`,{prompt:s,stopSequences:[`
${n}:`]}}function js(e){return e==null?void 0:e.tokens.map((t,n)=>({token:t,logprob:e.token_logprobs[n],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[n]).map(([r,s])=>({token:r,logprob:s})):[]}))}var Vp=class{constructor(e,t,n){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:n,maxTokens:r,temperature:s,topP:a,topK:o,frequencyPenalty:i,presencePenalty:u,stopSequences:l,responseFormat:c,seed:f}){var d;const m=e.type,_=[];o!=null&&_.push({type:"unsupported-setting",setting:"topK"}),c!=null&&c.type!=="text"&&_.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:g,stopSequences:y}=Zp({prompt:n,inputFormat:t}),v=[...y??[],...l??[]],x={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:r,temperature:s,top_p:a,frequency_penalty:i,presence_penalty:u,seed:f,prompt:g,stop:v.length>0?v:void 0};switch(m){case"regular":{if((d=e.tools)!=null&&d.length)throw new G({functionality:"tools"});if(e.toolChoice)throw new G({functionality:"toolChoice"});return{args:x,warnings:_}}case"object-json":throw new G({functionality:"object-json mode"});case"object-tool":throw new G({functionality:"object-tool mode"});default:{const A=m;throw new Error(`Unsupported type: ${A}`)}}}async doGenerate(e){const{args:t,warnings:n}=this.getArgs(e),{responseHeaders:r,value:s,rawValue:a}=await se({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),body:t,failedResponseHandler:We,successfulResponseHandler:we(Bp),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...i}=t,u=s.choices[0];return{text:u.text,usage:{promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens},finishReason:Yn(u.finish_reason),logprobs:js(u.logprobs),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:r,body:a},response:Kn(s),warnings:n,request:{body:JSON.stringify(t)}}}async doStream(e){const{args:t,warnings:n}=this.getArgs(e),r={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:s,value:a}=await se({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),body:r,failedResponseHandler:We,successfulResponseHandler:It(Jp),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...i}=t;let u="unknown",l={promptTokens:Number.NaN,completionTokens:Number.NaN},c,f=!0;return{stream:a.pipeThrough(new TransformStream({transform(d,m){if(!d.success){u="error",m.enqueue({type:"error",error:d.error});return}const _=d.value;if("error"in _){u="error",m.enqueue({type:"error",error:_.error});return}f&&(f=!1,m.enqueue({type:"response-metadata",...Kn(_)})),_.usage!=null&&(l={promptTokens:_.usage.prompt_tokens,completionTokens:_.usage.completion_tokens});const g=_.choices[0];(g==null?void 0:g.finish_reason)!=null&&(u=Yn(g.finish_reason)),(g==null?void 0:g.text)!=null&&m.enqueue({type:"text-delta",textDelta:g.text});const y=js(g==null?void 0:g.logprobs);y!=null&&y.length&&(c===void 0&&(c=[]),c.push(...y))},flush(d){d.enqueue({type:"finish",finishReason:u,logprobs:c,usage:l})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:s},warnings:n,request:{body:JSON.stringify(r)}}}},Bp=h({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(h({text:p(),finish_reason:p(),logprobs:h({tokens:O(p()),token_logprobs:O(w()),top_logprobs:O(Lt(p(),w())).nullable()}).nullish()})),usage:h({prompt_tokens:w(),completion_tokens:w()})}),Jp=X([h({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(h({text:p(),finish_reason:p().nullish(),index:w(),logprobs:h({tokens:O(p()),token_logprobs:O(w()),top_logprobs:O(Lt(p(),w())).nullable()}).nullish()})),usage:h({prompt_tokens:w(),completion_tokens:w()}).nullish()}),Qr]),Hp=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)!=null?e:!0}async doEmbed({values:e,headers:t,abortSignal:n}){if(e.length>this.maxEmbeddingsPerCall)throw new Xn({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:r,value:s}=await se({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:re(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:We,successfulResponseHandler:we(Gp),abortSignal:n,fetch:this.config.fetch});return{embeddings:s.data.map(a=>a.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:r}}}},Gp=h({data:O(h({embedding:O(w())})),usage:h({prompt_tokens:w()}).nullish()}),zp={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},Wp=new Set(["gpt-image-1"]),Yp=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return(t=(e=this.settings.maxImagesPerCall)!=null?e:zp[this.modelId])!=null?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:s,providerOptions:a,headers:o,abortSignal:i}){var u,l,c,f;const d=[];r!=null&&d.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),s!=null&&d.push({type:"unsupported-setting",setting:"seed"});const m=(c=(l=(u=this.config._internal)==null?void 0:u.currentDate)==null?void 0:l.call(u))!=null?c:new Date,{value:_,responseHeaders:g}=await se({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:re(this.config.headers(),o),body:{model:this.modelId,prompt:e,n:t,size:n,...(f=a.openai)!=null?f:{},...Wp.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:We,successfulResponseHandler:we(Kp),abortSignal:i,fetch:this.config.fetch});return{images:_.data.map(y=>y.b64_json),warnings:d,response:{timestamp:m,modelId:this.modelId,headers:g}}}},Kp=h({data:O(h({b64_json:p()}))}),Xp=h({include:O(p()).nullish(),language:p().nullish(),prompt:p().nullish(),temperature:w().min(0).max(1).nullish().default(0),timestampGranularities:O(Fe(["word","segment"])).nullish().default(["segment"])}),$s={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},Qp=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:n}){var r,s,a,o,i;const u=[],l=Ct({provider:"openai",providerOptions:n,schema:Xp}),c=new FormData,f=e instanceof Uint8Array?new Blob([e]):new Blob([_n(e)]);if(c.append("model",this.modelId),c.append("file",new File([f],"audio",{type:t})),l){const d={include:(r=l.include)!=null?r:void 0,language:(s=l.language)!=null?s:void 0,prompt:(a=l.prompt)!=null?a:void 0,temperature:(o=l.temperature)!=null?o:void 0,timestamp_granularities:(i=l.timestampGranularities)!=null?i:void 0};for(const m in d){const _=d[m];_!==void 0&&c.append(m,String(_))}}return{formData:c,warnings:u}}async doGenerate(e){var t,n,r,s,a,o;const i=(r=(n=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:n.call(t))!=null?r:new Date,{formData:u,warnings:l}=this.getArgs(e),{value:c,responseHeaders:f,rawValue:d}=await Ua({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),formData:u,failedResponseHandler:We,successfulResponseHandler:we(ef),abortSignal:e.abortSignal,fetch:this.config.fetch}),m=c.language!=null&&c.language in $s?$s[c.language]:void 0;return{text:c.text,segments:(a=(s=c.words)==null?void 0:s.map(_=>({text:_.word,startSecond:_.start,endSecond:_.end})))!=null?a:[],language:m,durationInSeconds:(o=c.duration)!=null?o:void 0,warnings:l,response:{timestamp:i,modelId:this.modelId,headers:f,body:d}}}},ef=h({text:p(),language:p().nullish(),duration:w().nullish(),words:O(h({word:p(),start:w(),end:w()})).nullish()});function tf({prompt:e,systemMessageMode:t}){const n=[],r=[];for(const{role:s,content:a}of e)switch(s){case"system":{switch(t){case"system":{n.push({role:"system",content:a});break}case"developer":{n.push({role:"developer",content:a});break}case"remove":{r.push({type:"other",message:"system messages are removed for this model"});break}default:{const o=t;throw new Error(`Unsupported system message mode: ${o}`)}}break}case"user":{n.push({role:"user",content:a.map((o,i)=>{var u,l,c,f;switch(o.type){case"text":return{type:"input_text",text:o.text};case"image":return{type:"input_image",image_url:o.image instanceof URL?o.image.toString():`data:${(u=o.mimeType)!=null?u:"image/jpeg"};base64,${Ge(o.image)}`,detail:(c=(l=o.providerMetadata)==null?void 0:l.openai)==null?void 0:c.imageDetail};case"file":{if(o.data instanceof URL)throw new G({functionality:"File URLs in user messages"});switch(o.mimeType){case"application/pdf":return{type:"input_file",filename:(f=o.filename)!=null?f:`part-${i}.pdf`,file_data:`data:application/pdf;base64,${o.data}`};default:throw new G({functionality:"Only PDF files are supported in user messages"})}}}})});break}case"assistant":{for(const o of a)switch(o.type){case"text":{n.push({role:"assistant",content:[{type:"output_text",text:o.text}]});break}case"tool-call":{n.push({type:"function_call",call_id:o.toolCallId,name:o.toolName,arguments:JSON.stringify(o.args)});break}}break}case"tool":{for(const o of a)n.push({type:"function_call_output",call_id:o.toolCallId,output:JSON.stringify(o.result)});break}default:{const o=s;throw new Error(`Unsupported role: ${o}`)}}return{messages:n,warnings:r}}function qs({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}function nf({mode:e,strict:t}){var n;const r=(n=e.tools)!=null&&n.length?e.tools:void 0,s=[];if(r==null)return{tools:void 0,tool_choice:void 0,toolWarnings:s};const a=e.toolChoice,o=[];for(const u of r)switch(u.type){case"function":o.push({type:"function",name:u.name,description:u.description,parameters:u.parameters,strict:t?!0:void 0});break;case"provider-defined":switch(u.id){case"openai.web_search_preview":o.push({type:"web_search_preview",search_context_size:u.args.searchContextSize,user_location:u.args.userLocation});break;default:s.push({type:"unsupported-tool",tool:u});break}break;default:s.push({type:"unsupported-tool",tool:u});break}if(a==null)return{tools:o,tool_choice:void 0,toolWarnings:s};const i=a.type;switch(i){case"auto":case"none":case"required":return{tools:o,tool_choice:i,toolWarnings:s};case"tool":return a.toolName==="web_search_preview"?{tools:o,tool_choice:{type:"web_search_preview"},toolWarnings:s}:{tools:o,tool_choice:{type:"function",name:a.toolName},toolWarnings:s};default:{const u=i;throw new G({functionality:`Unsupported tool choice type: ${u}`})}}}var rf=class{constructor(e,t){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}getArgs({mode:e,maxTokens:t,temperature:n,stopSequences:r,topP:s,topK:a,presencePenalty:o,frequencyPenalty:i,seed:u,prompt:l,providerMetadata:c,responseFormat:f}){var d,m,_;const g=[],y=kf(this.modelId),v=e.type;a!=null&&g.push({type:"unsupported-setting",setting:"topK"}),u!=null&&g.push({type:"unsupported-setting",setting:"seed"}),o!=null&&g.push({type:"unsupported-setting",setting:"presencePenalty"}),i!=null&&g.push({type:"unsupported-setting",setting:"frequencyPenalty"}),r!=null&&g.push({type:"unsupported-setting",setting:"stopSequences"});const{messages:x,warnings:A}=tf({prompt:l,systemMessageMode:y.systemMessageMode});g.push(...A);const b=Ct({provider:"openai",providerOptions:c,schema:Sf}),T=(d=b==null?void 0:b.strictSchemas)!=null?d:!0,k={model:this.modelId,input:x,temperature:n,top_p:s,max_output_tokens:t,...(f==null?void 0:f.type)==="json"&&{text:{format:f.schema!=null?{type:"json_schema",strict:T,name:(m=f.name)!=null?m:"response",description:f.description,schema:f.schema}:{type:"json_object"}}},metadata:b==null?void 0:b.metadata,parallel_tool_calls:b==null?void 0:b.parallelToolCalls,previous_response_id:b==null?void 0:b.previousResponseId,store:b==null?void 0:b.store,user:b==null?void 0:b.user,instructions:b==null?void 0:b.instructions,...y.isReasoningModel&&((b==null?void 0:b.reasoningEffort)!=null||(b==null?void 0:b.reasoningSummary)!=null)&&{reasoning:{...(b==null?void 0:b.reasoningEffort)!=null&&{effort:b.reasoningEffort},...(b==null?void 0:b.reasoningSummary)!=null&&{summary:b.reasoningSummary}}},...y.requiredAutoTruncation&&{truncation:"auto"}};switch(y.isReasoningModel&&(k.temperature!=null&&(k.temperature=void 0,g.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),k.top_p!=null&&(k.top_p=void 0,g.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),v){case"regular":{const{tools:M,tool_choice:R,toolWarnings:D}=nf({mode:e,strict:T});return{args:{...k,tools:M,tool_choice:R},warnings:[...g,...D]}}case"object-json":return{args:{...k,text:{format:e.schema!=null?{type:"json_schema",strict:T,name:(_=e.name)!=null?_:"response",description:e.description,schema:e.schema}:{type:"json_object"}}},warnings:g};case"object-tool":return{args:{...k,tool_choice:{type:"function",name:e.tool.name},tools:[{type:"function",name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:T}]},warnings:g};default:{const M=v;throw new Error(`Unsupported type: ${M}`)}}}async doGenerate(e){var t,n,r,s,a,o,i;const{args:u,warnings:l}=this.getArgs(e),c=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:f,value:d,rawValue:m}=await se({url:c,headers:re(this.config.headers(),e.headers),body:u,failedResponseHandler:We,successfulResponseHandler:we(h({id:p(),created_at:w(),error:h({message:p(),code:p()}).nullish(),model:p(),output:O(st("type",[h({type:N("message"),role:N("assistant"),content:O(h({type:N("output_text"),text:p(),annotations:O(h({type:N("url_citation"),start_index:w(),end_index:w(),url:p(),title:p()}))}))}),h({type:N("function_call"),call_id:p(),name:p(),arguments:p()}),h({type:N("web_search_call")}),h({type:N("computer_call")}),h({type:N("reasoning"),summary:O(h({type:N("summary_text"),text:p()}))})])),incomplete_details:h({reason:p()}).nullable(),usage:yi})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(d.error)throw new Ae({message:d.error.message,url:c,requestBodyValues:u,statusCode:400,responseHeaders:f,responseBody:m,isRetryable:!1});const _=d.output.filter(v=>v.type==="message").flatMap(v=>v.content).filter(v=>v.type==="output_text"),g=d.output.filter(v=>v.type==="function_call").map(v=>({toolCallType:"function",toolCallId:v.call_id,toolName:v.name,args:v.arguments})),y=(n=(t=d.output.find(v=>v.type==="reasoning"))==null?void 0:t.summary)!=null?n:null;return{text:_.map(v=>v.text).join(`
`),sources:_.flatMap(v=>v.annotations.map(x=>{var A,b,T;return{sourceType:"url",id:(T=(b=(A=this.config).generateId)==null?void 0:b.call(A))!=null?T:Se(),url:x.url,title:x.title}})),finishReason:qs({finishReason:(r=d.incomplete_details)==null?void 0:r.reason,hasToolCalls:g.length>0}),toolCalls:g.length>0?g:void 0,reasoning:y?y.map(v=>({type:"text",text:v.text})):void 0,usage:{promptTokens:d.usage.input_tokens,completionTokens:d.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:f,body:m},request:{body:JSON.stringify(u)},response:{id:d.id,timestamp:new Date(d.created_at*1e3),modelId:d.model},providerMetadata:{openai:{responseId:d.id,cachedPromptTokens:(a=(s=d.usage.input_tokens_details)==null?void 0:s.cached_tokens)!=null?a:null,reasoningTokens:(i=(o=d.usage.output_tokens_details)==null?void 0:o.reasoning_tokens)!=null?i:null}},warnings:l}}async doStream(e){const{args:t,warnings:n}=this.getArgs(e),{responseHeaders:r,value:s}=await se({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:We,successfulResponseHandler:It(hf),abortSignal:e.abortSignal,fetch:this.config.fetch}),a=this;let o="unknown",i=NaN,u=NaN,l=null,c=null,f=null;const d={};let m=!1;return{stream:s.pipeThrough(new TransformStream({transform(_,g){var y,v,x,A,b,T,k,M;if(!_.success){o="error",g.enqueue({type:"error",error:_.error});return}const R=_.value;if(bf(R))R.item.type==="function_call"&&(d[R.output_index]={toolName:R.item.name,toolCallId:R.item.call_id},g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:R.item.call_id,toolName:R.item.name,argsTextDelta:R.item.arguments}));else if(_f(R)){const D=d[R.output_index];D!=null&&g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:D.toolCallId,toolName:D.toolName,argsTextDelta:R.delta})}else vf(R)?(f=R.response.id,g.enqueue({type:"response-metadata",id:R.response.id,timestamp:new Date(R.response.created_at*1e3),modelId:R.response.model})):mf(R)?g.enqueue({type:"text-delta",textDelta:R.delta}):xf(R)?g.enqueue({type:"reasoning",textDelta:R.delta}):gf(R)&&R.item.type==="function_call"?(d[R.output_index]=void 0,m=!0,g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:R.item.call_id,toolName:R.item.name,args:R.item.arguments})):yf(R)?(o=qs({finishReason:(y=R.response.incomplete_details)==null?void 0:y.reason,hasToolCalls:m}),i=R.response.usage.input_tokens,u=R.response.usage.output_tokens,l=(x=(v=R.response.usage.input_tokens_details)==null?void 0:v.cached_tokens)!=null?x:l,c=(b=(A=R.response.usage.output_tokens_details)==null?void 0:A.reasoning_tokens)!=null?b:c):wf(R)?g.enqueue({type:"source",source:{sourceType:"url",id:(M=(k=(T=a.config).generateId)==null?void 0:k.call(T))!=null?M:Se(),url:R.annotation.url,title:R.annotation.title}}):Tf(R)&&g.enqueue({type:"error",error:R})},flush(_){_.enqueue({type:"finish",finishReason:o,usage:{promptTokens:i,completionTokens:u},...(l!=null||c!=null)&&{providerMetadata:{openai:{responseId:f,cachedPromptTokens:l,reasoningTokens:c}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:r},request:{body:JSON.stringify(t)},warnings:n}}},yi=h({input_tokens:w(),input_tokens_details:h({cached_tokens:w().nullish()}).nullish(),output_tokens:w(),output_tokens_details:h({reasoning_tokens:w().nullish()}).nullish()}),sf=h({type:N("response.output_text.delta"),delta:p()}),af=h({type:Fe(["response.completed","response.incomplete"]),response:h({incomplete_details:h({reason:p()}).nullish(),usage:yi})}),of=h({type:N("response.created"),response:h({id:p(),created_at:w(),model:p()})}),lf=h({type:N("response.output_item.done"),output_index:w(),item:st("type",[h({type:N("message")}),h({type:N("function_call"),id:p(),call_id:p(),name:p(),arguments:p(),status:N("completed")})])}),uf=h({type:N("response.function_call_arguments.delta"),item_id:p(),output_index:w(),delta:p()}),cf=h({type:N("response.output_item.added"),output_index:w(),item:st("type",[h({type:N("message")}),h({type:N("function_call"),id:p(),call_id:p(),name:p(),arguments:p()})])}),df=h({type:N("response.output_text.annotation.added"),annotation:h({type:N("url_citation"),url:p(),title:p()})}),pf=h({type:N("response.reasoning_summary_text.delta"),item_id:p(),output_index:w(),summary_index:w(),delta:p()}),ff=h({type:N("error"),code:p(),message:p(),param:p().nullish(),sequence_number:w()}),hf=X([sf,af,of,lf,uf,cf,df,pf,ff,h({type:p()}).passthrough()]);function mf(e){return e.type==="response.output_text.delta"}function gf(e){return e.type==="response.output_item.done"}function yf(e){return e.type==="response.completed"||e.type==="response.incomplete"}function vf(e){return e.type==="response.created"}function _f(e){return e.type==="response.function_call_arguments.delta"}function bf(e){return e.type==="response.output_item.added"}function wf(e){return e.type==="response.output_text.annotation.added"}function xf(e){return e.type==="response.reasoning_summary_text.delta"}function Tf(e){return e.type==="error"}function kf(e){return e.startsWith("o")||e.startsWith("gpt-5")?e.startsWith("o1-mini")||e.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1}:{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1}}var Sf=h({metadata:Qn().nullish(),parallelToolCalls:_e().nullish(),previousResponseId:p().nullish(),store:_e().nullish(),user:p().nullish(),reasoningEffort:p().nullish(),strictSchemas:_e().nullish(),instructions:p().nullish(),reasoningSummary:p().nullish()}),Cf=h({});function If({searchContextSize:e,userLocation:t}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:e,userLocation:t},parameters:Cf}}var Rf={webSearchPreview:If},Af=h({instructions:p().nullish(),speed:w().min(.25).max(4).default(1).nullish()}),Nf=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({text:e,voice:t="alloy",outputFormat:n="mp3",speed:r,instructions:s,providerOptions:a}){const o=[],i=Ct({provider:"openai",providerOptions:a,schema:Af}),u={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:r,instructions:s};if(n&&(["mp3","opus","aac","flac","wav","pcm"].includes(n)?u.response_format=n:o.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${n}. Using mp3 instead.`})),i){const l={};for(const c in l){const f=l[c];f!==void 0&&(u[c]=f)}}return{requestBody:u,warnings:o}}async doGenerate(e){var t,n,r;const s=(r=(n=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:n.call(t))!=null?r:new Date,{requestBody:a,warnings:o}=this.getArgs(e),{value:i,responseHeaders:u,rawValue:l}=await se({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),body:a,failedResponseHandler:We,successfulResponseHandler:cl(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:i,warnings:o,request:{body:JSON.stringify(a)},response:{timestamp:s,modelId:this.modelId,headers:u,body:l}}}};function vi(e={}){var t,n,r;const s=(t=Ht(e.baseURL))!=null?t:"https://api.openai.com/v1",a=(n=e.compatibility)!=null?n:"compatible",o=(r=e.name)!=null?r:"openai",i=()=>({Authorization:`Bearer ${vn({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),u=(v,x={})=>new jp(v,x,{provider:`${o}.chat`,url:({path:A})=>`${s}${A}`,headers:i,compatibility:a,fetch:e.fetch}),l=(v,x={})=>new Vp(v,x,{provider:`${o}.completion`,url:({path:A})=>`${s}${A}`,headers:i,compatibility:a,fetch:e.fetch}),c=(v,x={})=>new Hp(v,x,{provider:`${o}.embedding`,url:({path:A})=>`${s}${A}`,headers:i,fetch:e.fetch}),f=(v,x={})=>new Yp(v,x,{provider:`${o}.image`,url:({path:A})=>`${s}${A}`,headers:i,fetch:e.fetch}),d=v=>new Qp(v,{provider:`${o}.transcription`,url:({path:x})=>`${s}${x}`,headers:i,fetch:e.fetch}),m=v=>new Nf(v,{provider:`${o}.speech`,url:({path:x})=>`${s}${x}`,headers:i,fetch:e.fetch}),_=(v,x)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return v==="gpt-3.5-turbo-instruct"?l(v,x):u(v,x)},g=v=>new rf(v,{provider:`${o}.responses`,url:({path:x})=>`${s}${x}`,headers:i,fetch:e.fetch}),y=function(v,x){return _(v,x)};return y.languageModel=_,y.chat=u,y.completion=l,y.responses=g,y.embedding=c,y.textEmbedding=c,y.textEmbeddingModel=c,y.image=f,y.imageModel=f,y.transcription=d,y.transcriptionModel=d,y.speech=m,y.speechModel=m,y.tools=Rf,y}vi({compatibility:"strict"});function Pe(e){if(Ef(e))return;if(typeof e=="boolean")return{type:"boolean",properties:{}};const{type:t,description:n,required:r,properties:s,items:a,allOf:o,anyOf:i,oneOf:u,format:l,const:c,minLength:f,enum:d}=e,m={};if(n&&(m.description=n),r&&(m.required=r),l&&(m.format=l),c!==void 0&&(m.enum=[c]),t&&(Array.isArray(t)?t.includes("null")?(m.type=t.filter(_=>_!=="null")[0],m.nullable=!0):m.type=t:t==="null"?m.type="null":m.type=t),d!==void 0&&(m.enum=d),s!=null&&(m.properties=Object.entries(s).reduce((_,[g,y])=>(_[g]=Pe(y),_),{})),a&&(m.items=Array.isArray(a)?a.map(Pe):Pe(a)),o&&(m.allOf=o.map(Pe)),i)if(i.some(_=>typeof _=="object"&&(_==null?void 0:_.type)==="null")){const _=i.filter(g=>!(typeof g=="object"&&(g==null?void 0:g.type)==="null"));if(_.length===1){const g=Pe(_[0]);typeof g=="object"&&(m.nullable=!0,Object.assign(m,g))}else m.anyOf=_.map(Pe),m.nullable=!0}else m.anyOf=i.map(Pe);return u&&(m.oneOf=u.map(Pe)),f!==void 0&&(m.minLength=f),m}function Ef(e){return e!=null&&typeof e=="object"&&e.type==="object"&&(e.properties==null||Object.keys(e.properties).length===0)&&!e.additionalProperties}function Of(e){var t,n;const r=[],s=[];let a=!0;for(const{role:o,content:i}of e)switch(o){case"system":{if(!a)throw new G({functionality:"system messages are only supported at the beginning of the conversation"});r.push({text:i});break}case"user":{a=!1;const u=[];for(const l of i)switch(l.type){case"text":{u.push({text:l.text});break}case"image":{u.push(l.image instanceof URL?{fileData:{mimeType:(t=l.mimeType)!=null?t:"image/jpeg",fileUri:l.image.toString()}}:{inlineData:{mimeType:(n=l.mimeType)!=null?n:"image/jpeg",data:Ge(l.image)}});break}case"file":{u.push(l.data instanceof URL?{fileData:{mimeType:l.mimeType,fileUri:l.data.toString()}}:{inlineData:{mimeType:l.mimeType,data:l.data}});break}}s.push({role:"user",parts:u});break}case"assistant":{a=!1,s.push({role:"model",parts:i.map(u=>{switch(u.type){case"text":return u.text.length===0?void 0:{text:u.text};case"file":{if(u.mimeType!=="image/png")throw new G({functionality:"Only PNG images are supported in assistant messages"});if(u.data instanceof URL)throw new G({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:u.mimeType,data:u.data}}}case"tool-call":return{functionCall:{name:u.toolName,args:u.args}}}}).filter(u=>u!==void 0)});break}case"tool":{a=!1,s.push({role:"user",parts:i.map(u=>({functionResponse:{name:u.toolName,response:{name:u.toolName,content:u.result}}}))});break}}return{systemInstruction:r.length>0?{parts:r}:void 0,contents:s}}function Ls(e){return e.includes("/")?e:`models/${e}`}var Pf=h({error:h({code:w().nullable(),message:p(),status:p()})}),Or=Jt({errorSchema:Pf,errorToMessage:e=>e.error.message});function Mf(e,t,n,r){var s,a;const o=(s=e.tools)!=null&&s.length?e.tools:void 0,i=[],u=r.includes("gemini-2"),l=r.includes("gemini-1.5-flash")&&!r.includes("-8b");if(t)return{tools:u?{googleSearch:{}}:{googleSearchRetrieval:!l||!n?{}:{dynamicRetrievalConfig:n}},toolConfig:void 0,toolWarnings:i};if(o==null)return{tools:void 0,toolConfig:void 0,toolWarnings:i};const c=[];for(const m of o)m.type==="provider-defined"?i.push({type:"unsupported-tool",tool:m}):c.push({name:m.name,description:(a=m.description)!=null?a:"",parameters:Pe(m.parameters)});const f=e.toolChoice;if(f==null)return{tools:{functionDeclarations:c},toolConfig:void 0,toolWarnings:i};const d=f.type;switch(d){case"auto":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:i};case"none":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:i};case"required":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:i};case"tool":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[f.toolName]}},toolWarnings:i};default:{const m=d;throw new G({functionality:`Unsupported tool choice type: ${m}`})}}}function Us({finishReason:e,hasToolCalls:t}){switch(e){case"STOP":return t?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";case"MALFORMED_FUNCTION_CALL":return"error";default:return"unknown"}}var Df=class{constructor(e,t,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=n}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:!0}get provider(){return this.config.provider}async getArgs({mode:e,prompt:t,maxTokens:n,temperature:r,topP:s,topK:a,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,providerMetadata:f}){var d,m,_;const g=e.type,y=[],v=Ct({provider:"google",providerOptions:f,schema:Lf});((d=v==null?void 0:v.thinkingConfig)==null?void 0:d.includeThoughts)===!0&&!this.config.provider.startsWith("google.vertex.")&&y.push({type:"other",message:`The 'includeThoughts' option is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});const x={maxOutputTokens:n,temperature:r,topK:a,topP:s,frequencyPenalty:o,presencePenalty:i,stopSequences:u,seed:c,responseMimeType:(l==null?void 0:l.type)==="json"?"application/json":void 0,responseSchema:(l==null?void 0:l.type)==="json"&&l.schema!=null&&this.supportsStructuredOutputs?Pe(l.schema):void 0,...this.settings.audioTimestamp&&{audioTimestamp:this.settings.audioTimestamp},responseModalities:v==null?void 0:v.responseModalities,thinkingConfig:v==null?void 0:v.thinkingConfig},{contents:A,systemInstruction:b}=Of(t);switch(g){case"regular":{const{tools:T,toolConfig:k,toolWarnings:M}=Mf(e,(m=this.settings.useSearchGrounding)!=null?m:!1,this.settings.dynamicRetrievalConfig,this.modelId);return{args:{generationConfig:x,contents:A,systemInstruction:b,safetySettings:this.settings.safetySettings,tools:T,toolConfig:k,cachedContent:this.settings.cachedContent},warnings:[...y,...M]}}case"object-json":return{args:{generationConfig:{...x,responseMimeType:"application/json",responseSchema:e.schema!=null&&this.supportsStructuredOutputs?Pe(e.schema):void 0},contents:A,systemInstruction:b,safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:y};case"object-tool":return{args:{generationConfig:x,contents:A,systemInstruction:b,tools:{functionDeclarations:[{name:e.tool.name,description:(_=e.tool.description)!=null?_:"",parameters:Pe(e.tool.parameters)}]},toolConfig:{functionCallingConfig:{mode:"ANY"}},safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:y};default:{const T=g;throw new Error(`Unsupported type: ${T}`)}}}supportsUrl(e){return this.config.isSupportedUrl(e)}async doGenerate(e){var t,n,r,s,a;const{args:o,warnings:i}=await this.getArgs(e),u=JSON.stringify(o),l=re(await En(this.config.headers),e.headers),{responseHeaders:c,value:f,rawValue:d}=await se({url:`${this.config.baseURL}/${Ls(this.modelId)}:generateContent`,headers:l,body:o,failedResponseHandler:Or,successfulResponseHandler:we($f),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:m,..._}=o,g=f.candidates[0],y=g.content==null||typeof g.content!="object"||!("parts"in g.content)?[]:g.content.parts,v=Fs({parts:y,generateId:this.config.generateId}),x=f.usageMetadata;return{text:Zs(y),reasoning:Vs(y),files:(t=Bs(y))==null?void 0:t.map(A=>({data:A.inlineData.data,mimeType:A.inlineData.mimeType})),toolCalls:v,finishReason:Us({finishReason:g.finishReason,hasToolCalls:v!=null&&v.length>0}),usage:{promptTokens:(n=x==null?void 0:x.promptTokenCount)!=null?n:NaN,completionTokens:(r=x==null?void 0:x.candidatesTokenCount)!=null?r:NaN},rawCall:{rawPrompt:m,rawSettings:_},rawResponse:{headers:c,body:d},warnings:i,providerMetadata:{google:{groundingMetadata:(s=g.groundingMetadata)!=null?s:null,safetyRatings:(a=g.safetyRatings)!=null?a:null}},sources:Js({groundingMetadata:g.groundingMetadata,generateId:this.config.generateId}),request:{body:u}}}async doStream(e){const{args:t,warnings:n}=await this.getArgs(e),r=JSON.stringify(t),s=re(await En(this.config.headers),e.headers),{responseHeaders:a,value:o}=await se({url:`${this.config.baseURL}/${Ls(this.modelId)}:streamGenerateContent?alt=sse`,headers:s,body:t,failedResponseHandler:Or,successfulResponseHandler:It(qf),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:i,...u}=t;let l="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},f;const d=this.config.generateId;let m=!1;return{stream:o.pipeThrough(new TransformStream({transform(_,g){var y,v,x,A,b,T;if(!_.success){g.enqueue({type:"error",error:_.error});return}const k=_.value,M=k.usageMetadata;M!=null&&(c={promptTokens:(y=M.promptTokenCount)!=null?y:NaN,completionTokens:(v=M.candidatesTokenCount)!=null?v:NaN});const R=(x=k.candidates)==null?void 0:x[0];if(R==null)return;const D=R.content;if(D!=null){const Y=Zs(D.parts);Y!=null&&g.enqueue({type:"text-delta",textDelta:Y});const oe=Vs(D.parts);if(oe!=null)for(const Z of oe)g.enqueue({type:"reasoning",textDelta:Z.text});const ue=Bs(D.parts);if(ue!=null)for(const Z of ue)g.enqueue({type:"file",mimeType:Z.inlineData.mimeType,data:Z.inlineData.data});const Q=Fs({parts:D.parts,generateId:d});if(Q!=null)for(const Z of Q)g.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:Z.toolCallId,toolName:Z.toolName,argsTextDelta:Z.args}),g.enqueue({type:"tool-call",toolCallType:"function",toolCallId:Z.toolCallId,toolName:Z.toolName,args:Z.args}),m=!0}if(R.finishReason!=null){l=Us({finishReason:R.finishReason,hasToolCalls:m});const Y=(A=Js({groundingMetadata:R.groundingMetadata,generateId:d}))!=null?A:[];for(const oe of Y)g.enqueue({type:"source",source:oe});f={google:{groundingMetadata:(b=R.groundingMetadata)!=null?b:null,safetyRatings:(T=R.safetyRatings)!=null?T:null}}}},flush(_){_.enqueue({type:"finish",finishReason:l,usage:c,providerMetadata:f})}})),rawCall:{rawPrompt:i,rawSettings:u},rawResponse:{headers:a},warnings:n,request:{body:r}}}};function Fs({parts:e,generateId:t}){const n=e==null?void 0:e.filter(r=>"functionCall"in r);return n==null||n.length===0?void 0:n.map(r=>({toolCallType:"function",toolCallId:t(),toolName:r.functionCall.name,args:JSON.stringify(r.functionCall.args)}))}function Zs(e){const t=e==null?void 0:e.filter(n=>"text"in n&&n.thought!==!0);return t==null||t.length===0?void 0:t.map(n=>n.text).join("")}function Vs(e){const t=e==null?void 0:e.filter(n=>"text"in n&&n.thought===!0&&n.text!=null);return t==null||t.length===0?void 0:t.map(n=>({type:"text",text:n.text}))}function Bs(e){return e==null?void 0:e.filter(t=>"inlineData"in t)}function Js({groundingMetadata:e,generateId:t}){var n;return(n=e==null?void 0:e.groundingChunks)==null?void 0:n.filter(r=>r.web!=null).map(r=>({sourceType:"url",id:t(),url:r.web.uri,title:r.web.title}))}var _i=h({parts:O(X([h({functionCall:h({name:p(),args:Gt()})}),h({inlineData:h({mimeType:p(),data:p()})}),h({text:p().nullish(),thought:_e().nullish()})])).nullish()}),jf=h({web:h({uri:p(),title:p()}).nullish(),retrievedContext:h({uri:p(),title:p()}).nullish()}),bi=h({webSearchQueries:O(p()).nullish(),retrievalQueries:O(p()).nullish(),searchEntryPoint:h({renderedContent:p()}).nullish(),groundingChunks:O(jf).nullish(),groundingSupports:O(h({segment:h({startIndex:w().nullish(),endIndex:w().nullish(),text:p().nullish()}),segment_text:p().nullish(),groundingChunkIndices:O(w()).nullish(),supportChunkIndices:O(w()).nullish(),confidenceScores:O(w()).nullish(),confidenceScore:O(w()).nullish()})).nullish(),retrievalMetadata:X([h({webDynamicRetrievalScore:w()}),h({})]).nullish()}),wi=h({category:p().nullish(),probability:p().nullish(),probabilityScore:w().nullish(),severity:p().nullish(),severityScore:w().nullish(),blocked:_e().nullish()}),$f=h({candidates:O(h({content:_i.nullish().or(h({}).strict()),finishReason:p().nullish(),safetyRatings:O(wi).nullish(),groundingMetadata:bi.nullish()})),usageMetadata:h({promptTokenCount:w().nullish(),candidatesTokenCount:w().nullish(),totalTokenCount:w().nullish()}).nullish()}),qf=h({candidates:O(h({content:_i.nullish(),finishReason:p().nullish(),safetyRatings:O(wi).nullish(),groundingMetadata:bi.nullish()})).nullish(),usageMetadata:h({promptTokenCount:w().nullish(),candidatesTokenCount:w().nullish(),totalTokenCount:w().nullish()}).nullish()}),Lf=h({responseModalities:O(Fe(["TEXT","IMAGE"])).nullish(),thinkingConfig:h({thinkingBudget:w().nullish(),includeThoughts:_e().nullish()}).nullish()}),Uf=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){return 2048}get supportsParallelCalls(){return!0}async doEmbed({values:e,headers:t,abortSignal:n}){if(e.length>this.maxEmbeddingsPerCall)throw new Xn({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const r=re(await En(this.config.headers),t),{responseHeaders:s,value:a}=await se({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:r,body:{requests:e.map(o=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:o}]},outputDimensionality:this.settings.outputDimensionality,taskType:this.settings.taskType}))},failedResponseHandler:Or,successfulResponseHandler:we(Ff),abortSignal:n,fetch:this.config.fetch});return{embeddings:a.embeddings.map(o=>o.values),usage:void 0,rawResponse:{headers:s}}}},Ff=h({embeddings:O(h({values:O(w())}))});function Zf(e){return e.toString().startsWith("https://generativelanguage.googleapis.com/v1beta/files/")}function xi(e={}){var t;const n=(t=Ht(e.baseURL))!=null?t:"https://generativelanguage.googleapis.com/v1beta",r=()=>({"x-goog-api-key":vn({apiKey:e.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...e.headers}),s=(i,u={})=>{var l;return new Df(i,u,{provider:"google.generative-ai",baseURL:n,headers:r,generateId:(l=e.generateId)!=null?l:Se,isSupportedUrl:Zf,fetch:e.fetch})},a=(i,u={})=>new Uf(i,u,{provider:"google.generative-ai",baseURL:n,headers:r,fetch:e.fetch}),o=function(i,u){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return s(i,u)};return o.languageModel=s,o.chat=s,o.generativeAI=s,o.embedding=a,o.textEmbedding=a,o.textEmbeddingModel=a,o}xi();function Vf(e){const t=[];for(const{role:n,content:r}of e)switch(n){case"system":{t.push({role:"system",content:r});break}case"user":{if(r.length===1&&r[0].type==="text"){t.push({role:"user",content:r[0].text});break}t.push({role:"user",content:r.map(s=>{var a;switch(s.type){case"text":return{type:"text",text:s.text};case"image":return{type:"image_url",image_url:{url:s.image instanceof URL?s.image.toString():`data:${(a=s.mimeType)!=null?a:"image/jpeg"};base64,${Ge(s.image)}`}};case"file":throw new G({functionality:"File content parts in user messages"})}})});break}case"assistant":{let s="";const a=[];for(const o of r)switch(o.type){case"text":{s+=o.text;break}case"tool-call":{a.push({id:o.toolCallId,type:"function",function:{name:o.toolName,arguments:JSON.stringify(o.args)}});break}}t.push({role:"assistant",content:s,tool_calls:a.length>0?a:void 0});break}case"tool":{for(const s of r)t.push({role:"tool",tool_call_id:s.toolCallId,content:JSON.stringify(s.result)});break}default:{const s=n;throw new Error(`Unsupported role: ${s}`)}}return t}function Hs({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}var Ti=h({error:h({message:p(),type:p()})}),Pr=Jt({errorSchema:Ti,errorToMessage:e=>e.error.message});function Bf({mode:e}){var t;const n=(t=e.tools)!=null&&t.length?e.tools:void 0,r=[];if(n==null)return{tools:void 0,tool_choice:void 0,toolWarnings:r};const s=e.toolChoice,a=[];for(const i of n)i.type==="provider-defined"?r.push({type:"unsupported-tool",tool:i}):a.push({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}});if(s==null)return{tools:a,tool_choice:void 0,toolWarnings:r};const o=s.type;switch(o){case"auto":case"none":case"required":return{tools:a,tool_choice:o,toolWarnings:r};case"tool":return{tools:a,tool_choice:{type:"function",function:{name:s.toolName}},toolWarnings:r};default:{const i=o;throw new G({functionality:`Unsupported tool choice type: ${i}`})}}}function Gs(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Jf=class{constructor(e,t,n){this.specificationVersion="v1",this.supportsStructuredOutputs=!1,this.defaultObjectGenerationMode="json",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:n,temperature:r,topP:s,topK:a,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,stream:f,providerMetadata:d}){const m=e.type,_=[];a!=null&&_.push({type:"unsupported-setting",setting:"topK"}),l!=null&&l.type==="json"&&l.schema!=null&&_.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is not supported"});const g=Ct({provider:"groq",providerOptions:d,schema:h({reasoningFormat:Fe(["parsed","raw","hidden"]).nullish()})}),y={model:this.modelId,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:n,temperature:r,top_p:s,frequency_penalty:o,presence_penalty:i,stop:u,seed:c,response_format:f===!1&&(l==null?void 0:l.type)==="json"?{type:"json_object"}:void 0,reasoning_format:g==null?void 0:g.reasoningFormat,messages:Vf(t)};switch(m){case"regular":{const{tools:v,tool_choice:x,toolWarnings:A}=Bf({mode:e});return{args:{...y,tools:v,tool_choice:x},warnings:[..._,...A]}}case"object-json":return{args:{...y,response_format:f===!1?{type:"json_object"}:void 0},warnings:_};case"object-tool":return{args:{...y,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}}]},warnings:_};default:{const v=m;throw new Error(`Unsupported type: ${v}`)}}}async doGenerate(e){var t,n,r,s,a,o,i;const{args:u,warnings:l}=this.getArgs({...e,stream:!1}),c=JSON.stringify(u),{responseHeaders:f,value:d,rawValue:m}=await se({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),body:u,failedResponseHandler:Pr,successfulResponseHandler:we(Hf),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:_,...g}=u,y=d.choices[0];return{text:(t=y.message.content)!=null?t:void 0,reasoning:(n=y.message.reasoning)!=null?n:void 0,toolCalls:(r=y.message.tool_calls)==null?void 0:r.map(v=>{var x;return{toolCallType:"function",toolCallId:(x=v.id)!=null?x:Se(),toolName:v.function.name,args:v.function.arguments}}),finishReason:Gs(y.finish_reason),usage:{promptTokens:(a=(s=d.usage)==null?void 0:s.prompt_tokens)!=null?a:NaN,completionTokens:(i=(o=d.usage)==null?void 0:o.completion_tokens)!=null?i:NaN},rawCall:{rawPrompt:_,rawSettings:g},rawResponse:{headers:f,body:m},response:Hs(d),warnings:l,request:{body:c}}}async doStream(e){const{args:t,warnings:n}=this.getArgs({...e,stream:!0}),r=JSON.stringify({...t,stream:!0}),{responseHeaders:s,value:a}=await se({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:Pr,successfulResponseHandler:It(Gf),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=t,u=[];let l="unknown",c={promptTokens:void 0,completionTokens:void 0},f=!0;return{stream:a.pipeThrough(new TransformStream({transform(d,m){var _,g,y,v,x,A,b,T,k,M,R,D,Y,oe,ue;if(!d.success){l="error",m.enqueue({type:"error",error:d.error});return}const Q=d.value;if("error"in Q){l="error",m.enqueue({type:"error",error:Q.error});return}f&&(f=!1,m.enqueue({type:"response-metadata",...Hs(Q)})),((_=Q.x_groq)==null?void 0:_.usage)!=null&&(c={promptTokens:(g=Q.x_groq.usage.prompt_tokens)!=null?g:void 0,completionTokens:(y=Q.x_groq.usage.completion_tokens)!=null?y:void 0});const Z=Q.choices[0];if((Z==null?void 0:Z.finish_reason)!=null&&(l=Gs(Z.finish_reason)),(Z==null?void 0:Z.delta)==null)return;const ne=Z.delta;if(ne.reasoning!=null&&ne.reasoning.length>0&&m.enqueue({type:"reasoning",textDelta:ne.reasoning}),ne.content!=null&&ne.content.length>0&&m.enqueue({type:"text-delta",textDelta:ne.content}),ne.tool_calls!=null)for(const ee of ne.tool_calls){const de=ee.index;if(u[de]==null){if(ee.type!=="function")throw new jt({data:ee,message:"Expected 'function' type."});if(ee.id==null)throw new jt({data:ee,message:"Expected 'id' to be a string."});if(((v=ee.function)==null?void 0:v.name)==null)throw new jt({data:ee,message:"Expected 'function.name' to be a string."});u[de]={id:ee.id,type:"function",function:{name:ee.function.name,arguments:(x=ee.function.arguments)!=null?x:""},hasFinished:!1};const te=u[de];((A=te.function)==null?void 0:A.name)!=null&&((b=te.function)==null?void 0:b.arguments)!=null&&(te.function.arguments.length>0&&m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:te.id,toolName:te.function.name,argsTextDelta:te.function.arguments}),Nn(te.function.arguments)&&(m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(T=te.id)!=null?T:Se(),toolName:te.function.name,args:te.function.arguments}),te.hasFinished=!0));continue}const B=u[de];B.hasFinished||(((k=ee.function)==null?void 0:k.arguments)!=null&&(B.function.arguments+=(R=(M=ee.function)==null?void 0:M.arguments)!=null?R:""),m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:B.id,toolName:B.function.name,argsTextDelta:(D=ee.function.arguments)!=null?D:""}),((Y=B.function)==null?void 0:Y.name)!=null&&((oe=B.function)==null?void 0:oe.arguments)!=null&&Nn(B.function.arguments)&&(m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(ue=B.id)!=null?ue:Se(),toolName:B.function.name,args:B.function.arguments}),B.hasFinished=!0))}},flush(d){var m,_;d.enqueue({type:"finish",finishReason:l,usage:{promptTokens:(m=c.promptTokens)!=null?m:NaN,completionTokens:(_=c.completionTokens)!=null?_:NaN}})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:s},warnings:n,request:{body:r}}}},Hf=h({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(h({message:h({content:p().nullish(),reasoning:p().nullish(),tool_calls:O(h({id:p().nullish(),type:N("function"),function:h({name:p(),arguments:p()})})).nullish()}),index:w(),finish_reason:p().nullish()})),usage:h({prompt_tokens:w().nullish(),completion_tokens:w().nullish()}).nullish()}),Gf=X([h({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(h({delta:h({content:p().nullish(),reasoning:p().nullish(),tool_calls:O(h({index:w(),id:p().nullish(),type:N("function").optional(),function:h({name:p().nullish(),arguments:p().nullish()})})).nullish()}).nullish(),finish_reason:p().nullable().optional(),index:w()})),x_groq:h({usage:h({prompt_tokens:w().nullish(),completion_tokens:w().nullish()}).nullish()}).nullish()}),Ti]),zf=h({language:p().nullish(),prompt:p().nullish(),responseFormat:p().nullish(),temperature:w().min(0).max(1).nullish(),timestampGranularities:O(p()).nullish()}),Wf=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:n}){var r,s,a,o,i;const u=[],l=Ct({provider:"groq",providerOptions:n,schema:zf}),c=new FormData,f=e instanceof Uint8Array?new Blob([e]):new Blob([_n(e)]);if(c.append("model",this.modelId),c.append("file",new File([f],"audio",{type:t})),l){const d={language:(r=l.language)!=null?r:void 0,prompt:(s=l.prompt)!=null?s:void 0,response_format:(a=l.responseFormat)!=null?a:void 0,temperature:(o=l.temperature)!=null?o:void 0,timestamp_granularities:(i=l.timestampGranularities)!=null?i:void 0};for(const m in d){const _=d[m];_!==void 0&&c.append(m,String(_))}}return{formData:c,warnings:u}}async doGenerate(e){var t,n,r,s,a;const o=(r=(n=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:n.call(t))!=null?r:new Date,{formData:i,warnings:u}=this.getArgs(e),{value:l,responseHeaders:c,rawValue:f}=await Ua({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:re(this.config.headers(),e.headers),formData:i,failedResponseHandler:Pr,successfulResponseHandler:we(Yf),abortSignal:e.abortSignal,fetch:this.config.fetch});return{text:l.text,segments:(a=(s=l.segments)==null?void 0:s.map(d=>({text:d.text,startSecond:d.start,endSecond:d.end})))!=null?a:[],language:l.language,durationInSeconds:l.duration,warnings:u,response:{timestamp:o,modelId:this.modelId,headers:c,body:f}}}},Yf=h({task:p(),language:p(),duration:w(),text:p(),segments:O(h({id:w(),seek:w(),start:w(),end:w(),text:p(),tokens:O(w()),temperature:w(),avg_logprob:w(),compression_ratio:w(),no_speech_prob:w()})),x_groq:h({id:p()})});function ki(e={}){var t;const n=(t=Ht(e.baseURL))!=null?t:"https://api.groq.com/openai/v1",r=()=>({Authorization:`Bearer ${vn({apiKey:e.apiKey,environmentVariableName:"GROQ_API_KEY",description:"Groq"})}`,...e.headers}),s=(u,l={})=>new Jf(u,l,{provider:"groq.chat",url:({path:c})=>`${n}${c}`,headers:r,fetch:e.fetch}),a=(u,l)=>{if(new.target)throw new Error("The Groq model function cannot be called with the new keyword.");return s(u,l)},o=u=>new Wf(u,{provider:"groq.transcription",url:({path:l})=>`${n}${l}`,headers:r,fetch:e.fetch}),i=function(u,l){return a(u,l)};return i.languageModel=a,i.chat=s,i.textEmbeddingModel=u=>{throw new Ra({modelId:u,modelType:"textEmbeddingModel"})},i.transcription=o,i}ki();function Kf(e){const t=[];for(let n=0;n<e.length;n++){const{role:r,content:s}=e[n],a=n===e.length-1;switch(r){case"system":{t.push({role:"system",content:s});break}case"user":{t.push({role:"user",content:s.map(o=>{var i;switch(o.type){case"text":return{type:"text",text:o.text};case"image":return{type:"image_url",image_url:o.image instanceof URL?o.image.toString():`data:${(i=o.mimeType)!=null?i:"image/jpeg"};base64,${Ge(o.image)}`};case"file":{if(!(o.data instanceof URL))throw new G({functionality:"File content parts in user messages"});switch(o.mimeType){case"application/pdf":return{type:"document_url",document_url:o.data.toString()};default:throw new G({functionality:"Only PDF files are supported in user messages"})}}}})});break}case"assistant":{let o="";const i=[];for(const u of s)switch(u.type){case"text":{o+=u.text;break}case"tool-call":{i.push({id:u.toolCallId,type:"function",function:{name:u.toolName,arguments:JSON.stringify(u.args)}});break}}t.push({role:"assistant",content:o,prefix:a?!0:void 0,tool_calls:i.length>0?i:void 0});break}case"tool":{for(const o of s)t.push({role:"tool",name:o.toolName,content:JSON.stringify(o.result),tool_call_id:o.toolCallId});break}default:{const o=r;throw new Error(`Unsupported role: ${o}`)}}}return t}function zs(e){switch(e){case"stop":return"stop";case"length":case"model_length":return"length";case"tool_calls":return"tool-calls";default:return"unknown"}}var Xf=h({object:N("error"),message:p(),type:p(),param:p().nullable(),code:p().nullable()}),Mr=Jt({errorSchema:Xf,errorToMessage:e=>e.message});function Ws({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function Qf(e){var t;const n=(t=e.tools)!=null&&t.length?e.tools:void 0,r=[];if(n==null)return{tools:void 0,tool_choice:void 0,toolWarnings:r};const s=[];for(const i of n)i.type==="provider-defined"?r.push({type:"unsupported-tool",tool:i}):s.push({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}});const a=e.toolChoice;if(a==null)return{tools:s,tool_choice:void 0,toolWarnings:r};const o=a.type;switch(o){case"auto":case"none":return{tools:s,tool_choice:o,toolWarnings:r};case"required":return{tools:s,tool_choice:"any",toolWarnings:r};case"tool":return{tools:s.filter(i=>i.function.name===a.toolName),tool_choice:"any",toolWarnings:r};default:{const i=o;throw new G({functionality:`Unsupported tool choice type: ${i}`})}}}var eh=class{constructor(e,t,n){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}supportsUrl(e){return e.protocol==="https:"}getArgs({mode:e,prompt:t,maxTokens:n,temperature:r,topP:s,topK:a,frequencyPenalty:o,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,providerMetadata:f}){var d,m;const _=e.type,g=[];a!=null&&g.push({type:"unsupported-setting",setting:"topK"}),o!=null&&g.push({type:"unsupported-setting",setting:"frequencyPenalty"}),i!=null&&g.push({type:"unsupported-setting",setting:"presencePenalty"}),u!=null&&g.push({type:"unsupported-setting",setting:"stopSequences"}),l!=null&&l.type==="json"&&l.schema!=null&&g.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is not supported"});const y={model:this.modelId,safe_prompt:this.settings.safePrompt,max_tokens:n,temperature:r,top_p:s,random_seed:c,response_format:(l==null?void 0:l.type)==="json"?{type:"json_object"}:void 0,document_image_limit:(d=f==null?void 0:f.mistral)==null?void 0:d.documentImageLimit,document_page_limit:(m=f==null?void 0:f.mistral)==null?void 0:m.documentPageLimit,messages:Kf(t)};switch(_){case"regular":{const{tools:v,tool_choice:x,toolWarnings:A}=Qf(e);return{args:{...y,tools:v,tool_choice:x},warnings:[...g,...A]}}case"object-json":return{args:{...y,response_format:{type:"json_object"}},warnings:g};case"object-tool":return{args:{...y,tool_choice:"any",tools:[{type:"function",function:e.tool}]},warnings:g};default:{const v=_;throw new Error(`Unsupported type: ${v}`)}}}async doGenerate(e){var t;const{args:n,warnings:r}=this.getArgs(e),{responseHeaders:s,value:a,rawValue:o}=await se({url:`${this.config.baseURL}/chat/completions`,headers:re(this.config.headers(),e.headers),body:n,failedResponseHandler:Mr,successfulResponseHandler:we(th),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:i,...u}=n,l=a.choices[0];let c=Ys(l.message.content);const f=i[i.length-1];return f.role==="assistant"&&(c!=null&&c.startsWith(f.content))&&(c=c.slice(f.content.length)),{text:c,toolCalls:(t=l.message.tool_calls)==null?void 0:t.map(d=>({toolCallType:"function",toolCallId:d.id,toolName:d.function.name,args:d.function.arguments})),finishReason:zs(l.finish_reason),usage:{promptTokens:a.usage.prompt_tokens,completionTokens:a.usage.completion_tokens},rawCall:{rawPrompt:i,rawSettings:u},rawResponse:{headers:s,body:o},request:{body:JSON.stringify(n)},response:Ws(a),warnings:r}}async doStream(e){const{args:t,warnings:n}=this.getArgs(e),r={...t,stream:!0},{responseHeaders:s,value:a}=await se({url:`${this.config.baseURL}/chat/completions`,headers:re(this.config.headers(),e.headers),body:r,failedResponseHandler:Mr,successfulResponseHandler:It(nh),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...i}=t;let u="unknown",l={promptTokens:Number.NaN,completionTokens:Number.NaN},c=0,f=!1;return{stream:a.pipeThrough(new TransformStream({transform(d,m){if(!d.success){m.enqueue({type:"error",error:d.error});return}c++;const _=d.value;c===1&&m.enqueue({type:"response-metadata",...Ws(_)}),_.usage!=null&&(l={promptTokens:_.usage.prompt_tokens,completionTokens:_.usage.completion_tokens});const g=_.choices[0];if((g==null?void 0:g.finish_reason)!=null&&(u=zs(g.finish_reason)),(g==null?void 0:g.delta)==null)return;const y=g.delta,v=Ys(y.content);if(c<=2){const x=o[o.length-1];if(x.role==="assistant"&&v===x.content.trimEnd()){v.length<x.content.length&&(f=!0);return}}if(v!=null&&(m.enqueue({type:"text-delta",textDelta:f?v.trimStart():v}),f=!1),y.tool_calls!=null)for(const x of y.tool_calls)m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:x.id,toolName:x.function.name,argsTextDelta:x.function.arguments}),m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:x.id,toolName:x.function.name,args:x.function.arguments})},flush(d){d.enqueue({type:"finish",finishReason:u,usage:l})}})),rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:s},request:{body:JSON.stringify(r)},warnings:n}}};function Ys(e){if(typeof e=="string")return e;if(e==null)return;const t=[];for(const n of e){const{type:r}=n;switch(r){case"text":t.push(n.text);break;case"image_url":case"reference":break;default:{const s=r;throw new Error(`Unsupported type: ${s}`)}}}return t.length?t.join(""):void 0}var Si=X([p(),O(st("type",[h({type:N("text"),text:p()}),h({type:N("image_url"),image_url:X([p(),h({url:p(),detail:p().nullable()})])}),h({type:N("reference"),reference_ids:O(w())})]))]).nullish(),th=h({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(h({message:h({role:N("assistant"),content:Si,tool_calls:O(h({id:p(),function:h({name:p(),arguments:p()})})).nullish()}),index:w(),finish_reason:p().nullish()})),object:N("chat.completion"),usage:h({prompt_tokens:w(),completion_tokens:w()})}),nh=h({id:p().nullish(),created:w().nullish(),model:p().nullish(),choices:O(h({delta:h({role:Fe(["assistant"]).optional(),content:Si,tool_calls:O(h({id:p(),function:h({name:p(),arguments:p()})})).nullish()}),finish_reason:p().nullish(),index:w()})),usage:h({prompt_tokens:w(),completion_tokens:w()}).nullish()}),rh=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:32}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)!=null?e:!1}async doEmbed({values:e,abortSignal:t,headers:n}){if(e.length>this.maxEmbeddingsPerCall)throw new Xn({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:r,value:s}=await se({url:`${this.config.baseURL}/embeddings`,headers:re(this.config.headers(),n),body:{model:this.modelId,input:e,encoding_format:"float"},failedResponseHandler:Mr,successfulResponseHandler:we(sh),abortSignal:t,fetch:this.config.fetch});return{embeddings:s.data.map(a=>a.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:r}}}},sh=h({data:O(h({embedding:O(w())})),usage:h({prompt_tokens:w()}).nullish()});function Ci(e={}){var t;const n=(t=Ht(e.baseURL))!=null?t:"https://api.mistral.ai/v1",r=()=>({Authorization:`Bearer ${vn({apiKey:e.apiKey,environmentVariableName:"MISTRAL_API_KEY",description:"Mistral"})}`,...e.headers}),s=(i,u={})=>new eh(i,u,{provider:"mistral.chat",baseURL:n,headers:r,fetch:e.fetch}),a=(i,u={})=>new rh(i,u,{provider:"mistral.embedding",baseURL:n,headers:r,fetch:e.fetch}),o=function(i,u){if(new.target)throw new Error("The Mistral model function cannot be called with the new keyword.");return s(i,u)};return o.languageModel=s,o.chat=s,o.embedding=a,o.textEmbedding=a,o.textEmbeddingModel=a,o}Ci();var Ii={},Dr={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Allow=e.ALL=e.COLLECTION=e.ATOM=e.SPECIAL=e.INF=e._INFINITY=e.INFINITY=e.NAN=e.BOOL=e.NULL=e.OBJ=e.ARR=e.NUM=e.STR=void 0,e.STR=1,e.NUM=2,e.ARR=4,e.OBJ=8,e.NULL=16,e.BOOL=32,e.NAN=64,e.INFINITY=128,e._INFINITY=256,e.INF=e.INFINITY|e._INFINITY,e.SPECIAL=e.NULL|e.BOOL|e.INF|e.NAN,e.ATOM=e.STR|e.NUM|e.SPECIAL,e.COLLECTION=e.ARR|e.OBJ,e.ALL=e.ATOM|e.COLLECTION,e.Allow={STR:e.STR,NUM:e.NUM,ARR:e.ARR,OBJ:e.OBJ,NULL:e.NULL,BOOL:e.BOOL,NAN:e.NAN,INFINITY:e.INFINITY,_INFINITY:e._INFINITY,INF:e.INF,SPECIAL:e.SPECIAL,ATOM:e.ATOM,COLLECTION:e.COLLECTION,ALL:e.ALL},e.default=e.Allow})(Dr);(function(e){var t=Tn&&Tn.__createBinding||(Object.create?function(l,c,f,d){d===void 0&&(d=f);var m=Object.getOwnPropertyDescriptor(c,f);(!m||("get"in m?!c.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return c[f]}}),Object.defineProperty(l,d,m)}:function(l,c,f,d){d===void 0&&(d=f),l[d]=c[f]}),n=Tn&&Tn.__exportStar||function(l,c){for(var f in l)f!=="default"&&!Object.prototype.hasOwnProperty.call(c,f)&&t(c,l,f)};Object.defineProperty(e,"__esModule",{value:!0}),e.Allow=e.MalformedJSON=e.PartialJSON=e.parseJSON=e.parse=void 0;const r=Dr;Object.defineProperty(e,"Allow",{enumerable:!0,get:function(){return r.Allow}}),n(Dr,e);class s extends Error{}e.PartialJSON=s;class a extends Error{}e.MalformedJSON=a;function o(l,c=r.Allow.ALL){if(typeof l!="string")throw new TypeError(`expecting str, got ${typeof l}`);if(!l.trim())throw new Error(`${l} is empty`);return i(l.trim(),c)}e.parseJSON=o;const i=(l,c)=>{const f=l.length;let d=0;const m=T=>{throw new s(`${T} at position ${d}`)},_=T=>{throw new a(`${T} at position ${d}`)},g=()=>(b(),d>=f&&m("Unexpected end of input"),l[d]==='"'?y():l[d]==="{"?v():l[d]==="["?x():l.substring(d,d+4)==="null"||r.Allow.NULL&c&&f-d<4&&"null".startsWith(l.substring(d))?(d+=4,null):l.substring(d,d+4)==="true"||r.Allow.BOOL&c&&f-d<4&&"true".startsWith(l.substring(d))?(d+=4,!0):l.substring(d,d+5)==="false"||r.Allow.BOOL&c&&f-d<5&&"false".startsWith(l.substring(d))?(d+=5,!1):l.substring(d,d+8)==="Infinity"||r.Allow.INFINITY&c&&f-d<8&&"Infinity".startsWith(l.substring(d))?(d+=8,1/0):l.substring(d,d+9)==="-Infinity"||r.Allow._INFINITY&c&&1<f-d&&f-d<9&&"-Infinity".startsWith(l.substring(d))?(d+=9,-1/0):l.substring(d,d+3)==="NaN"||r.Allow.NAN&c&&f-d<3&&"NaN".startsWith(l.substring(d))?(d+=3,NaN):A()),y=()=>{const T=d;let k=!1;for(d++;d<f&&(l[d]!=='"'||k&&l[d-1]==="\\");)k=l[d]==="\\"?!k:!1,d++;if(l.charAt(d)=='"')try{return JSON.parse(l.substring(T,++d-Number(k)))}catch(M){_(String(M))}else if(r.Allow.STR&c)try{return JSON.parse(l.substring(T,d-Number(k))+'"')}catch{return JSON.parse(l.substring(T,l.lastIndexOf("\\"))+'"')}m("Unterminated string literal")},v=()=>{d++,b();const T={};try{for(;l[d]!=="}";){if(b(),d>=f&&r.Allow.OBJ&c)return T;const k=y();b(),d++;try{const M=g();T[k]=M}catch(M){if(r.Allow.OBJ&c)return T;throw M}b(),l[d]===","&&d++}}catch{if(r.Allow.OBJ&c)return T;m("Expected '}' at end of object")}return d++,T},x=()=>{d++;const T=[];try{for(;l[d]!=="]";)T.push(g()),b(),l[d]===","&&d++}catch{if(r.Allow.ARR&c)return T;m("Expected ']' at end of array")}return d++,T},A=()=>{if(d===0){l==="-"&&_("Not sure what '-' is");try{return JSON.parse(l)}catch(k){if(r.Allow.NUM&c)try{return JSON.parse(l.substring(0,l.lastIndexOf("e")))}catch{}_(String(k))}}const T=d;for(l[d]==="-"&&d++;l[d]&&",]}".indexOf(l[d])===-1;)d++;d==f&&!(r.Allow.NUM&c)&&m("Unterminated number literal");try{return JSON.parse(l.substring(T,d))}catch{l.substring(T,d)==="-"&&m("Not sure what '-' is");try{return JSON.parse(l.substring(T,l.lastIndexOf("e")))}catch(M){_(String(M))}}},b=()=>{for(;d<f&&` 
\r	`.includes(l[d]);)d++};return g()},u=o;e.parse=u})(Ii);function yr(e){const t=[];for(const{content:n,role:r}of e)switch(r){case"system":{t.push({content:n,role:"system"});break}case"user":{t.push({...n.reduce((s,a)=>{if(a.type==="text")s.content+=a.text;else{if(a.type==="image"&&a.image instanceof URL)throw new G({functionality:"Image URLs in user messages"});a.type==="image"&&a.image instanceof Uint8Array&&(s.images=s.images||[],s.images.push(Ge(a.image)))}return s},{content:""}),role:"user"});break}case"assistant":{const s=[],a=[];for(const o of n)switch(o.type){case"text":{s.push(o.text);break}case"tool-call":{a.push({function:{arguments:o.args,name:o.toolName},id:o.toolCallId,type:"function"});break}default:{const i=o;throw new Error(`Unsupported part: ${i}`)}}t.push({content:s.join(","),role:"assistant",tool_calls:a.length>0?a:void 0});break}case"tool":{t.push(...n.map(s=>({content:typeof s.result=="object"?JSON.stringify(s.result):`${s.result}`,role:"tool",tool_call_id:s.toolCallId})));break}default:{const s=r;throw new Error(`Unsupported role: ${s}`)}}return t}var ah=class{constructor({tools:e,type:t}){this._firstMessage=!0,this._tools=e,this._toolPartial="",this._toolCalls=[],this._type=t,this._detectedToolCall=!1}get toolCalls(){return this._toolCalls}get detectedToolCall(){return this._detectedToolCall}parse({controller:e,delta:t}){var n;if(this.detectToolCall(t),!this._detectedToolCall)return!1;this._toolPartial+=t;let r=Ii.parse(this._toolPartial);Array.isArray(r)||(r=[r]);for(const[s,a]of r.entries()){const o=(n=JSON.stringify(a==null?void 0:a.parameters))!=null?n:"";if(o==="")continue;this._toolCalls[s]||(this._toolCalls[s]={function:{arguments:"",name:a.name},id:Se(),type:"function"});const i=this._toolCalls[s];i.function.arguments=o,e.enqueue({argsTextDelta:t,toolCallId:i.id,toolCallType:"function",toolName:i.function.name,type:"tool-call-delta"})}return!0}finish({controller:e}){for(const t of this.toolCalls)e.enqueue({args:t.function.arguments,toolCallId:t.id,toolCallType:"function",toolName:t.function.name,type:"tool-call"});return this.finishReason()}detectToolCall(e){!this._tools||this._tools.length===0||this._firstMessage&&(this._type==="object-tool"?this._detectedToolCall=!0:this._type==="regular"&&(e.trim().startsWith("{")||e.trim().startsWith("["))&&(this._detectedToolCall=!0),this._firstMessage=!1)}finishReason(){return this.detectedToolCall?this._type==="object-tool"?"stop":"tool-calls":"stop"}};function oh({finishReason:e,hasToolCalls:t}){switch(e){case"stop":return t?"tool-calls":"stop";default:return"other"}}var ih=h({error:h({code:p().nullable(),message:p(),param:Qn().nullable(),type:p()})}),jr=Jt({errorSchema:ih,errorToMessage:e=>e.error.message});function lh({mode:e}){var t;const n=(t=e.tools)!=null&&t.length?e.tools:void 0,r=[],s=e.toolChoice;if(n===void 0)return{tools:void 0,toolWarnings:r};const a=[];for(const i of n)i.type==="provider-defined"?r.push({tool:i,type:"unsupported-tool"}):a.push({function:{description:i.description,name:i.name,parameters:i.parameters},type:"function"});if(s===void 0)return{tools:a,toolWarnings:r};const o=s.type;switch(o){case"auto":return{tools:a,toolWarnings:r};case"none":return{tools:void 0,toolWarnings:r};default:{const i=o;throw new G({functionality:`Unsupported tool choice type: ${i}`})}}}function uh(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}var ch=class extends TransformStream{constructor(){super({flush:e=>{this.buffer.length!==0&&e.enqueue(this.buffer)},transform:(e,t)=>{for(e=this.buffer+e;;){const n=e.indexOf(`
`);if(n===-1)break;t.enqueue(e.slice(0,n)),e=e.slice(n+1)}this.buffer=e}}),this.buffer=""}},dh=e=>async({response:t})=>{const n=Vt(t);if(t.body===null)throw new la({});return{responseHeaders:n,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new ch).pipeThrough(new TransformStream({transform(r,s){s.enqueue(bt({schema:e,text:r}))}}))}},ph=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:!1}get provider(){return this.config.provider}getArguments({frequencyPenalty:e,maxTokens:t,mode:n,presencePenalty:r,prompt:s,responseFormat:a,seed:o,stopSequences:i,temperature:u,topK:l,topP:c}){const f=n.type,d=[];a!==void 0&&a.type==="json"&&a.schema!==void 0&&!this.supportsStructuredOutputs&&d.push({details:"JSON response format schema is only supported with structuredOutputs",setting:"responseFormat",type:"unsupported-setting"});const m={format:a==null?void 0:a.type,model:this.modelId,options:uh({f16_kv:this.settings.f16Kv,frequency_penalty:e,low_vram:this.settings.lowVram,main_gpu:this.settings.mainGpu,min_p:this.settings.minP,mirostat:this.settings.mirostat,mirostat_eta:this.settings.mirostatEta,mirostat_tau:this.settings.mirostatTau,num_batch:this.settings.numBatch,num_ctx:this.settings.numCtx,num_gpu:this.settings.numGpu,num_keep:this.settings.numKeep,num_predict:t,num_thread:this.settings.numThread,numa:this.settings.numa,penalize_newline:this.settings.penalizeNewline,presence_penalty:r,repeat_last_n:this.settings.repeatLastN,repeat_penalty:this.settings.repeatPenalty,seed:o,stop:i,temperature:u,tfs_z:this.settings.tfsZ,top_k:l,top_p:c,typical_p:this.settings.typicalP,use_mlock:this.settings.useMlock,use_mmap:this.settings.useMmap,vocab_only:this.settings.vocabOnly})};switch(f){case"regular":{const{tools:_,toolWarnings:g}=lh({mode:n});return{args:{...m,messages:yr(s),tools:_},type:f,warnings:[...d,...g]}}case"object-json":return{args:{...m,format:this.supportsStructuredOutputs&&n.schema!==void 0?n.schema:"json",messages:yr(s)},type:f,warnings:d};case"object-tool":return{args:{...m,messages:yr(s),tool_choice:{function:{name:n.tool.name},type:"function"},tools:[{function:{description:n.tool.description,name:n.tool.name,parameters:n.tool.parameters},type:"function"}]},type:f,warnings:d};default:{const _=f;throw new Error(`Unsupported type: ${_}`)}}}async doGenerate(e){var t,n;const{args:r,warnings:s}=this.getArguments(e),a={...r,stream:!1},{responseHeaders:o,value:i}=await se({abortSignal:e.abortSignal,body:a,failedResponseHandler:jr,fetch:this.config.fetch,headers:re(this.config.headers(),e.headers),successfulResponseHandler:we(fh),url:`${this.config.baseURL}/chat`}),{messages:u,...l}=a,c=(t=i.message.tool_calls)==null?void 0:t.map(f=>{var d;return{args:JSON.stringify(f.function.arguments),toolCallId:(d=f.id)!=null?d:Se(),toolCallType:"function",toolName:f.function.name}});return{finishReason:oh({finishReason:i.done_reason,hasToolCalls:c!==void 0&&c.length>0}),rawCall:{rawPrompt:u,rawSettings:l},rawResponse:{headers:o},request:{body:JSON.stringify(a)},text:(n=i.message.content)!=null?n:void 0,toolCalls:c,usage:{completionTokens:i.eval_count||0,promptTokens:i.prompt_eval_count||0},warnings:s}}async doStream(e){if(this.settings.simulateStreaming){const m=await this.doGenerate(e),_=new ReadableStream({start(g){if(g.enqueue({type:"response-metadata",...m.response}),m.text&&g.enqueue({textDelta:m.text,type:"text-delta"}),m.toolCalls)for(const y of m.toolCalls)g.enqueue({argsTextDelta:y.args,toolCallId:y.toolCallId,toolCallType:"function",toolName:y.toolName,type:"tool-call-delta"}),g.enqueue({type:"tool-call",...y});g.enqueue({finishReason:m.finishReason,logprobs:m.logprobs,providerMetadata:m.providerMetadata,type:"finish",usage:m.usage}),g.close()}});return{rawCall:m.rawCall,rawResponse:m.rawResponse,stream:_,warnings:m.warnings}}const{args:t,type:n,warnings:r}=this.getArguments(e),{responseHeaders:s,value:a}=await se({abortSignal:e.abortSignal,body:t,failedResponseHandler:jr,fetch:this.config.fetch,headers:re(this.config.headers(),e.headers),successfulResponseHandler:dh(hh),url:`${this.config.baseURL}/chat`}),{messages:o,...i}=t,u=e.mode.type==="regular"?e.mode.tools:e.mode.type==="object-tool"?[e.mode.tool]:void 0,l=new ah({tools:u,type:n});let c="other",f={completionTokens:Number.NaN,promptTokens:Number.NaN};const{experimentalStreamTools:d=!0}=this.settings;return{rawCall:{rawPrompt:o,rawSettings:i},rawResponse:{headers:s},request:{body:JSON.stringify(t)},stream:a.pipeThrough(new TransformStream({async flush(m){m.enqueue({finishReason:c,type:"finish",usage:f})},async transform(m,_){if(!m.success){_.enqueue({error:m.error,type:"error"});return}const g=m.value;if(g.done){c=l.finish({controller:_}),f={completionTokens:g.eval_count,promptTokens:g.prompt_eval_count||0};return}d&&l.parse({controller:_,delta:g.message.content})||g.message.content!==null&&_.enqueue({textDelta:g.message.content,type:"text-delta"})}})),warnings:r}}},fh=h({created_at:p(),done:N(!0),done_reason:p().optional().nullable(),eval_count:w(),eval_duration:w(),load_duration:w().optional(),message:h({content:p(),role:p(),tool_calls:O(h({function:h({arguments:Lt(Qn()),name:p()}),id:p().optional()})).optional().nullable()}),model:p(),prompt_eval_count:w().optional(),prompt_eval_duration:w().optional(),total_duration:w()}),hh=st("done",[h({created_at:p(),done:N(!1),message:h({content:p(),role:p()}),model:p()}),h({created_at:p(),done:N(!0),eval_count:w(),eval_duration:w(),load_duration:w().optional(),model:p(),prompt_eval_count:w().optional(),prompt_eval_duration:w().optional(),total_duration:w()})]),mh=class{constructor(e,t,n){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=n}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){return!1}async doEmbed({abortSignal:e,values:t}){if(t.length>this.maxEmbeddingsPerCall)throw new Xn({maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,modelId:this.modelId,provider:this.provider,values:t});const{responseHeaders:n,value:r}=await se({abortSignal:e,body:{input:t,model:this.modelId},failedResponseHandler:jr,fetch:this.config.fetch,headers:this.config.headers(),successfulResponseHandler:we(gh),url:`${this.config.baseURL}/embed`});return{embeddings:r.embeddings,rawResponse:{headers:n},usage:r.prompt_eval_count?{tokens:r.prompt_eval_count}:void 0}}},gh=h({embeddings:O(O(w())),prompt_eval_count:w().nullable()});function Ri(e={}){var t;const n=(t=Ht(e.baseURL))!=null?t:"http://127.0.0.1:11434/api",r=()=>({...e.headers}),s=(i,u={})=>new ph(i,u,{baseURL:n,fetch:e.fetch,headers:r,provider:"ollama.chat"}),a=(i,u={})=>new mh(i,u,{baseURL:n,fetch:e.fetch,headers:r,provider:"ollama.embedding"}),o=function(i,u){if(new.target)throw new Error("The Ollama model function cannot be called with the new keyword.");return s(i,u)};return o.chat=s,o.embedding=a,o.languageModel=s,o.textEmbedding=a,o.textEmbeddingModel=a,o}Ri();chrome.runtime.onMessage.addListener((e,t,n)=>{var r;if(e.type==="GET_SETTINGS")return chrome.storage.sync.get(Ei,s=>{n(s)}),!0;if(e.type==="SAVE_SETTINGS")return chrome.storage.sync.set(e.payload,()=>{n({ok:!0})}),!0;if(e.type==="CHAT_STREAM"){const s=(r=t.tab)==null?void 0:r.id;return _h({...e.payload,tabId:s},n),!0}if(e.type==="GET_CAPTION_TRACKS")return yh(e.payload.videoId,n),!0;if(e.type==="FETCH_TRANSCRIPT_URL")return vh(e.payload.url,n),!0;if(e.type==="EMBED_TEXT")return xh(e.payload.text,n),!0;if(e.type==="GENERATE_TIMELINE")return bh(e.payload,n),!0});async function yh(e,t){var n,r;try{const s=await fetch("https://www.youtube.com/youtubei/v1/player?prettyPrint=false",{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"com.google.android.youtube/19.09.37 (Linux; U; Android 11) gzip","X-YouTube-Client-Name":"3","X-YouTube-Client-Version":"19.09.37"},body:JSON.stringify({context:{client:{clientName:"ANDROID",clientVersion:"19.09.37",androidSdkVersion:30,hl:"en",gl:"US"}},videoId:e})});if(!s.ok){t({error:`Innertube player returned ${s.status}`});return}const a=await s.json(),o=(r=(n=a==null?void 0:a.captions)==null?void 0:n.playerCaptionsTracklistRenderer)==null?void 0:r.captionTracks;t({tracks:Array.isArray(o)?o:[]})}catch(s){t({error:s instanceof Error?s.message:String(s)})}}async function vh(e,t){try{const n=await fetch(e,{headers:{"Accept-Language":"en-US,en;q=0.9"}});if(!n.ok){t({error:`HTTP ${n.status}`});return}const r=await n.text();t({text:r})}catch(n){t({error:n instanceof Error?n.message:String(n)})}}function Ai(e,t,n){switch(e){case"anthropic":return mi({apiKey:t});case"openai":return vi({apiKey:t});case"google":return xi({apiKey:t});case"groq":return ki({apiKey:t});case"mistral":return Ci({apiKey:t});case"ollama":return Ri({baseURL:(n??"http://localhost:11434")+"/api"});default:return null}}async function _h(e,t){const{messages:n,systemPrompt:r,provider:s,model:a,apiKey:o,ollamaBaseUrl:i,tabId:u}=e;try{const l=Ai(s,o,i);if(!l){t({error:`Unknown provider: ${s}`});return}const c={description:"Search the video transcript for segments relevant to a query. Returns up to 15 matching transcript snippets with timestamps. Use up to 3 times with different queries to gather all necessary context.",parameters:Qa({type:"object",properties:{query:{type:"string",description:"The search query to find relevant transcript segments"}},required:["query"]}),execute:async({query:m})=>u==null?"Search unavailable (no tab context).":new Promise(_=>{chrome.tabs.sendMessage(u,{type:"SEARCH_REQUEST",payload:{query:m}},g=>{chrome.runtime.lastError||!g?_("No results found for this query."):_(g.results)})})},f=await Fd({model:l(a),system:r,messages:n.map(m=>({role:m.role,content:m.content})),tools:{search_transcript:c},maxSteps:4});let d="";for await(const m of f.fullStream)m.type==="tool-call"&&m.toolName==="search_transcript"&&u!=null?chrome.tabs.sendMessage(u,{type:"CHAT_SEARCHING",payload:{query:m.args.query}}).catch(()=>{}):m.type==="text-delta"&&(d+=m.textDelta,u!=null&&chrome.tabs.sendMessage(u,{type:"CHAT_CHUNK",payload:{chunk:m.textDelta,fullText:d}}).catch(()=>{}));t({ok:!0,fullText:d})}catch(l){const c=l instanceof Error?l.message:String(l);t({error:c})}}function Ks(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return t>0?`${t}:${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}`:`${n}:${String(r).padStart(2,"0")}`}async function bh(e,t){const{blocks:n,provider:r,model:s,apiKey:a,ollamaBaseUrl:o}=e;try{const i=Ai(r,a,o);if(!i){t({error:`Unknown provider: ${r}`});return}const u=n.map((f,d)=>`Block ${d+1} [${Ks(f.startTime)}  ${Ks(f.endTime)}]:
${f.text}`).join(`

`),l=await Rd({model:i(s),system:"You are analyzing a YouTube video transcript. For each given segment, provide a short, descriptive title (47 words) capturing the main topic. Return ONLY a valid JSON array of strings, one per segment, in order. No other text, no markdown fences.",messages:[{role:"user",content:`Generate titles for these ${n.length} video segments:

${u}`}]});let c;try{c=JSON.parse(l.text.trim())}catch{const f=l.text.match(/\[[\s\S]+\]/);try{c=f?JSON.parse(f[0]):[]}catch{c=[]}}for(;c.length<n.length;)c.push(`Segment ${c.length+1}`);c=c.slice(0,n.length),t({titles:c})}catch(i){t({error:i instanceof Error?i.message:String(i)})}}const Xs=chrome.runtime.getURL("src/offscreen/index.html");async function wh(){(await chrome.runtime.getContexts({contextTypes:["OFFSCREEN_DOCUMENT"],documentUrls:[Xs]})).length===0&&await chrome.offscreen.createDocument({url:Xs,reasons:["BLOBS"],justification:"Run ML embedding inference (WASM/ORT) outside service worker"})}async function xh(e,t){try{await wh(),chrome.runtime.sendMessage({type:"OFFSCREEN_EMBED_TEXT",payload:{text:e}},n=>{chrome.runtime.lastError?t({error:chrome.runtime.lastError.message}):t(n)})}catch(n){t({error:n instanceof Error?n.message:String(n)})}}
