import{r as p,j as t,c as W}from"./content-DmZOpr4u.js";import{P as R,D as H}from"./providers-D_NaGG7O.js";function J(e){var o;const r=e.split('"captions":');if(r.length<=1)return[];try{const i=r[1].split(',"videoDetails')[0].replace(/\n/g,""),n=JSON.parse(i),s=(o=n==null?void 0:n.playerCaptionsTracklistRenderer)==null?void 0:o.captionTracks;if(Array.isArray(s)&&s.length>0)return s}catch{}return[]}function U(){var r,o;const e=document.querySelector('script[id="ytInitialPlayerResponse"]');if(e!=null&&e.textContent)try{const i=JSON.parse(e.textContent),n=(o=(r=i==null?void 0:i.captions)==null?void 0:r.playerCaptionsTracklistRenderer)==null?void 0:o.captionTracks;if(Array.isArray(n)&&n.length>0)return n}catch{}for(const i of document.querySelectorAll("script")){const n=i.textContent??"";if(n.includes('"captionTracks"')){const s=J(n);if(s.length>0)return s}}throw new Error("No captions found. This video may not have a transcript.")}async function _(e){var s,l;const o=await fetch("https://www.youtube.com/youtubei/v1/player?key=AIzaSyAO_FJ2SlqU8Q4STEHLGCilw_Y9_11qcW8&prettyPrint=false",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:{client:{clientName:"ANDROID",clientVersion:"20.10.38"}},videoId:e})});if(!o.ok)throw new Error(`Innertube player returned ${o.status}`);const i=await o.json(),n=(l=(s=i==null?void 0:i.captions)==null?void 0:s.playerCaptionsTracklistRenderer)==null?void 0:l.captionTracks;return Array.isArray(n)?n:[]}async function X(e){var l;const r={steps:[]};let o=[],i=null;try{o=await _(e),r.steps.push({label:"Page fetch caption tracks",status:o.length>0?"ok":"warn",detail:o.length>0?`Found ${o.length} track(s): ${o.map(a=>`${a.languageCode}${a.kind?` [${a.kind}]`:""}`).join(", ")}`:"Returned 0 tracks"})}catch(a){i=a instanceof Error?a.message:String(a),r.steps.push({label:"Page fetch caption tracks",status:"error",detail:i})}if(o.length===0)try{o=U(),r.steps.push({label:"DOM fallback caption tracks",status:o.length>0?"ok":"warn",detail:o.length>0?`Found ${o.length} track(s): ${o.map(a=>`${a.languageCode}${a.kind?` [${a.kind}]`:""}`).join(", ")}`:"Returned 0 tracks"})}catch(a){const u=a instanceof Error?a.message:String(a);throw r.steps.push({label:"DOM fallback caption tracks",status:"error",detail:u}),Object.assign(new Error(`Could not find any caption tracks.
Background: ${i??"n/a"}
DOM: ${u}`),{diagnostics:r})}if(o.length===0)throw r.steps.push({label:"Select track",status:"error",detail:"No tracks available to select."}),Object.assign(new Error("No caption tracks found in background fetch or DOM."),{diagnostics:r});const n=o.find(a=>a.languageCode==="en"&&!a.kind)??o.find(a=>a.languageCode==="en")??o[0];r.steps.push({label:"Select track",status:"ok",detail:`Using "${((l=n.name)==null?void 0:l.simpleText)??"unknown"}" (lang=${n.languageCode}, kind=${n.kind??"manual"})`});let s;try{s=await Y(n.baseUrl,r)}catch(a){const u=a instanceof Error?a.message:String(a);throw Object.assign(new Error(u),{diagnostics:r})}return{segments:s,tracksLen:o.length,diagnostics:r}}async function Y(e,r){(e.includes("exp=xpe")||e.includes("exp=xpv"))&&r.steps.push({label:"⚠ POT token required",status:"warn",detail:"URL contains exp=xpe — YouTube requires Proof-of-Origin Token for this track. The Innertube ANDROID client should have avoided this."});let o="skipped";try{const n=e+"&fmt=json3",s=await fetch(n,{credentials:"include",headers:{"Accept-Language":"en-US,en;q=0.9"}}),l=s.headers.get("content-length")??"unknown",a=await s.text();if(r.steps.push({label:"HTTP response (JSON3)",status:a.length>0?"ok":"error",detail:`status=${s.status}, content-length=${l}, body=${a.length} bytes, preview: ${JSON.stringify(a.slice(0,200))}`}),o=`${a.length} bytes`,a){const u=JSON.parse(a),h=[];for(const b of u.events??[]){if(!b.segs)continue;const F=b.segs.map(m=>m.utf8).join("").replace(/\n/g," ").trim();F&&h.push({text:F,start:b.tStartMs/1e3,duration:b.dDurationMs/1e3})}if(h.length>0)return r.steps.push({label:"Fetch JSON3 transcript",status:"ok",detail:`${h.length} events, ${o}`}),h;o+=" (0 events after filtering)"}else o="empty body"}catch(n){o=`Error: ${n instanceof Error?n.message:String(n)}`}r.steps.push({label:"Fetch JSON3 transcript",status:"warn",detail:o+" — falling back to XML"});let i="skipped";try{const n=await fetch(e,{credentials:"include",headers:{"Accept-Language":"en-US,en;q=0.9"}}),s=n.headers.get("content-length")??"unknown",l=await n.text();r.steps.push({label:"HTTP response (XML)",status:l.length>0?"ok":"error",detail:`status=${n.status}, content-length=${s}, body=${l.length} bytes, preview: ${JSON.stringify(l.slice(0,200))}`}),i=`${l.length} bytes`;const a=K(l);return r.steps.push({label:"Fetch XML transcript",status:"ok",detail:`${a.length} segments, ${i}`}),a}catch(n){const s=n instanceof Error?n.message:String(n);throw r.steps.push({label:"Fetch XML transcript",status:"error",detail:`${i} — ${s}`}),new Error(s)}}function I(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/\n/g," ").trim()}function K(e){const r=new DOMParser().parseFromString(e,"text/xml"),o=[],i=r.querySelectorAll("p");if(i.length>0){for(const n of i){const s=parseFloat(n.getAttribute("t")??"0"),l=parseFloat(n.getAttribute("d")??"0"),a=n.querySelectorAll("s"),u=a.length>0?Array.from(a).map(b=>b.textContent??"").join(""):n.textContent??"",h=I(u);h&&o.push({text:h,start:s/1e3,duration:l/1e3})}if(o.length>0)return o}for(const n of r.querySelectorAll("text")){const s=parseFloat(n.getAttribute("start")??"0"),l=parseFloat(n.getAttribute("dur")??"0"),a=I(n.textContent??"");a&&o.push({text:a,start:s,duration:l})}if(o.length===0)throw new Error(`XML parsed but yielded 0 segments. XML snippet: ${e.slice(0,300)}`);return o}function V(e,r=80){const o=[];let i="",n=0,s=0;for(const l of e)i.split(/\s+/).filter(Boolean).length>=r&&i.length>0?(o.push({text:i.trim(),start:n,duration:s}),i=l.text,n=l.start,s=l.duration):(i||(n=l.start,s=0),i+=(i?" ":"")+l.text,s=l.start+l.duration-n);return i.trim()&&o.push({text:i.trim(),start:n,duration:s}),o}function z(e){const r=Math.floor(e/3600),o=Math.floor(e%3600/60),i=Math.floor(e%60);return r>0?`${r}:${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")}`:`${o}:${String(i).padStart(2,"0")}`}function G(e){const r=e.match(/[?&]v=([^&]+)/);return r?r[1]:null}async function N(e){return new Promise((r,o)=>{chrome.runtime.sendMessage({type:"EMBED_TEXT",payload:{text:e}},i=>{chrome.runtime.lastError?o(new Error(chrome.runtime.lastError.message)):!i||i.error?o(new Error((i==null?void 0:i.error)??"No response from background")):r(i.embedding)})})}async function Q(e,r){const o=[];for(let i=0;i<e.length;i++){const n=e[i],s=await N(n.text);o.push({...n,embedding:s,index:i}),r==null||r(Math.round((i+1)/e.length*100))}return o}function Z(e,r,o=5){const i=r.map(n=>({segment:n,score:cosineSimilarity(e,n.embedding)}));return i.sort((n,s)=>s.score-n.score),i.slice(0,o)}function P(e,r){if(!e.trim())return[];const o=e.toLowerCase().trim(),i=[];for(let n=0;n<r.length;n++){const s=r[n];s.text.toLowerCase().includes(o)&&i.push({segment:s,index:n,score:1,matchType:"exact"})}return i}async function ee(e,r,o=8){if(!e.trim())return[];const i=P(e,r),n=new Set(i.map(u=>u.index)),s=await N(e),l=Z(s,r,o),a=[...i];for(const{segment:u,score:h}of l)!n.has(u.index)&&h>.3&&a.push({segment:u,index:u.index,score:h,matchType:"semantic"});return a.sort((u,h)=>u.matchType==="exact"&&h.matchType!=="exact"?-1:h.matchType==="exact"&&u.matchType!=="exact"?1:h.score-u.score),a}function te(e,r){if(!r.trim())return e;const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return e.replace(new RegExp(`(${o})`,"gi"),"<mark>$1</mark>")}function ne({segments:e,semanticEnabled:r}){const[o,i]=p.useState(""),[n,s]=p.useState([]),[l,a]=p.useState(!1),u=p.useRef(null),h=p.useCallback(async m=>{if(!m.trim()){s([]);return}a(!0);try{const f=r?await ee(m,e):P(m,e).map(S=>({...S}));s(f)}finally{a(!1)}},[e,r]);function b(m){const f=m.target.value;i(f),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>h(f),400)}function F(m){const f=document.querySelector("video");f&&(f.currentTime=m,f.play())}return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid #3F3F3F"},children:[t.jsxs("div",{style:{position:"relative"},children:[t.jsx("input",{type:"text",value:o,onChange:b,placeholder:r?"Search by meaning or keyword…":"Search transcript…",style:{width:"100%",background:"#212121",border:"1px solid #3F3F3F",borderRadius:6,padding:"9px 36px 9px 12px",color:"#F1F1F1",fontSize:13,outline:"none"},onFocus:m=>m.target.style.borderColor="#FF0000",onBlur:m=>m.target.style.borderColor="#3F3F3F"}),l&&t.jsx("div",{style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",width:14,height:14,border:"2px solid #3F3F3F",borderTopColor:"#FF0000",borderRadius:"50%",animation:"spin 0.6s linear infinite"}})]}),r&&t.jsx("p",{style:{marginTop:6,fontSize:11,color:"#AAAAAA"},children:"AI semantic search active — finds related concepts too"})]}),t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:[o&&!l&&n.length===0&&t.jsx("div",{style:{padding:"16px",color:"#AAAAAA",fontSize:13},children:"No results found."}),n.map((m,f)=>t.jsx(re,{result:m,query:o,onJump:F},f))]})]})}function re({result:e,query:r,onJump:o}){const i=te(e.segment.text,r);return t.jsxs("div",{onClick:()=>o(e.segment.start),style:{padding:"10px 16px",cursor:"pointer",borderBottom:"1px solid #1a1a1a",transition:"background 0.1s"},onMouseEnter:n=>n.currentTarget.style.background="#1a1a1a",onMouseLeave:n=>n.currentTarget.style.background="transparent",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:4},children:[t.jsx("span",{style:{fontSize:11,fontWeight:700,color:"#FF0000",fontVariantNumeric:"tabular-nums"},children:z(e.segment.start)}),e.matchType==="semantic"&&t.jsx("span",{style:{fontSize:10,background:"#1e3a5f",color:"#60a5fa",borderRadius:3,padding:"1px 5px",fontWeight:600},children:"AI match"}),e.matchType==="exact"&&t.jsx("span",{style:{fontSize:10,background:"#1a2a1a",color:"#4ade80",borderRadius:3,padding:"1px 5px",fontWeight:600},children:"exact"})]}),t.jsx("p",{style:{fontSize:13,color:"#F1F1F1",margin:0,lineHeight:1.5},dangerouslySetInnerHTML:{__html:i}})]})}function oe({segments:e,settings:r,onSettingsChange:o}){const[i,n]=p.useState([]),[s,l]=p.useState(""),[a,u]=p.useState(!1),[h,b]=p.useState(""),F=p.useRef(null),m=p.useRef(""),f=R.find(c=>c.id===r.selectedProvider),S=r.apiKeys[r.selectedProvider]??"",A=!(f!=null&&f.requiresKey)||S.length>0;p.useEffect(()=>{var c;(c=F.current)==null||c.scrollIntoView({behavior:"smooth"})},[i,a]);function k(){return`You are a helpful assistant answering questions about a YouTube video.
You have access to the full transcript below. When relevant, cite specific timestamps like [1:23] so the user can jump to that moment.

TRANSCRIPT:
${e.map(y=>`[${z(y.start)}] ${y.text}`).join(`
`)}

Rules:
- Answer based on the transcript content
- Cite timestamps for specific claims using the format [MM:SS] or [H:MM:SS]
- If the video doesn't cover the topic, say so clearly
- Be concise and direct`}async function j(){if(!s.trim()||a)return;const c={role:"user",content:s.trim()},y=[...i,c];n(y),l(""),u(!0),b(""),m.current="",n(g=>[...g,{role:"assistant",content:""}]);const d=g=>{g.type==="CHAT_CHUNK"&&(m.current=g.payload.fullText,n(x=>{const v=[...x];return v[v.length-1]={role:"assistant",content:m.current},v}))};chrome.runtime.onMessage.addListener(d);try{const g=await chrome.runtime.sendMessage({type:"CHAT_STREAM",payload:{messages:y.map(x=>({role:x.role,content:x.content})),systemPrompt:k(),provider:r.selectedProvider,model:r.selectedModel,apiKey:S,ollamaBaseUrl:r.ollamaBaseUrl}});g!=null&&g.error&&(b(g.error),n(x=>x.slice(0,-1)))}catch(g){b(g instanceof Error?g.message:"Unknown error"),n(x=>x.slice(0,-1))}finally{chrome.runtime.onMessage.removeListener(d),u(!1)}}function T(c){c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),j())}function w(c){const y=document.querySelector("video");y&&(y.currentTime=c,y.play())}function C(c){return c.split(/(\[\d+:\d{2}(?::\d{2})?\])/g).map((d,g)=>{const x=d.match(/\[(\d+):(\d{2})(?::(\d{2}))?\]/);if(x){const v=x[3]!==void 0?parseInt(x[1]):0,E=x[3]!==void 0?parseInt(x[2]):parseInt(x[1]),M=x[3]!==void 0?parseInt(x[3]):parseInt(x[2]),q=v*3600+E*60+M;return t.jsx("button",{onClick:()=>w(q),style:{background:"#1e1e1e",border:"1px solid #3F3F3F",borderRadius:4,color:"#FF0000",cursor:"pointer",fontSize:12,fontWeight:700,padding:"1px 6px",margin:"0 2px"},children:d},g)}return t.jsx("span",{children:d},g)})}return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px solid #3F3F3F",display:"flex",gap:6,alignItems:"center"},children:[t.jsx("select",{value:r.selectedProvider,onChange:c=>{const y=R.find(d=>d.id===c.target.value);o({...r,selectedProvider:y.id,selectedModel:y.models[0].id})},style:L,children:R.map(c=>t.jsx("option",{value:c.id,children:c.label},c.id))}),t.jsx("select",{value:r.selectedModel,onChange:c=>o({...r,selectedModel:c.target.value}),style:L,children:((f==null?void 0:f.models)??[]).map(c=>t.jsx("option",{value:c.id,children:c.label},c.id))})]}),!A&&t.jsxs("div",{style:{margin:"8px 12px",padding:"8px 10px",background:"#2a1a00",border:"1px solid #7c4a00",borderRadius:6,fontSize:12,color:"#fbbf24"},children:["No API key set for ",f==null?void 0:f.label,". Add one in the extension settings."]}),t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",display:"flex",flexDirection:"column",gap:12},children:[i.length===0&&t.jsxs("div",{style:{textAlign:"center",color:"#AAAAAA",fontSize:13,marginTop:24,lineHeight:1.7},children:["Ask anything about this video.",t.jsx("br",{}),t.jsx("span",{style:{fontSize:11},children:"Timestamps in answers are clickable."})]}),i.map((c,y)=>t.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:c.role==="user"?"flex-end":"flex-start"},children:t.jsxs("div",{style:{maxWidth:"85%",padding:"9px 12px",borderRadius:c.role==="user"?"12px 12px 2px 12px":"12px 12px 12px 2px",background:c.role==="user"?"#CC0000":"#212121",fontSize:13,lineHeight:1.6,color:"#F1F1F1"},children:[c.role==="assistant"?C(c.content):c.content,a&&y===i.length-1&&c.role==="assistant"&&!c.content&&t.jsx("span",{style:{color:"#AAAAAA"},children:"▋"})]})},y)),h&&t.jsxs("div",{style:{color:"#f87171",fontSize:12,padding:"4px 0"},children:["Error: ",h]}),t.jsx("div",{ref:F})]}),t.jsxs("div",{style:{padding:"10px 12px",borderTop:"1px solid #3F3F3F",display:"flex",gap:8,alignItems:"flex-end"},children:[t.jsx("textarea",{value:s,onChange:c=>l(c.target.value),onKeyDown:T,placeholder:"Ask about the video… (Enter to send)",disabled:a||!A,rows:1,style:{flex:1,background:"#212121",border:"1px solid #3F3F3F",borderRadius:8,padding:"9px 12px",color:"#F1F1F1",fontSize:13,resize:"none",outline:"none",fontFamily:"inherit",lineHeight:1.5,maxHeight:100,overflow:"auto"},onFocus:c=>c.target.style.borderColor="#FF0000",onBlur:c=>c.target.style.borderColor="#3F3F3F"}),t.jsx("button",{onClick:j,disabled:a||!s.trim()||!A,style:{background:a||!s.trim()||!A?"#3F3F3F":"#FF0000",border:"none",borderRadius:8,color:"white",cursor:a||!s.trim()||!A?"default":"pointer",padding:"9px 14px",fontSize:13,fontWeight:700,transition:"background 0.15s"},children:a?"…":"↑"})]})]})}const L={background:"#212121",border:"1px solid #3F3F3F",borderRadius:5,color:"#F1F1F1",padding:"5px 8px",fontSize:11,cursor:"pointer",flex:1,outline:"none"};function se({segments:e}){const[r,o]=p.useState(null),i=p.useRef(null);p.useEffect(()=>{const s=document.querySelector("video");if(!s)return;function l(){const a=s.currentTime;let u=0;for(let h=0;h<e.length&&e[h].start<=a;h++)u=h;o(u)}return s.addEventListener("timeupdate",l),()=>s.removeEventListener("timeupdate",l)},[e]),p.useEffect(()=>{var l;if(r===null)return;const s=(l=i.current)==null?void 0:l.querySelector(`[data-index="${r}"]`);s==null||s.scrollIntoView({block:"nearest",behavior:"smooth"})},[r]);function n(s){const l=document.querySelector("video");l&&(l.currentTime=s,l.play())}return t.jsx("div",{ref:i,style:{flex:1,overflowY:"auto",padding:"8px 0"},children:e.map((s,l)=>t.jsxs("div",{"data-index":l,onClick:()=>n(s.start),style:{padding:"8px 16px",cursor:"pointer",background:r===l?"#1a1a1a":"transparent",borderLeft:r===l?"3px solid #FF0000":"3px solid transparent",transition:"all 0.15s"},onMouseEnter:a=>{r!==l&&(a.currentTarget.style.background="#141414")},onMouseLeave:a=>{r!==l&&(a.currentTarget.style.background="transparent")},children:[t.jsx("span",{style:{fontSize:11,fontWeight:700,color:r===l?"#FF0000":"#AAAAAA",fontVariantNumeric:"tabular-nums",display:"block",marginBottom:2},children:z(s.start)}),t.jsx("p",{style:{margin:0,fontSize:13,color:r===l?"#F1F1F1":"#CCCCCC",lineHeight:1.5},children:s.text})]},l))})}const D={ok:"#4ade80",warn:"#facc15",error:"#f87171"},ie={ok:"✓",warn:"⚠",error:"✗"};function O({segments:e,errorDetails:r,diagnostics:o}){const i=e.reduce((s,l)=>s+l.text.split(" ").length,0),n=e.length>0?e[e.length-1].start+e[e.length-1].duration:0;return t.jsxs("div",{style:{padding:16,fontSize:13,color:"#AAAAAA",overflowY:"auto",flex:1},children:[t.jsx("h3",{style:{color:"#F1F1F1",marginTop:0,marginBottom:12},children:"Debug Details"}),o&&o.steps.length>0&&t.jsxs("div",{style:{marginBottom:20},children:[t.jsx("h4",{style:{color:"#F1F1F1",marginTop:0,marginBottom:8,fontSize:12,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Pipeline Steps"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:o.steps.map((s,l)=>t.jsxs("div",{style:{background:"#1A1A1A",borderRadius:4,padding:"8px 10px",borderLeft:`3px solid ${D[s.status]??"#555"}`},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:s.detail?4:0},children:[t.jsx("span",{style:{color:D[s.status]??"#555",fontWeight:700,fontSize:12,minWidth:14},children:ie[s.status]??"?"}),t.jsx("span",{style:{color:"#F1F1F1",fontWeight:500},children:s.label})]}),s.detail&&t.jsx("div",{style:{marginLeft:20,color:"#AAAAAA",fontSize:11,wordBreak:"break-all"},children:s.detail})]},l))})]}),r&&t.jsxs("div",{style:{marginBottom:20,padding:12,background:"rgba(248,113,113,0.08)",border:"1px solid #f87171",color:"#f87171",borderRadius:4},children:[t.jsx("strong",{style:{display:"block",marginBottom:6,fontSize:11,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Full Error Trace"}),t.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:11,wordBreak:"break-all"},children:r})]}),t.jsx("h4",{style:{color:"#F1F1F1",marginTop:0,marginBottom:8,fontSize:12,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Transcript Stats"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:16},children:[{label:"Segments",value:e.length},{label:"Duration",value:`${Math.round(n)}s`},{label:"Words",value:i},{label:"Avg words/seg",value:e.length>0?Math.round(i/e.length):0}].map(({label:s,value:l})=>t.jsxs("div",{style:{background:"#1A1A1A",borderRadius:4,padding:"8px 10px"},children:[t.jsx("div",{style:{fontSize:11,color:"#777",marginBottom:2},children:s}),t.jsx("div",{style:{color:"#F1F1F1",fontWeight:600},children:l})]},s))}),e.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("h4",{style:{color:"#F1F1F1",marginBottom:8,fontSize:12,textTransform:"uppercase",letterSpacing:"0.05em"},children:"First Segment"}),t.jsx("pre",{style:{background:"#1A1A1A",padding:8,borderRadius:4,overflowX:"auto",whiteSpace:"pre-wrap",fontSize:11},children:JSON.stringify(e[0],null,2)}),t.jsx("h4",{style:{color:"#F1F1F1",marginBottom:8,fontSize:12,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Last Segment"}),t.jsx("pre",{style:{background:"#1A1A1A",padding:8,borderRadius:4,overflowX:"auto",whiteSpace:"pre-wrap",fontSize:11},children:JSON.stringify(e[e.length-1],null,2)})]})]})}function ae(){const[e,r]=p.useState(!1),[o,i]=p.useState("search"),[n,s]=p.useState("idle"),[l,a]=p.useState(0),[u,h]=p.useState(""),[b,F]=p.useState(null),[m,f]=p.useState(null),[S,A]=p.useState([]),[k,j]=p.useState([]),[T,w]=p.useState(H),C=p.useRef(null);p.useEffect(()=>{chrome.runtime.sendMessage({type:"GET_SETTINGS"},d=>{d&&w(d)})},[]),p.useEffect(()=>{if(!e||n!=="idle")return;const d=G(window.location.href);if(!d){h("Could not find a video on this page."),s("error");return}C.current=d,c(d)},[e]);async function c(d){try{s("fetching"),F(null),f(null);const{segments:g,diagnostics:x}=await X(d);f(x);const v=V(g);if(A(v),T.semanticSearchEnabled){s("embedding");const E=await Q(v,M=>a(M));j(E)}s("ready")}catch(g){h("Failed to load transcript."),F(g instanceof Error?g.stack||g.message:String(g));const x=g.diagnostics;x&&f(x),s("error")}}const y=[{id:"search",label:"Search"},{id:"chat",label:"Chat"},{id:"transcript",label:"Transcript"},{id:"details",label:"Details"}];return t.jsxs("div",{style:{pointerEvents:"auto"},children:[t.jsx("button",{onClick:()=>r(d=>!d),style:{position:"fixed",top:"50%",right:e?"380px":"0px",transform:"translateY(-50%)",transition:"right 0.3s ease",zIndex:1e4,background:"#FF0000",color:"white",border:"none",borderRadius:"6px 0 0 6px",padding:"12px 6px",cursor:"pointer",fontSize:"10px",fontWeight:"bold",letterSpacing:"1px",writingMode:"vertical-rl",textOrientation:"mixed"},title:e?"Close transcript panel":"Open transcript search",children:"TRANSCRIPT"}),t.jsxs("div",{style:{position:"fixed",top:0,right:e?0:"-380px",width:"380px",height:"100vh",background:"#0F0F0F",borderLeft:"1px solid #3F3F3F",display:"flex",flexDirection:"column",transition:"right 0.3s ease",zIndex:9999,fontFamily:"'Roboto', 'Arial', sans-serif",color:"#F1F1F1",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"14px 16px 0",borderBottom:"1px solid #3F3F3F",background:"#0F0F0F"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[t.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:"#FF0000",flexShrink:0}}),t.jsx("span",{style:{fontWeight:700,fontSize:14},children:"Transcript Search"}),t.jsxs("span",{style:{marginLeft:"auto",fontSize:11,color:"#AAAAAA"},children:[n==="ready"&&`${S.length} chunks`,n==="embedding"&&`Embedding… ${l}%`,n==="fetching"&&"Fetching…"]}),t.jsx("button",{onClick:()=>r(!1),title:"Close",style:{marginLeft:8,background:"transparent",border:"none",color:"#AAAAAA",cursor:"pointer",fontSize:18,lineHeight:1,padding:"0 2px",flexShrink:0},onMouseEnter:d=>d.currentTarget.style.color="#F1F1F1",onMouseLeave:d=>d.currentTarget.style.color="#AAAAAA",children:"×"})]}),t.jsx("div",{style:{display:"flex",gap:2},children:y.map(d=>t.jsx("button",{onClick:()=>i(d.id),style:{flex:1,padding:"8px 0",background:"transparent",border:"none",borderBottom:o===d.id?"2px solid #FF0000":"2px solid transparent",color:o===d.id?"#F1F1F1":"#AAAAAA",cursor:"pointer",fontSize:13,fontWeight:o===d.id?600:400,transition:"all 0.15s"},children:d.label},d.id))})]}),t.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[n==="error"&&t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{padding:16,color:"#f87171",fontSize:13,borderBottom:"1px solid #3F3F3F"},children:[u," Check the ",t.jsx("strong",{children:"Details"})," tab for more information."]}),o==="details"&&t.jsx(O,{segments:S,errorDetails:b,diagnostics:m})]}),(n==="fetching"||n==="embedding")&&t.jsxs("div",{style:{padding:24,textAlign:"center",color:"#AAAAAA",fontSize:13},children:[t.jsx("div",{style:{marginBottom:8},children:n==="fetching"?"Fetching transcript…":`Building search index… ${l}%`}),t.jsx("div",{style:{height:3,background:"#3F3F3F",borderRadius:2,overflow:"hidden"},children:t.jsx("div",{style:{height:"100%",background:"#FF0000",width:n==="fetching"?"30%":`${l}%`,transition:"width 0.3s"}})})]}),n==="ready"&&t.jsxs(t.Fragment,{children:[o==="search"&&t.jsx(ne,{segments:k.length>0?k:S.map((d,g)=>({...d,embedding:[],index:g})),semanticEnabled:T.semanticSearchEnabled&&k.length>0}),o==="chat"&&t.jsx(oe,{segments:S,settings:T,onSettingsChange:w}),o==="transcript"&&t.jsx(se,{segments:S}),o==="details"&&t.jsx(O,{segments:S,errorDetails:b,diagnostics:m})]}),n==="idle"&&t.jsx("div",{style:{padding:24,color:"#AAAAAA",fontSize:13},children:"Opening panel…"})]})]})]})}function $(){if(document.getElementById("yt-transcript-root"))return;const e=document.createElement("div");e.id="yt-transcript-root",e.style.cssText=`
    position: fixed;
    top: 0;
    right: 0;
    height: 100vh;
    z-index: 9999;
    pointer-events: none;
  `,document.body.appendChild(e);const r=e.attachShadow({mode:"open"}),o=document.createElement("div");r.appendChild(o),W(o).render(t.jsx(ae,{}))}function B(){const e=new MutationObserver(()=>{document.querySelector("#player")&&(e.disconnect(),$())});e.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("#player")&&$()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B();document.addEventListener("yt-navigate-finish",()=>{const e=document.getElementById("yt-transcript-root");e&&e.remove(),setTimeout($,500)});
