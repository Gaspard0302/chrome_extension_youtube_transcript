import{Z as E,v as qn,s as It,A as M,g as Tr,N as ze,o as k,u as be,a as A,b as We,l as X,d as Ir,I as $n,c as gr,r as hr,i as Vt,e as Ht,f as et,h as Er,j as ft,k as Ge,m as ut,n as Un,p as Fn,q as Et,t as Jn,w as ie,U as Zt,x as yr,T as Rt,y as Zr,z as Ln,B as Vn,C as Zn,D as Bn,E as Gn,J as zn,F as Wn}from"./types-B0luv8fm.js";import{G as qu,H as $u,L as Uu,K as Fu}from"./types-B0luv8fm.js";const Kn=Symbol("Let zodToJsonSchema decide on which parser to use"),Br={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Yn=e=>typeof e=="string"?{...Br,name:e}:{...Br,...e},Hn=e=>{const t=Yn(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([a,s])=>[s._def,{def:s._def,path:[...t.basePath,t.definitionPath,a],jsonSchema:void 0}]))}};function na(e,t,r,a){a!=null&&a.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function L(e,t,r,a,s){e[t]=r,na(e,t,a,s)}const sa=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function Re(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?sa(t,e.currentPath):t.join("/")}}function Xn(e,t){var a,s,n;const r={type:"array"};return(a=e.type)!=null&&a._def&&((n=(s=e.type)==null?void 0:s._def)==null?void 0:n.typeName)!==E.ZodAny&&(r.items=D(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&L(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&L(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(L(r,"minItems",e.exactLength.value,e.exactLength.message,t),L(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}function Qn(e,t){const r={type:"integer",format:"int64"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"min":t.target==="jsonSchema7"?a.inclusive?L(r,"minimum",a.value,a.message,t):L(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),L(r,"minimum",a.value,a.message,t));break;case"max":t.target==="jsonSchema7"?a.inclusive?L(r,"maximum",a.value,a.message,t):L(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),L(r,"maximum",a.value,a.message,t));break;case"multipleOf":L(r,"multipleOf",a.value,a.message,t);break}return r}function es(){return{type:"boolean"}}function oa(e,t){return D(e.type._def,t)}const ts=(e,t)=>D(e.innerType._def,t);function ia(e,t,r){const a=r??t.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((s,n)=>ia(e,t,s))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return rs(e,t)}}const rs=(e,t)=>{const r={type:"integer",format:"unix-time"};if(t.target==="openApi3")return r;for(const a of e.checks)switch(a.kind){case"min":L(r,"minimum",a.value,a.message,t);break;case"max":L(r,"maximum",a.value,a.message,t);break}return r};function as(e,t){return{...D(e.innerType._def,t),default:e.defaultValue()}}function ns(e,t){return t.effectStrategy==="input"?D(e.schema._def,t):Re(t)}function ss(e){return{type:"string",enum:Array.from(e.values)}}const os=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function is(e,t){const r=[D(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),D(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(n=>!!n);let a=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return r.forEach(n=>{if(os(n))s.push(...n.allOf),n.unevaluatedProperties===void 0&&(a=void 0);else{let o=n;if("additionalProperties"in n&&n.additionalProperties===!1){const{additionalProperties:i,...u}=n;o=u}else a=void 0;s.push(o)}}),s.length?{allOf:s,...a}:void 0}function ls(e,t){const r=typeof e.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[e.value]}:{type:r==="bigint"?"integer":r,const:e.value}}let ir;const Me={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ir===void 0&&(ir=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ir),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function la(e,t){const r={type:"string"};if(e.checks)for(const a of e.checks)switch(a.kind){case"min":L(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":L(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Ne(r,"email",a.message,t);break;case"format:idn-email":Ne(r,"idn-email",a.message,t);break;case"pattern:zod":Te(r,Me.email,a.message,t);break}break;case"url":Ne(r,"uri",a.message,t);break;case"uuid":Ne(r,"uuid",a.message,t);break;case"regex":Te(r,a.regex,a.message,t);break;case"cuid":Te(r,Me.cuid,a.message,t);break;case"cuid2":Te(r,Me.cuid2,a.message,t);break;case"startsWith":Te(r,RegExp(`^${lr(a.value,t)}`),a.message,t);break;case"endsWith":Te(r,RegExp(`${lr(a.value,t)}$`),a.message,t);break;case"datetime":Ne(r,"date-time",a.message,t);break;case"date":Ne(r,"date",a.message,t);break;case"time":Ne(r,"time",a.message,t);break;case"duration":Ne(r,"duration",a.message,t);break;case"length":L(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,t),L(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":{Te(r,RegExp(lr(a.value,t)),a.message,t);break}case"ip":{a.version!=="v6"&&Ne(r,"ipv4",a.message,t),a.version!=="v4"&&Ne(r,"ipv6",a.message,t);break}case"base64url":Te(r,Me.base64url,a.message,t);break;case"jwt":Te(r,Me.jwt,a.message,t);break;case"cidr":{a.version!=="v6"&&Te(r,Me.ipv4Cidr,a.message,t),a.version!=="v4"&&Te(r,Me.ipv6Cidr,a.message,t);break}case"emoji":Te(r,Me.emoji(),a.message,t);break;case"ulid":{Te(r,Me.ulid,a.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Ne(r,"binary",a.message,t);break}case"contentEncoding:base64":{L(r,"contentEncoding","base64",a.message,t);break}case"pattern:zod":{Te(r,Me.base64,a.message,t);break}}break}case"nanoid":Te(r,Me.nanoid,a.message,t)}return r}function lr(e,t){return t.patternStrategy==="escape"?cs(e):e}const us=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function cs(e){let t="";for(let r=0;r<e.length;r++)us.has(e[r])||(t+="\\"),t+=e[r];return t}function Ne(e,t,r,a){var s;e.format||(s=e.anyOf)!=null&&s.some(n=>n.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):L(e,"format",t,r,a)}function Te(e,t,r,a){var s;e.pattern||(s=e.allOf)!=null&&s.some(n=>n.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:Gr(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):L(e,"pattern",Gr(t,a),r,a)}function Gr(e,t){var u;if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source;let s="",n=!1,o=!1,i=!1;for(let l=0;l<a.length;l++){if(n){s+=a[l],n=!1;continue}if(r.i){if(o){if(a[l].match(/[a-z]/)){i?(s+=a[l],s+=`${a[l-2]}-${a[l]}`.toUpperCase(),i=!1):a[l+1]==="-"&&((u=a[l+2])!=null&&u.match(/[a-z]/))?(s+=a[l],i=!0):s+=`${a[l]}${a[l].toUpperCase()}`;continue}}else if(a[l].match(/[a-z]/)){s+=`[${a[l]}${a[l].toUpperCase()}]`;continue}}if(r.m){if(a[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(a[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(r.s&&a[l]==="."){s+=o?`${a[l]}\r
`:`[${a[l]}\r
]`;continue}s+=a[l],a[l]==="\\"?n=!0:o&&a[l]==="]"?o=!1:!o&&a[l]==="["&&(o=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function ua(e,t){var a,s,n,o,i,u;if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&((a=e.keyType)==null?void 0:a._def.typeName)===E.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((l,c)=>({...l,[c]:D(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",c]})??Re(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const r={type:"object",additionalProperties:D(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return r;if(((s=e.keyType)==null?void 0:s._def.typeName)===E.ZodString&&((n=e.keyType._def.checks)!=null&&n.length)){const{type:l,...c}=la(e.keyType._def,t);return{...r,propertyNames:c}}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===E.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(((i=e.keyType)==null?void 0:i._def.typeName)===E.ZodBranded&&e.keyType._def.type._def.typeName===E.ZodString&&((u=e.keyType._def.type._def.checks)!=null&&u.length)){const{type:l,...c}=oa(e.keyType._def,t);return{...r,propertyNames:c}}}return r}function ps(e,t){if(t.mapStrategy==="record")return ua(e,t);const r=D(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Re(t),a=D(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Re(t);return{type:"array",maxItems:125,items:{type:"array",items:[r,a],minItems:2,maxItems:2}}}function ds(e){const t=e.values,a=Object.keys(e.values).filter(n=>typeof t[t[n]]!="number").map(n=>t[n]),s=Array.from(new Set(a.map(n=>typeof n)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:a}}function ms(e){return e.target==="openAi"?void 0:{not:Re({...e,currentPath:[...e.currentPath,"not"]})}}function fs(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Bt={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function gs(e,t){if(t.target==="openApi3")return zr(e,t);const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(a=>a._def.typeName in Bt&&(!a._def.checks||!a._def.checks.length))){const a=r.reduce((s,n)=>{const o=Bt[n._def.typeName];return o&&!s.includes(o)?[...s,o]:s},[]);return{type:a.length>1?a:a[0]}}else if(r.every(a=>a._def.typeName==="ZodLiteral"&&!a.description)){const a=r.reduce((s,n)=>{const o=typeof n._def.value;switch(o){case"string":case"number":case"boolean":return[...s,o];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(a.length===r.length){const s=a.filter((n,o,i)=>i.indexOf(n)===o);return{type:s.length>1?s:s[0],enum:r.reduce((n,o)=>n.includes(o._def.value)?n:[...n,o._def.value],[])}}}else if(r.every(a=>a._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((a,s)=>[...a,...s._def.values.filter(n=>!a.includes(n))],[])};return zr(e,t)}const zr=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((a,s)=>D(a._def,{...t,currentPath:[...t.currentPath,"anyOf",`${s}`]})).filter(a=>!!a&&(!t.strictUnions||typeof a=="object"&&Object.keys(a).length>0));return r.length?{anyOf:r}:void 0};function hs(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:Bt[e.innerType._def.typeName],nullable:!0}:{type:[Bt[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const a=D(e.innerType._def,{...t,currentPath:[...t.currentPath]});return a&&"$ref"in a?{allOf:[a],nullable:!0}:a&&{...a,nullable:!0}}const r=D(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function ys(e,t){const r={type:"number"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"int":r.type="integer",na(r,"type",a.message,t);break;case"min":t.target==="jsonSchema7"?a.inclusive?L(r,"minimum",a.value,a.message,t):L(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),L(r,"minimum",a.value,a.message,t));break;case"max":t.target==="jsonSchema7"?a.inclusive?L(r,"maximum",a.value,a.message,t):L(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),L(r,"maximum",a.value,a.message,t));break;case"multipleOf":L(r,"multipleOf",a.value,a.message,t);break}return r}function vs(e,t){const r=t.target==="openAi",a={type:"object",properties:{}},s=[],n=e.shape();for(const i in n){let u=n[i];if(u===void 0||u._def===void 0)continue;let l=bs(u);l&&r&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);const c=D(u._def,{...t,currentPath:[...t.currentPath,"properties",i],propertyPath:[...t.currentPath,"properties",i]});c!==void 0&&(a.properties[i]=c,l||s.push(i))}s.length&&(a.required=s);const o=ws(e,t);return o!==void 0&&(a.additionalProperties=o),a}function ws(e,t){if(e.catchall._def.typeName!=="ZodNever")return D(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function bs(e){try{return e.isOptional()}catch{return!0}}const _s=(e,t)=>{var a;if(t.currentPath.toString()===((a=t.propertyPath)==null?void 0:a.toString()))return D(e.innerType._def,t);const r=D(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:Re(t)},r]}:Re(t)},xs=(e,t)=>{if(t.pipeStrategy==="input")return D(e.in._def,t);if(t.pipeStrategy==="output")return D(e.out._def,t);const r=D(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=D(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(s=>s!==void 0)}};function Ss(e,t){return D(e.type._def,t)}function Ts(e,t){const a={type:"array",uniqueItems:!0,items:D(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&L(a,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&L(a,"maxItems",e.maxSize.value,e.maxSize.message,t),a}function Is(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,a)=>D(r._def,{...t,currentPath:[...t.currentPath,"items",`${a}`]})).reduce((r,a)=>a===void 0?r:[...r,a],[]),additionalItems:D(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,a)=>D(r._def,{...t,currentPath:[...t.currentPath,"items",`${a}`]})).reduce((r,a)=>a===void 0?r:[...r,a],[])}}function Es(e){return{not:Re(e)}}function Rs(e){return Re(e)}const As=(e,t)=>D(e.innerType._def,t),Ps=(e,t,r)=>{switch(t){case E.ZodString:return la(e,r);case E.ZodNumber:return ys(e,r);case E.ZodObject:return vs(e,r);case E.ZodBigInt:return Qn(e,r);case E.ZodBoolean:return es();case E.ZodDate:return ia(e,r);case E.ZodUndefined:return Es(r);case E.ZodNull:return fs(r);case E.ZodArray:return Xn(e,r);case E.ZodUnion:case E.ZodDiscriminatedUnion:return gs(e,r);case E.ZodIntersection:return is(e,r);case E.ZodTuple:return Is(e,r);case E.ZodRecord:return ua(e,r);case E.ZodLiteral:return ls(e,r);case E.ZodEnum:return ss(e);case E.ZodNativeEnum:return ds(e);case E.ZodNullable:return hs(e,r);case E.ZodOptional:return _s(e,r);case E.ZodMap:return ps(e,r);case E.ZodSet:return Ts(e,r);case E.ZodLazy:return()=>e.getter()._def;case E.ZodPromise:return Ss(e,r);case E.ZodNaN:case E.ZodNever:return ms(r);case E.ZodEffects:return ns(e,r);case E.ZodAny:return Re(r);case E.ZodUnknown:return Rs(r);case E.ZodDefault:return as(e,r);case E.ZodBranded:return oa(e,r);case E.ZodReadonly:return As(e,r);case E.ZodCatch:return ts(e,r);case E.ZodPipeline:return xs(e,r);case E.ZodFunction:case E.ZodVoid:case E.ZodSymbol:return;default:return(a=>{})()}};function D(e,t,r=!1){var i;const a=t.seen.get(e);if(t.override){const u=(i=t.override)==null?void 0:i.call(t,e,t,a,r);if(u!==Kn)return u}if(a&&!r){const u=Cs(a,t);if(u!==void 0)return u}const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);const n=Ps(e,e.typeName,t),o=typeof n=="function"?D(n(),t):n;if(o&&ks(e,t,o),t.postProcess){const u=t.postProcess(o,e,t);return s.jsonSchema=o,u}return s.jsonSchema=o,o}const Cs=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:sa(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,a)=>t.currentPath[a]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Re(t)):t.$refStrategy==="seen"?Re(t):void 0}},ks=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),Ms=(e,t)=>{const r=Hn(t);let a=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[l,c])=>({...u,[l]:D(c._def,{...r,currentPath:[...r.basePath,r.definitionPath,l]},!0)??Re(r)}),{}):void 0;const s=typeof t=="string"?t:(t==null?void 0:t.nameStrategy)==="title"||t==null?void 0:t.name,n=D(e._def,s===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,s]},!1)??Re(r),o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(n.title=o),r.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[r.openAiAnyTypeName]||(a[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));const i=s===void 0?a?{...n,[r.definitionPath]:a}:n:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,s].join("/"),[r.definitionPath]:{...a,[s]:n}};return r.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};var At={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},Pt={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},Ct={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},kt={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},Mt={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},ca=[At,Pt,Ct,kt,Mt],Ns={[At.code]:At,[Pt.code]:Pt,[Ct.code]:Ct,[kt.code]:kt,[Mt.code]:Mt};At.name+"",At.code,Pt.name+"",Pt.code,Ct.name+"",Ct.code,kt.name+"",kt.code,Mt.name+"",Mt.code;var Os=ca.map(e=>e.code),ou=e=>{const t=e.indexOf(":");if(t===-1)throw new Error("Failed to parse stream string. No separator found.");const r=e.slice(0,t);if(!Os.includes(r))throw new Error(`Failed to parse stream string. Invalid code ${r}.`);const a=r,s=e.slice(t+1),n=JSON.parse(s);return Ns[a].parse(n)};function lt(e,t){const r=ca.find(a=>a.name===e);if(!r)throw new Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}function js(e){const t=["ROOT"];let r=-1,a=null;function s(u,l,c){switch(u){case'"':{r=l,t.pop(),t.push(c),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{r=l,a=l,t.pop(),t.push(c),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=l,t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"{":{r=l,t.pop(),t.push(c),t.push("INSIDE_OBJECT_START");break}case"[":{r=l,t.pop(),t.push(c),t.push("INSIDE_ARRAY_START");break}}}function n(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{r=l,t.pop();break}}}function o(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=l,t.pop();break}}}for(let u=0;u<e.length;u++){const l=e[u];switch(t[t.length-1]){case"ROOT":s(l,u,"FINISH");break;case"INSIDE_OBJECT_START":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{r=u,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(l){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{s(l,u,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{n(l,u);break}case"INSIDE_STRING":{switch(l){case'"':{t.pop(),r=u;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:r=u}break}case"INSIDE_ARRAY_START":{switch(l){case"]":{r=u,t.pop();break}default:{r=u,s(l,u,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=u,t.pop();break}default:{r=u;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{s(l,u,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),r=u;break}case"INSIDE_NUMBER":{switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=u;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(l,u);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(l,u);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const p=e.substring(a,u+1);!"false".startsWith(p)&&!"true".startsWith(p)&&!"null".startsWith(p)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(l,u):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u)):r=u;break}}}let i=e.slice(0,r+1);for(let u=t.length-1;u>=0;u--)switch(t[u]){case"INSIDE_STRING":{i+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{i+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{i+="]";break}case"INSIDE_LITERAL":{const c=e.substring(a,e.length);"true".startsWith(c)?i+="true".slice(c.length):"false".startsWith(c)?i+="false".slice(c.length):"null".startsWith(c)&&(i+="null".slice(c.length))}}return i}function pa(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=It({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=It({text:js(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var Ds={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},qs={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},$s={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},Us={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},Fs={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},Js={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},Ls={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},Vs={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},Zs={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},Bs={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},Gs={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},zs={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},Ws={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},Ks={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},Ys={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},Hs={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}},Xt=[Ds,qs,$s,Us,Fs,Js,Ls,Vs,Zs,Bs,Gs,zs,Ws,Ks,Ys,Hs],Xs=Object.fromEntries(Xt.map(e=>[e.code,e]));Object.fromEntries(Xt.map(e=>[e.name,e.code]));var Qs=Xt.map(e=>e.code),eo=e=>{const t=e.indexOf(":");if(t===-1)throw new Error("Failed to parse stream string. No separator found.");const r=e.slice(0,t);if(!Qs.includes(r))throw new Error(`Failed to parse stream string. Invalid code ${r}.`);const a=r,s=e.slice(t+1),n=JSON.parse(s);return Xs[a].parse(n)};function G(e,t){const r=Xt.find(a=>a.name===e);if(!r)throw new Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}var to=10;function ro(e,t){const r=new Uint8Array(t);let a=0;for(const s of e)r.set(s,a),a+=s.length;return e.length=0,r}async function iu({stream:e,onTextPart:t,onReasoningPart:r,onReasoningSignaturePart:a,onRedactedReasoningPart:s,onSourcePart:n,onFilePart:o,onDataPart:i,onErrorPart:u,onToolCallStreamingStartPart:l,onToolCallDeltaPart:c,onToolCallPart:p,onToolResultPart:d,onMessageAnnotationsPart:h,onFinishMessagePart:y,onFinishStepPart:v,onStartStepPart:g}){const m=e.getReader(),b=new TextDecoder,_=[];let w=0;for(;;){const{value:T}=await m.read();if(T&&(_.push(T),w+=T.length,T[T.length-1]!==to))continue;if(_.length===0)break;const I=ro(_,w);w=0;const U=b.decode(I,{stream:!0}).split(`
`).filter(j=>j!=="").map(eo);for(const{type:j,value:V}of U)switch(j){case"text":await(t==null?void 0:t(V));break;case"reasoning":await(r==null?void 0:r(V));break;case"reasoning_signature":await(a==null?void 0:a(V));break;case"redacted_reasoning":await(s==null?void 0:s(V));break;case"file":await(o==null?void 0:o(V));break;case"source":await(n==null?void 0:n(V));break;case"data":await(i==null?void 0:i(V));break;case"error":await(u==null?void 0:u(V));break;case"message_annotations":await(h==null?void 0:h(V));break;case"tool_call_streaming_start":await(l==null?void 0:l(V));break;case"tool_call_delta":await(c==null?void 0:c(V));break;case"tool_call":await(p==null?void 0:p(V));break;case"tool_result":await(d==null?void 0:d(V));break;case"finish_message":await(y==null?void 0:y(V));break;case"finish_step":await(v==null?void 0:v(V));break;case"start_step":await(g==null?void 0:g(V));break;default:{const Y=j;throw new Error(`Unknown stream part type: ${Y}`)}}}}async function lu({stream:e,onTextPart:t}){const r=e.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:a,value:s}=await r.read();if(a)break;await t(s)}}function ao(e){return e==null?void 0:e.reduce((t,r)=>{var a;return Math.max(t,(a=r.step)!=null?a:0)},0)}function Gt(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(typeof e!="object"&&typeof t!="object")return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!Gt(e[s],t[s]))return!1;return!0}const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(const s of r)if(!a.includes(s)||!Gt(e[s],t[s]))return!1;return!0}function no(e,t){var r;const a=(r=t==null?void 0:t.useReferences)!=null?r:!1;return da(Ms(e,{$refStrategy:a?"root":"none",target:"jsonSchema7"}),{validate:s=>{const n=e.safeParse(s);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}var vr=Symbol.for("vercel.ai.schema");function da(e,{validate:t}={}){return{[vr]:!0,_type:void 0,[qn]:!0,jsonSchema:e,validate:t}}function so(e){return typeof e=="object"&&e!==null&&vr in e&&e[vr]===!0&&"jsonSchema"in e&&"validate"in e}function ct(e){return so(e)?e:no(e)}var oo=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},tt="1.9.0",Wr=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function io(e){var t=new Set([e]),r=new Set,a=e.match(Wr);if(!a)return function(){return!1};var s={major:+a[1],minor:+a[2],patch:+a[3],prerelease:a[4]};if(s.prerelease!=null)return function(u){return u===e};function n(i){return r.add(i),!1}function o(i){return t.add(i),!0}return function(u){if(t.has(u))return!0;if(r.has(u))return!1;var l=u.match(Wr);if(!l)return n(u);var c={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return c.prerelease!=null||s.major!==c.major?n(u):s.major===0?s.minor===c.minor&&s.patch<=c.patch?o(u):n(u):s.minor<=c.minor?o(u):n(u)}}var lo=io(tt),uo=tt.split(".")[0],Nt=Symbol.for("opentelemetry.js.api."+uo),Ot=oo;function Rr(e,t,r,a){var s;a===void 0&&(a=!1);var n=Ot[Nt]=(s=Ot[Nt])!==null&&s!==void 0?s:{version:tt};if(!a&&n[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(o.stack||o.message),!1}if(n.version!==tt){var o=new Error("@opentelemetry/api: Registration of version v"+n.version+" for "+e+" does not match previously registered API v"+tt);return r.error(o.stack||o.message),!1}return n[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+tt+"."),!0}function jt(e){var t,r,a=(t=Ot[Nt])===null||t===void 0?void 0:t.version;if(!(!a||!lo(a)))return(r=Ot[Nt])===null||r===void 0?void 0:r[e]}function Ar(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+tt+".");var r=Ot[Nt];r&&delete r[e]}var co=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),s,n=[],o;try{for(;(t===void 0||t-- >0)&&!(s=a.next()).done;)n.push(s.value)}catch(i){o={error:i}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return n},po=function(e,t,r){if(r||arguments.length===2)for(var a=0,s=t.length,n;a<s;a++)(n||!(a in t))&&(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},mo=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return St("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return St("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return St("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return St("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return St("verbose",this._namespace,t)},e}();function St(e,t,r){var a=jt("diag");if(a)return r.unshift(t),a[e].apply(a,po([],co(r),!1))}var Pe;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(Pe||(Pe={}));function fo(e,t){e<Pe.NONE?e=Pe.NONE:e>Pe.ALL&&(e=Pe.ALL),t=t||{};function r(a,s){var n=t[a];return typeof n=="function"&&e>=s?n.bind(t):function(){}}return{error:r("error",Pe.ERROR),warn:r("warn",Pe.WARN),info:r("info",Pe.INFO),debug:r("debug",Pe.DEBUG),verbose:r("verbose",Pe.VERBOSE)}}var go=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),s,n=[],o;try{for(;(t===void 0||t-- >0)&&!(s=a.next()).done;)n.push(s.value)}catch(i){o={error:i}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return n},ho=function(e,t,r){if(r||arguments.length===2)for(var a=0,s=t.length,n;a<s;a++)(n||!(a in t))&&(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},yo="diag",zt=function(){function e(){function t(s){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var i=jt("diag");if(i)return i[s].apply(i,ho([],go(n),!1))}}var r=this,a=function(s,n){var o,i,u;if(n===void 0&&(n={logLevel:Pe.INFO}),s===r){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof n=="number"&&(n={logLevel:n});var c=jt("diag"),p=fo((i=n.logLevel)!==null&&i!==void 0?i:Pe.INFO,s);if(c&&!n.suppressOverrideMessage){var d=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+d),p.warn("Current logger will overwrite one already registered from "+d)}return Rr("diag",p,r,!0)};r.setLogger=a,r.disable=function(){Ar(yo,r)},r.createComponentLogger=function(s){return new mo(s)},r.verbose=t("verbose"),r.debug=t("debug"),r.info=t("info"),r.warn=t("warn"),r.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function vo(e){return Symbol.for(e)}var wo=function(){function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(a){return r._currentContext.get(a)},r.setValue=function(a,s){var n=new e(r._currentContext);return n._currentContext.set(a,s),n},r.deleteValue=function(a){var s=new e(r._currentContext);return s._currentContext.delete(a),s}}return e}(),bo=new wo,_o=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),s,n=[],o;try{for(;(t===void 0||t-- >0)&&!(s=a.next()).done;)n.push(s.value)}catch(i){o={error:i}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return n},xo=function(e,t,r){if(r||arguments.length===2)for(var a=0,s=t.length,n;a<s;a++)(n||!(a in t))&&(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},So=function(){function e(){}return e.prototype.active=function(){return bo},e.prototype.with=function(t,r,a){for(var s=[],n=3;n<arguments.length;n++)s[n-3]=arguments[n];return r.call.apply(r,xo([a],_o(s),!1))},e.prototype.bind=function(t,r){return r},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),To=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),s,n=[],o;try{for(;(t===void 0||t-- >0)&&!(s=a.next()).done;)n.push(s.value)}catch(i){o={error:i}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return n},Io=function(e,t,r){if(r||arguments.length===2)for(var a=0,s=t.length,n;a<s;a++)(n||!(a in t))&&(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},ur="context",Eo=new So,ma=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return Rr(ur,t,zt.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,r,a){for(var s,n=[],o=3;o<arguments.length;o++)n[o-3]=arguments[o];return(s=this._getContextManager()).with.apply(s,Io([t,r,a],To(n),!1))},e.prototype.bind=function(t,r){return this._getContextManager().bind(t,r)},e.prototype._getContextManager=function(){return jt(ur)||Eo},e.prototype.disable=function(){this._getContextManager().disable(),Ar(ur,zt.instance())},e}(),wr;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(wr||(wr={}));var fa="0000000000000000",ga="00000000000000000000000000000000",Ro={traceId:ga,spanId:fa,traceFlags:wr.NONE},Tt=function(){function e(t){t===void 0&&(t=Ro),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,r){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,r){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,r){},e}(),Pr=vo("OpenTelemetry Context Key SPAN");function Cr(e){return e.getValue(Pr)||void 0}function Ao(){return Cr(ma.getInstance().active())}function kr(e,t){return e.setValue(Pr,t)}function Po(e){return e.deleteValue(Pr)}function Co(e,t){return kr(e,new Tt(t))}function ha(e){var t;return(t=Cr(e))===null||t===void 0?void 0:t.spanContext()}var ko=/^([0-9a-f]{32})$/i,Mo=/^[0-9a-f]{16}$/i;function No(e){return ko.test(e)&&e!==ga}function Oo(e){return Mo.test(e)&&e!==fa}function ya(e){return No(e.traceId)&&Oo(e.spanId)}function jo(e){return new Tt(e)}var cr=ma.getInstance(),va=function(){function e(){}return e.prototype.startSpan=function(t,r,a){a===void 0&&(a=cr.active());var s=!!(r!=null&&r.root);if(s)return new Tt;var n=a&&ha(a);return Do(n)&&ya(n)?new Tt(n):new Tt},e.prototype.startActiveSpan=function(t,r,a,s){var n,o,i;if(!(arguments.length<2)){arguments.length===2?i=r:arguments.length===3?(n=r,i=a):(n=r,o=a,i=s);var u=o??cr.active(),l=this.startSpan(t,n,u),c=kr(u,l);return cr.with(c,i,void 0,l)}},e}();function Do(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var qo=new va,$o=function(){function e(t,r,a,s){this._provider=t,this.name=r,this.version=a,this.options=s}return e.prototype.startSpan=function(t,r,a){return this._getTracer().startSpan(t,r,a)},e.prototype.startActiveSpan=function(t,r,a,s){var n=this._getTracer();return Reflect.apply(n.startActiveSpan,n,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):qo},e}(),Uo=function(){function e(){}return e.prototype.getTracer=function(t,r,a){return new va},e}(),Fo=new Uo,Kr=function(){function e(){}return e.prototype.getTracer=function(t,r,a){var s;return(s=this.getDelegateTracer(t,r,a))!==null&&s!==void 0?s:new $o(this,t,r,a)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:Fo},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,r,a){var s;return(s=this._delegate)===null||s===void 0?void 0:s.getTracer(t,r,a)},e}(),Wt;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(Wt||(Wt={}));var pr="trace",Jo=function(){function e(){this._proxyTracerProvider=new Kr,this.wrapSpanContext=jo,this.isSpanContextValid=ya,this.deleteSpan=Po,this.getSpan=Cr,this.getActiveSpan=Ao,this.getSpanContext=ha,this.setSpan=kr,this.setSpanContext=Co}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var r=Rr(pr,this._proxyTracerProvider,zt.instance());return r&&this._proxyTracerProvider.setDelegate(t),r},e.prototype.getTracerProvider=function(){return jt(pr)||this._proxyTracerProvider},e.prototype.getTracer=function(t,r){return this.getTracerProvider().getTracer(t,r)},e.prototype.disable=function(){Ar(pr,zt.instance()),this._proxyTracerProvider=new Kr},e}(),Lo=Jo.getInstance(),Vo=Object.defineProperty,Mr=(e,t)=>{for(var r in t)Vo(e,r,{get:t[r],enumerable:!0})};function wa({execute:e,onError:t=()=>"An error occurred."}){let r;const a=[],s=new ReadableStream({start(i){r=i}});function n(i){try{r.enqueue(i)}catch{}}try{const i=e({write(u){n(u)},writeData(u){n(G("data",[u]))},writeMessageAnnotation(u){n(G("message_annotations",[u]))},writeSource(u){n(G("source",u))},merge(u){a.push((async()=>{const l=u.getReader();for(;;){const{done:c,value:p}=await l.read();if(c)break;n(p)}})().catch(l=>{n(G("error",t(l)))}))},onError:t});i&&a.push(i.catch(u=>{n(G("error",t(u)))}))}catch(i){n(G("error",t(i)))}return new Promise(async i=>{for(;a.length>0;)await a.shift();i()}).finally(()=>{try{r.close()}catch{}}),s}function at(e,{contentType:t,dataStreamVersion:r}){const a=new Headers(e??{});return a.has("Content-Type")||a.set("Content-Type",t),r!==void 0&&a.set("X-Vercel-AI-Data-Stream",r),a}function uu({status:e,statusText:t,headers:r,execute:a,onError:s}){return new Response(wa({execute:a,onError:s}).pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:at(r,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Kt(e,{contentType:t,dataStreamVersion:r}){const a={};if(e!=null)for(const[s,n]of Object.entries(e))a[s]=n;return a["Content-Type"]==null&&(a["Content-Type"]=t),r!==void 0&&(a["X-Vercel-AI-Data-Stream"]=r),a}function Yt({response:e,status:t,statusText:r,headers:a,stream:s}){e.writeHead(t??200,r,a);const n=s.getReader();(async()=>{try{for(;;){const{done:i,value:u}=await n.read();if(i)break;e.write(u)}}catch(i){throw i}finally{e.end()}})()}function cu(e,{status:t,statusText:r,headers:a,execute:s,onError:n}){Yt({response:e,status:t,statusText:r,headers:Kt(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:wa({execute:s,onError:n}).pipeThrough(new TextEncoderStream)})}var Le=class extends M{constructor(){super({name:"AI_UnsupportedModelVersionError",message:'Unsupported model version. AI SDK 4 only supports models that implement specification version "v1". Please upgrade to AI SDK 5 to use this model.'})}},ba="AI_InvalidArgumentError",_a=`vercel.ai.error.${ba}`,Zo=Symbol.for(_a),xa,J=class extends M{constructor({parameter:e,value:t,message:r}){super({name:ba,message:`Invalid argument for parameter ${e}: ${r}`}),this[xa]=!0,this.parameter=e,this.value=t}static isInstance(e){return M.hasMarker(e,_a)}};xa=Zo;var Sa="AI_RetryError",Ta=`vercel.ai.error.${Sa}`,Bo=Symbol.for(Ta),Ia,Yr=class extends M{constructor({message:e,reason:t,errors:r}){super({name:Sa,message:e}),this[Ia]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return M.hasMarker(e,Ta)}};Ia=Bo;var Go=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>Ea(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function Ea(e,{maxRetries:t,delayInMs:r,backoffFactor:a},s=[]){try{return await e()}catch(n){if(Vn(n)||t===0)throw n;const o=Zn(n),i=[...s,n],u=i.length;if(u>t)throw new Yr({message:`Failed after ${u} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:i});if(n instanceof Error&&Bn.isInstance(n)&&n.isRetryable===!0&&u<=t)return await Ir(r),Ea(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},i);throw u===1?n:new Yr({message:`Failed after ${u} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:i})}}function Ve({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new J({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new J({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const t=e??2;return{maxRetries:t,retry:Go({maxRetries:t})}}function ve({operationId:e,telemetry:t}){return{"operation.name":`${e}${(t==null?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":t==null?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":t==null?void 0:t.functionId}}function gt({model:e,settings:t,telemetry:r,headers:a}){var s;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((n,[o,i])=>(n[`ai.settings.${o}`]=i,n),{}),...Object.entries((s=r==null?void 0:r.metadata)!=null?s:{}).reduce((n,[o,i])=>(n[`ai.telemetry.metadata.${o}`]=i,n),{}),...Object.entries(a??{}).reduce((n,[o,i])=>(i!==void 0&&(n[`ai.request.headers.${o}`]=i),n),{})}}var zo={startSpan(){return Lt},startActiveSpan(e,t,r,a){if(typeof t=="function")return t(Lt);if(typeof r=="function")return r(Lt);if(typeof a=="function")return a(Lt)}},Lt={spanContext(){return Wo},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Wo={traceId:"",spanId:"",traceFlags:0};function ht({isEnabled:e=!1,tracer:t}={}){return e?t||Lo.getTracer("ai"):zo}function we({name:e,tracer:t,attributes:r,fn:a,endWhenDone:s=!0}){return t.startActiveSpan(e,{attributes:r},async n=>{try{const o=await a(n);return s&&n.end(),o}catch(o){try{Nr(n,o)}finally{n.end()}throw o}})}function Nr(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:Wt.ERROR,message:t.message})):e.setStatus({code:Wt.ERROR})}function O({telemetry:e,attributes:t}){return(e==null?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((r,[a,s])=>{if(s===void 0)return r;if(typeof s=="object"&&"input"in s&&typeof s.input=="function"){if((e==null?void 0:e.recordInputs)===!1)return r;const n=s.input();return n===void 0?r:{...r,[a]:n}}if(typeof s=="object"&&"output"in s&&typeof s.output=="function"){if((e==null?void 0:e.recordOutputs)===!1)return r;const n=s.output();return n===void 0?r:{...r,[a]:n}}return{...r,[a]:s}},{})}async function pu({model:e,value:t,maxRetries:r,abortSignal:a,headers:s,experimental_telemetry:n}){if(typeof e=="string"||e.specificationVersion!=="v1")throw new Le;const{maxRetries:o,retry:i}=Ve({maxRetries:r}),u=gt({model:e,telemetry:n,headers:s,settings:{maxRetries:o}}),l=ht(n);return we({name:"ai.embed",attributes:O({telemetry:n,attributes:{...ve({operationId:"ai.embed",telemetry:n}),...u,"ai.value":{input:()=>JSON.stringify(t)}}}),tracer:l,fn:async c=>{const{embedding:p,usage:d,rawResponse:h}=await i(()=>we({name:"ai.embed.doEmbed",attributes:O({telemetry:n,attributes:{...ve({operationId:"ai.embed.doEmbed",telemetry:n}),...u,"ai.values":{input:()=>[JSON.stringify(t)]}}}),tracer:l,fn:async y=>{var v;const g=await e.doEmbed({values:[t],abortSignal:a,headers:s}),m=g.embeddings[0],b=(v=g.usage)!=null?v:{tokens:NaN};return y.setAttributes(O({telemetry:n,attributes:{"ai.embeddings":{output:()=>g.embeddings.map(_=>JSON.stringify(_))},"ai.usage.tokens":b.tokens}})),{embedding:m,usage:b,rawResponse:g.rawResponse}}}));return c.setAttributes(O({telemetry:n,attributes:{"ai.embedding":{output:()=>JSON.stringify(p)},"ai.usage.tokens":d.tokens}})),new Ko({value:t,embedding:p,usage:d,rawResponse:h})}})}var Ko=class{constructor(e){this.value=e.value,this.embedding=e.embedding,this.usage=e.usage,this.rawResponse=e.rawResponse}};function Yo(e,t){if(t<=0)throw new Error("chunkSize must be greater than 0");const r=[];for(let a=0;a<e.length;a+=t)r.push(e.slice(a,a+t));return r}async function du({model:e,values:t,maxRetries:r,abortSignal:a,headers:s,experimental_telemetry:n}){if(typeof e=="string"||e.specificationVersion!=="v1")throw new Le;const{maxRetries:o,retry:i}=Ve({maxRetries:r}),u=gt({model:e,telemetry:n,headers:s,settings:{maxRetries:o}}),l=ht(n);return we({name:"ai.embedMany",attributes:O({telemetry:n,attributes:{...ve({operationId:"ai.embedMany",telemetry:n}),...u,"ai.values":{input:()=>t.map(c=>JSON.stringify(c))}}}),tracer:l,fn:async c=>{const p=e.maxEmbeddingsPerCall;if(p==null){const{embeddings:v,usage:g}=await i(()=>we({name:"ai.embedMany.doEmbed",attributes:O({telemetry:n,attributes:{...ve({operationId:"ai.embedMany.doEmbed",telemetry:n}),...u,"ai.values":{input:()=>t.map(m=>JSON.stringify(m))}}}),tracer:l,fn:async m=>{var b;const _=await e.doEmbed({values:t,abortSignal:a,headers:s}),w=_.embeddings,T=(b=_.usage)!=null?b:{tokens:NaN};return m.setAttributes(O({telemetry:n,attributes:{"ai.embeddings":{output:()=>w.map(I=>JSON.stringify(I))},"ai.usage.tokens":T.tokens}})),{embeddings:w,usage:T}}}));return c.setAttributes(O({telemetry:n,attributes:{"ai.embeddings":{output:()=>v.map(m=>JSON.stringify(m))},"ai.usage.tokens":g.tokens}})),new Hr({values:t,embeddings:v,usage:g})}const d=Yo(t,p),h=[];let y=0;for(const v of d){const{embeddings:g,usage:m}=await i(()=>we({name:"ai.embedMany.doEmbed",attributes:O({telemetry:n,attributes:{...ve({operationId:"ai.embedMany.doEmbed",telemetry:n}),...u,"ai.values":{input:()=>v.map(b=>JSON.stringify(b))}}}),tracer:l,fn:async b=>{var _;const w=await e.doEmbed({values:v,abortSignal:a,headers:s}),T=w.embeddings,I=(_=w.usage)!=null?_:{tokens:NaN};return b.setAttributes(O({telemetry:n,attributes:{"ai.embeddings":{output:()=>T.map(U=>JSON.stringify(U))},"ai.usage.tokens":I.tokens}})),{embeddings:T,usage:I}}}));h.push(...g),y+=m.tokens}return c.setAttributes(O({telemetry:n,attributes:{"ai.embeddings":{output:()=>h.map(v=>JSON.stringify(v))},"ai.usage.tokens":y}})),new Hr({values:t,embeddings:h,usage:{tokens:y}})}})}var Hr=class{constructor(e){this.values=e.values,this.embeddings=e.embeddings,this.usage=e.usage}},Ra="AI_NoImageGeneratedError",Aa=`vercel.ai.error.${Ra}`,Ho=Symbol.for(Aa),Pa,Xo=class extends M{constructor({message:e="No image generated.",cause:t,responses:r}){super({name:Ra,message:e,cause:t}),this[Pa]=!0,this.responses=r}static isInstance(e){return M.hasMarker(e,Aa)}};Pa=Ho;var Qt=class{constructor({data:e,mimeType:t}){const r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mimeType=t}get base64(){return this.base64Data==null&&(this.base64Data=gr(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=Er(this.base64Data)),this.uint8ArrayData}},Qo=class extends Qt{constructor(e){super(e),this.type="file"}},Ca=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],ka=[{mimeType:"audio/mpeg",bytesPrefix:[255,251],base64Prefix:"//s="},{mimeType:"audio/wav",bytesPrefix:[82,73,70,70],base64Prefix:"UklGR"},{mimeType:"audio/ogg",bytesPrefix:[79,103,103,83],base64Prefix:"T2dnUw"},{mimeType:"audio/flac",bytesPrefix:[102,76,97,67],base64Prefix:"ZkxhQw"},{mimeType:"audio/aac",bytesPrefix:[64,21,0,0],base64Prefix:"QBUA"},{mimeType:"audio/mp4",bytesPrefix:[102,116,121,112],base64Prefix:"ZnR5cA"}],ei=e=>{const t=typeof e=="string"?Er(e):e,r=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(r+10)};function ti(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?ei(e):e}function er({data:e,signatures:t}){const r=ti(e);for(const a of t)if(typeof r=="string"?r.startsWith(a.base64Prefix):r.length>=a.bytesPrefix.length&&a.bytesPrefix.every((s,n)=>r[n]===s))return a.mimeType}async function mu({model:e,prompt:t,n:r=1,size:a,aspectRatio:s,seed:n,providerOptions:o,maxRetries:i,abortSignal:u,headers:l}){var c;if(typeof e=="string"||e.specificationVersion!=="v1")throw new Le;const{retry:p}=Ve({maxRetries:i}),d=(c=e.maxImagesPerCall)!=null?c:1,h=Math.ceil(r/d),y=Array.from({length:h},(_,w)=>{if(w<h-1)return d;const T=r%d;return T===0?d:T}),v=await Promise.all(y.map(async _=>p(()=>e.doGenerate({prompt:t,n:_,abortSignal:u,headers:l,size:a,aspectRatio:s,seed:n,providerOptions:o??{}})))),g=[],m=[],b=[];for(const _ of v)g.push(..._.images.map(w=>{var T;return new Qt({data:w,mimeType:(T=er({data:w,signatures:Ca}))!=null?T:"image/png"})})),m.push(..._.warnings),b.push(_.response);if(!g.length)throw new Xo({responses:b});return new ri({images:g,warnings:m,responses:b})}var ri=class{constructor(e){this.images=e.images,this.warnings=e.warnings,this.responses=e.responses}get image(){return this.images[0]}},Ma="AI_NoObjectGeneratedError",Na=`vercel.ai.error.${Ma}`,ai=Symbol.for(Na),Oa,Je=class extends M{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:s,finishReason:n}){super({name:Ma,message:e,cause:t}),this[Oa]=!0,this.text=r,this.response=a,this.usage=s,this.finishReason=n}static isInstance(e){return M.hasMarker(e,Na)}};Oa=ai;var ja="AI_DownloadError",Da=`vercel.ai.error.${ja}`,ni=Symbol.for(Da),qa,dr=class extends M{constructor({url:e,statusCode:t,statusText:r,cause:a,message:s=a==null?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:ja,message:s,cause:a}),this[qa]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return M.hasMarker(e,Da)}};qa=ni;async function $a({url:e}){var t;const r=e.toString();try{const a=await fetch(r);if(!a.ok)throw new dr({url:r,statusCode:a.status,statusText:a.statusText});return{data:new Uint8Array(await a.arrayBuffer()),mimeType:(t=a.headers.get("content-type"))!=null?t:void 0}}catch(a){throw dr.isInstance(a)?a:new dr({url:r,cause:a})}}var Ua="AI_InvalidDataContentError",Fa=`vercel.ai.error.${Ua}`,si=Symbol.for(Fa),Ja,Xr=class extends M{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:Ua,message:r,cause:t}),this[Ja]=!0,this.content=e}static isInstance(e){return M.hasMarker(e,Fa)}};Ja=si;var La=be([A(),Vt(Uint8Array),Vt(ArrayBuffer),Jn(e=>{var t,r;return(r=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?r:!1},{message:"Must be a Buffer"})]);function tr(e){return typeof e=="string"?e:e instanceof ArrayBuffer?gr(new Uint8Array(e)):gr(e)}function Dt(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return Er(e)}catch(t){throw new Xr({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Xr({content:e})}function oi(e){try{return new TextDecoder().decode(e)}catch{throw new Error("Error decoding Uint8Array to text")}}var Va="AI_InvalidMessageRoleError",Za=`vercel.ai.error.${Va}`,ii=Symbol.for(Za),Ba,li=class extends M{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Va,message:t}),this[Ba]=!0,this.role=e}static isInstance(e){return M.hasMarker(e,Za)}};Ba=ii;function ui(e){try{const[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch{return{mimeType:void 0,base64Content:void 0}}}async function pt({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=$a}){const s=await pi(e.messages,a,t,r);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(n=>ci(n,s))]}function ci(e,t){var r,a,s,n,o,i;const u=e.role;switch(u){case"system":return{role:"system",content:e.content,providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata}:{role:"user",content:e.content.map(l=>di(l,t)).filter(l=>l.type!=="text"||l.text!==""),providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(l=>l.type!=="text"||l.text!=="").map(l=>{var c;const p=(c=l.providerOptions)!=null?c:l.experimental_providerMetadata;switch(l.type){case"file":return{type:"file",data:l.data instanceof URL?l.data:tr(l.data),filename:l.filename,mimeType:l.mimeType,providerMetadata:p};case"reasoning":return{type:"reasoning",text:l.text,signature:l.signature,providerMetadata:p};case"redacted-reasoning":return{type:"redacted-reasoning",data:l.data,providerMetadata:p};case"text":return{type:"text",text:l.text,providerMetadata:p};case"tool-call":return{type:"tool-call",toolCallId:l.toolCallId,toolName:l.toolName,args:l.args,providerMetadata:p}}}),providerMetadata:(o=e.providerOptions)!=null?o:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(l=>{var c;return{type:"tool-result",toolCallId:l.toolCallId,toolName:l.toolName,result:l.result,content:l.experimental_content,isError:l.isError,providerMetadata:(c=l.providerOptions)!=null?c:l.experimental_providerMetadata}}),providerMetadata:(i=e.providerOptions)!=null?i:e.experimental_providerMetadata};default:{const l=u;throw new li({role:l})}}}async function pi(e,t,r,a){const s=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>!(o.type==="image"&&r===!0)).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!a(o)),n=await Promise.all(s.map(async o=>({url:o,data:await t({url:o})})));return Object.fromEntries(n.map(({url:o,data:i})=>[o.toString(),i]))}function di(e,t){var r,a,s,n;if(e.type==="text")return{type:"text",text:e.text,providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata};let o=e.mimeType,i,u,l;const c=e.type;switch(c){case"image":i=e.image;break;case"file":i=e.data;break;default:throw new Error(`Unsupported part type: ${c}`)}try{u=typeof i=="string"?new URL(i):i}catch{u=i}if(u instanceof URL)if(u.protocol==="data:"){const{mimeType:p,base64Content:d}=ui(u.toString());if(p==null||d==null)throw new Error(`Invalid data URL format in part ${c}`);o=p,l=Dt(d)}else{const p=t[u.toString()];p?(l=p.data,o??(o=p.mimeType)):l=u}else l=Dt(u);switch(c){case"image":return l instanceof Uint8Array&&(o=(a=er({data:l,signatures:Ca}))!=null?a:o),{type:"image",image:l,mimeType:o,providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata};case"file":{if(o==null)throw new Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?tr(l):l,filename:e.filename,mimeType:o,providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata}}}}function dt({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:o,seed:i}){if(e!=null){if(!Number.isInteger(e))throw new J({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new J({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new J({parameter:"temperature",value:t,message:"temperature must be a number"});if(r!=null&&typeof r!="number")throw new J({parameter:"topP",value:r,message:"topP must be a number"});if(a!=null&&typeof a!="number")throw new J({parameter:"topK",value:a,message:"topK must be a number"});if(s!=null&&typeof s!="number")throw new J({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(n!=null&&typeof n!="number")throw new J({parameter:"frequencyPenalty",value:n,message:"frequencyPenalty must be a number"});if(i!=null&&!Number.isInteger(i))throw new J({parameter:"seed",value:i,message:"seed must be an integer"});return{maxTokens:e,temperature:t??0,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:o!=null&&o.length>0?o:void 0,seed:i}}function Qr(e){var t,r,a;const s=[];for(const n of e){let o;try{o=new URL(n.url)}catch{throw new Error(`Invalid URL: ${n.url}`)}switch(o.protocol){case"http:":case"https:":{if((t=n.contentType)!=null&&t.startsWith("image/"))s.push({type:"image",image:o});else{if(!n.contentType)throw new Error("If the attachment is not an image, it must specify a content type");s.push({type:"file",data:o,mimeType:n.contentType})}break}case"data:":{let i,u,l;try{[i,u]=n.url.split(","),l=i.split(";")[0].split(":")[1]}catch{throw new Error(`Error processing data URL: ${n.url}`)}if(l==null||u==null)throw new Error(`Invalid data URL format: ${n.url}`);if((r=n.contentType)!=null&&r.startsWith("image/"))s.push({type:"image",image:Dt(u)});else if((a=n.contentType)!=null&&a.startsWith("text/"))s.push({type:"text",text:oi(Dt(u))});else{if(!n.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");s.push({type:"file",data:u,mimeType:n.contentType})}break}default:throw new Error(`Unsupported URL protocol: ${o.protocol}`)}}return s}var Ga="AI_MessageConversionError",za=`vercel.ai.error.${Ga}`,mi=Symbol.for(za),Wa,mr=class extends M{constructor({originalMessage:e,message:t}){super({name:Ga,message:t}),this[Wa]=!0,this.originalMessage=e}static isInstance(e){return M.hasMarker(e,za)}};Wa=mi;function fi(e,t){var r,a;const s=(r=t==null?void 0:t.tools)!=null?r:{},n=[];for(let o=0;o<e.length;o++){const i=e[o],u=o===e.length-1,{role:l,content:c,experimental_attachments:p}=i;switch(l){case"system":{n.push({role:"system",content:c});break}case"user":{if(i.parts==null)n.push({role:"user",content:p?[{type:"text",text:c},...Qr(p)]:c});else{const d=i.parts.filter(h=>h.type==="text").map(h=>({type:"text",text:h.text}));n.push({role:"user",content:p?[...d,...Qr(p)]:d})}break}case"assistant":{if(i.parts!=null){let y=function(){const b=[];for(const w of m)switch(w.type){case"file":case"text":{b.push(w);break}case"reasoning":{for(const T of w.details)switch(T.type){case"text":b.push({type:"reasoning",text:T.text,signature:T.signature});break;case"redacted":b.push({type:"redacted-reasoning",data:T.data});break}break}case"tool-invocation":b.push({type:"tool-call",toolCallId:w.toolInvocation.toolCallId,toolName:w.toolInvocation.toolName,args:w.toolInvocation.args});break;default:{const T=w;throw new Error(`Unsupported part: ${T}`)}}n.push({role:"assistant",content:b});const _=m.filter(w=>w.type==="tool-invocation").map(w=>w.toolInvocation);_.length>0&&n.push({role:"tool",content:_.map(w=>{if(!("result"in w))throw new mr({originalMessage:i,message:"ToolInvocation must have a result: "+JSON.stringify(w)});const{toolCallId:T,toolName:I,result:U}=w,j=s[I];return(j==null?void 0:j.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:T,toolName:I,result:j.experimental_toToolResultContent(U),experimental_content:j.experimental_toToolResultContent(U)}:{type:"tool-result",toolCallId:T,toolName:I,result:U}})}),m=[],g=!1,v++},v=0,g=!1,m=[];for(const b of i.parts)switch(b.type){case"text":{g&&y(),m.push(b);break}case"file":case"reasoning":{m.push(b);break}case"tool-invocation":{((a=b.toolInvocation.step)!=null?a:0)!==v&&y(),m.push(b),g=!0;break}}y();break}const d=i.toolInvocations;if(d==null||d.length===0){n.push({role:"assistant",content:c});break}const h=d.reduce((y,v)=>{var g;return Math.max(y,(g=v.step)!=null?g:0)},0);for(let y=0;y<=h;y++){const v=d.filter(g=>{var m;return((m=g.step)!=null?m:0)===y});v.length!==0&&(n.push({role:"assistant",content:[...u&&c&&y===0?[{type:"text",text:c}]:[],...v.map(({toolCallId:g,toolName:m,args:b})=>({type:"tool-call",toolCallId:g,toolName:m,args:b}))]}),n.push({role:"tool",content:v.map(g=>{if(!("result"in g))throw new mr({originalMessage:i,message:"ToolInvocation must have a result: "+JSON.stringify(g)});const{toolCallId:m,toolName:b,result:_}=g,w=s[b];return(w==null?void 0:w.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:m,toolName:b,result:w.experimental_toToolResultContent(_),experimental_content:w.experimental_toToolResultContent(_)}:{type:"tool-result",toolCallId:m,toolName:b,result:_}})}))}c&&!u&&n.push({role:"assistant",content:c});break}case"data":break;default:{const d=l;throw new mr({originalMessage:i,message:`Unsupported role: ${d}`})}}}return n}var br=Un(()=>be([Fn(),A(),Et(),et(),hr(A(),br),We(br)])),K=hr(A(),hr(A(),br)),gi=We(be([k({type:X("text"),text:A()}),k({type:X("image"),data:A(),mimeType:A().optional()})])),Ka=k({type:X("text"),text:A(),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),hi=k({type:X("image"),image:be([La,Vt(URL)]),mimeType:A().optional(),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),Ya=k({type:X("file"),data:be([La,Vt(URL)]),filename:A().optional(),mimeType:A(),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),yi=k({type:X("reasoning"),text:A(),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),vi=k({type:X("redacted-reasoning"),data:A(),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),wi=k({type:X("tool-call"),toolCallId:A(),toolName:A(),args:Ht(),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),bi=k({type:X("tool-result"),toolCallId:A(),toolName:A(),result:Ht(),content:gi.optional(),isError:et().optional(),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),_i=k({role:X("system"),content:A(),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),xi=k({role:X("user"),content:be([A(),We(be([Ka,hi,Ya]))]),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),Si=k({role:X("assistant"),content:be([A(),We(be([Ka,Ya,yi,vi,wi]))]),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),Ti=k({role:X("tool"),content:We(bi),providerOptions:K.optional(),experimental_providerMetadata:K.optional()}),Ii=be([_i,xi,Si,Ti]);function mt({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new Ge({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new Ge({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new Ge({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new Ge({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){const a=Ei(e.messages)==="ui-messages"?fi(e.messages,{tools:t}):e.messages;if(a.length===0)throw new Ge({prompt:e,message:"messages must not be empty"});const s=ut({value:a,schema:We(Ii)});if(!s.success)throw new Ge({prompt:e,message:["message must be a CoreMessage or a UI message",`Validation error: ${s.error.message}`].join(`
`),cause:s.error});return{type:"messages",messages:a,system:e.system}}throw new Error("unreachable")}function Ei(e){if(!Array.isArray(e))throw new Ge({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received non-array value: ${JSON.stringify(e)}`].join(`
`),cause:e});if(e.length===0)return"messages";const t=e.map(Ri);if(t.some(a=>a==="has-ui-specific-parts"))return"ui-messages";const r=t.findIndex(a=>a!=="has-core-specific-parts"&&a!=="message");if(r===-1)return"messages";throw new Ge({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received message of type: "${t[r]}" at index ${r}`,`messages[${r}]: ${JSON.stringify(e[r])}`].join(`
`),cause:e})}function Ri(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function Fe({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function Ha(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}var Ai="JSON schema:",Pi="You MUST answer with a JSON object that matches the JSON schema above.",Ci="You MUST answer with JSON.";function qt({prompt:e,schema:t,schemaPrefix:r=t!=null?Ai:void 0,schemaSuffix:a=t!=null?Pi:Ci}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,r,t!=null?JSON.stringify(t):void 0,a].filter(s=>s!=null).join(`
`)}function rt(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{const r=t.getReader();return{async next(){const{done:a,value:s}=await r.read();return a?{done:!0,value:void 0}:{done:!1,value:s}}}},t}var ki={type:"no-schema",jsonSchema:void 0,validatePartialResult({value:e,textDelta:t}){return{success:!0,value:{partial:e,textDelta:t}}},validateFinalResult(e,t){return e===void 0?{success:!1,error:new Je({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e}},createElementStream(){throw new Zt({functionality:"element streams in no-schema mode"})}},Mi=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult({value:t,textDelta:r}){return{success:!0,value:{partial:t,textDelta:r}}},validateFinalResult(t){return ut({value:t,schema:e})},createElementStream(){throw new Zt({functionality:"element streams in object mode"})}}),Ni=e=>{const{$schema:t,...r}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1},validatePartialResult({value:a,latestObject:s,isFirstDelta:n,isFinalDelta:o}){var i;if(!yr(a)||!Zr(a.elements))return{success:!1,error:new Rt({value:a,cause:"value must be an object that contains an array of elements"})};const u=a.elements,l=[];for(let d=0;d<u.length;d++){const h=u[d],y=ut({value:h,schema:e});if(!(d===u.length-1&&!o)){if(!y.success)return y;l.push(y.value)}}const c=(i=s==null?void 0:s.length)!=null?i:0;let p="";return n&&(p+="["),c>0&&(p+=","),p+=l.slice(c).map(d=>JSON.stringify(d)).join(","),o&&(p+="]"),{success:!0,value:{partial:l,textDelta:p}}},validateFinalResult(a){if(!yr(a)||!Zr(a.elements))return{success:!1,error:new Rt({value:a,cause:"value must be an object that contains an array of elements"})};const s=a.elements;for(const n of s){const o=ut({value:n,schema:e});if(!o.success)return o}return{success:!0,value:s}},createElementStream(a){let s=0;return rt(a.pipeThrough(new TransformStream({transform(n,o){switch(n.type){case"object":{const i=n.object;for(;s<i.length;s++)o.enqueue(i[s]);break}case"text-delta":case"finish":case"error":break;default:{const i=n;throw new Error(`Unsupported chunk type: ${i}`)}}}})))}}},Oi=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(t){if(!yr(t)||typeof t.result!="string")return{success:!1,error:new Rt({value:t,cause:'value must be an object that contains a string in the "result" property.'})};const r=t.result;return e.includes(r)?{success:!0,value:r}:{success:!1,error:new Rt({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new Zt({functionality:"partial results in enum mode"})},createElementStream(){throw new Zt({functionality:"element streams in enum mode"})}});function Xa({output:e,schema:t,enumValues:r}){switch(e){case"object":return Mi(ct(t));case"array":return Ni(ct(t));case"enum":return Oi(r);case"no-schema":return ki;default:{const a=e;throw new Error(`Unsupported output: ${a}`)}}}function Qa({output:e,mode:t,schema:r,schemaName:a,schemaDescription:s,enumValues:n}){if(e!=null&&e!=="object"&&e!=="array"&&e!=="enum"&&e!=="no-schema")throw new J({parameter:"output",value:e,message:"Invalid output type."});if(e==="no-schema"){if(t==="auto"||t==="tool")throw new J({parameter:"mode",value:t,message:'Mode must be "json" for no-schema output.'});if(r!=null)throw new J({parameter:"schema",value:r,message:"Schema is not supported for no-schema output."});if(s!=null)throw new J({parameter:"schemaDescription",value:s,message:"Schema description is not supported for no-schema output."});if(a!=null)throw new J({parameter:"schemaName",value:a,message:"Schema name is not supported for no-schema output."});if(n!=null)throw new J({parameter:"enumValues",value:n,message:"Enum values are not supported for no-schema output."})}if(e==="object"){if(r==null)throw new J({parameter:"schema",value:r,message:"Schema is required for object output."});if(n!=null)throw new J({parameter:"enumValues",value:n,message:"Enum values are not supported for object output."})}if(e==="array"){if(r==null)throw new J({parameter:"schema",value:r,message:"Element schema is required for array output."});if(n!=null)throw new J({parameter:"enumValues",value:n,message:"Enum values are not supported for array output."})}if(e==="enum"){if(r!=null)throw new J({parameter:"schema",value:r,message:"Schema is not supported for enum output."});if(s!=null)throw new J({parameter:"schemaDescription",value:s,message:"Schema description is not supported for enum output."});if(a!=null)throw new J({parameter:"schemaName",value:a,message:"Schema name is not supported for enum output."});if(n==null)throw new J({parameter:"enumValues",value:n,message:"Enum values are required for enum output."});for(const o of n)if(typeof o!="string")throw new J({parameter:"enumValues",value:o,message:"Enum values must be strings."})}}function rr(e){const t=e.map(r=>({...r,content:typeof r.content=="string"?r.content:r.content.map(ji)}));return JSON.stringify(t)}function ji(e){return e.type==="image"?{...e,image:e.image instanceof Uint8Array?tr(e.image):e.image}:e}var Di=ft({prefix:"aiobj",size:24});async function fu({model:e,enum:t,schema:r,schemaName:a,schemaDescription:s,mode:n,output:o="object",system:i,prompt:u,messages:l,maxRetries:c,abortSignal:p,headers:d,experimental_repairText:h,experimental_telemetry:y,experimental_providerMetadata:v,providerOptions:g=v,_internal:{generateId:m=Di,currentDate:b=()=>new Date}={},..._}){if(typeof e=="string"||e.specificationVersion!=="v1")throw new Le;Qa({output:o,mode:n,schema:r,schemaName:a,schemaDescription:s,enumValues:t});const{maxRetries:w,retry:T}=Ve({maxRetries:c}),I=Xa({output:o,schema:r,enumValues:t});I.type==="no-schema"&&n===void 0&&(n="json");const U=gt({model:e,telemetry:y,headers:d,settings:{..._,maxRetries:w}}),j=ht(y);return we({name:"ai.generateObject",attributes:O({telemetry:y,attributes:{...ve({operationId:"ai.generateObject",telemetry:y}),...U,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:u,messages:l})},"ai.schema":I.jsonSchema!=null?{input:()=>JSON.stringify(I.jsonSchema)}:void 0,"ai.schema.name":a,"ai.schema.description":s,"ai.settings.output":I.type,"ai.settings.mode":n}}),tracer:j,fn:async V=>{var Y,re,_e,Ie;(n==="auto"||n==null)&&(n=e.defaultObjectGenerationMode);let me,ne,se,Q,fe,le,xe,W,ue;switch(n){case"json":{const q=mt({prompt:{system:I.jsonSchema==null?qt({prompt:i}):e.supportsStructuredOutputs?i:qt({prompt:i,schema:I.jsonSchema}),prompt:u,messages:l},tools:void 0}),Z=await pt({prompt:q,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(Y=e.supportsUrl)==null?void 0:Y.bind(e)}),F=await T(()=>we({name:"ai.generateObject.doGenerate",attributes:O({telemetry:y,attributes:{...ve({operationId:"ai.generateObject.doGenerate",telemetry:y}),...U,"ai.prompt.format":{input:()=>q.type},"ai.prompt.messages":{input:()=>JSON.stringify(Z)},"ai.settings.mode":n,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":_.frequencyPenalty,"gen_ai.request.max_tokens":_.maxTokens,"gen_ai.request.presence_penalty":_.presencePenalty,"gen_ai.request.temperature":_.temperature,"gen_ai.request.top_k":_.topK,"gen_ai.request.top_p":_.topP}}),tracer:j,fn:async $=>{var S,z,he,ye,Se,P;const x=await e.doGenerate({mode:{type:"object-json",schema:I.jsonSchema,name:a,description:s},...dt(_),inputFormat:q.type,prompt:Z,providerMetadata:g,abortSignal:p,headers:d}),R={id:(z=(S=x.response)==null?void 0:S.id)!=null?z:m(),timestamp:(ye=(he=x.response)==null?void 0:he.timestamp)!=null?ye:b(),modelId:(P=(Se=x.response)==null?void 0:Se.modelId)!=null?P:e.modelId};if(x.text===void 0)throw new Je({message:"No object generated: the model did not return a response.",response:R,usage:Fe(x.usage),finishReason:x.finishReason});return $.setAttributes(O({telemetry:y,attributes:{"ai.response.finishReason":x.finishReason,"ai.response.object":{output:()=>x.text},"ai.response.id":R.id,"ai.response.model":R.modelId,"ai.response.timestamp":R.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(x.providerMetadata),"ai.usage.promptTokens":x.usage.promptTokens,"ai.usage.completionTokens":x.usage.completionTokens,"gen_ai.response.finish_reasons":[x.finishReason],"gen_ai.response.id":R.id,"gen_ai.response.model":R.modelId,"gen_ai.usage.prompt_tokens":x.usage.promptTokens,"gen_ai.usage.completion_tokens":x.usage.completionTokens}})),{...x,objectText:x.text,responseData:R}}}));me=F.objectText,ne=F.finishReason,se=F.usage,Q=F.warnings,fe=F.rawResponse,W=F.logprobs,ue=F.providerMetadata,xe=(re=F.request)!=null?re:{},le=F.responseData;break}case"tool":{const q=mt({prompt:{system:i,prompt:u,messages:l},tools:void 0}),Z=await pt({prompt:q,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(_e=e.supportsUrl)==null?void 0:_e.bind(e)}),F=q.type,$=await T(()=>we({name:"ai.generateObject.doGenerate",attributes:O({telemetry:y,attributes:{...ve({operationId:"ai.generateObject.doGenerate",telemetry:y}),...U,"ai.prompt.format":{input:()=>F},"ai.prompt.messages":{input:()=>rr(Z)},"ai.settings.mode":n,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":_.frequencyPenalty,"gen_ai.request.max_tokens":_.maxTokens,"gen_ai.request.presence_penalty":_.presencePenalty,"gen_ai.request.temperature":_.temperature,"gen_ai.request.top_k":_.topK,"gen_ai.request.top_p":_.topP}}),tracer:j,fn:async S=>{var z,he,ye,Se,P,x,R,ee;const N=await e.doGenerate({mode:{type:"object-tool",tool:{type:"function",name:a??"json",description:s??"Respond with a JSON object.",parameters:I.jsonSchema}},...dt(_),inputFormat:F,prompt:Z,providerMetadata:g,abortSignal:p,headers:d}),f=(he=(z=N.toolCalls)==null?void 0:z[0])==null?void 0:he.args,B={id:(Se=(ye=N.response)==null?void 0:ye.id)!=null?Se:m(),timestamp:(x=(P=N.response)==null?void 0:P.timestamp)!=null?x:b(),modelId:(ee=(R=N.response)==null?void 0:R.modelId)!=null?ee:e.modelId};if(f===void 0)throw new Je({message:"No object generated: the tool was not called.",response:B,usage:Fe(N.usage),finishReason:N.finishReason});return S.setAttributes(O({telemetry:y,attributes:{"ai.response.finishReason":N.finishReason,"ai.response.object":{output:()=>f},"ai.response.id":B.id,"ai.response.model":B.modelId,"ai.response.timestamp":B.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(N.providerMetadata),"ai.usage.promptTokens":N.usage.promptTokens,"ai.usage.completionTokens":N.usage.completionTokens,"gen_ai.response.finish_reasons":[N.finishReason],"gen_ai.response.id":B.id,"gen_ai.response.model":B.modelId,"gen_ai.usage.input_tokens":N.usage.promptTokens,"gen_ai.usage.output_tokens":N.usage.completionTokens}})),{...N,objectText:f,responseData:B}}}));me=$.objectText,ne=$.finishReason,se=$.usage,Q=$.warnings,fe=$.rawResponse,W=$.logprobs,ue=$.providerMetadata,xe=(Ie=$.request)!=null?Ie:{},le=$.responseData;break}case void 0:throw new Error("Model does not have a default object generation mode.");default:{const q=n;throw new Error(`Unsupported mode: ${q}`)}}function ge(q){const Z=It({text:q});if(!Z.success)throw new Je({message:"No object generated: could not parse the response.",cause:Z.error,text:q,response:le,usage:Fe(se),finishReason:ne});const F=I.validateFinalResult(Z.value,{text:q,response:le,usage:Fe(se)});if(!F.success)throw new Je({message:"No object generated: response did not match schema.",cause:F.error,text:q,response:le,usage:Fe(se),finishReason:ne});return F.value}let ce;try{ce=ge(me)}catch(q){if(h!=null&&Je.isInstance(q)&&(zn.isInstance(q.cause)||Rt.isInstance(q.cause))){const Z=await h({text:me,error:q.cause});if(Z===null)throw q;ce=ge(Z)}else throw q}return V.setAttributes(O({telemetry:y,attributes:{"ai.response.finishReason":ne,"ai.response.object":{output:()=>JSON.stringify(ce)},"ai.usage.promptTokens":se.promptTokens,"ai.usage.completionTokens":se.completionTokens}})),new qi({object:ce,finishReason:ne,usage:Fe(se),warnings:Q,request:xe,response:{...le,headers:fe==null?void 0:fe.headers,body:fe==null?void 0:fe.body},logprobs:W,providerMetadata:ue})}})}var qi=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.experimental_providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.logprobs=e.logprobs}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:at(e==null?void 0:e.headers,{contentType:"application/json; charset=utf-8"})})}},te=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t}),this.promise)}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&((t=this._reject)==null||t.call(this,e))}};function ea(){let e,t;return{promise:new Promise((a,s)=>{e=a,t=s}),resolve:e,reject:t}}function en(){let e=[],t=null,r=!1,a=ea();const s=async()=>{if(r&&e.length===0){t==null||t.close();return}if(e.length===0)return a=ea(),await a.promise,s();try{const{value:n,done:o}=await e[0].read();o?(e.shift(),e.length>0?await s():r&&(t==null||t.close())):t==null||t.enqueue(n)}catch(n){t==null||t.error(n),e.shift(),r&&e.length===0&&(t==null||t.close())}};return{stream:new ReadableStream({start(n){t=n},pull:s,async cancel(){for(const n of e)await n.cancel();e=[],r=!0}}),addStream:n=>{if(r)throw new Error("Cannot add inner stream: outer stream is closed");e.push(n.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),e.length===0&&(t==null||t.close())},terminate:()=>{r=!0,a.resolve(),e.forEach(n=>n.cancel()),e=[],t==null||t.close()}}}function tn(){var e,t;return(t=(e=globalThis==null?void 0:globalThis.performance)==null?void 0:e.now())!=null?t:Date.now()}var $i=ft({prefix:"aiobj",size:24});function gu({model:e,schema:t,schemaName:r,schemaDescription:a,mode:s,output:n="object",system:o,prompt:i,messages:u,maxRetries:l,abortSignal:c,headers:p,experimental_telemetry:d,experimental_providerMetadata:h,providerOptions:y=h,onError:v,onFinish:g,_internal:{generateId:m=$i,currentDate:b=()=>new Date,now:_=tn}={},...w}){if(typeof e=="string"||e.specificationVersion!=="v1")throw new Le;Qa({output:n,mode:s,schema:t,schemaName:r,schemaDescription:a});const T=Xa({output:n,schema:t});return T.type==="no-schema"&&s===void 0&&(s="json"),new Ui({model:e,telemetry:d,headers:p,settings:w,maxRetries:l,abortSignal:c,outputStrategy:T,system:o,prompt:i,messages:u,schemaName:r,schemaDescription:a,providerOptions:y,mode:s,onError:v,onFinish:g,generateId:m,currentDate:b,now:_})}var Ui=class{constructor({model:e,headers:t,telemetry:r,settings:a,maxRetries:s,abortSignal:n,outputStrategy:o,system:i,prompt:u,messages:l,schemaName:c,schemaDescription:p,providerOptions:d,mode:h,onError:y,onFinish:v,generateId:g,currentDate:m,now:b}){this.objectPromise=new te,this.usagePromise=new te,this.providerMetadataPromise=new te,this.warningsPromise=new te,this.requestPromise=new te,this.responsePromise=new te;const{maxRetries:_,retry:w}=Ve({maxRetries:s}),T=gt({model:e,telemetry:r,headers:t,settings:{...a,maxRetries:_}}),I=ht(r),U=this,j=en(),V=new TransformStream({transform(Y,re){re.enqueue(Y),Y.type==="error"&&(y==null||y({error:Y.error}))}});this.baseStream=j.stream.pipeThrough(V),we({name:"ai.streamObject",attributes:O({telemetry:r,attributes:{...ve({operationId:"ai.streamObject",telemetry:r}),...T,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:u,messages:l})},"ai.schema":o.jsonSchema!=null?{input:()=>JSON.stringify(o.jsonSchema)}:void 0,"ai.schema.name":c,"ai.schema.description":p,"ai.settings.output":o.type,"ai.settings.mode":h}}),tracer:I,endWhenDone:!1,fn:async Y=>{var re,_e;(h==="auto"||h==null)&&(h=e.defaultObjectGenerationMode);let Ie,me;switch(h){case"json":{const P=mt({prompt:{system:o.jsonSchema==null?qt({prompt:i}):e.supportsStructuredOutputs?i:qt({prompt:i,schema:o.jsonSchema}),prompt:u,messages:l},tools:void 0});Ie={mode:{type:"object-json",schema:o.jsonSchema,name:c,description:p},...dt(a),inputFormat:P.type,prompt:await pt({prompt:P,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(re=e.supportsUrl)==null?void 0:re.bind(e)}),providerMetadata:d,abortSignal:n,headers:t},me={transform:(x,R)=>{switch(x.type){case"text-delta":R.enqueue(x.textDelta);break;case"response-metadata":case"finish":case"error":R.enqueue(x);break}}};break}case"tool":{const P=mt({prompt:{system:i,prompt:u,messages:l},tools:void 0});Ie={mode:{type:"object-tool",tool:{type:"function",name:c??"json",description:p??"Respond with a JSON object.",parameters:o.jsonSchema}},...dt(a),inputFormat:P.type,prompt:await pt({prompt:P,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(_e=e.supportsUrl)==null?void 0:_e.bind(e)}),providerMetadata:d,abortSignal:n,headers:t},me={transform(x,R){switch(x.type){case"tool-call-delta":R.enqueue(x.argsTextDelta);break;case"response-metadata":case"finish":case"error":R.enqueue(x);break}}};break}case void 0:throw new Error("Model does not have a default object generation mode.");default:{const P=h;throw new Error(`Unsupported mode: ${P}`)}}const{result:{stream:ne,warnings:se,rawResponse:Q,request:fe},doStreamSpan:le,startTimestampMs:xe}=await w(()=>we({name:"ai.streamObject.doStream",attributes:O({telemetry:r,attributes:{...ve({operationId:"ai.streamObject.doStream",telemetry:r}),...T,"ai.prompt.format":{input:()=>Ie.inputFormat},"ai.prompt.messages":{input:()=>rr(Ie.prompt)},"ai.settings.mode":h,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":a.frequencyPenalty,"gen_ai.request.max_tokens":a.maxTokens,"gen_ai.request.presence_penalty":a.presencePenalty,"gen_ai.request.temperature":a.temperature,"gen_ai.request.top_k":a.topK,"gen_ai.request.top_p":a.topP}}),tracer:I,endWhenDone:!1,fn:async P=>({startTimestampMs:b(),doStreamSpan:P,result:await e.doStream(Ie)})}));U.requestPromise.resolve(fe??{});let W,ue,ge,ce,q,Z="",F="",$={id:g(),timestamp:m(),modelId:e.modelId},S,z,he=!0,ye=!0;const Se=ne.pipeThrough(new TransformStream(me)).pipeThrough(new TransformStream({async transform(P,x){var R,ee,N;if(he){const f=b()-xe;he=!1,le.addEvent("ai.stream.firstChunk",{"ai.stream.msToFirstChunk":f}),le.setAttributes({"ai.stream.msToFirstChunk":f})}if(typeof P=="string"){Z+=P,F+=P;const{value:f,state:B}=pa(Z);if(f!==void 0&&!Gt(S,f)){const pe=o.validatePartialResult({value:f,textDelta:F,latestObject:z,isFirstDelta:ye,isFinalDelta:B==="successful-parse"});pe.success&&!Gt(z,pe.value.partial)&&(S=f,z=pe.value.partial,x.enqueue({type:"object",object:z}),x.enqueue({type:"text-delta",textDelta:pe.value.textDelta}),F="",ye=!1)}return}switch(P.type){case"response-metadata":{$={id:(R=P.id)!=null?R:$.id,timestamp:(ee=P.timestamp)!=null?ee:$.timestamp,modelId:(N=P.modelId)!=null?N:$.modelId};break}case"finish":{F!==""&&x.enqueue({type:"text-delta",textDelta:F}),ue=P.finishReason,W=Fe(P.usage),ge=P.providerMetadata,x.enqueue({...P,usage:W,response:$}),U.usagePromise.resolve(W),U.providerMetadataPromise.resolve(ge),U.responsePromise.resolve({...$,headers:Q==null?void 0:Q.headers});const f=o.validateFinalResult(S,{text:Z,response:$,usage:W});f.success?(ce=f.value,U.objectPromise.resolve(ce)):(q=new Je({message:"No object generated: response did not match schema.",cause:f.error,text:Z,response:$,usage:W,finishReason:ue}),U.objectPromise.reject(q));break}default:{x.enqueue(P);break}}},async flush(P){try{const x=W??{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};le.setAttributes(O({telemetry:r,attributes:{"ai.response.finishReason":ue,"ai.response.object":{output:()=>JSON.stringify(ce)},"ai.response.id":$.id,"ai.response.model":$.modelId,"ai.response.timestamp":$.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(ge),"ai.usage.promptTokens":x.promptTokens,"ai.usage.completionTokens":x.completionTokens,"gen_ai.response.finish_reasons":[ue],"gen_ai.response.id":$.id,"gen_ai.response.model":$.modelId,"gen_ai.usage.input_tokens":x.promptTokens,"gen_ai.usage.output_tokens":x.completionTokens}})),le.end(),Y.setAttributes(O({telemetry:r,attributes:{"ai.usage.promptTokens":x.promptTokens,"ai.usage.completionTokens":x.completionTokens,"ai.response.object":{output:()=>JSON.stringify(ce)},"ai.response.providerMetadata":JSON.stringify(ge)}})),await(v==null?void 0:v({usage:x,object:ce,error:q,response:{...$,headers:Q==null?void 0:Q.headers},warnings:se,providerMetadata:ge,experimental_providerMetadata:ge}))}catch(x){P.enqueue({type:"error",error:x})}finally{Y.end()}}}));j.addStream(Se)}}).catch(Y=>{j.addStream(new ReadableStream({start(re){re.enqueue({type:"error",error:Y}),re.close()}}))}).finally(()=>{j.close()}),this.outputStrategy=o}get object(){return this.objectPromise.value}get usage(){return this.usagePromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get warnings(){return this.warningsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get partialObjectStream(){return rt(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"object":t.enqueue(e.object);break;case"text-delta":case"finish":case"error":break;default:{const r=e;throw new Error(`Unsupported chunk type: ${r}`)}}}})))}get elementStream(){return this.outputStrategy.createElementStream(this.baseStream)}get textStream(){return rt(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case"text-delta":t.enqueue(e.textDelta);break;case"object":case"finish":case"error":break;default:{const r=e;throw new Error(`Unsupported chunk type: ${r}`)}}}})))}get fullStream(){return rt(this.baseStream)}pipeTextStreamToResponse(e,t){Yt({response:e,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText,headers:Kt(t==null?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:at(e==null?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},rn="AI_NoOutputSpecifiedError",an=`vercel.ai.error.${rn}`,Fi=Symbol.for(an),nn,sn=class extends M{constructor({message:e="No output specified."}={}){super({name:rn,message:e}),this[nn]=!0}static isInstance(e){return M.hasMarker(e,an)}};nn=Fi;var on="AI_ToolExecutionError",ln=`vercel.ai.error.${on}`,Ji=Symbol.for(ln),un,cn=class extends M{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:s=`Error executing tool ${t}: ${Tr(a)}`}){super({name:on,message:s,cause:a}),this[un]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return M.hasMarker(e,ln)}};un=Ji;function Li(e){return e!=null&&Object.keys(e).length>0}function pn({tools:e,toolChoice:t,activeTools:r}){return Li(e)?{tools:(r!=null?Object.entries(e).filter(([s])=>r.includes(s)):Object.entries(e)).map(([s,n])=>{const o=n.type;switch(o){case void 0:case"function":return{type:"function",name:s,description:n.description,parameters:ct(n.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:s,id:n.id,args:n.args};default:{const i=o;throw new Error(`Unsupported tool type: ${i}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var Vi=/^([\s\S]*?)(\s+)(\S*)$/;function dn(e){const t=e.match(Vi);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}function Zi(e){const t=dn(e);return t?t.prefix+t.whitespace:e}var mn="AI_InvalidToolArgumentsError",fn=`vercel.ai.error.${mn}`,Bi=Symbol.for(fn),gn,hn=class extends M{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${Tr(r)}`}){super({name:mn,message:a,cause:r}),this[gn]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return M.hasMarker(e,fn)}};gn=Bi;var yn="AI_NoSuchToolError",vn=`vercel.ai.error.${yn}`,Gi=Symbol.for(vn),wn,_r=class extends M{constructor({toolName:e,availableTools:t=void 0,message:r=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:yn,message:r}),this[wn]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return M.hasMarker(e,vn)}};wn=Gi;var bn="AI_ToolCallRepairError",_n=`vercel.ai.error.${bn}`,zi=Symbol.for(_n),xn,Wi=class extends M{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${Tr(e)}`}){super({name:bn,message:r,cause:e}),this[xn]=!0,this.originalError=t}static isInstance(e){return M.hasMarker(e,_n)}};xn=zi;async function Sn({toolCall:e,tools:t,repairToolCall:r,system:a,messages:s}){if(t==null)throw new _r({toolName:e.toolName});try{return await ta({toolCall:e,tools:t})}catch(n){if(r==null||!(_r.isInstance(n)||hn.isInstance(n)))throw n;let o=null;try{o=await r({toolCall:e,tools:t,parameterSchema:({toolName:i})=>ct(t[i].parameters).jsonSchema,system:a,messages:s,error:n})}catch(i){throw new Wi({cause:i,originalError:n})}if(o==null)throw n;return await ta({toolCall:o,tools:t})}}async function ta({toolCall:e,tools:t}){const r=e.toolName,a=t[r];if(a==null)throw new _r({toolName:e.toolName,availableTools:Object.keys(t)});const s=ct(a.parameters),n=e.args.trim()===""?ut({value:{},schema:s}):It({text:e.args,schema:s});if(n.success===!1)throw new hn({toolName:r,toolArgs:e.args,cause:n.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:n.value}}function xr(e){const t=e.filter(r=>r.type==="text").map(r=>r.text).join("");return t.length>0?t:void 0}function Sr({text:e="",files:t,reasoning:r,tools:a,toolCalls:s,toolResults:n,messageId:o,generateMessageId:i}){const u=[],l=[];return r.length>0&&l.push(...r.map(c=>c.type==="text"?{...c,type:"reasoning"}:{...c,type:"redacted-reasoning"})),t.length>0&&l.push(...t.map(c=>({type:"file",data:c.base64,mimeType:c.mimeType}))),e.length>0&&l.push({type:"text",text:e}),s.length>0&&l.push(...s),l.length>0&&u.push({role:"assistant",content:l,id:o}),n.length>0&&u.push({role:"tool",id:i(),content:n.map(c=>{const p=a[c.toolName];return(p==null?void 0:p.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:c.toolCallId,toolName:c.toolName,result:p.experimental_toToolResultContent(c.result),experimental_content:p.experimental_toToolResultContent(c.result)}:{type:"tool-result",toolCallId:c.toolCallId,toolName:c.toolName,result:c.result}})}),u}var Ki=ft({prefix:"aitxt",size:24}),Yi=ft({prefix:"msg",size:24});async function hu({model:e,tools:t,toolChoice:r,system:a,prompt:s,messages:n,maxRetries:o,abortSignal:i,headers:u,maxSteps:l=1,experimental_generateMessageId:c=Yi,experimental_output:p,experimental_continueSteps:d=!1,experimental_telemetry:h,experimental_providerMetadata:y,providerOptions:v=y,experimental_activeTools:g,experimental_prepareStep:m,experimental_repairToolCall:b,_internal:{generateId:_=Ki,currentDate:w=()=>new Date}={},onStepFinish:T,...I}){var U;if(typeof e=="string"||e.specificationVersion!=="v1")throw new Le;if(l<1)throw new J({parameter:"maxSteps",value:l,message:"maxSteps must be at least 1"});const{maxRetries:j,retry:V}=Ve({maxRetries:o}),Y=gt({model:e,telemetry:h,headers:u,settings:{...I,maxRetries:j}}),re=mt({prompt:{system:(U=p==null?void 0:p.injectIntoSystemPrompt({system:a,model:e}))!=null?U:a,prompt:s,messages:n},tools:t}),_e=ht(h);return we({name:"ai.generateText",attributes:O({telemetry:h,attributes:{...ve({operationId:"ai.generateText",telemetry:h}),...Y,"ai.model.provider":e.provider,"ai.model.id":e.modelId,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:s,messages:n})},"ai.settings.maxSteps":l}}),tracer:_e,fn:async Ie=>{var me,ne,se,Q,fe,le,xe,W,ue,ge,ce,q,Z,F;const $=dt(I);let S,z=[],he=[],ye=[],Se=0;const P=[];let x="";const R=[],ee=[];let N={completionTokens:0,promptTokens:0,totalTokens:0},f="initial";do{const B=Se===0?re.type:"messages",pe=[...re.messages,...P],ae=await(m==null?void 0:m({model:e,steps:ee,maxSteps:l,stepNumber:Se})),nt=(me=ae==null?void 0:ae.toolChoice)!=null?me:r,nr=(ne=ae==null?void 0:ae.experimental_activeTools)!=null?ne:g,Ee=(se=ae==null?void 0:ae.model)!=null?se:e,yt=await pt({prompt:{type:B,system:re.system,messages:pe},modelSupportsImageUrls:Ee.supportsImageUrls,modelSupportsUrl:(Q=Ee.supportsUrl)==null?void 0:Q.bind(Ee)}),Ze={type:"regular",...pn({tools:t,toolChoice:nt,activeTools:nr})};S=await V(()=>we({name:"ai.generateText.doGenerate",attributes:O({telemetry:h,attributes:{...ve({operationId:"ai.generateText.doGenerate",telemetry:h}),...Y,"ai.model.provider":Ee.provider,"ai.model.id":Ee.modelId,"ai.prompt.format":{input:()=>B},"ai.prompt.messages":{input:()=>rr(yt)},"ai.prompt.tools":{input:()=>{var Ae;return(Ae=Ze.tools)==null?void 0:Ae.map(Ce=>JSON.stringify(Ce))}},"ai.prompt.toolChoice":{input:()=>Ze.toolChoice!=null?JSON.stringify(Ze.toolChoice):void 0},"gen_ai.system":Ee.provider,"gen_ai.request.model":Ee.modelId,"gen_ai.request.frequency_penalty":I.frequencyPenalty,"gen_ai.request.max_tokens":I.maxTokens,"gen_ai.request.presence_penalty":I.presencePenalty,"gen_ai.request.stop_sequences":I.stopSequences,"gen_ai.request.temperature":I.temperature,"gen_ai.request.top_k":I.topK,"gen_ai.request.top_p":I.topP}}),tracer:_e,fn:async Ae=>{var Ce,wt,Ft,bt,Oe,st;const de=await Ee.doGenerate({mode:Ze,...$,inputFormat:B,responseFormat:p==null?void 0:p.responseFormat({model:e}),prompt:yt,providerMetadata:v,abortSignal:i,headers:u}),Ue={id:(wt=(Ce=de.response)==null?void 0:Ce.id)!=null?wt:_(),timestamp:(bt=(Ft=de.response)==null?void 0:Ft.timestamp)!=null?bt:w(),modelId:(st=(Oe=de.response)==null?void 0:Oe.modelId)!=null?st:Ee.modelId};return Ae.setAttributes(O({telemetry:h,attributes:{"ai.response.finishReason":de.finishReason,"ai.response.text":{output:()=>de.text},"ai.response.toolCalls":{output:()=>JSON.stringify(de.toolCalls)},"ai.response.id":Ue.id,"ai.response.model":Ue.modelId,"ai.response.timestamp":Ue.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(de.providerMetadata),"ai.usage.promptTokens":de.usage.promptTokens,"ai.usage.completionTokens":de.usage.completionTokens,"gen_ai.response.finish_reasons":[de.finishReason],"gen_ai.response.id":Ue.id,"gen_ai.response.model":Ue.modelId,"gen_ai.usage.input_tokens":de.usage.promptTokens,"gen_ai.usage.output_tokens":de.usage.completionTokens}})),{...de,response:Ue}}})),z=await Promise.all(((fe=S.toolCalls)!=null?fe:[]).map(Ae=>Sn({toolCall:Ae,tools:t,repairToolCall:b,system:a,messages:pe}))),he=t==null?[]:await Hi({toolCalls:z,tools:t,tracer:_e,telemetry:h,messages:pe,abortSignal:i});const vt=Fe(S.usage);N=Ha(N,vt);let qe="done";++Se<l&&(d&&S.finishReason==="length"&&z.length===0?qe="continue":z.length>0&&he.length===z.length&&(qe="tool-result"));const Ke=(le=S.text)!=null?le:"",Ut=f==="continue"&&x.trimEnd()!==x?Ke.trimStart():Ke,$e=qe==="continue"?Zi(Ut):Ut;if(x=qe==="continue"||f==="continue"?x+$e:$e,ye=ra(S.reasoning),R.push(...(xe=S.sources)!=null?xe:[]),f==="continue"){const Ae=P[P.length-1];typeof Ae.content=="string"?Ae.content+=$e:Ae.content.push({text:$e,type:"text"})}else P.push(...Sr({text:x,files:fr(S.files),reasoning:ra(S.reasoning),tools:t??{},toolCalls:z,toolResults:he,messageId:c(),generateMessageId:c}));const Ye={stepType:f,text:$e,reasoning:xr(ye),reasoningDetails:ye,files:fr(S.files),sources:(W=S.sources)!=null?W:[],toolCalls:z,toolResults:he,finishReason:S.finishReason,usage:vt,warnings:S.warnings,logprobs:S.logprobs,request:(ue=S.request)!=null?ue:{},response:{...S.response,headers:(ge=S.rawResponse)==null?void 0:ge.headers,body:(ce=S.rawResponse)==null?void 0:ce.body,messages:structuredClone(P)},providerMetadata:S.providerMetadata,experimental_providerMetadata:S.providerMetadata,isContinued:qe==="continue"};ee.push(Ye),await(T==null?void 0:T(Ye)),f=qe}while(f!=="done");return Ie.setAttributes(O({telemetry:h,attributes:{"ai.response.finishReason":S.finishReason,"ai.response.text":{output:()=>S.text},"ai.response.toolCalls":{output:()=>JSON.stringify(S.toolCalls)},"ai.usage.promptTokens":S.usage.promptTokens,"ai.usage.completionTokens":S.usage.completionTokens,"ai.response.providerMetadata":JSON.stringify(S.providerMetadata)}})),new Xi({text:x,files:fr(S.files),reasoning:xr(ye),reasoningDetails:ye,sources:R,outputResolver:()=>{if(p==null)throw new sn;return p.parseOutput({text:x},{response:S.response,usage:N,finishReason:S.finishReason})},toolCalls:z,toolResults:he,finishReason:S.finishReason,usage:N,warnings:S.warnings,request:(q=S.request)!=null?q:{},response:{...S.response,headers:(Z=S.rawResponse)==null?void 0:Z.headers,body:(F=S.rawResponse)==null?void 0:F.body,messages:P},logprobs:S.logprobs,steps:ee,providerMetadata:S.providerMetadata})}})}async function Hi({toolCalls:e,tools:t,tracer:r,telemetry:a,messages:s,abortSignal:n}){return(await Promise.all(e.map(async({toolCallId:i,toolName:u,args:l})=>{const c=t[u];if((c==null?void 0:c.execute)==null)return;const p=await we({name:"ai.toolCall",attributes:O({telemetry:a,attributes:{...ve({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":u,"ai.toolCall.id":i,"ai.toolCall.args":{output:()=>JSON.stringify(l)}}}),tracer:r,fn:async d=>{try{const h=await c.execute(l,{toolCallId:i,messages:s,abortSignal:n});try{d.setAttributes(O({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(h)}}}))}catch{}return h}catch(h){throw Nr(d,h),new cn({toolCallId:i,toolName:u,toolArgs:l,cause:h})}}});return{type:"tool-result",toolCallId:i,toolName:u,args:l,result:p}}))).filter(i=>i!=null)}var Xi=class{constructor(e){this.text=e.text,this.files=e.files,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};function ra(e){return e==null?[]:typeof e=="string"?[{type:"text",text:e}]:e}function fr(e){var t;return(t=e==null?void 0:e.map(r=>new Qt(r)))!=null?t:[]}var Qi={};Mr(Qi,{object:()=>sl,text:()=>nl});var Tn="AI_InvalidStreamPartError",In=`vercel.ai.error.${Tn}`,el=Symbol.for(In),En,tl=class extends M{constructor({chunk:e,message:t}){super({name:Tn,message:t}),this[En]=!0,this.chunk=e}static isInstance(e){return M.hasMarker(e,In)}};En=el;var rl="AI_MCPClientError",Rn=`vercel.ai.error.${rl}`,al=Symbol.for(Rn),An,oe=class extends M{constructor({name:e="MCPClientError",message:t,cause:r}){super({name:e,message:t,cause:r}),this[An]=!0}static isInstance(e){return M.hasMarker(e,Rn)}};An=al;var nl=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:e}){return e},parsePartial({text:e}){return{partial:e}},parseOutput({text:e}){return e}}),sl=({schema:e})=>{const t=ct(e);return{type:"object",responseFormat:({model:r})=>({type:"json",schema:r.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt({system:r,model:a}){return a.supportsStructuredOutputs?r:qt({prompt:r,schema:t.jsonSchema})},parsePartial({text:r}){const a=pa(r);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:a.value};default:{const s=a.state;throw new Error(`Unsupported parse state: ${s}`)}}},parseOutput({text:r},a){const s=It({text:r});if(!s.success)throw new Je({message:"No object generated: could not parse the response.",cause:s.error,text:r,response:a.response,usage:a.usage,finishReason:a.finishReason});const n=ut({value:s.value,schema:t});if(!n.success)throw new Je({message:"No object generated: response did not match schema.",cause:n.error,text:r,response:a.response,usage:a.usage,finishReason:a.finishReason});return n.value}}},ol={word:/\S+\s+/m,line:/\n+/m};function yu({delayInMs:e=10,chunking:t="word",_internal:{delay:r=Ir}={}}={}){let a;if(typeof t=="function")a=s=>{const n=t(s);if(n==null)return null;if(!n.length)throw new Error("Chunking function must return a non-empty string.");if(!s.startsWith(n))throw new Error(`Chunking function must return a match that is a prefix of the buffer. Received: "${n}" expected to start with "${s}"`);return n};else{const s=typeof t=="string"?ol[t]:t;if(s==null)throw new $n({argument:"chunking",message:`Chunking must be "word" or "line" or a RegExp. Received: ${t}`});a=n=>{const o=s.exec(n);return o?n.slice(0,o.index)+(o==null?void 0:o[0]):null}}return()=>{let s="";return new TransformStream({async transform(n,o){if(n.type!=="text-delta"){s.length>0&&(o.enqueue({type:"text-delta",textDelta:s}),s=""),o.enqueue(n);return}s+=n.textDelta;let i;for(;(i=a(s))!=null;)o.enqueue({type:"text-delta",textDelta:i}),s=s.slice(i.length),await r(e)}})}}function Pn(e){return e===void 0?[]:Array.isArray(e)?e:[e]}async function il({stream:e,onError:t}){const r=e.getReader();try{for(;;){const{done:a}=await r.read();if(a)break}}catch(a){t==null||t(a)}finally{r.releaseLock()}}function Or(e,t){const r=e.getReader(),a=t.getReader();let s,n,o=!1,i=!1;async function u(c){try{s==null&&(s=r.read());const p=await s;s=void 0,p.done?c.close():c.enqueue(p.value)}catch(p){c.error(p)}}async function l(c){try{n==null&&(n=a.read());const p=await n;n=void 0,p.done?c.close():c.enqueue(p.value)}catch(p){c.error(p)}}return new ReadableStream({async pull(c){try{if(o){await l(c);return}if(i){await u(c);return}s==null&&(s=r.read()),n==null&&(n=a.read());const{result:p,reader:d}=await Promise.race([s.then(h=>({result:h,reader:r})),n.then(h=>({result:h,reader:a}))]);p.done||c.enqueue(p.value),d===r?(s=void 0,p.done&&(await l(c),o=!0)):(n=void 0,p.done&&(i=!0,await u(c)))}catch(p){c.error(p)}},cancel(){r.cancel(),a.cancel()}})}function ll({tools:e,generatorStream:t,toolCallStreaming:r,tracer:a,telemetry:s,system:n,messages:o,abortSignal:i,repairToolCall:u}){let l=null;const c=new ReadableStream({start(m){l=m}}),p={},d=new Set;let h=!1,y;function v(){h&&d.size===0&&(y!=null&&l.enqueue(y),l.close())}const g=new TransformStream({async transform(m,b){const _=m.type;switch(_){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":{b.enqueue(m);break}case"file":{b.enqueue(new Qo({data:m.data,mimeType:m.mimeType}));break}case"tool-call-delta":{r&&(p[m.toolCallId]||(b.enqueue({type:"tool-call-streaming-start",toolCallId:m.toolCallId,toolName:m.toolName}),p[m.toolCallId]=!0),b.enqueue({type:"tool-call-delta",toolCallId:m.toolCallId,toolName:m.toolName,argsTextDelta:m.argsTextDelta}));break}case"tool-call":{try{const w=await Sn({toolCall:m,tools:e,repairToolCall:u,system:n,messages:o});b.enqueue(w);const T=e[w.toolName];if(T.execute!=null){const I=Ln();d.add(I),we({name:"ai.toolCall",attributes:O({telemetry:s,attributes:{...ve({operationId:"ai.toolCall",telemetry:s}),"ai.toolCall.name":w.toolName,"ai.toolCall.id":w.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(w.args)}}}),tracer:a,fn:async U=>T.execute(w.args,{toolCallId:w.toolCallId,messages:o,abortSignal:i}).then(j=>{l.enqueue({...w,type:"tool-result",result:j}),d.delete(I),v();try{U.setAttributes(O({telemetry:s,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(j)}}}))}catch{}},j=>{Nr(U,j),l.enqueue({type:"error",error:new cn({toolCallId:w.toolCallId,toolName:w.toolName,toolArgs:w.args,cause:j})}),d.delete(I),v()})})}}catch(w){l.enqueue({type:"error",error:w})}break}case"finish":{y={type:"finish",finishReason:m.finishReason,logprobs:m.logprobs,usage:Fe(m.usage),experimental_providerMetadata:m.providerMetadata};break}default:{const w=_;throw new Error(`Unhandled chunk type: ${w}`)}}},flush(){h=!0,v()}});return new ReadableStream({async start(m){return Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(b){m.enqueue(b)},close(){}})),c.pipeTo(new WritableStream({write(b){m.enqueue(b)},close(){m.close()}}))])}})}var ul=ft({prefix:"aitxt",size:24}),cl=ft({prefix:"msg",size:24});function vu({model:e,tools:t,toolChoice:r,system:a,prompt:s,messages:n,maxRetries:o,abortSignal:i,headers:u,maxSteps:l=1,experimental_generateMessageId:c=cl,experimental_output:p,experimental_continueSteps:d=!1,experimental_telemetry:h,experimental_providerMetadata:y,providerOptions:v=y,experimental_toolCallStreaming:g=!1,toolCallStreaming:m=g,experimental_activeTools:b,experimental_repairToolCall:_,experimental_transform:w,onChunk:T,onError:I,onFinish:U,onStepFinish:j,_internal:{now:V=tn,generateId:Y=ul,currentDate:re=()=>new Date}={},..._e}){if(typeof e=="string"||e.specificationVersion!=="v1")throw new Le;return new dl({model:e,telemetry:h,headers:u,settings:_e,maxRetries:o,abortSignal:i,system:a,prompt:s,messages:n,tools:t,toolChoice:r,toolCallStreaming:m,transforms:Pn(w),activeTools:b,repairToolCall:_,maxSteps:l,output:p,continueSteps:d,providerOptions:v,onChunk:T,onError:I,onFinish:U,onStepFinish:j,now:V,currentDate:re,generateId:Y,generateMessageId:c})}function pl(e){if(!e)return new TransformStream({transform(n,o){o.enqueue({part:n,partialOutput:void 0})}});let t="",r="",a="";function s({controller:n,partialOutput:o=void 0}){n.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:o}),r=""}return new TransformStream({transform(n,o){if(n.type==="step-finish"&&s({controller:o}),n.type!=="text-delta"){o.enqueue({part:n,partialOutput:void 0});return}t+=n.textDelta,r+=n.textDelta;const i=e.parsePartial({text:t});if(i!=null){const u=JSON.stringify(i.partial);u!==a&&(s({controller:o,partialOutput:i.partial}),a=u)}},flush(n){r.length>0&&s({controller:n})}})}var dl=class{constructor({model:e,telemetry:t,headers:r,settings:a,maxRetries:s,abortSignal:n,system:o,prompt:i,messages:u,tools:l,toolChoice:c,toolCallStreaming:p,transforms:d,activeTools:h,repairToolCall:y,maxSteps:v,output:g,continueSteps:m,providerOptions:b,now:_,currentDate:w,generateId:T,generateMessageId:I,onChunk:U,onError:j,onFinish:V,onStepFinish:Y}){this.warningsPromise=new te,this.usagePromise=new te,this.finishReasonPromise=new te,this.providerMetadataPromise=new te,this.textPromise=new te,this.reasoningPromise=new te,this.reasoningDetailsPromise=new te,this.sourcesPromise=new te,this.filesPromise=new te,this.toolCallsPromise=new te,this.toolResultsPromise=new te,this.requestPromise=new te,this.responsePromise=new te,this.stepsPromise=new te;var re;if(v<1)throw new J({parameter:"maxSteps",value:v,message:"maxSteps must be at least 1"});this.output=g;let _e="",Ie="",me="",ne=[],se=[],Q,fe=[];const le=[],xe={id:T(),timestamp:w(),modelId:e.modelId,messages:[]};let W=[],ue=[],ge,ce,q="initial";const Z=[];let F;const $=new TransformStream({async transform(ee,N){N.enqueue(ee);const{part:f}=ee;if((f.type==="text-delta"||f.type==="reasoning"||f.type==="source"||f.type==="tool-call"||f.type==="tool-result"||f.type==="tool-call-streaming-start"||f.type==="tool-call-delta")&&await(U==null?void 0:U({chunk:f})),f.type==="error"&&await(j==null?void 0:j({error:f.error})),f.type==="text-delta"&&(_e+=f.textDelta,Ie+=f.textDelta,me+=f.textDelta),f.type==="reasoning"&&(Q==null?(Q={type:"text",text:f.textDelta},ne.push(Q)):Q.text+=f.textDelta),f.type==="reasoning-signature"){if(Q==null)throw new M({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});Q.signature=f.signature,Q=void 0}if(f.type==="redacted-reasoning"&&ne.push({type:"redacted",data:f.data}),f.type==="file"&&se.push(f),f.type==="source"&&(le.push(f.source),fe.push(f.source)),f.type==="tool-call"&&W.push(f),f.type==="tool-result"&&ue.push(f),f.type==="step-finish"){const B=Sr({text:Ie,files:se,reasoning:ne,tools:l??{},toolCalls:W,toolResults:ue,messageId:f.messageId,generateMessageId:I}),pe=Z.length;let ae="done";pe+1<v&&(m&&f.finishReason==="length"&&W.length===0?ae="continue":W.length>0&&ue.length===W.length&&(ae="tool-result"));const nt={stepType:q,text:_e,reasoning:xr(ne),reasoningDetails:ne,files:se,sources:fe,toolCalls:W,toolResults:ue,finishReason:f.finishReason,usage:f.usage,warnings:f.warnings,logprobs:f.logprobs,request:f.request,response:{...f.response,messages:[...xe.messages,...B]},providerMetadata:f.experimental_providerMetadata,experimental_providerMetadata:f.experimental_providerMetadata,isContinued:f.isContinued};await(Y==null?void 0:Y(nt)),Z.push(nt),W=[],ue=[],_e="",fe=[],ne=[],se=[],Q=void 0,ae!=="done"&&(q=ae),ae!=="continue"&&(xe.messages.push(...B),Ie="")}f.type==="finish"&&(xe.id=f.response.id,xe.timestamp=f.response.timestamp,xe.modelId=f.response.modelId,xe.headers=f.response.headers,ce=f.usage,ge=f.finishReason)},async flush(ee){var N;try{if(Z.length===0)return;const f=Z[Z.length-1];R.warningsPromise.resolve(f.warnings),R.requestPromise.resolve(f.request),R.responsePromise.resolve(f.response),R.toolCallsPromise.resolve(f.toolCalls),R.toolResultsPromise.resolve(f.toolResults),R.providerMetadataPromise.resolve(f.experimental_providerMetadata),R.reasoningPromise.resolve(f.reasoning),R.reasoningDetailsPromise.resolve(f.reasoningDetails);const B=ge??"unknown",pe=ce??{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};R.finishReasonPromise.resolve(B),R.usagePromise.resolve(pe),R.textPromise.resolve(me),R.sourcesPromise.resolve(le),R.filesPromise.resolve(f.files),R.stepsPromise.resolve(Z),await(V==null?void 0:V({finishReason:B,logprobs:void 0,usage:pe,text:me,reasoning:f.reasoning,reasoningDetails:f.reasoningDetails,files:f.files,sources:f.sources,toolCalls:f.toolCalls,toolResults:f.toolResults,request:(N=f.request)!=null?N:{},response:f.response,warnings:f.warnings,providerMetadata:f.providerMetadata,experimental_providerMetadata:f.experimental_providerMetadata,steps:Z})),F.setAttributes(O({telemetry:t,attributes:{"ai.response.finishReason":B,"ai.response.text":{output:()=>me},"ai.response.toolCalls":{output:()=>{var ae;return(ae=f.toolCalls)!=null&&ae.length?JSON.stringify(f.toolCalls):void 0}},"ai.usage.promptTokens":pe.promptTokens,"ai.usage.completionTokens":pe.completionTokens,"ai.response.providerMetadata":JSON.stringify(f.providerMetadata)}}))}catch(f){ee.error(f)}finally{F.end()}}}),S=en();this.addStream=S.addStream,this.closeStream=S.close;let z=S.stream;for(const ee of d)z=z.pipeThrough(ee({tools:l,stopStream(){S.terminate()}}));this.baseStream=z.pipeThrough(pl(g)).pipeThrough($);const{maxRetries:he,retry:ye}=Ve({maxRetries:s}),Se=ht(t),P=gt({model:e,telemetry:t,headers:r,settings:{...a,maxRetries:he}}),x=mt({prompt:{system:(re=g==null?void 0:g.injectIntoSystemPrompt({system:o,model:e}))!=null?re:o,prompt:i,messages:u},tools:l}),R=this;we({name:"ai.streamText",attributes:O({telemetry:t,attributes:{...ve({operationId:"ai.streamText",telemetry:t}),...P,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:i,messages:u})},"ai.settings.maxSteps":v}}),tracer:Se,endWhenDone:!1,fn:async ee=>{F=ee;async function N({currentStep:f,responseMessages:B,usage:pe,stepType:ae,previousStepText:nt,hasLeadingWhitespace:nr,messageId:Ee}){var yt;const Ze=B.length===0?x.type:"messages",vt=[...x.messages,...B],qe=await pt({prompt:{type:Ze,system:x.system,messages:vt},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(yt=e.supportsUrl)==null?void 0:yt.bind(e)}),Ke={type:"regular",...pn({tools:l,toolChoice:c,activeTools:h})},{result:{stream:Ut,warnings:$e,rawResponse:Ye,request:Ae},doStreamSpan:Ce,startTimestampMs:wt}=await ye(()=>we({name:"ai.streamText.doStream",attributes:O({telemetry:t,attributes:{...ve({operationId:"ai.streamText.doStream",telemetry:t}),...P,"ai.prompt.format":{input:()=>Ze},"ai.prompt.messages":{input:()=>rr(qe)},"ai.prompt.tools":{input:()=>{var C;return(C=Ke.tools)==null?void 0:C.map(H=>JSON.stringify(H))}},"ai.prompt.toolChoice":{input:()=>Ke.toolChoice!=null?JSON.stringify(Ke.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":a.frequencyPenalty,"gen_ai.request.max_tokens":a.maxTokens,"gen_ai.request.presence_penalty":a.presencePenalty,"gen_ai.request.stop_sequences":a.stopSequences,"gen_ai.request.temperature":a.temperature,"gen_ai.request.top_k":a.topK,"gen_ai.request.top_p":a.topP}}),tracer:Se,endWhenDone:!1,fn:async C=>({startTimestampMs:_(),doStreamSpan:C,result:await e.doStream({mode:Ke,...dt(a),inputFormat:Ze,responseFormat:g==null?void 0:g.responseFormat({model:e}),prompt:qe,providerMetadata:b,abortSignal:n,headers:r})})})),Ft=ll({tools:l,generatorStream:Ut,toolCallStreaming:p,tracer:Se,telemetry:t,system:o,messages:vt,repairToolCall:y,abortSignal:n}),bt=Ae??{},Oe=[],st=[],de=[],Ue=[];let He,Xe="unknown",Be={promptTokens:0,completionTokens:0,totalTokens:0},ot,$r=!0,_t="",Ur=ae==="continue"?nt:"",sr,ke={id:T(),timestamp:w(),modelId:e.modelId},it="",Fr=!1,Jr=!0,Lr=!1;async function or({controller:C,chunk:H}){C.enqueue(H),_t+=H.textDelta,Ur+=H.textDelta,Fr=!0,Lr=H.textDelta.trimEnd()!==H.textDelta}R.addStream(Ft.pipeThrough(new TransformStream({async transform(C,H){var je,xt,Qe;if($r){const De=_()-wt;$r=!1,Ce.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":De}),Ce.setAttributes({"ai.response.msToFirstChunk":De}),H.enqueue({type:"step-start",messageId:Ee,request:bt,warnings:$e??[]})}if(C.type==="text-delta"&&C.textDelta.length===0)return;const Vr=C.type;switch(Vr){case"text-delta":{if(m){const De=Jr&&nr?C.textDelta.trimStart():C.textDelta;if(De.length===0)break;Jr=!1,it+=De;const Jt=dn(it);Jt!=null&&(it=Jt.suffix,await or({controller:H,chunk:{type:"text-delta",textDelta:Jt.prefix+Jt.whitespace}}))}else await or({controller:H,chunk:C});break}case"reasoning":{H.enqueue(C),He==null?(He={type:"text",text:C.textDelta},de.push(He)):He.text+=C.textDelta;break}case"reasoning-signature":{if(H.enqueue(C),He==null)throw new tl({chunk:C,message:"reasoning-signature without reasoning"});He.signature=C.signature,He=void 0;break}case"redacted-reasoning":{H.enqueue(C),de.push({type:"redacted",data:C.data});break}case"tool-call":{H.enqueue(C),Oe.push(C);break}case"tool-result":{H.enqueue(C),st.push(C);break}case"response-metadata":{ke={id:(je=C.id)!=null?je:ke.id,timestamp:(xt=C.timestamp)!=null?xt:ke.timestamp,modelId:(Qe=C.modelId)!=null?Qe:ke.modelId};break}case"finish":{Be=C.usage,Xe=C.finishReason,ot=C.experimental_providerMetadata,sr=C.logprobs;const De=_()-wt;Ce.addEvent("ai.stream.finish"),Ce.setAttributes({"ai.response.msToFinish":De,"ai.response.avgCompletionTokensPerSecond":1e3*Be.completionTokens/De});break}case"file":{Ue.push(C),H.enqueue(C);break}case"source":case"tool-call-streaming-start":case"tool-call-delta":{H.enqueue(C);break}case"error":{H.enqueue(C),Xe="error";break}default:{const De=Vr;throw new Error(`Unknown chunk type: ${De}`)}}},async flush(C){const H=Oe.length>0?JSON.stringify(Oe):void 0;let je="done";f+1<v&&(m&&Xe==="length"&&Oe.length===0?je="continue":Oe.length>0&&st.length===Oe.length&&(je="tool-result")),m&&it.length>0&&(je!=="continue"||ae==="continue"&&!Fr)&&(await or({controller:C,chunk:{type:"text-delta",textDelta:it}}),it="");try{Ce.setAttributes(O({telemetry:t,attributes:{"ai.response.finishReason":Xe,"ai.response.text":{output:()=>_t},"ai.response.toolCalls":{output:()=>H},"ai.response.id":ke.id,"ai.response.model":ke.modelId,"ai.response.timestamp":ke.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(ot),"ai.usage.promptTokens":Be.promptTokens,"ai.usage.completionTokens":Be.completionTokens,"gen_ai.response.finish_reasons":[Xe],"gen_ai.response.id":ke.id,"gen_ai.response.model":ke.modelId,"gen_ai.usage.input_tokens":Be.promptTokens,"gen_ai.usage.output_tokens":Be.completionTokens}}))}catch{}finally{Ce.end()}C.enqueue({type:"step-finish",finishReason:Xe,usage:Be,providerMetadata:ot,experimental_providerMetadata:ot,logprobs:sr,request:bt,response:{...ke,headers:Ye==null?void 0:Ye.headers},warnings:$e,isContinued:je==="continue",messageId:Ee});const xt=Ha(pe,Be);if(je==="done")C.enqueue({type:"finish",finishReason:Xe,usage:xt,providerMetadata:ot,experimental_providerMetadata:ot,logprobs:sr,response:{...ke,headers:Ye==null?void 0:Ye.headers}}),R.closeStream();else{if(ae==="continue"){const Qe=B[B.length-1];typeof Qe.content=="string"?Qe.content+=_t:Qe.content.push({text:_t,type:"text"})}else B.push(...Sr({text:_t,files:Ue,reasoning:de,tools:l??{},toolCalls:Oe,toolResults:st,messageId:Ee,generateMessageId:I}));await N({currentStep:f+1,responseMessages:B,usage:xt,stepType:je,previousStepText:Ur,hasLeadingWhitespace:Lr,messageId:je==="continue"?Ee:I()})}}})))}await N({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:I()})}}).catch(ee=>{R.addStream(new ReadableStream({start(N){N.enqueue({type:"error",error:ee}),N.close()}})),R.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get files(){return this.filesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){const[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return rt(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type==="text-delta"&&t.enqueue(e.textDelta)}})))}get fullStream(){return rt(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await il({stream:this.fullStream,onError:e==null?void 0:e.onError})}catch(r){(t=e==null?void 0:e.onError)==null||t.call(e,r)}}get experimental_partialOutputStream(){if(this.output==null)throw new sn;return rt(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:r=!1,sendSources:a=!1,experimental_sendFinish:s=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(n,o)=>{const i=n.type;switch(i){case"text-delta":{o.enqueue(G("text",n.textDelta));break}case"reasoning":{r&&o.enqueue(G("reasoning",n.textDelta));break}case"redacted-reasoning":{r&&o.enqueue(G("redacted_reasoning",{data:n.data}));break}case"reasoning-signature":{r&&o.enqueue(G("reasoning_signature",{signature:n.signature}));break}case"file":{o.enqueue(G("file",{mimeType:n.mimeType,data:n.base64}));break}case"source":{a&&o.enqueue(G("source",n.source));break}case"tool-call-streaming-start":{o.enqueue(G("tool_call_streaming_start",{toolCallId:n.toolCallId,toolName:n.toolName}));break}case"tool-call-delta":{o.enqueue(G("tool_call_delta",{toolCallId:n.toolCallId,argsTextDelta:n.argsTextDelta}));break}case"tool-call":{o.enqueue(G("tool_call",{toolCallId:n.toolCallId,toolName:n.toolName,args:n.args}));break}case"tool-result":{o.enqueue(G("tool_result",{toolCallId:n.toolCallId,result:n.result}));break}case"error":{o.enqueue(G("error",e(n.error)));break}case"step-start":{o.enqueue(G("start_step",{messageId:n.messageId}));break}case"step-finish":{o.enqueue(G("finish_step",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0,isContinued:n.isContinued}));break}case"finish":{s&&o.enqueue(G("finish_message",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0}));break}default:{const u=i;throw new Error(`Unknown chunk type: ${u}`)}}}}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:a,data:s,getErrorMessage:n,sendUsage:o,sendReasoning:i,sendSources:u,experimental_sendFinish:l}={}){Yt({response:e,status:t,statusText:r,headers:Kt(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:s,getErrorMessage:n,sendUsage:o,sendReasoning:i,sendSources:u,experimental_sendFinish:l})})}pipeTextStreamToResponse(e,t){Yt({response:e,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText,headers:Kt(t==null?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){const t=this.toDataStreamInternal({getErrorMessage:e==null?void 0:e.getErrorMessage,sendUsage:e==null?void 0:e.sendUsage,sendReasoning:e==null?void 0:e.sendReasoning,sendSources:e==null?void 0:e.sendSources,experimental_sendFinish:e==null?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return e!=null&&e.data?Or(e==null?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:t==null?void 0:t.sendUsage,sendReasoning:t==null?void 0:t.sendReasoning,sendSources:t==null?void 0:t.sendSources,experimental_sendFinish:t==null?void 0:t.experimental_sendFinish}))}toDataStreamResponse({headers:e,status:t,statusText:r,data:a,getErrorMessage:s,sendUsage:n,sendReasoning:o,sendSources:i,experimental_sendFinish:u}={}){return new Response(this.toDataStream({data:a,getErrorMessage:s,sendUsage:n,sendReasoning:o,sendSources:i,experimental_sendFinish:u}),{status:t,statusText:r,headers:at(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:at(e==null?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},ml=class extends M{constructor(e){super({name:"AI_NoSpeechGeneratedError",message:"No speech audio generated."}),this.responses=e.responses}},fl=class extends Qt{constructor({data:e,mimeType:t}){super({data:e,mimeType:t});let r="mp3";if(t){const a=t.split("/");a.length===2&&t!=="audio/mpeg"&&(r=a[1])}if(!r)throw new Error("Audio format must be provided or determinable from mimeType");this.format=r}};async function wu({model:e,text:t,voice:r,outputFormat:a,instructions:s,speed:n,providerOptions:o={},maxRetries:i,abortSignal:u,headers:l}){var c;if(typeof e=="string"||e.specificationVersion!=="v1")throw new Le;const{retry:p}=Ve({maxRetries:i}),d=await p(()=>e.doGenerate({text:t,voice:r,outputFormat:a,instructions:s,speed:n,abortSignal:u,headers:l,providerOptions:o}));if(!d.audio||d.audio.length===0)throw new ml({responses:[d.response]});return new gl({audio:new fl({data:d.audio,mimeType:(c=er({data:d.audio,signatures:ka}))!=null?c:"audio/mp3"}),warnings:d.warnings,responses:[d.response],providerMetadata:d.providerMetadata})}var gl=class{constructor(e){var t;this.audio=e.audio,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=(t=e.providerMetadata)!=null?t:{}}},hl=class extends M{constructor(e){super({name:"AI_NoTranscriptGeneratedError",message:"No transcript generated."}),this.responses=e.responses}};async function bu({model:e,audio:t,providerOptions:r={},maxRetries:a,abortSignal:s,headers:n}){if(typeof e=="string"||e.specificationVersion!=="v1")throw new Le;const{retry:o}=Ve({maxRetries:a}),i=t instanceof URL?(await $a({url:t})).data:Dt(t),u=await o(()=>{var l;return e.doGenerate({audio:i,abortSignal:s,headers:n,providerOptions:r,mediaType:(l=er({data:i,signatures:ka}))!=null?l:"audio/wav"})});if(!u.text)throw new hl({responses:[u.response]});return new yl({text:u.text,segments:u.segments,language:u.language,durationInSeconds:u.durationInSeconds,warnings:u.warnings,responses:[u.response],providerMetadata:u.providerMetadata})}var yl=class{constructor(e){var t;this.text=e.text,this.segments=e.segments,this.language=e.language,this.durationInSeconds=e.durationInSeconds,this.warnings=e.warnings,this.responses=e.responses,this.providerMetadata=(t=e.providerMetadata)!=null?t:{}}};function Cn(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;const r={...e};for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a)){const s=t[a];if(s===void 0)continue;const n=a in e?e[a]:void 0,o=s!==null&&typeof s=="object"&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),i=n!=null&&typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);o&&i?r[a]=Cn(n,s):r[a]=s}return r}function _u({settings:e}){return{middlewareVersion:"v1",transformParams:async({params:t})=>{var r;return{...e,...t,providerMetadata:Cn(e.providerMetadata,t.providerMetadata),temperature:t.temperature===0||t.temperature==null?(r=e.temperature)!=null?r:0:t.temperature}}}}function vl(e,t){if(t.length===0)return null;const r=e.indexOf(t);if(r!==-1)return r;for(let a=e.length-1;a>=0;a--){const s=e.substring(a);if(t.startsWith(s))return a}return null}function xu({tagName:e,separator:t=`
`,startWithReasoning:r=!1}){const a=`<${e}>`,s=`</${e}>`;return{middlewareVersion:"v1",wrapGenerate:async({doGenerate:n})=>{const{text:o,...i}=await n();if(o==null)return{text:o,...i};const u=r?a+o:o,l=new RegExp(`${a}(.*?)${s}`,"gs"),c=Array.from(u.matchAll(l));if(!c.length)return{text:u,...i};const p=c.map(h=>h[1]).join(t);let d=u;for(let h=c.length-1;h>=0;h--){const y=c[h],v=d.slice(0,y.index),g=d.slice(y.index+y[0].length);d=v+(v.length>0&&g.length>0?t:"")+g}return{...i,text:d,reasoning:p}},wrapStream:async({doStream:n})=>{const{stream:o,...i}=await n();let u=!0,l=!0,c=!1,p=r,d="";return{stream:o.pipeThrough(new TransformStream({transform:(h,y)=>{if(h.type!=="text-delta"){y.enqueue(h);return}d+=h.textDelta;function v(g){if(g.length>0){const m=c&&(p?!u:!l)?t:"";y.enqueue({type:p?"reasoning":"text-delta",textDelta:m+g}),c=!1,p?u=!1:l=!1}}do{const g=p?s:a,m=vl(d,g);if(m==null){v(d),d="";break}if(v(d.slice(0,m)),m+g.length<=d.length)d=d.slice(m+g.length),p=!p,c=!0;else{d=d.slice(m);break}}while(!0)}})),...i}}}}function Su(){return{middlewareVersion:"v1",wrapStream:async({doGenerate:e})=>{const t=await e();return{stream:new ReadableStream({start(a){if(a.enqueue({type:"response-metadata",...t.response}),t.reasoning)if(typeof t.reasoning=="string")a.enqueue({type:"reasoning",textDelta:t.reasoning});else for(const s of t.reasoning)switch(s.type){case"text":{a.enqueue({type:"reasoning",textDelta:s.text}),s.signature!=null&&a.enqueue({type:"reasoning-signature",signature:s.signature});break}case"redacted":{a.enqueue({type:"redacted-reasoning",data:s.data});break}}if(t.text&&a.enqueue({type:"text-delta",textDelta:t.text}),t.toolCalls)for(const s of t.toolCalls)a.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:s.toolCallId,toolName:s.toolName,argsTextDelta:s.args}),a.enqueue({type:"tool-call",...s});a.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,logprobs:t.logprobs,providerMetadata:t.providerMetadata}),a.close()}}),rawCall:t.rawCall,rawResponse:t.rawResponse,warnings:t.warnings}}}}var wl=({model:e,middleware:t,modelId:r,providerId:a})=>Pn(t).reverse().reduce((s,n)=>bl({model:s,middleware:n,modelId:r,providerId:a}),e),bl=({model:e,middleware:{transformParams:t,wrapGenerate:r,wrapStream:a},modelId:s,providerId:n})=>{var o;async function i({params:u,type:l}){return t?await t({params:u,type:l}):u}return{specificationVersion:"v1",provider:n??e.provider,modelId:s??e.modelId,defaultObjectGenerationMode:e.defaultObjectGenerationMode,supportsImageUrls:e.supportsImageUrls,supportsUrl:(o=e.supportsUrl)==null?void 0:o.bind(e),supportsStructuredOutputs:e.supportsStructuredOutputs,async doGenerate(u){const l=await i({params:u,type:"generate"}),c=async()=>e.doGenerate(l);return r?r({doGenerate:c,doStream:async()=>e.doStream(l),params:l,model:e}):c()},async doStream(u){const l=await i({params:u,type:"stream"}),c=async()=>e.doGenerate(l),p=async()=>e.doStream(l);return a?a({doGenerate:c,doStream:p,params:l,model:e}):p()}}},Tu=wl;function Iu({messages:e,message:t}){return[...e.length>0&&e[e.length-1].id===t.id?e.slice(0,-1):e,t]}function Eu({messages:e,responseMessages:t,_internal:{currentDate:r=()=>new Date}={}}){var a,s,n,o;const i=structuredClone(e);for(const u of t){const l=u.role,c=i[i.length-1],p=c.role==="assistant";switch(l){case"assistant":{let d=function(g){return(typeof u.content=="string"?[]:u.content.filter(m=>m.type==="tool-call")).map(m=>({state:"call",step:g,args:m.args,toolCallId:m.toolCallId,toolName:m.toolName}))};const h=[{type:"step-start"}];let y="",v;if(typeof u.content=="string")y=u.content,h.push({type:"text",text:u.content});else{let g;for(const m of u.content)switch(m.type){case"text":{g=void 0,y+=m.text,h.push({type:"text",text:m.text});break}case"reasoning":{g==null&&(g={type:"reasoning",reasoning:"",details:[]},h.push(g)),v=(v??"")+m.text,g.reasoning+=m.text,g.details.push({type:"text",text:m.text,signature:m.signature});break}case"redacted-reasoning":{g==null&&(g={type:"reasoning",reasoning:"",details:[]},h.push(g)),g.details.push({type:"redacted",data:m.data});break}case"tool-call":break;case"file":if(m.data instanceof URL)throw new M({name:"InvalidAssistantFileData",message:"File data cannot be a URL"});h.push({type:"file",mimeType:m.mimeType,data:tr(m.data)});break}}if(p){const g=ao(c.toolInvocations);(a=c.parts)!=null||(c.parts=[]),c.content=y,c.reasoning=v,c.parts.push(...h),c.toolInvocations=[...(s=c.toolInvocations)!=null?s:[],...d(g===void 0?0:g+1)],d(g===void 0?0:g+1).map(m=>({type:"tool-invocation",toolInvocation:m})).forEach(m=>{c.parts.push(m)})}else i.push({role:"assistant",id:u.id,createdAt:r(),content:y,reasoning:v,toolInvocations:d(0),parts:[...h,...d(0).map(g=>({type:"tool-invocation",toolInvocation:g}))]});break}case"tool":{if((n=c.toolInvocations)!=null||(c.toolInvocations=[]),c.role!=="assistant")throw new Error(`Tool result must follow an assistant message: ${c.role}`);(o=c.parts)!=null||(c.parts=[]);for(const d of u.content){const h=c.toolInvocations.find(g=>g.toolCallId===d.toolCallId),y=c.parts.find(g=>g.type==="tool-invocation"&&g.toolInvocation.toolCallId===d.toolCallId);if(!h)throw new Error("Tool call not found in previous message");h.state="result";const v=h;v.result=d.result,y?y.toolInvocation=v:c.parts.push({type:"tool-invocation",toolInvocation:v})}break}default:{const d=l;throw new Error(`Unsupported message role: ${d}`)}}}return i}function _l({languageModels:e,textEmbeddingModels:t,imageModels:r,fallbackProvider:a}){return{languageModel(s){if(e!=null&&s in e)return e[s];if(a)return a.languageModel(s);throw new ze({modelId:s,modelType:"languageModel"})},textEmbeddingModel(s){if(t!=null&&s in t)return t[s];if(a)return a.textEmbeddingModel(s);throw new ze({modelId:s,modelType:"textEmbeddingModel"})},imageModel(s){if(r!=null&&s in r)return r[s];if(a!=null&&a.imageModel)return a.imageModel(s);throw new ze({modelId:s,modelType:"imageModel"})}}}var Ru=_l,kn="AI_NoSuchProviderError",Mn=`vercel.ai.error.${kn}`,xl=Symbol.for(Mn),Nn,Sl=class extends ze{constructor({modelId:e,modelType:t,providerId:r,availableProviders:a,message:s=`No such provider: ${r} (available providers: ${a.join()})`}){super({errorName:kn,modelId:e,modelType:t,message:s}),this[Nn]=!0,this.providerId=r,this.availableProviders=a}static isInstance(e){return M.hasMarker(e,Mn)}};Nn=xl;function Tl(e,{separator:t=":"}={}){const r=new Il({separator:t});for(const[a,s]of Object.entries(e))r.registerProvider({id:a,provider:s});return r}var Au=Tl,Il=class{constructor({separator:e}){this.providers={},this.separator=e}registerProvider({id:e,provider:t}){this.providers[e]=t}getProvider(e){const t=this.providers[e];if(t==null)throw new Sl({modelId:e,modelType:"languageModel",providerId:e,availableProviders:Object.keys(this.providers)});return t}splitId(e,t){const r=e.indexOf(this.separator);if(r===-1)throw new ze({modelId:e,modelType:t,message:`Invalid ${t} id for registry: ${e} (must be in the format "providerId${this.separator}modelId")`});return[e.slice(0,r),e.slice(r+this.separator.length)]}languageModel(e){var t,r;const[a,s]=this.splitId(e,"languageModel"),n=(r=(t=this.getProvider(a)).languageModel)==null?void 0:r.call(t,s);if(n==null)throw new ze({modelId:e,modelType:"languageModel"});return n}textEmbeddingModel(e){var t;const[r,a]=this.splitId(e,"textEmbeddingModel"),s=this.getProvider(r),n=(t=s.textEmbeddingModel)==null?void 0:t.call(s,a);if(n==null)throw new ze({modelId:e,modelType:"textEmbeddingModel"});return n}imageModel(e){var t;const[r,a]=this.splitId(e,"imageModel"),s=this.getProvider(r),n=(t=s.imageModel)==null?void 0:t.call(s,a);if(n==null)throw new ze({modelId:e,modelType:"imageModel"});return n}};function Pu(e){return e}var On="2024-11-05",El=[On,"2024-10-07"],Rl=k({name:A(),version:A()}).passthrough(),jr=k({_meta:ie(k({}).passthrough())}).passthrough(),$t=jr,Al=k({method:A(),params:ie(jr)}),Pl=k({experimental:ie(k({}).passthrough()),logging:ie(k({}).passthrough()),prompts:ie(k({listChanged:ie(et())}).passthrough()),resources:ie(k({subscribe:ie(et()),listChanged:ie(et())}).passthrough()),tools:ie(k({listChanged:ie(et())}).passthrough())}).passthrough(),Cl=$t.extend({protocolVersion:A(),capabilities:Pl,serverInfo:Rl,instructions:ie(A())}),kl=$t.extend({nextCursor:ie(A())}),Ml=k({name:A(),description:ie(A()),inputSchema:k({type:X("object"),properties:ie(k({}).passthrough())}).passthrough()}).passthrough(),Nl=kl.extend({tools:We(Ml)}),Ol=k({type:X("text"),text:A()}).passthrough(),jl=k({type:X("image"),data:A().base64(),mimeType:A()}).passthrough(),jn=k({uri:A(),mimeType:ie(A())}).passthrough(),Dl=jn.extend({text:A()}),ql=jn.extend({blob:A().base64()}),$l=k({type:X("resource"),resource:be([Dl,ql])}).passthrough(),Ul=$t.extend({content:We(be([Ol,jl,$l])),isError:et().default(!1).optional()}).or($t.extend({toolResult:Ht()})),ar="2.0",Fl=k({jsonrpc:X(ar),id:be([A(),Et().int()])}).merge(Al).strict(),Jl=k({jsonrpc:X(ar),id:be([A(),Et().int()]),result:$t}).strict(),Ll=k({jsonrpc:X(ar),id:be([A(),Et().int()]),error:k({code:Et().int(),message:A(),data:ie(Ht())})}).strict(),Vl=k({jsonrpc:X(ar)}).merge(k({method:A(),params:ie(jr)})).strict(),Zl=be([Fl,Vl,Jl,Ll]),Bl=class{constructor({url:e,headers:t}){this.connected=!1,this.url=new URL(e),this.headers=t}async start(){return new Promise((e,t)=>{if(this.connected)return e();this.abortController=new AbortController,(async()=>{var a,s,n;try{const o=new Headers(this.headers);o.set("Accept","text/event-stream");const i=await fetch(this.url.href,{headers:o,signal:(a=this.abortController)==null?void 0:a.signal});if(!i.ok||!i.body){const p=new oe({message:`MCP SSE Transport Error: ${i.status} ${i.statusText}`});return(s=this.onerror)==null||s.call(this,p),t(p)}const l=i.body.pipeThrough(new TextDecoderStream).pipeThrough(Gn()).getReader(),c=async()=>{var p,d,h;try{for(;;){const{done:y,value:v}=await l.read();if(y){if(this.connected)throw this.connected=!1,new oe({message:"MCP SSE Transport Error: Connection closed unexpectedly"});return}const{event:g,data:m}=v;if(g==="endpoint"){if(this.endpoint=new URL(m,this.url),this.endpoint.origin!==this.url.origin)throw new oe({message:`MCP SSE Transport Error: Endpoint origin does not match connection origin: ${this.endpoint.origin}`});this.connected=!0,e()}else if(g==="message")try{const b=Zl.parse(JSON.parse(m));(p=this.onmessage)==null||p.call(this,b)}catch(b){const _=new oe({message:"MCP SSE Transport Error: Failed to parse message",cause:b});(d=this.onerror)==null||d.call(this,_)}}}catch(y){if(y instanceof Error&&y.name==="AbortError")return;(h=this.onerror)==null||h.call(this,y),t(y)}};this.sseConnection={close:()=>l.cancel()},c()}catch(o){if(o instanceof Error&&o.name==="AbortError")return;(n=this.onerror)==null||n.call(this,o),t(o)}})()})}async close(){var e,t,r;this.connected=!1,(e=this.sseConnection)==null||e.close(),(t=this.abortController)==null||t.abort(),(r=this.onclose)==null||r.call(this)}async send(e){var t,r,a;if(!this.endpoint||!this.connected)throw new oe({message:"MCP SSE Transport Error: Not connected"});try{const s=new Headers(this.headers);s.set("Content-Type","application/json");const n={method:"POST",headers:s,body:JSON.stringify(e),signal:(t=this.abortController)==null?void 0:t.signal},o=await fetch(this.endpoint,n);if(!o.ok){const i=await o.text().catch(()=>null),u=new oe({message:`MCP SSE Transport Error: POSTing to endpoint (HTTP ${o.status}): ${i}`});(r=this.onerror)==null||r.call(this,u);return}}catch(s){(a=this.onerror)==null||a.call(this,s);return}}};function Gl(e){if(e.type!=="sse")throw new oe({message:"Unsupported or invalid transport configuration. If you are using a custom transport, make sure it implements the MCPTransport interface."});return new Bl(e)}function zl(e){return"start"in e&&typeof e.start=="function"&&"send"in e&&typeof e.send=="function"&&"close"in e&&typeof e.close=="function"}var Wl="1.0.0";async function Cu(e){const t=new Kl(e);return await t.init(),t}var Kl=class{constructor({transport:e,name:t="ai-sdk-mcp-client",onUncaughtError:r}){this.requestMessageId=0,this.responseHandlers=new Map,this.serverCapabilities={},this.isClosed=!0,this.onUncaughtError=r,zl(e)?this.transport=e:this.transport=Gl(e),this.transport.onclose=()=>this.onClose(),this.transport.onerror=a=>this.onError(a),this.transport.onmessage=a=>{if("method"in a){this.onError(new oe({message:"Unsupported message type"}));return}this.onResponse(a)},this.clientInfo={name:t,version:Wl}}async init(){try{await this.transport.start(),this.isClosed=!1;const e=await this.request({request:{method:"initialize",params:{protocolVersion:On,capabilities:{},clientInfo:this.clientInfo}},resultSchema:Cl});if(e===void 0)throw new oe({message:"Server sent invalid initialize result"});if(!El.includes(e.protocolVersion))throw new oe({message:`Server's protocol version is not supported: ${e.protocolVersion}`});return this.serverCapabilities=e.capabilities,await this.notification({method:"notifications/initialized"}),this}catch(e){throw await this.close(),e}}async close(){var e;this.isClosed||(await((e=this.transport)==null?void 0:e.close()),this.onClose())}assertCapability(e){switch(e){case"initialize":break;case"tools/list":case"tools/call":if(!this.serverCapabilities.tools)throw new oe({message:"Server does not support tools"});break;default:throw new oe({message:`Unsupported method: ${e}`})}}async request({request:e,resultSchema:t,options:r}){return new Promise((a,s)=>{if(this.isClosed)return s(new oe({message:"Attempted to send a request from a closed client"}));this.assertCapability(e.method);const n=r==null?void 0:r.signal;n==null||n.throwIfAborted();const o=this.requestMessageId++,i={...e,jsonrpc:"2.0",id:o},u=()=>{this.responseHandlers.delete(o)};this.responseHandlers.set(o,l=>{if(n!=null&&n.aborted)return s(new oe({message:"Request was aborted",cause:n.reason}));if(l instanceof Error)return s(l);try{const c=t.parse(l.result);a(c)}catch(c){const p=new oe({message:"Failed to parse server response",cause:c});s(p)}}),this.transport.send(i).catch(l=>{u(),s(l)})})}async listTools({params:e,options:t}={}){try{return this.request({request:{method:"tools/list",params:e},resultSchema:Nl,options:t})}catch(r){throw r}}async callTool({name:e,args:t,options:r}){try{return this.request({request:{method:"tools/call",params:{name:e,arguments:t}},resultSchema:Ul,options:{signal:r==null?void 0:r.abortSignal}})}catch(a){throw a}}async notification(e){const t={...e,jsonrpc:"2.0"};await this.transport.send(t)}async tools({schemas:e="automatic"}={}){var t;const r={};try{const a=await this.listTools();for(const{name:s,description:n,inputSchema:o}of a.tools){if(e!=="automatic"&&!(s in e))continue;const i=e==="automatic"?da({...o,properties:(t=o.properties)!=null?t:{},additionalProperties:!1}):e[s].parameters,u=this,l={description:n,parameters:i,execute:async(c,p)=>{var d;return(d=p==null?void 0:p.abortSignal)==null||d.throwIfAborted(),u.callTool({name:s,args:c,options:p})}};r[s]=l}return r}catch(a){throw a}}onClose(){if(this.isClosed)return;this.isClosed=!0;const e=new oe({message:"Connection closed"});for(const t of this.responseHandlers.values())t(e);this.responseHandlers.clear()}onError(e){this.onUncaughtError&&this.onUncaughtError(e)}onResponse(e){const t=Number(e.id),r=this.responseHandlers.get(t);if(r===void 0)throw new oe({message:`Protocol error: Received a response for an unknown message ID: ${JSON.stringify(e)}`});this.responseHandlers.delete(t),r("result"in e?e:new oe({message:e.error.message,cause:e.error}))}};function ku(e,t,r){if(e.length!==t.length)throw new J({parameter:"vector1,vector2",value:{vector1Length:e.length,vector2Length:t.length},message:"Vectors must have the same length"});const a=e.length;if(a===0){if(r!=null&&r.throwErrorForEmptyVectors)throw new J({parameter:"vector1",value:e,message:"Vectors cannot be empty"});return 0}let s=0,n=0,o=0;for(let i=0;i<a;i++){const u=e[i],l=t[i];s+=u*u,n+=l*l,o+=u*l}return s===0||n===0?0:o/(Math.sqrt(s)*Math.sqrt(n))}function Mu({chunks:e,initialDelayInMs:t=0,chunkDelayInMs:r=0,_internal:a}){var s;const n=(s=a==null?void 0:a.delay)!=null?s:Ir;let o=0;return new ReadableStream({async pull(i){o<e.length?(await n(o===0?t:r),i.enqueue(e[o++])):i.close()}})}function Nu({threadId:e,messageId:t},r){const a=new ReadableStream({async start(s){var n;const o=new TextEncoder,i=p=>{s.enqueue(o.encode(lt("assistant_message",p)))},u=p=>{s.enqueue(o.encode(lt("data_message",p)))},l=p=>{s.enqueue(o.encode(lt("error",p)))},c=async p=>{var d,h;let y;for await(const v of p)switch(v.event){case"thread.message.created":{s.enqueue(o.encode(lt("assistant_message",{id:v.data.id,role:"assistant",content:[{type:"text",text:{value:""}}]})));break}case"thread.message.delta":{const g=(d=v.data.delta.content)==null?void 0:d[0];(g==null?void 0:g.type)==="text"&&((h=g.text)==null?void 0:h.value)!=null&&s.enqueue(o.encode(lt("text",g.text.value)));break}case"thread.run.completed":case"thread.run.requires_action":{y=v.data;break}}return y};s.enqueue(o.encode(lt("assistant_control_data",{threadId:e,messageId:t})));try{await r({sendMessage:i,sendDataMessage:u,forwardStream:c})}catch(p){l((n=p.message)!=null?n:`${p}`)}finally{s.close()}},pull(s){},cancel(){}});return new Response(a,{status:200,headers:{"Content-Type":"text/plain; charset=utf-8"}})}var Yl={};Mr(Yl,{mergeIntoDataStream:()=>Ql,toDataStream:()=>Hl,toDataStreamResponse:()=>Xl});function Dn(e={}){const t=new TextEncoder;let r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,s){s.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&typeof a=="string"&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function Dr(e,t){return e.pipeThrough(new TransformStream({transform:async(r,a)=>{var s;if(typeof r=="string"){a.enqueue(r);return}if("event"in r){r.event==="on_chat_model_stream"&&aa((s=r.data)==null?void 0:s.chunk,a);return}aa(r,a)}})).pipeThrough(Dn(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,a)=>{a.enqueue(G("text",r))}}))}function Hl(e,t){return Dr(e,t).pipeThrough(new TextEncoderStream)}function Xl(e,t){var r;const a=Dr(e,t==null?void 0:t.callbacks).pipeThrough(new TextEncoderStream),s=t==null?void 0:t.data,n=t==null?void 0:t.init,o=s?Or(s.stream,a):a;return new Response(o,{status:(r=n==null?void 0:n.status)!=null?r:200,statusText:n==null?void 0:n.statusText,headers:at(n==null?void 0:n.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Ql(e,t){t.dataStream.merge(Dr(e,t.callbacks))}function aa(e,t){if(typeof e.content=="string")t.enqueue(e.content);else{const r=e.content;for(const a of r)a.type==="text"&&t.enqueue(a.text)}}var eu={};Mr(eu,{mergeIntoDataStream:()=>au,toDataStream:()=>tu,toDataStreamResponse:()=>ru});function qr(e,t){const r=nu();return Wn(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(a,s){s.enqueue(r(a.delta))}})).pipeThrough(Dn(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(a,s)=>{s.enqueue(G("text",a))}}))}function tu(e,t){return qr(e,t).pipeThrough(new TextEncoderStream)}function ru(e,t={}){var r;const{init:a,data:s,callbacks:n}=t,o=qr(e,n).pipeThrough(new TextEncoderStream),i=s?Or(s.stream,o):o;return new Response(i,{status:(r=a==null?void 0:a.status)!=null?r:200,statusText:a==null?void 0:a.statusText,headers:at(a==null?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function au(e,t){t.dataStream.merge(qr(e,t.callbacks))}function nu(){let e=!0;return t=>(e&&(t=t.trimStart(),t&&(e=!1)),t)}var Ou=class{constructor(){this.encoder=new TextEncoder,this.controller=null,this.isClosed=!1,this.warningTimeout=null;const e=this;this.stream=new ReadableStream({start:async t=>{e.controller=t},pull:t=>{},cancel:t=>{this.isClosed=!0}})}async close(){if(this.isClosed)throw new Error("Data Stream has already been closed.");if(!this.controller)throw new Error("Stream controller is not initialized.");this.controller.close(),this.isClosed=!0,this.warningTimeout&&clearTimeout(this.warningTimeout)}append(e){if(this.isClosed)throw new Error("Data Stream has already been closed.");if(!this.controller)throw new Error("Stream controller is not initialized.");this.controller.enqueue(this.encoder.encode(G("data",[e])))}appendMessageAnnotation(e){if(this.isClosed)throw new Error("Data Stream has already been closed.");if(!this.controller)throw new Error("Stream controller is not initialized.");this.controller.enqueue(this.encoder.encode(G("message_annotations",[e])))}};export{M as AISDKError,Bn as APICallError,Nu as AssistantResponse,dr as DownloadError,qu as EmptyResponseBodyError,J as InvalidArgumentError,Xr as InvalidDataContentError,li as InvalidMessageRoleError,Ge as InvalidPromptError,$u as InvalidResponseDataError,tl as InvalidStreamPartError,hn as InvalidToolArgumentsError,zn as JSONParseError,Yl as LangChainAdapter,eu as LlamaIndexAdapter,Uu as LoadAPIKeyError,oe as MCPClientError,mr as MessageConversionError,Fu as NoContentGeneratedError,Xo as NoImageGeneratedError,Je as NoObjectGeneratedError,sn as NoOutputSpecifiedError,ze as NoSuchModelError,Sl as NoSuchProviderError,_r as NoSuchToolError,Qi as Output,Yr as RetryError,Ou as StreamData,Wi as ToolCallRepairError,cn as ToolExecutionError,Rt as TypeValidationError,Zt as UnsupportedFunctionalityError,Le as UnsupportedModelVersionError,Iu as appendClientMessage,Eu as appendResponseMessages,fi as convertToCoreMessages,Si as coreAssistantMessageSchema,Ii as coreMessageSchema,_i as coreSystemMessageSchema,Ti as coreToolMessageSchema,xi as coreUserMessageSchema,ku as cosineSimilarity,wa as createDataStream,uu as createDataStreamResponse,ft as createIdGenerator,Tl as createProviderRegistry,_l as customProvider,_u as defaultSettingsMiddleware,pu as embed,du as embedMany,Cu as experimental_createMCPClient,Au as experimental_createProviderRegistry,Ru as experimental_customProvider,mu as experimental_generateImage,wu as experimental_generateSpeech,bu as experimental_transcribe,Tu as experimental_wrapLanguageModel,xu as extractReasoningMiddleware,lt as formatAssistantStreamPart,G as formatDataStreamPart,Ln as generateId,fu as generateObject,hu as generateText,da as jsonSchema,ou as parseAssistantStreamPart,eo as parseDataStreamPart,cu as pipeDataStreamToResponse,iu as processDataStream,lu as processTextStream,Mu as simulateReadableStream,Su as simulateStreamingMiddleware,yu as smoothStream,gu as streamObject,vu as streamText,Pu as tool,wl as wrapLanguageModel,no as zodSchema};
